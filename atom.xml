<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GZ</title>
  
  <subtitle>痛苦是财富，这话是扯淡。少年，痛苦就是痛苦，对痛苦的思考才是财富</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://gongzhao1.coding.me/"/>
  <updated>2020-07-02T15:49:46.947Z</updated>
  <id>https://gongzhao1.coding.me/</id>
  
  <author>
    <name>弓昭</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nginx之多级证书的双向认证</title>
    <link href="https://gongzhao1.coding.me/Nginx%E4%B9%8B%E5%A4%9A%E7%BA%A7%E8%AF%81%E4%B9%A6%E7%9A%84%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/"/>
    <id>https://gongzhao1.coding.me/Nginx之多级证书的双向认证/</id>
    <published>2020-07-02T15:35:28.000Z</published>
    <updated>2020-07-02T15:49:46.947Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-准备"><a href="#1-准备" class="headerlink" title="1 准备"></a>1 准备</h1><p>请参考我之前的博客准备好三级证书</p><h1 id="2-Nginx配置文件"><a href="#2-Nginx配置文件" class="headerlink" title="2 Nginx配置文件"></a>2 Nginx配置文件</h1><p>将生成的证书，组成证书链（三级证书链，从上至下顺序，最上面为第三级证书）</p><p>server-chain.pem</p><blockquote><p>rootca-&gt;secondca-&gt;server</p></blockquote><p>client-chain.pem：</p><blockquote><p>rootca-&gt;clientca</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate         /etc/nginx/ssl/server-chain.pem;</span><br><span class="line">        ssl_certificate_key     /etc/nginx/ssl/server.key;</span><br><span class="line">        ssl_verify_client       on;</span><br><span class="line">        ssl_client_certificate  /etc/nginx/ssl/client-chain.pem;</span><br><span class="line">        ssl_verify_depth        5;</span><br><span class="line">        server_name test.com;</span><br><span class="line">        listen 443 default_server deferred;</span><br><span class="line"></span><br><span class="line">        error_log /var/log/nginx/ssl_auth_error.log debug;</span><br><span class="line">        access_log /var/log/nginx/ssl_auth_access.log;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                #proxy_pass http://test;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为要使用双向认证，所以需要生成客户端证书，因为客户端证书链是由rootca和clientca组成，所以客户端证书可以由这两个证书中的任意一个去生成。</p><p>这里我们用clientca去生成了一个device的证书，分别是device.pem和device.key</p><a id="more"></a><h1 id="3-测试方法"><a href="#3-测试方法" class="headerlink" title="3 测试方法"></a>3 测试方法</h1><h2 id="3-1-curl"><a href="#3-1-curl" class="headerlink" title="3.1 curl"></a>3.1 curl</h2><p>curl命令有可能会因为一些环境而导致执行结果不同，不建议使用curl去测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --cacert trusted-chain.pem --cert device.pem --key device.key https://test.com</span><br></pre></td></tr></table></figure><p>trusted-chain.pem</p><blockquote><p>rootca-&gt;secondca</p></blockquote><h2 id="3-2-openssl-s-client"><a href="#3-2-openssl-s-client" class="headerlink" title="3.2 openssl s_client"></a>3.2 openssl s_client</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect test.com:443 -cert device.pem -key device.key -CAfile trusted-chain.pem</span><br><span class="line">.....</span><br><span class="line">GET /</span><br></pre></td></tr></table></figure><h2 id="3-3-Postman"><a href="#3-3-Postman" class="headerlink" title="3.3 Postman"></a>3.3 Postman</h2><p>略</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-准备&quot;&gt;&lt;a href=&quot;#1-准备&quot; class=&quot;headerlink&quot; title=&quot;1 准备&quot;&gt;&lt;/a&gt;1 准备&lt;/h1&gt;&lt;p&gt;请参考我之前的博客准备好三级证书&lt;/p&gt;
&lt;h1 id=&quot;2-Nginx配置文件&quot;&gt;&lt;a href=&quot;#2-Nginx配置文件&quot; class=&quot;headerlink&quot; title=&quot;2 Nginx配置文件&quot;&gt;&lt;/a&gt;2 Nginx配置文件&lt;/h1&gt;&lt;p&gt;将生成的证书，组成证书链（三级证书链，从上至下顺序，最上面为第三级证书）&lt;/p&gt;
&lt;p&gt;server-chain.pem&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rootca-&amp;gt;secondca-&amp;gt;server&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;client-chain.pem：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rootca-&amp;gt;clientca&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_certificate         /etc/nginx/ssl/server-chain.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_certificate_key     /etc/nginx/ssl/server.key;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_verify_client       on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_client_certificate  /etc/nginx/ssl/client-chain.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_verify_depth        5;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        server_name test.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listen 443 default_server deferred;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        error_log /var/log/nginx/ssl_auth_error.log debug;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        access_log /var/log/nginx/ssl_auth_access.log;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                #proxy_pass http://test;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;因为要使用双向认证，所以需要生成客户端证书，因为客户端证书链是由rootca和clientca组成，所以客户端证书可以由这两个证书中的任意一个去生成。&lt;/p&gt;
&lt;p&gt;这里我们用clientca去生成了一个device的证书，分别是device.pem和device.key&lt;/p&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginx之SSL配置项解析</title>
    <link href="https://gongzhao1.coding.me/Nginx%E4%B9%8BSSL%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%A7%A3%E6%9E%90/"/>
    <id>https://gongzhao1.coding.me/Nginx之SSL配置项解析/</id>
    <published>2020-07-02T15:09:31.000Z</published>
    <updated>2020-07-02T15:22:54.352Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h1><ul><li>ssl_certificate 证书其实是个公钥，它会被发送到连接服务器的每个客户端</li><li>ssl_certificate_key 私钥是用来解密的，所以它的权限要得到保护但nginx的主进程能够读取。</li><li>ssl_session_timeout  客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</li><li>ssl_session_cache shared:SSL:10m; : 设置ssl/tls会话缓存的类型和大小。<ul><li>shared 所有工作进程之间共享缓存。缓存大小以字节为单位指定；一兆字节可以存储大约4000个session。每个共享缓存都应该有一个任意名称。具有相同名称的缓存可以用于多个虚拟服务器。</li><li>off 严禁使用session缓存：nginx明确告诉客户端session可能不会被重用。</li><li>none session缓存的使用被禁止：nginx告诉客户端session可能会被重用，但实际上并不会将session参数存储在缓存中。</li><li>builtin 在OpenSSL中构建的缓存；仅由一个工作进程使用。缓存大小在session中指定。如果没有给出大小，则等于20480个会话。使用内置高速缓存可能导致内存碎片。</li><li>注意： builtin和shared可以同时使用，但是Nginx官方说只使用shared缓存，而不使用built-in缓存的性能应该会更高。配置案例：<br>ssl_session_cache builtin:1000 shared:SSL:10m;</li></ul></li><li>设置较长的keepalive_timeout也可以减少请求ssl会话协商的开销，但同时得考虑线程的并发数了。</li><li>ssl_protocols指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。</li><li>ssl_ciphers选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher ‘RC4:HIGH:!aNULL:!MD5’（后面是你所指定的套件加密算法） 来看所支持算法。<ul><li>加密套件 之间用冒号分隔，加密套件 前有感叹号的表示必须废弃。</li></ul></li><li>ssl_prefer_server_ciphers on设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</li></ul><a id="more"></a><h1 id="HSTS（HTTP-Strict-Transport-Security，严格传输安全）"><a href="#HSTS（HTTP-Strict-Transport-Security，严格传输安全）" class="headerlink" title="HSTS（HTTP Strict Transport Security，严格传输安全）"></a>HSTS（HTTP Strict Transport Security，严格传输安全）</h1><ul><li><p>HSTS 简单说就是在一定时间内强制客户端使用 HTTPS 访问页面。原理如下：</p><p>在服务器响应头中添加 Strict-Transport-Security，可以设置 max-age<br>用户访问时，服务器种下这个头<br>下次如果使用 HTTP 访问，只要 max-age 未过期，客户端会进行内部跳转，可以看到 307 Redirect Internel 的响应码（注意是客户端浏览器相应的，这里给服务器省下了一次 302 跳转）<br>变成 HTTPS 访问源服务器</p></li><li><p>这个过程有效避免了中间人对 80 端口的劫持。但是这里存在一个问题：如果用户在劫持状态，并且没有访问过源服务器，那么源服务器是没有办法给客户端种下 Strict-Transport-Security 响应头的（都被中间人挡下来了）。如何解决？</p></li><li><p>需要注意的是，只有启用 preload（预加载） 之后才是严格意义上安全的 HTTPS。否则都可能在最薄弱环节被攻破。比如：</p><ul><li>允许 SSL 连接但不强制从 HTTP 跳转到 HTTPS，用户访问 HTTP 被劫持</li><li>部署了 HSTS，但用户第一次访问是 HTTP 的，Strict-Transport-Security 的响应头没有作用的机会，还是被劫持。</li></ul></li></ul><h1 id="OSCP-Stapling"><a href="#OSCP-Stapling" class="headerlink" title="OSCP Stapling"></a>OSCP Stapling</h1><ul><li><p>当我们通过HTTPS访问网站的时候，客户端会通过证书颁发机构的证书吊销列表（CRL）或者数字证书在线状态协议(OCSP)记录验证网站服务器的证书是否有效。前一种验证方式是最低效的，CA会不断向CRL文件添加证书吊销记录，CRL文件就会变得越来越大，客户端在验证前就需要耗费越来越长的时间来下载CRL文件。</p></li><li><p>相比 CRL 验证方式，OCSP 就更加高效，OCSP 每次只查询并获取一条记录。然而这些默认查询 OCSP 的客户端在获得查询结果的响应前势必会一直阻塞后续的事件，在网络情况堪忧的情况下（尤其是大陆地区）会造成较长时间的页面空白。并且一旦有黑客或者组织对CA的OCSP发动DDos攻击（分布式拒绝攻击），客户端便无法从 OCSP 服务器获取查询结果并完成证书验证, 客户端就可能会提示网站不受信任。</p></li><li><p>而 OCSP Stapling ，顾名思义，是将查询 OCSP 接口的工作交给服务器来做，服务器除了可以直接查询 OCSP 信息，还可以仅进行少数次查询并将响应缓存起来。当有客户端向服务器发起 TLS 握手请求时，服务器将证书的 OCSP 信息随证书链一同发送给客户端，从而避免了客户端验证会产生的阻塞问题。由于 OCSP 响应是无法伪造的，因此这一过程也不会产生额外的安全问题。</p></li><li><p>值得注意的是：Nginx会在客户端的HELLO握手信息中返回OCSP记录，并且只有当客户端对Nginx发出OCSP信息请求的情况下，Nginx才会发送缓存的OCSP 权威记录到客户端。</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ssl_stapling on;</span><br><span class="line"># OCSP Stapling 开启。OCSP是用于在线查询证书吊销情况的服务，使用OCSP Stapling能将证书有效状态的信息缓存到服务器，提高 TLS 握手速度</span><br><span class="line"> </span><br><span class="line">ssl_stapling_verify on; </span><br><span class="line"># OCSP Stapling 验证开启</span><br><span class="line"> </span><br><span class="line">ssl_trusted_certificate /etc/nginx/cert/trustchain.crt; </span><br><span class="line"># OCSP Stapling 的证书位置（完整的证书链）</span><br><span class="line"> </span><br><span class="line">resolver 233.5.5.5 233.6.6.6 valid=300s; </span><br><span class="line"># 用于查询 OCSP 服务器的DNS</span><br><span class="line"> </span><br><span class="line">resolver_timeout 5s;</span><br><span class="line">#查询域名超时时间</span><br></pre></td></tr></table></figure><h1 id="缓存连接凭据"><a href="#缓存连接凭据" class="headerlink" title="缓存连接凭据"></a>缓存连接凭据</h1><ul><li>缓存 SSL 连接凭据可以避免频繁握手带来的速度降低和性能损耗。</li><li>TLS 协议有两类会话缓存机制：会话标识 session ID 与会话记录 session ticket。session ID 由服务器端支持，协议中的标准字段，因此基本所有服务器都支持，服务器端保存会话ID以及协商的通信信息，Nginx 中1M 内存约可以保存4000个 session ID 机器相关信息，占用服务器资源较多；而 session ticket 属于一个 TLS 扩展字段，需要服务器和客户端都支持。</li><li>二者对比，主要是保存协商信息的位置与方式不同，类似与 HTTP 中的 session 与 cookie。都存在的情况下，Nginx 优先使用 session_ticket。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_cache shared:SSL:20m; </span><br><span class="line"># SSL session 缓存区大小</span><br><span class="line"># 这条语句加在server段里话，在SSL Lab的测试中识别不出来，因为它假设客户端不支持SNI协议，但实际上是可以加在server段的</span><br><span class="line"> </span><br><span class="line">ssl_session_tickets on;</span><br><span class="line"># 开启浏览器的 Session Ticket 缓存</span><br><span class="line"> </span><br><span class="line">ssl_session_timeout 60m; </span><br><span class="line"># 过期时间，分钟</span><br></pre></td></tr></table></figure><h1 id="301-跳转"><a href="#301-跳转" class="headerlink" title="301 跳转"></a>301 跳转</h1><p>跳转到https</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">    listen 80; </span><br><span class="line">    return 301 https://$host$request_uri; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="HTTP-2"><a href="#HTTP-2" class="headerlink" title="HTTP/2"></a>HTTP/2</h1><p>尽管 HTTP/2 协议本身并不要求一定开启 SSL，但大多数主流浏览器要求一定要启用 SSL 才能使用 HTTP/2。要使用 HTTP/2，把 listen directive 改成 listen 443 ssl http2 即可。HTTP/2 是 SPDY 的演进版本，性能上相比 HTTP 1.1 最主要的是增加了多路复用 multiplexing、header 压缩和二进制格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="双向认证配置proxy-ssl-verify-depth"><a href="#双向认证配置proxy-ssl-verify-depth" class="headerlink" title="双向认证配置proxy_ssl_verify_depth"></a>双向认证配置proxy_ssl_verify_depth</h1><blockquote><p>The depth actually is the maximum number of intermediate certificate issuers, i.e. the number of CA certificates which are max allowed to be followed while verifying the client certificate. A depth of 0 means that self-signed client certificates are accepted only, the default depth of 1 means the client certificate can be self-signed or has to be signed by a CA which is directly known to the server (i.e. the CA’s certificate is under SSLCACertificatePath), etc.</p></blockquote><p>当待验证的客户端证书是由intermediate-CA签发，而非有root-CA签发时，需要在proxy_ssl_trusted_certificate中配置intermediate-CA和root-CA组成的证书链文件<br>也就是说，直接尝试使用中级 CA 来验证客户端是无法通过的，openssl 会自动的去找中级 CA 的签发者一层层验证上去，直到找到根。</p><p>因此，在实际使用的时候，需要注意一下两点：</p><ul><li>CA 文件中必须同时存在 中级 CA 和 根 CA，必须构成完整证书链，不能少任何一个；</li><li>默认的验证深度 SslVerifyDepth ssl_verify_depth 是 1，也就是说只要是中级 CA 签发的客户端证书一律无法通过认证，需要增大该值。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;常见参数&quot;&gt;&lt;a href=&quot;#常见参数&quot; class=&quot;headerlink&quot; title=&quot;常见参数&quot;&gt;&lt;/a&gt;常见参数&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ssl_certificate 证书其实是个公钥，它会被发送到连接服务器的每个客户端&lt;/li&gt;
&lt;li&gt;ssl_certificate_key 私钥是用来解密的，所以它的权限要得到保护但nginx的主进程能够读取。&lt;/li&gt;
&lt;li&gt;ssl_session_timeout  客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。&lt;/li&gt;
&lt;li&gt;ssl_session_cache shared:SSL:10m; : 设置ssl/tls会话缓存的类型和大小。&lt;ul&gt;
&lt;li&gt;shared 所有工作进程之间共享缓存。缓存大小以字节为单位指定；一兆字节可以存储大约4000个session。每个共享缓存都应该有一个任意名称。具有相同名称的缓存可以用于多个虚拟服务器。&lt;/li&gt;
&lt;li&gt;off 严禁使用session缓存：nginx明确告诉客户端session可能不会被重用。&lt;/li&gt;
&lt;li&gt;none session缓存的使用被禁止：nginx告诉客户端session可能会被重用，但实际上并不会将session参数存储在缓存中。&lt;/li&gt;
&lt;li&gt;builtin 在OpenSSL中构建的缓存；仅由一个工作进程使用。缓存大小在session中指定。如果没有给出大小，则等于20480个会话。使用内置高速缓存可能导致内存碎片。&lt;/li&gt;
&lt;li&gt;注意： builtin和shared可以同时使用，但是Nginx官方说只使用shared缓存，而不使用built-in缓存的性能应该会更高。配置案例：&lt;br&gt;ssl_session_cache builtin:1000 shared:SSL:10m;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;设置较长的keepalive_timeout也可以减少请求ssl会话协商的开销，但同时得考虑线程的并发数了。&lt;/li&gt;
&lt;li&gt;ssl_protocols指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &amp;gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。&lt;/li&gt;
&lt;li&gt;ssl_ciphers选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher ‘RC4:HIGH:!aNULL:!MD5’（后面是你所指定的套件加密算法） 来看所支持算法。&lt;ul&gt;
&lt;li&gt;加密套件 之间用冒号分隔，加密套件 前有感叹号的表示必须废弃。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ssl_prefer_server_ciphers on设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>openssl生成多级证书</title>
    <link href="https://gongzhao1.coding.me/openssl%E7%94%9F%E6%88%90%E5%A4%9A%E7%BA%A7%E8%AF%81%E4%B9%A6/"/>
    <id>https://gongzhao1.coding.me/openssl生成多级证书/</id>
    <published>2020-07-02T14:19:25.000Z</published>
    <updated>2020-07-02T15:49:57.390Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/u010129119/article/details/53419581" target="_blank" rel="noopener">https://blog.csdn.net/u010129119/article/details/53419581</a></li><li><a href="https://www.jianshu.com/p/7d940d7a07d9" target="_blank" rel="noopener">https://www.jianshu.com/p/7d940d7a07d9</a></li></ul><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>Centos7.6</p><h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line"><span class="built_in">echo</span> 01 &gt; /etc/pki/CA/serial</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="制作证书"><a href="#制作证书" class="headerlink" title="制作证书"></a>制作证书</h1><h2 id="生成RootCA证书（Common-Name填RootCA）"><a href="#生成RootCA证书（Common-Name填RootCA）" class="headerlink" title="生成RootCA证书（Common Name填RootCA）"></a>生成RootCA证书（Common Name填RootCA）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out rootca.key 2048</span><br><span class="line"><span class="comment">#可以用openssl命令查看私钥的明细</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> rootca.key -noout -text</span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl req -new -x509 -days 3650 -key rootca.key -out rootca.crt -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=RootCA/emailAddress=rootca@world.com"</span></span><br><span class="line"><span class="comment">#查看生成的证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> rootca.crt -noout -text</span><br></pre></td></tr></table></figure><h2 id="生成二级CA证书（Common-Name填SecondCA）"><a href="#生成二级CA证书（Common-Name填SecondCA）" class="headerlink" title="生成二级CA证书（Common Name填SecondCA）"></a>生成二级CA证书（Common Name填SecondCA）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out secondca.key 2048</span><br><span class="line"><span class="comment">#生成证书签名请求</span></span><br><span class="line">openssl req -new -key secondca.key -out secondca.csr -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=SecondCA/emailAddress=secondca@world.com"</span></span><br><span class="line"><span class="comment">#通过openssl命令查看证书请求文件的明细</span></span><br><span class="line">openssl req -noout -text -<span class="keyword">in</span> secondca.csr</span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl ca -extensions v3_ca -<span class="keyword">in</span> secondca.csr -out secondca.crt -cert rootca.crt -keyfile rootca.key -days 3650</span><br></pre></td></tr></table></figure><h2 id="生成服务器证书（Common-Name填真实域名）"><a href="#生成服务器证书（Common-Name填真实域名）" class="headerlink" title="生成服务器证书（Common Name填真实域名）"></a>生成服务器证书（Common Name填真实域名）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line"><span class="comment">#生成证书签名请求</span></span><br><span class="line">openssl req -new -key serve.key -out server.csr -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=test.com/emailAddress=test@world.com"</span></span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl ca -<span class="keyword">in</span> server.csr -out server.crt -cert secondca.crt -keyfile secondca.key -days 3650</span><br></pre></td></tr></table></figure><p>P.S.</p><ul><li><p>指定证书内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-subj /C=CN/ST=Guangdong/L=Shenzhen/O=PAX/OU=Common Software/CN=Server CA/emailAddress=qiaojx@paxsz.com</span><br></pre></td></tr></table></figure></li><li><p>去掉key加密的输入提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">去掉 -des3</span><br><span class="line">openssl genrsa -des3 -out server.key 2048</span><br></pre></td></tr></table></figure></li><li><p>crt转pem格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> mycert.crt -out mycert.pem -outform PEM</span><br></pre></td></tr></table></figure></li></ul><h1 id="吊销证书"><a href="#吊销证书" class="headerlink" title="吊销证书"></a>吊销证书</h1><p>一般由于用户私钥泄露等情况才需要吊销一个未过期的证书。（当然我们用本测试CA时其时很少用到该命令，除非专门用于测试吊销证书的情况）<br>假设需要被吊销的证书文件为client.pem，则执行以下命令吊销证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 00 &gt; /etc/pki/CA/crlnumber</span><br><span class="line">openssl ca -revoke client.pem -cert RootCA.pem -keyfile RootCA.key -config /etc/pki/tls/openssl.cnf</span><br></pre></td></tr></table></figure><p>生成证书吊销列表文件（CRL）<br>准备公开被吊销的证书列表时，可以生成证书吊销列表（CRL），执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -gencrl -out client.crl -cert RootCA.pem -keyfile RootCA.key -config /etc/pki/tls/openssl.cnf</span><br></pre></td></tr></table></figure><p>还可以添加-crldays和-crlhours参数来说明下一个吊销列表将在多少天后（或多少小时候）发布。</p><p>可以用以下命令检查client.crl的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl crl -<span class="keyword">in</span> client.crl -text -noout</span><br></pre></td></tr></table></figure><h1 id="使用X509生成pem格式证书"><a href="#使用X509生成pem格式证书" class="headerlink" title="使用X509生成pem格式证书"></a>使用X509生成pem格式证书</h1><h2 id="生成CA证书"><a href="#生成CA证书" class="headerlink" title="生成CA证书"></a>生成CA证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out rootca.key 2048</span><br><span class="line">openssl req -new -x509 -days 365 -key rootca.key -out rootca.crt -subj <span class="string">"/C=CN/ST=BJ/L=BJ/O=HD/OU=dev/CN=rootca/emailAddress=rootca@world.com"</span></span><br></pre></td></tr></table></figure><h2 id="生成服务器证书请求"><a href="#生成服务器证书请求" class="headerlink" title="生成服务器证书请求"></a>生成服务器证书请求</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line">openssl req -new -key server.key -out server.csr -subj <span class="string">"/C=CN/ST=BJ/L=BJ/O=HD/OU=dev/CN=test.com/emailAddress=test@world.com"</span></span><br></pre></td></tr></table></figure><h2 id="签署证书"><a href="#签署证书" class="headerlink" title="签署证书"></a>签署证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 3650 -<span class="keyword">in</span> server.csr -CA rootca.crt -CAkey rootca.key -CAcreateserial -out server.pem</span><br><span class="line">openssl x509 -<span class="keyword">in</span> server.pem -noout -text</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/u010129119/article/details/53419581&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/u010129119/article/details/53419581&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/7d940d7a07d9&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/7d940d7a07d9&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;Centos7.6&lt;/p&gt;
&lt;h1 id=&quot;初始化&quot;&gt;&lt;a href=&quot;#初始化&quot; class=&quot;headerlink&quot; title=&quot;初始化&quot;&gt;&lt;/a&gt;初始化&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;touch /etc/pki/CA/index.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; 01 &amp;gt; /etc/pki/CA/serial&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="openssl" scheme="https://gongzhao1.coding.me/categories/openssl/"/>
    
    
      <category term="openssl" scheme="https://gongzhao1.coding.me/tags/openssl/"/>
    
  </entry>
  
  <entry>
    <title>Nginx优化</title>
    <link href="https://gongzhao1.coding.me/Nginx%E4%BC%98%E5%8C%96/"/>
    <id>https://gongzhao1.coding.me/Nginx优化/</id>
    <published>2020-07-02T14:02:06.000Z</published>
    <updated>2020-07-02T14:18:46.112Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Nginx优化之worker-processes-worker-connections"><a href="#1-Nginx优化之worker-processes-worker-connections" class="headerlink" title="1 Nginx优化之worker_processes,worker_connections"></a>1 Nginx优化之worker_processes,worker_connections</h1><p>worker_processes与worker_connections 设置好合适大小，可以提示nginx处理性能，非常重要。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">原作者的话：</span><br><span class="line">As a general rule you need the only worker with large number of worker_connections, say 10,000 or 20,000.</span><br><span class="line">However, if nginx does CPU-intensive work as SSL or gzipping and you have 2 or more CPU, then you may </span><br><span class="line">set worker_processes to be equal to CPU number.</span><br><span class="line">Besides, if you serve many static files and the total size of the files is bigger than memory, then you may </span><br><span class="line">increase worker_processes to utilize a full disk bandwidth.</span><br><span class="line">Igor Sysoev</span><br><span class="line"></span><br><span class="line">翻译：</span><br><span class="line">一般一个进程足够了，你可以把连接数设得很大。（worker_processes: 1，worker_connections: 10,000）</span><br><span class="line">如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。(worker_processes: CPU核心数)</span><br><span class="line">或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）</span><br></pre></td></tr></table></figure><p><strong>worker_processes，工作进程数</strong></p><ol><li>默认：worker_processes: 1</li><li>调大：worker_processes: CPU核心数，(双核4线程，可以设置为4)</li></ol><p><strong>worker_connections，单个工作进程可以允许同时建立外部连接的数量</strong><br>数字越大，能同时处理的连接越多</p><ol><li>默认：worker_connections: 1024</li><li>调大：worker_connections: 100000，（调大到10万连接）</li></ol><p><strong>worker_connections解析</strong></p><ol><li>connections不是随便设置的，而是与两个指标有重要关联，一是内存，二是操作系统级别的“进程最大可打开文件数”。</li><li>内存：每个连接数分别对应一个read_event、一个write_event事件，一个连接数大概占用232字节，2个事件总占用96字节，那么一个连接总共占用328字节，通过数学公式可以算出100000个连接数大概会占用 31M = 100000 * 328 / 1024 / 1024，当然这只是nginx启动时，connections连接数所占用的nginx。</li><li>进程最大可打开文件数：进程最大可打开文件数受限于操作系统，可通过 ulimit -n 命令查询，以前是1024，现在是65535,<br>nginx提供了worker_rlimit_nofile指令，这是除了ulimit的一种设置可用的描述符的方式。 该指令与使用ulimit对用户的设置是同样的效果。此指令的值将覆盖ulimit的值，如：worker_rlimit_nofile 20960;<br>设置ulimits：ulimit -SHn 65535</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 2; </span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line">#pid logs/nginx.pid; </span><br><span class="line">events &#123; </span><br><span class="line">   worker_connections 65535; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-Nginx优化之worker-processes-worker-connections&quot;&gt;&lt;a href=&quot;#1-Nginx优化之worker-processes-worker-connections&quot; class=&quot;headerlink&quot; title=&quot;1 Nginx优化之worker_processes,worker_connections&quot;&gt;&lt;/a&gt;1 Nginx优化之worker_processes,worker_connections&lt;/h1&gt;&lt;p&gt;worker_processes与worker_connections 设置好合适大小，可以提示nginx处理性能，非常重要。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;原作者的话：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;As a general rule you need the only worker with large number of worker_connections, say 10,000 or 20,000.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;However, if nginx does CPU-intensive work as SSL or gzipping and you have 2 or more CPU, then you may &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set worker_processes to be equal to CPU number.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Besides, if you serve many static files and the total size of the files is bigger than memory, then you may &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;increase worker_processes to utilize a full disk bandwidth.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Igor Sysoev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;翻译：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;一般一个进程足够了，你可以把连接数设得很大。（worker_processes: 1，worker_connections: 10,000）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。(worker_processes: CPU核心数)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;worker_processes，工作进程数&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;默认：worker_processes: 1&lt;/li&gt;
&lt;li&gt;调大：worker_processes: CPU核心数，(双核4线程，可以设置为4)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;worker_connections，单个工作进程可以允许同时建立外部连接的数量&lt;/strong&gt;&lt;br&gt;数字越大，能同时处理的连接越多&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;默认：worker_connections: 1024&lt;/li&gt;
&lt;li&gt;调大：worker_connections: 100000，（调大到10万连接）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;worker_connections解析&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;connections不是随便设置的，而是与两个指标有重要关联，一是内存，二是操作系统级别的“进程最大可打开文件数”。&lt;/li&gt;
&lt;li&gt;内存：每个连接数分别对应一个read_event、一个write_event事件，一个连接数大概占用232字节，2个事件总占用96字节，那么一个连接总共占用328字节，通过数学公式可以算出100000个连接数大概会占用 31M = 100000 * 328 / 1024 / 1024，当然这只是nginx启动时，connections连接数所占用的nginx。&lt;/li&gt;
&lt;li&gt;进程最大可打开文件数：进程最大可打开文件数受限于操作系统，可通过 ulimit -n 命令查询，以前是1024，现在是65535,&lt;br&gt;nginx提供了worker_rlimit_nofile指令，这是除了ulimit的一种设置可用的描述符的方式。 该指令与使用ulimit对用户的设置是同样的效果。此指令的值将覆盖ulimit的值，如：worker_rlimit_nofile 20960;&lt;br&gt;设置ulimits：ulimit -SHn 65535&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;worker_processes 2; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;worker_rlimit_nofile 65535;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#pid logs/nginx.pid; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;events &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   worker_connections 65535; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.coding.me/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>maven之settings.xml</title>
    <link href="https://gongzhao1.coding.me/maven%E4%B9%8Bsettings-xml/"/>
    <id>https://gongzhao1.coding.me/maven之settings-xml/</id>
    <published>2020-05-24T15:03:37.000Z</published>
    <updated>2020-05-24T15:37:38.860Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://www.cnblogs.com/wdliu/p/8312543.html" target="_blank" rel="noopener">https://www.cnblogs.com/wdliu/p/8312543.html</a></li></ul><h1 id="1-settings-xml详解"><a href="#1-settings-xml详解" class="headerlink" title="1 settings.xml详解"></a>1 settings.xml详解</h1><h2 id="1-1-声明规范"><a href="#1-1-声明规范" class="headerlink" title="1.1 声明规范"></a>1.1 声明规范</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-2-localRepository"><a href="#1-2-localRepository" class="headerlink" title="1.2 localRepository"></a>1.2 localRepository</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 本地仓库的路径。默认值为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/opt/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-3-interactiveMode"><a href="#1-3-interactiveMode" class="headerlink" title="1.3 interactiveMode"></a>1.3 interactiveMode</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Maven是否需要和用户交互以获得输入。如果Maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interactiveMode</span>&gt;</span>true<span class="tag">&lt;/<span class="name">interactiveMode</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-4-usePluginRegistry"><a href="#1-4-usePluginRegistry" class="headerlink" title="1.4 usePluginRegistry"></a>1.4 usePluginRegistry</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Maven是否需要使用plugin-registry.xml文件来管理插件版本。如果需要让Maven使用文件来管理插件版本，则设为true。默认为false。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">usePluginRegistry</span>&gt;</span>false<span class="tag">&lt;/<span class="name">usePluginRegistry</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-5-offline"><a href="#1-5-offline" class="headerlink" title="1.5 offline"></a>1.5 offline</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--表示Maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认为false。当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">offline</span>&gt;</span>false<span class="tag">&lt;/<span class="name">offline</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="1-6-pluginGroups"><a href="#1-6-pluginGroups" class="headerlink" title="1.6 pluginGroups"></a>1.6 pluginGroups</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--当插件的组织Id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。该元素包含一个pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。当我们使用某个插件，并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。默认情况下该列表包含了org.apache.maven.plugins和org.codehaus.mojo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--plugin的组织Id（groupId） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-7-proxies"><a href="#1-7-proxies" class="headerlink" title="1.7 proxies"></a>1.7 proxies</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用来配置不同的代理，多代理profiles 可以应对笔记本或移动设备的工作环境：通过简单的设置profile id就可以很容易的更换整个代理配置。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--代理元素包含配置代理时需要的信息--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的唯一定义符，用来区分不同的代理元素。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>myproxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该代理是否是激活的那个。true则激活代理。当我们声明了一组代理，而某个时候只需要激活一个代理的时候，该元素就可以派上用处。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的协议。 协议://主机名:端口，分隔成离散的元素以方便配置。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>http<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的主机名。协议://主机名:端口，分隔成离散的元素以方便配置。  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">host</span>&gt;</span>proxy.somewhere.com<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的端口。协议://主机名:端口，分隔成离散的元素以方便配置。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的用户名，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">username</span>&gt;</span>proxyuser<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的密码，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">password</span>&gt;</span>somepassword<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--不该被代理的主机名列表。该列表的分隔符由代理服务器指定；例子中使用了竖线分隔符，使用逗号分隔也很常见。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>*.google.com|ibiblio.org<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-8-servers"><a href="#1-8-servers" class="headerlink" title="1.8 servers"></a>1.8 servers</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置服务端的一些设置。一些设置如安全证书不应该和pom.xml一起分发。这种类型的信息应该存在于构建服务器上的settings.xml文件中。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--服务器元素包含配置服务器时需要的信息 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--这是server的id（注意不是用户登陆的id），该id与distributionManagement中repository元素的id相匹配。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>server001<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权用户名。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">username</span>&gt;</span>my_login<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权密码 。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。密码加密功能已被添加到2.1.0 +。详情请访问密码加密页面--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">password</span>&gt;</span>my_password<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权时使用的私钥位置。和前两个元素类似，私钥位置和私钥密码指定了一个私钥的路径（默认是$&#123;user.home&#125;/.ssh/id_dsa）以及如果需要的话，一个密语。将来passphrase和password元素可能会被提取到外部，但目前它们必须在settings.xml文件以纯文本的形式声明。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">privateKey</span>&gt;</span>$&#123;usr.home&#125;/.ssh/id_dsa<span class="tag">&lt;/<span class="name">privateKey</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权时使用的私钥密码。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">passphrase</span>&gt;</span>some_passphrase<span class="tag">&lt;/<span class="name">passphrase</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--文件被创建时的权限。如果在部署的时候会创建一个仓库文件或者目录，这时候就可以使用权限（permission）。这两个元素合法的值是一个三位数字，其对应了unix文件系统的权限，如664，或者775。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filePermissions</span>&gt;</span>664<span class="tag">&lt;/<span class="name">filePermissions</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--目录被创建时的权限。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directoryPermissions</span>&gt;</span>775<span class="tag">&lt;/<span class="name">directoryPermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-9-mirrors"><a href="#1-9-mirrors" class="headerlink" title="1.9 mirrors"></a>1.9 mirrors</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--为仓库列表配置的下载镜像列表。高级设置请参阅镜像设置页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--给定仓库的下载镜像。 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该镜像的唯一标识符。id用来区分不同的mirror元素。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>planetmirror.com<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--镜像名称 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>PlanetMirror Australia<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该镜像的URL。构建系统会优先考虑使用该URL，而非使用默认的服务器URL。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://downloads.planetmirror.com/pub/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--被镜像的服务器的id。例如，如果我们要设置了一个Maven中央仓库（http://repo.maven.apache.org/maven2/）的镜像，就需要将该元素设置成central。这必须和中央仓库的id central完全一致。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-10-profiles"><a href="#1-10-profiles" class="headerlink" title="1.10 profiles"></a>1.10 profiles</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据环境参数来调整构建配置的列表。settings.xml中的profile元素是pom.xml中profile元素的裁剪版本。它包含了id，activation, repositories, pluginRepositories和 properties元素。这里的profile元素只包含这五个子元素是因为这里只关心构建系统这个整体（这正是settings.xml文件的角色定位），而非单独的项目对象模型设置。如果一个settings中的profile被激活，它的值会覆盖任何其它定义在POM中或者profile.xml中的带有相同id的profile。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--根据环境参数来调整的构件的配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该配置的唯一标识符。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-11-Activation"><a href="#1-11-Activation" class="headerlink" title="1.11 Activation"></a>1.11 Activation</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙。如POM中的profile一样，profile的力量来自于它能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式。settings.xml文件中的activeProfile元素可以包含profile的id。profile也可以通过在命令行，使用-P标记和逗号分隔的列表来显式的激活（如，-P test）。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--profile默认是否激活的标识--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统的名字 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统所属家族(如 'windows')  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统体系结构  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统版本--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;name&#125;引用），其拥有对应的name = 值，Profile就会被激活。如果值字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的属性的名称--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的属性的值 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活profile。另一方面，exists则会检查文件是否存在，如果存在则激活profile。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exists</span>&gt;</span>$&#123;basedir&#125;/file2.properties<span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">missing</span>&gt;</span>$&#123;basedir&#125;/file1.properties<span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-12-Repositories"><a href="#1-12-Repositories" class="headerlink" title="1.12 Repositories"></a>1.12 Repositories</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">name</span>&gt;</span>local private nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库列表，它是Maven用来填充构建系统本地仓库所使用的一组远程项目。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库唯一标识--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>&gt;</span>codehausSnapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库名称 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Codehaus Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--true或者false表示该仓库是否为下载某种类型构件（发布版，快照版）开启。  --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳。这里的选项是：always（一直），daily（默认，每日），interval：X（这里X是以分钟为单位的时间间隔），或者never（从不）。 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做-ignore（忽略），fail（失败），或者warn（警告）。--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如何处理远程仓库里快照版本的下载。有了releases和snapshots这两组配置，POM就可以在每个单独的仓库中，为每种类型的构件采取不同的策略。例如，可能有人会决定只为开发目的开启对快照版本下载的支持。参见repositories/repository/releases元素--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://snapshots.maven.codehaus.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于定位和排序构件的仓库布局类型-可以是default（默认）或者legacy（遗留）。Maven 2为其仓库提供了一个默认的布局；然而，Maven 1.x有一种不同的布局。我们可以使用该元素指定布局是default（默认）还是legacy（遗留）。 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发现插件的远程仓库列表。仓库是两种主要构件的家。第一种构件被用作其它构件的依赖。这是中央仓库中存储的大部分构件类型。另外一种构件类型是插件。Maven插件是一种特殊类型的构件。由于这个原因，插件仓库独立于其它仓库。pluginRepositories元素的结构和repositories元素的结构类似。每个pluginRepository元素指定一个Maven可以用来寻找新插件的远程地址。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见profiles/profile/repositories/repository元素的说明--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>           </span><br><span class="line">         <span class="tag">&lt;<span class="name">releases</span>&gt;</span>      </span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">name</span>/&gt;</span><span class="tag">&lt;<span class="name">url</span>/&gt;</span><span class="tag">&lt;<span class="name">layout</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-13-activeProfiles"><a href="#1-13-activeProfiles" class="headerlink" title="1.13 activeProfiles"></a>1.13 activeProfiles</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">默认配置：</span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--    &lt;activeProfile&gt;devitcast&lt;/activeProfile&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    配置解释：</span><br><span class="line">    <span class="comment">&lt;!--手动激活profiles的列表，按照profile被应用的顺序定义activeProfile。 该元素包含了一组activeProfile元素，每个activeProfile都含有一个profile id。任何在activeProfile中定义的profile id，不论环境设置如何，其对应的profile都会被激活。如果没有匹配的profile，则什么都不会发生。例如，env-test是一个activeProfile，则在pom.xml（或者profile.xml）中对应id的profile会被激活。如果运行过程中找不到这样一个profile，Maven则会像往常一样运行 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>env-test<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="2-示例"><a href="#2-示例" class="headerlink" title="2 示例"></a>2 示例</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/opt/repository/maven<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like "mvn prefix:goal". Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | "org.apache.maven.plugins" and "org.codehaus.mojo" if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the 'id' attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>thirdparty<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>internal nexus repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id's for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property 'target-env' with a value of 'dev',</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set 'target-env' to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>apatch<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-apatch<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote apatch<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://inno.starhubdev.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>ibiblio<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-ibiblio<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote ibiblio<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://nexus.sourcesense.com/nexus/content/repositories/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>redev<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repository.sonatype.org/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3-私有仓库配置浅析"><a href="#3-私有仓库配置浅析" class="headerlink" title="3 私有仓库配置浅析"></a>3 私有仓库配置浅析</h1><p>基本逻辑</p><ul><li>pom&gt;启用的profile&gt;maven原有配置</li><li>mirror配置mirrorOf和id匹配优先</li></ul><p><strong>简单maven配置</strong></p><p>一般大家的配置（略去无关私有仓库配置）都是这样的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.xxx.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>         </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">      <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>         </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">      <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-1-mirrors"><a href="#3-1-mirrors" class="headerlink" title="3.1 mirrors"></a>3.1 mirrors</h2><p>这个标签重要的属性包括<strong>id</strong>、<strong>mirrorOf</strong>。id用来唯一区分。mirrorOf用来关联repository。<br>url用来表示私服地址。<br>mirrorOf常见大家配置成*、central、repo啥的</p><ul><li><code>id</code> 唯一标识</li><li><code>mirrorOf</code> 指定镜像的规则。就是什么情况会从镜像仓库拉取，而不是从原本的仓库拉取<br>可选项<a href="https://maven.apache.org/guides/mini/guide-mirror-settings.html" target="_blank" rel="noopener">参考链接</a>:<ol><li><code>*</code> 匹配所有</li><li><code>external:*</code> 除了本地缓存之后的所有仓库</li><li><code>repo,repo1</code> <code>repo</code> 或者 <code>repo1</code>。 这里<code>repo</code>指的是仓库的id，下文会提到</li><li><code>*,!repo1</code> 除了<code>repo1</code>的所有仓库</li></ol></li><li><code>name</code> 名称描述</li><li><code>url</code> 地址</li></ul><h2 id="3-2-profile"><a href="#3-2-profile" class="headerlink" title="3.2 profile"></a>3.2 profile</h2><p>这个就简单说下吧，就是算是个配置，可以配多个，具体哪个生效可以通过mvn命令指定，或者配置<activeprofiles></activeprofiles></p><h2 id="3-3-repositories"><a href="#3-3-repositories" class="headerlink" title="3.3 repositories"></a>3.3 repositories</h2><p>这里面算是配置的重点</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br></pre></td></tr></table></figure><p>几个重要的配置，一目了然吧，id标识，url地址，是否从该仓库下release，是否从该仓库下快照版本。<br> 这里就有人会懵逼了，这里怎么又配了个地址，跟mirrors里面的地址哪个生效呢？</p><p>好的，那咱们试试。先规定一下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.ws.netease.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把地址区分下，mirror里配成xxx，repository配成ccc<br>随便找一个项目，设定一个不存在的依赖，mvn -U compile下：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/1.webp" alt="image"></p><p>可以发现去ccc找了。说明repository里的生效了。<br> 那么mirror里的地址什么时候生效呢？其实刚才说了，mirror里的是靠mirrorOf中的内容和repository中id关联的。比如我们把刚才配置改为</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.ws.netease.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把repository中的id改成central</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/2.webp" alt="image"></p><p>这样就行了。此外mirrorOf中可以配置通配符，例如*，表示任何repository都和这个关联。</p><p><strong>其实简单来说就是如果repository的id能和mirrorOf关联上，那么url以mirror的为准，否则以repository中自己的url为准。</strong></p><p>其他还有一些点，repositories中可以配置多个repository，配置多个话，一个找不到会找下一个，比如我们在刚才基础上加上阿里的配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在构建一次：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/3.webp" alt="image"></p><h2 id="3-4-总结"><a href="#3-4-总结" class="headerlink" title="3.4 总结"></a>3.4 总结</h2><p>咱们在回顾下起初的配置，可以看到启用的profile是dev，dev中的repository的id是nexus，跟mirrorOf没有匹配，那么生效的配置就是repository中自己的url配置，所以这里完全可以省略掉mirror的配置。当然如果多个profile公用一个私服地址，也可以指定mirror地址，然后repository中的id指定成和mirrorOf相同，同时可以省略掉自己标签中url。</p><p>此外还有几个点要说，pluginRepositories，配置信息基本和repository一致，不过这个地址是用来下maven的插件的，就是pom中这样的配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filteringDeploymentDescriptors</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filteringDeploymentDescriptors</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">webResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/src/main/webapp/WEB-INF<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>WEB-INF<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还有，pom也可以指定repository:</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/4.webp" alt="image"></p><p>这样配置会和settings.xml中生效的配置合并，并优先从这个库找，找不到继续走settings.xml配置。</p><h2 id="3-5-多仓库配置"><a href="#3-5-多仓库配置" class="headerlink" title="3.5 多仓库配置"></a>3.5 多仓库配置</h2><p>第三方包，自己公司的包等除了手动<code>install:install-file</code>导入之外，最好的办法就是搭建自己公司的私有仓库，这里推荐使用<a href="https://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">nexus</a>, 这样除了中央仓库之外就需要设置自己的仓库了</p><p>设置多仓库有2个方法:</p><ol><li><p>pom设置(java的pom文件)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>setting设置(<code>${user.home}/.m2/settings.xml</code>)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>myprofile<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">       ...</span><br><span class="line">     <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>myprofile<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line"> ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>激活配置文件除了放在<code>activeProfiles</code>中之外，也可以使用mvn的参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mvn -Pmyprofile ...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/wdliu/p/8312543.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/wdliu/p/8312543.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-settings-xml详解&quot;&gt;&lt;a href=&quot;#1-settings-xml详解&quot; class=&quot;headerlink&quot; title=&quot;1 settings.xml详解&quot;&gt;&lt;/a&gt;1 settings.xml详解&lt;/h1&gt;&lt;h2 id=&quot;1-1-声明规范&quot;&gt;&lt;a href=&quot;#1-1-声明规范&quot; class=&quot;headerlink&quot; title=&quot;1.1 声明规范&quot;&gt;&lt;/a&gt;1.1 声明规范&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;&lt;/span&gt; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;xsi:schemaLocation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-2-localRepository&quot;&gt;&lt;a href=&quot;#1-2-localRepository&quot; class=&quot;headerlink&quot; title=&quot;1.2 localRepository&quot;&gt;&lt;/a&gt;1.2 localRepository&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- 本地仓库的路径。默认值为 --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;localRepository&lt;/span&gt;&amp;gt;&lt;/span&gt;/opt/repository&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;localRepository&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-3-interactiveMode&quot;&gt;&lt;a href=&quot;#1-3-interactiveMode&quot; class=&quot;headerlink&quot; title=&quot;1.3 interactiveMode&quot;&gt;&lt;/a&gt;1.3 interactiveMode&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--Maven是否需要和用户交互以获得输入。如果Maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;interactiveMode&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;interactiveMode&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-4-usePluginRegistry&quot;&gt;&lt;a href=&quot;#1-4-usePluginRegistry&quot; class=&quot;headerlink&quot; title=&quot;1.4 usePluginRegistry&quot;&gt;&lt;/a&gt;1.4 usePluginRegistry&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--Maven是否需要使用plugin-registry.xml文件来管理插件版本。如果需要让Maven使用文件来管理插件版本，则设为true。默认为false。--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;usePluginRegistry&lt;/span&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;usePluginRegistry&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-5-offline&quot;&gt;&lt;a href=&quot;#1-5-offline&quot; class=&quot;headerlink&quot; title=&quot;1.5 offline&quot;&gt;&lt;/a&gt;1.5 offline&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--表示Maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认为false。当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。 --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;offline&lt;/span&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;offline&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="java" scheme="https://gongzhao1.coding.me/categories/java/"/>
    
    
      <category term="maven" scheme="https://gongzhao1.coding.me/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>maven之pom文件详解</title>
    <link href="https://gongzhao1.coding.me/maven%E4%B9%8Bpom%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.coding.me/maven之pom文件详解/</id>
    <published>2020-05-24T14:27:34.000Z</published>
    <updated>2020-05-24T15:37:20.145Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://blog.csdn.net/weixin_38569499/article/details/91456988" target="_blank" rel="noopener">https://blog.csdn.net/weixin_38569499/article/details/91456988</a></li></ul><h1 id="1-maven项目目录结构"><a href="#1-maven项目目录结构" class="headerlink" title="1 maven项目目录结构"></a>1 maven项目目录结构</h1><p>  pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。</p><p>  maven的遵循约定大于配置，约定了如下的目录结构：</p><table><thead><tr><th><strong>目录</strong></th><th>目的</th></tr></thead><tbody><tr><td>${basedir}</td><td>存放pom.xml和所有的子目录</td></tr><tr><td>${basedir}/src/main/java</td><td>项目的java源代码</td></tr><tr><td>${basedir}/src/main/resources</td><td>项目的资源，比如说property文件，springmvc.xml</td></tr><tr><td>${basedir}/src/test/java</td><td>项目的测试类，比如说Junit代码</td></tr><tr><td>${basedir}/src/test/resources</td><td>测试用的资源</td></tr><tr><td>${basedir}/src/main/scripts</td><td>项目脚本源码的目录</td></tr><tr><td>${basedir}/src/main/webapp/WEB-INF</td><td>web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面</td></tr><tr><td>${basedir}/target</td><td>打包输出目录</td></tr><tr><td>${basedir}/target/classes</td><td>编译输出目录</td></tr><tr><td>${basedir}/target/site</td><td>生成文档的目录，可以通过index.html查看项目的文档</td></tr><tr><td>${basedir}/target/test-classes</td><td>测试编译输出目录</td></tr><tr><td>Test.java</td><td>Maven只会自动运行符合该命名规则的测试类</td></tr><tr><td>~/.m2/repository</td><td>Maven默认的本地仓库目录位置</td></tr></tbody></table><a id="more"></a><h1 id="2-配置详解"><a href="#2-配置详解" class="headerlink" title="2 配置详解"></a>2 配置详解</h1><h2 id="2-1-根元素和必要配置"><a href="#2-1-根元素和必要配置" class="headerlink" title="2.1 根元素和必要配置"></a>2.1 根元素和必要配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span> = <span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span> = <span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span> = <span class="string">"http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 模型版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 公司或者组织的唯一标志，也是打包成jar包路径的依据 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 例如com.companyname.project-group，maven打包jar包的路径：/com/companyname/project-group --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.companyname.project-group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 项目的唯一ID，一个groupId下面可能多个项目，就是靠artifactId来区分的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--项目产生的构件类型，包括jar、war、ear、pom等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>   project是pom文件的根元素，project下有modelVersion、groupId、artifactId、version、packaging等重要的元素。其中，groupId、artifactId、version三个元素用来定义一个项目的坐标，也就是说，一个maven仓库中，完全相同的一组groupId、artifactId、version，只能有一个项目。</p><ul><li>project：整个pom配置文件的根元素，所有的配置都是写在project元素里面的；</li><li>modelVersion：指定了当前POM模型的版本，对于Maven2及Maven 3来说，它只能是4.0.0；</li><li>groupId：这是项目组的标识。它在一个组织或者项目中通常是唯一的。</li><li>artifactId：这是项目的标识，通常是工程的名称。它在一个项目组（group）下是唯一的。</li><li>version：这是项目的版本号，用来区分同一个artifact的不同版本。</li><li>packaging：这是项目产生的构件类型，即项目通过maven打包的输出文件的后缀名，包括jar、war、ear、pom等。</li></ul><h2 id="2-2-父项目和parent元素"><a href="#2-2-父项目和parent元素" class="headerlink" title="2.2 父项目和parent元素"></a>2.2 父项目和parent元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--父项目的坐标，坐标包括group ID，artifact ID和version。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果项目中没有规定某个元素的值，那么父项目中的对应值即为项目的默认值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的构件标识符 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.companyname.project-group<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的全球唯一标识符 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>base-project<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.1-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 父项目的pom.xml文件的相对路径,默认值是../pom.xml。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 寻找父项目的pom：构建当前项目的地方--)relativePath指定的位置--)本地仓库--)远程仓库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>所有的pom都继承自一个父pom（Super POM）。父pom包含了一些可以被继承的默认设置，如果项目的pom中没有设置这些元素，就会使用父pom中设置。例如，Super POM中配置了默认仓库<a href="http://repo1.maven.org/maven2，这样哪怕项目的pom中没有配置仓库，也可以去这个默认仓库中去下载依赖。实际上，maven" target="_blank" rel="noopener">http://repo1.maven.org/maven2，这样哪怕项目的pom中没有配置仓库，也可以去这个默认仓库中去下载依赖。实际上，maven</a> pom文件约定大于配置的原则，就是通过在Super POM中预定义了一些配置信息来实现的。</p><p>Maven使用effective pom（Super pom加上工程自己的配置）来执行相关的目标，它帮助开发者在pom.xml中做尽可能少的配置。当然，这些配置也可以被重写。</p><p>parent元素可以指定父pom。用户可以通过增加parent元素来自定义一个父pom，从而继承该pom的配置。parent元素中包含一些子元素，用来定位父项目和父项目的pom文件位置。</p><ul><li>parent：用于指定父项目；</li><li>groupId：parent的子元素，父项目的groupId，用于定位父项目；</li><li>artifactId：parent的子元素，父项目的artifactId，用于定位父项目；</li><li>version：parent的子元素，父项目的version，用于定位父项目；</li><li>relativePath：parent的子元素，用于定位父项目pom文件的位置。</li></ul><h2 id="2-3-项目构建需要的信息"><a href="#2-3-项目构建需要的信息" class="headerlink" title="2.3 项目构建需要的信息"></a>2.3 项目构建需要的信息</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--构建项目需要的信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--------------------- 路径管理（在遵循约定大于配置原则下，不需要配置） ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录。该路径是相对于pom.xml的相对路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被编译过的测试class文件存放的目录。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testOutputDirectory</span> /&gt;</span>        </span><br><span class="line">    <span class="comment">&lt;!--项目脚本源码目录，该目录下的内容，会直接被拷贝到输出目录，因为脚本是被解释的，而不是被编译的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scriptSourceDirectory</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 资源管理 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 描述了资源的目标输出路径。该路径是相对于target/classes的路径 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 如果是想要把资源直接放在target/classes下，不需要配置该元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自文件里配置的属性，文件在filters元素里列出。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--描述存放资源的目录，该路径相对POM路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--包含的模式列表，例如**/*.xml，只有符合条件的资源文件才会在打包的时候被放入到输出路径中 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，子元素说明参考build/resources/resource元素的说明 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 插件管理 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 子项目可以引用的默认插件信息。pluginManagement中的插件直到被引用时才会被解析或绑定到生命周期 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里只是做了声明，并没有真正的引入。给定插件的任何本地配置都会覆盖这里的配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可使用的插件列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--插件在仓库里的group ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--插件在仓库里的artifact ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--被使用的插件的版本（或版本范围） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 是否从该插件下载Maven扩展(例如打包和类型处理器) --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 由于性能原因，只有在真需要下载时，该元素才被设置成enabled --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--execution元素包含了插件执行需要的信息 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--配置的执行目标 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--配置是否被传播到子POM --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--项目引入插件所需要的额外依赖 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        ......</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用的插件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    ......</span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 构建扩展 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用来自其他项目的一系列构建扩展 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--每个extension描述一个会使用到其构建扩展的一个项目，extension的子元素是项目的坐标 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 其他配置 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建产生的所有文件存放的目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>build标签定义了构建项目需要的信息，这部分信息对于定制化项目构建是非常重要的。这里会根据build的子元素的特点，简单地分类讲解。</p><h3 id="2-3-1-路径管理"><a href="#2-3-1-路径管理" class="headerlink" title="2.3.1 路径管理"></a>2.3.1 路径管理</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 路径管理（在遵循约定大于配置原则下，不需要配置） ---------------------&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">sourceDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录。该路径是相对于pom.xml的相对路径 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">testSourceDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--被编译过的测试class文件存放的目录。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">testOutputDirectory</span> /&gt;</span>        </span><br><span class="line"> <span class="comment">&lt;!--项目脚本源码目录，该目录下的内容，会直接被拷贝到输出目录，因为脚本是被解释的，而不是被编译的 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">scriptSourceDirectory</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>路径管理定义了各种源码和编译结果的输出路径。如果遵循maven默认的路径约定，这里的几个元素是不需要配置的。这些元素包括：</p><ul><li>sourceDirectory：项目源码目录，定义的是相对于pom文件的相对路径；</li><li>testSourceDirectory：项目单元测试源码目录，定义的也是是相对于pom文件的相对路径；</li><li>outputDirectory：被编译过的应用程序class文件存放的目录，也是是相对于pom文件的相对路径；</li><li>testOutoutDIrectory：被编译过的测试class文件存放的目录，也是是相对于pom文件的相对路径；</li><li>scriptSourceDirectory：项目脚本源码目录，也是是相对于pom文件的相对路径。由于脚本是解释性的语言，所以该目录下的内容，会直接被拷贝到输出目录，而不需要编译。</li></ul><h3 id="2-3-2-资源管理"><a href="#2-3-2-资源管理" class="headerlink" title="2.3.2 资源管理"></a>2.3.2 资源管理</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 资源管理 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 描述了资源的目标输出路径。该路径是相对于target/classes的路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果是想要把资源直接放在target/classes下，不需要配置该元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自文件里配置的属性，文件在filters元素里列出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--描述打包前的资源存放的目录，该路径相对POM路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包含的模式列表，例如**/*.xml，只有符合条件的资源文件才会在打包的时候被放入到输出路径中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，子元素说明参考build/resources/resource元素的说明 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的元素主要是对应用程序resource资源和单元测试部分resource资源的管理，分别通过resource标签和testResource标签管理两种资源。两个标签元素可选的子元素都是一样的。子元素包括：</p><ul><li>targetPath：描述了资源的目标输出路径，该路径是相对于target/classes的路径；</li><li>filtering：对文件中的参数值进行过滤，需要被过滤的文件在filter中指定；</li><li>directory：描述打包前的资源的存放路径，这个路径是相对于pom文件所在目录的相对路径；</li><li>includes：包含的模式列表，例如**/*.xml。只有符合条件的资源文件才会在打包的时候被放入到输出路径中；</li><li>excludes：排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉。</li></ul><h3 id="2-3-3-插件管理"><a href="#2-3-3-插件管理" class="headerlink" title="2.3.3 插件管理"></a>2.3.3 插件管理</h3><p>插件管理相关的元素有两个，包括pluginManagement和plugins。pluginManagement中有子元素plugins，它和project下的直接子元素plugins的区别是，pluginManagement主要是用来声明子项目可以引用的默认插件信息，这些插件如果只写在pluginManagement中是不会被引入的。project下的直接子元素plugins中定义的才是这个项目中真正需要被引入的插件。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 插件管理 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 子项目可以引用的默认插件信息。pluginManagement中的插件直到被引用时才会被解析或绑定到生命周期 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里只是做了声明，并没有真正的引入。给定插件的任何本地配置都会覆盖这里的配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可使用的插件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--插件定位坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否使用这个插件的Maven扩展(extensions)，默认为false --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 由于性能原因，只有在真需要下载时，该元素才被设置成enabled --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--execution元素包含了插件执行需要的信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置的执行目标 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置是否被传播到子POM --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目引入插件所需要的额外依赖，参见dependencies元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    ......</span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用的插件列表，这里是真正的引入插件。参见build/pluginManagement/plugins元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-4-构建扩展"><a href="#2-3-4-构建扩展" class="headerlink" title="2.3.4 构建扩展"></a>2.3.4 构建扩展</h3><p>extensions是在此构建中使用的项目的列表，它们将被包含在运行构建的classpath中。这些项目可以启用对构建过程的扩展，并使活动的插件能够对构建生命周期进行更改。简而言之，扩展是在构建期间激活的artifacts。扩展不需要实际执行任何操作，也不包含 Mojo。因此，扩展对于指定普通插件接口的多个实现中的一个是非常好的。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 构建扩展 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用来自其他项目的一系列构建扩展 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--每个extension描述一个会使用到其构建扩展的一个项目，extension的子元素是项目的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-5-其他配置"><a href="#2-3-5-其他配置" class="headerlink" title="2.3.5 其他配置"></a>2.3.5 其他配置</h3><p>  build中还有一些配置，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 其他配置 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--构建产生的所有文件存放的目录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-4-项目依赖相关信息"><a href="#2-4-项目依赖相关信息" class="headerlink" title="2.4 项目依赖相关信息"></a>2.4 项目依赖相关信息</h2><p>pom文件中通过dependencyManagement来声明依赖，通过dependencies元素来管理依赖。dependencyManagement下的子元素只有一个直接的子元素dependencice，其配置和dependencies子元素是完全一致的；而dependencies下只有一类直接的子元素：dependency。一个dependency子元素表示一个依赖项目。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖自动从项目定义的仓库中下载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖坐标 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖项目的坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-artifact<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖类型 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖类型，默认是jar。通常表示依赖文件的扩展名，但有例外。一个类型可以被映射成另外一个扩展名或分类器 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 类型经常和使用的打包方式对应，尽管这也有例外，一些类型的例子：jar，war，ejb-client和test-jar --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果设置extensions为true，就可以在plugin里定义新的类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果想将项目构建成两个单独的JAR，分别使用Java 4和6编译器，就可以使用分类器来生成两个单独的JAR构件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">classifier</span>&gt;</span><span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖传递 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖排除，即告诉maven只依赖指定的项目，不依赖该项目的这些依赖。此元素主要用于解决版本冲突问题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可选依赖，用于阻断依赖的传递性。如果在项目B中把C依赖声明为可选，那么依赖B的项目中无法使用C依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖范围 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来</span></span><br><span class="line"><span class="comment">            - compile：默认范围，用于编译;  - provided：类似于编译，但支持jdk或者容器提供，类似于classpath </span></span><br><span class="line"><span class="comment">            - runtime: 在执行时需要使用;    - systemPath: 仅用于范围为system。提供相应的路径 </span></span><br><span class="line"><span class="comment">            - test: 用于test任务时使用;    - system: 需要外在提供相应的元素。通过systemPath来取得 </span></span><br><span class="line"><span class="comment">            - optional: 当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 该元素为依赖规定了文件系统上的路径。仅供scope设置system时使用。但是不推荐使用这个元素 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不推荐使用绝对路径，如果必须要用，推荐使用属性匹配绝对路径，例如$&#123;java.home&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span><span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 继承自该项目的所有子项目的默认依赖信息，这部分的依赖信息不会被立即解析。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当子项目声明一个依赖，如果group ID和artifact ID以外的一些信息没有描述，则使用这里的依赖信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            ......</span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里也是根据元素的作用，简单的对dependency的子元素做了一下分类。下面按分类来看一下dependency的子元素：</p><h3 id="2-4-1-依赖坐标"><a href="#2-4-1-依赖坐标" class="headerlink" title="2.4.1 依赖坐标"></a>2.4.1 依赖坐标</h3><p>依然是通过groupId + artifactId + version来在仓库中定位一个项目：</p><ul><li>groupId：parent的子元素，父项目的groupId，用于定位父项目；</li><li>artifactId：parent的子元素，父项目的artifactId，用于定位父项目；</li><li>version：parent的子元素，父项目的version，用于定位父项目；</li></ul><h3 id="2-4-2-依赖类型"><a href="#2-4-2-依赖类型" class="headerlink" title="2.4.2 依赖类型"></a>2.4.2 依赖类型</h3><p>这个分类主要包括两个元素，分别是依赖类型和依赖的分类器。同一个项目，即使打包成同一种类型，也可以有多个文件同时存在，因为它们的分类器可能是不同的。</p><ul><li>type：依赖类型，默认是jar。通常表示依赖文件的扩展名，但也有例外。一个类型可以被映射成另外一个扩展名或分类器。类型经常和使用的打包方式对应，尽管这也有例外，一些类型的例子：jar，war，ejb-client和test-jar。如果设置extensions为true，就可以在plugin里定义新的类型。</li><li>classifier：依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面，如果想将项目构建成两个单独的JAR，分别使用Java 4和6编译器，就可以使用分类器来生成两个单独的JAR构件</li></ul><h3 id="2-4-3-依赖传递"><a href="#2-4-3-依赖传递" class="headerlink" title="2.4.3 依赖传递"></a>2.4.3 依赖传递</h3><p>依赖传递相关的子元素主要有两个，用于依赖排除的exclusions和设置依赖是否可选的optional。</p><ul><li>exclusions：排除该项目中的一些依赖，即本项目A依赖该dependency指示的项目B，但是不依赖项目B中依赖的这些依赖；</li><li>optional：可选依赖，用于阻断依赖的传递性，即本项目不会依赖父项目中optional设置为true的依赖。</li></ul><h3 id="2-4-4-依赖范围"><a href="#2-4-4-依赖范围" class="headerlink" title="2.4.4 依赖范围"></a>2.4.4 依赖范围</h3><p>还有一些其他元素：</p><ul><li><p>scope：依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来</p><ul><li>compile：默认范围，用于编译;   </li><li>provided：类似于编译，但支持jdk或者容器提供，类似于classpath </li><li>runtime: 在执行时需要使用;         </li><li>systemPath: 仅用于范围为system，提供相应的路径 </li><li>test: 用于test任务时使用;             </li><li>system: 需要外在提供相应的元素，通过systemPath来取得 </li><li>optional: 当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用</li></ul></li><li><p>systemPath：该元素为依赖规定了文件系统上的绝对路径。仅在scope设置成system时才会使用。不推荐使用这个元素。不推荐使用绝对路径，如果必须要用，推荐使用属性匹配绝对路径，例如${java.home}</p></li></ul><h2 id="2-5-生成文档相关的元素"><a href="#2-5-生成文档相关的元素" class="headerlink" title="2.5 生成文档相关的元素"></a>2.5 生成文档相关的元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目的名称, Maven生成文档使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>project-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目主页的URL, Maven生成文档使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://123.a.b/nsnxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 项目的详细描述, Maven生成文档使用。当这个元素能够用HTML格式描述时，不鼓励使用纯文本描述 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果你需要修改生成的web站点的索引页面，你应该修改你自己的索引页文件，而不是调整这里的文档 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Description of this maven project<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure><p>备注：maven可以通过mvn site命令生成项目的相关文档。</p><p>和生成文档相关的元素，包括name，url，和description。</p><ul><li>name：项目名称，maven生成文档会使用项目名；</li><li>url：项目主页的地址，maven生成文档的时候使用。</li><li>description：项目描述。如果可以使用HTML格式进行描述的时候，不推荐使用纯文本的描述。</li></ul><h2 id="2-6-远程仓库列表"><a href="#2-6-远程仓库列表" class="headerlink" title="2.6 远程仓库列表"></a>2.6 远程仓库列表</h2><p>远程仓库列表的配置，包括依赖和扩展的远程仓库配置，以及插件的远程仓库配置。在本地仓库找不到的情况下，maven下载依赖、扩展和插件就是从这里配置的远程仓库中进行下载。</p><p>需要注意的是release和snapshot两者的区别。release是稳定版本，一经发布不再修改，想发布修改后的项目，只能升级项目版本再进行发布；snapshot是不稳定的，一个snapshot的版本可以不断改变。项目在开发期间一般会使用snapshot，更方便进行频繁的代码更新；一旦发布到外部，或者开发基本完成，代码迭代不再频繁，则推荐使用release。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--值为true或者false，表示该仓库是否为下载某种类型构件（发布版，快照版）开启。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--选项：always，daily（默认），interval：X（X单位为分钟），或者never。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做。选项：ignore，fail，或者warn --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如何处理远程仓库里快照版本的下载 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 有了releases和snapshots这两组配置，就可以在每个单独的仓库中，为每种类型的构件采取不同的策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--远程仓库唯一标识符。可以用来匹配在settings.xml文件里配置的远程仓库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-repository-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程仓库名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxs-repository-proxy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.169:9999/repository/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用于定位和排序构件的仓库布局类型。可以是default或者legacy --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息。参见repositories/repository元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-7-项目分发信息相关元素"><a href="#2-7-项目分发信息相关元素" class="headerlink" title="2.7 项目分发信息相关元素"></a>2.7 项目分发信息相关元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目分发信息，在执行mvn deploy后表示要发布的位置。用于把网站部署到远程服务器或者把构件部署到远程仓库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--部署项目产生的构件到远程仓库需要的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 是分配给快照一个唯一的版本号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 其他配置参见repositories/repository元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxsmaven2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;basedir&#125;/target/deploy<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构件的快照部署的仓库。默认部署到distributionManagement/repository元素配置的仓库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nanxs-maven2 Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/nanxs:/usr/local/maven-snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--部署项目的网站需要的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">site</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的唯一标识符，用来匹配站点和settings.xml文件里的配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-site<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>business api website<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/nanxs:/var/www/localhost/nanxs-web<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">site</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目下载页面的URL。如果没有该元素，用户应该参考主页 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本元素是为了帮助定位那些不在仓库里的构件(license限制) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">downloadUrl</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果构件有了新的group ID和artifact ID（构件移到了新的位置），这里列出构件的重定位信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的group ID --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的artifact ID --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的版本号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--显示给用户的，关于移动的额外信息，例如原因 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 给出该构件在远程仓库的状态。本地项目中不能设置该元素，因为这是工具自动更新的 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 有效的值有：none（默认），converted（仓库管理员从 Maven 1 POM转换过来），</span></span><br><span class="line"><span class="comment">        partner（直接从伙伴Maven 2仓库同步过来），deployed（从Maven 2实例部署），</span></span><br><span class="line"><span class="comment">        verified（被核实时正确的和最终的） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">status</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目分发信息的相关配置，在distributionManagement中设置。设置的内容包括：</p><ul><li>repository和snapshotRepository：项目产生的构建/快照构建部署的远程仓库。如果不配置</li><li>snapshotRepository，快照也会部署到repository中；</li><li>site：部署项目的网站需要的信息；</li><li>downloadUrl：项目下载页面的URL，这是为不在仓库中的构建提供的；</li><li>relocation：如果构件有了新的group ID和artifact ID（移到了新的位置），这里列出构件的新的信息；</li><li>status：给出该构件在远程仓库的状态，本地项目中不能设置该元素，这是工具自动更新的。</li></ul><h2 id="2-8-报表规范"><a href="#2-8-报表规范" class="headerlink" title="2.8 报表规范"></a>2.8 报表规范</h2><p>报表规范描述的是使用mvn site命令时使用的一些配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该元素描述使用报表插件产生报表的规范 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当用户执行"mvn site"，这些报表就会运行，在页面导航栏能看到所有报表的链接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--网站是否排除默认的报表。这包括"项目信息"菜单中的报表。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">excludeDefaults</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--所有产生的报表存放到哪里。默认值是$&#123;project.build.directory&#125;/site。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用的报表插件和他们的配置。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--plugin元素包含描述报表插件需要的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--报表插件定位：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--报表插件的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 一组报表的多重规范，每个规范可能有不同的配置。一个规范（报表集）对应一个执行目标 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 例如，有1~9这9个报表。1，2构成A报表集，对应一个执行目标；2，5构成B报表集，对应另一个执行目标 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--表示报表的一个集合，以及产生该集合的配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--报表集合的唯一标识符，POM继承时用到 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--产生报表集合时，被使用的报表的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置是否被继承到子POMs --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--这个集合里使用到哪些报表 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-9-profile配置"><a href="#2-9-profile配置" class="headerlink" title="2.9 profile配置"></a>2.9 profile配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在列的项目构建profile，如果被激活，会修改构建处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据环境参数或命令行参数激活某个构建处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构建配置的唯一标识符。即用于命令行激活，也用于在继承时合并具有相同标识符的profile。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙，profile的力量来自于它 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--profile默认是否激活的标志 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdk</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统的名字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统所属家族(如 'windows') --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统体系结构 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统版本 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;名称&#125;引用），其拥有对应的名称和值，Profile就会被激活 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如果值字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的属性的名称 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的属性的值 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活profile --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--另一方面，exists则会检查文件是否存在，如果存在则激活profile --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exists</span>&gt;</span>/usr/local/abcd/abcd-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                <span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">missing</span>&gt;</span>/usr/local/abcd/abcd-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                <span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--构建项目所需要的信息。参见build元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。详情参见repositories元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表。详情参见pluginRepositories元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepositories</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 详细配置参见dependencies --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素包括使用报表插件产生报表的规范。当用户执行"mvn site"，这些报表就会运行。在页面导航栏能看到所有报表的链接。参见reporting元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">reporting</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见dependencyManagement元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencyManagement</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见distributionManagement元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distributionManagement</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见properties元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-10-邮件列表和持续集成配置"><a href="#2-10-邮件列表和持续集成配置" class="headerlink" title="2.10 邮件列表和持续集成配置"></a>2.10 邮件列表和持续集成配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目持续集成信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--持续集成系统的名字，例如continuum --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该项目使用的持续集成系统的URL（如果持续集成系统有web接口的话）。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建完成时，需要通知的开发者/用户的配置项。包括被通知者信息和通知条件（错误，失败，成功，警告） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">notifiers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置一种方式，当构建中断时，以该方式通知用户/开发者 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">notifier</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--传送通知的途径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发生错误时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnError</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建失败时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnFailure</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建成功时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnSuccess</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发生警告时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnWarning</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--不赞成使用。通知发送到哪里 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">address</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--扩展配置项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">notifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">notifiers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目相关邮件列表信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目相关的所有邮件列表。自动产生的网站引用这些信息。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mailingList</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--邮件的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发送邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">post</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">post</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">subscribe</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">subscribe</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--取消订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">unsubscribe</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">unsubscribe</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--你可以浏览邮件信息的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">archive</span>&gt;</span>http:/a.b.c/nanxs/demo/dev/<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mailingList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-11-项目的描述性信息"><a href="#2-11-项目的描述性信息" class="headerlink" title="2.11 项目的描述性信息"></a>2.11 项目的描述性信息</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目的问题管理系统(Bugzilla, Jira, Scarab,或任何你喜欢的问题管理系统)的名称和URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--问题管理系统（例如jira）的名字， --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span>&gt;</span>jira<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该项目使用的问题管理系统的URL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jira.baidu.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目创建年份，4位数字。当产生版权信息时需要使用这个值。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">inceptionYear</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目开发者列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--某个项目开发者的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SCM里项目开发者的唯一标识符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>HELLO WORLD<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的全名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的email --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span>&gt;</span>123@abc.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的主页的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者在项目中扮演的角色，角色元素描述了各种角色 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">roles</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">role</span>&gt;</span>Project Manager<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">role</span>&gt;</span>Architect<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">roles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所属组织 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organization</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所属组织的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者属性，如即时消息如何处理等 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dept</span>&gt;</span>No<span class="tag">&lt;/<span class="name">dept</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所在时区， -11到12范围内的整数。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目的其他贡献者列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contributors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的其他贡献者。参见developers/developer元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contributor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organization</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organizationUrl</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">roles</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timezone</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">contributor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--该元素描述了项目所有License列表。 应该只列出该项目的license列表，不要列出依赖项目的license列表 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果列出多个license，用户可以选择它们中的一个而不是接受所有license --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--描述了项目的license，用于生成项目的web站点的license页面，其他一些报表和validation也会用到该元素。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--license用于法律上的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Apache 2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方的license正文页面的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs/LICENSE-1.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目分发的主要方式： repo，可以从Maven库下载 manual， 用户必须手动下载和安装依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--关于license的补充信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comments</span>&gt;</span>A business-friendly OSS license<span class="tag">&lt;/<span class="name">comments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--SCM(Source Control Management)标签允许你配置你的代码库，供Maven web站点和其它插件使用。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SCM的URL,该URL描述了版本库和如何连接到版本库。该连接只读 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:svn:http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--给开发者使用的，类似connection元素。即该连接不仅仅只读 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:svn:http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当前代码的标签，在开发阶段默认为HEAD --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指向项目的可浏览SCM库（例如ViewVC或者Fisheye）的URL。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--描述项目所属组织的各种属性。Maven产生的文档用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">organization</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组织的全名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组织主页的URL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-12-其他配置"><a href="#2-12-其他配置" class="headerlink" title="2.12 其他配置"></a>2.12 其他配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--描述了这个项目构建环境中的前提条件。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建该项目或使用该插件所需要的Maven的最低版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--以值替代名称，Properties可以在整个POM中使用，也可以作为触发条件（见settings.xml中activation元素的说明） --&gt;</span></span><br><span class="line">&lt;!-格式是&lt;name&gt;value&lt;/name&gt;。 --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--不推荐使用，现在Maven忽略该元素. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reports</span>&gt;</span><span class="tag">&lt;/<span class="name">reports</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_38569499/article/details/91456988&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/weixin_38569499/article/details/91456988&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-maven项目目录结构&quot;&gt;&lt;a href=&quot;#1-maven项目目录结构&quot; class=&quot;headerlink&quot; title=&quot;1 maven项目目录结构&quot;&gt;&lt;/a&gt;1 maven项目目录结构&lt;/h1&gt;&lt;p&gt;  pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。&lt;/p&gt;
&lt;p&gt;  maven的遵循约定大于配置，约定了如下的目录结构：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;目的&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;${basedir}&lt;/td&gt;
&lt;td&gt;存放pom.xml和所有的子目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/java&lt;/td&gt;
&lt;td&gt;项目的java源代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/resources&lt;/td&gt;
&lt;td&gt;项目的资源，比如说property文件，springmvc.xml&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/test/java&lt;/td&gt;
&lt;td&gt;项目的测试类，比如说Junit代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/test/resources&lt;/td&gt;
&lt;td&gt;测试用的资源&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/scripts&lt;/td&gt;
&lt;td&gt;项目脚本源码的目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/webapp/WEB-INF&lt;/td&gt;
&lt;td&gt;web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target&lt;/td&gt;
&lt;td&gt;打包输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/classes&lt;/td&gt;
&lt;td&gt;编译输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/site&lt;/td&gt;
&lt;td&gt;生成文档的目录，可以通过index.html查看项目的文档&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/test-classes&lt;/td&gt;
&lt;td&gt;测试编译输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Test.java&lt;/td&gt;
&lt;td&gt;Maven只会自动运行符合该命名规则的测试类&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;~/.m2/repository&lt;/td&gt;
&lt;td&gt;Maven默认的本地仓库目录位置&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
    
    </summary>
    
      <category term="java" scheme="https://gongzhao1.coding.me/categories/java/"/>
    
    
      <category term="maven" scheme="https://gongzhao1.coding.me/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes之StorageClassss——nfs-client</title>
    <link href="https://gongzhao1.coding.me/Kubernetes%E4%B9%8BStorageClassss%E2%80%94%E2%80%94nfs-client/"/>
    <id>https://gongzhao1.coding.me/Kubernetes之StorageClassss——nfs-client/</id>
    <published>2020-05-24T09:04:47.000Z</published>
    <updated>2020-05-24T15:37:51.854Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></li><li><a href="http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5" target="_blank" rel="noopener">http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5</a></li></ul><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p> Kubernetes集群管理员通过提供不同的存储类，可以满足用户不同的服务质量级别、备份策略和任意策略要求的存储需求。动态存储卷供应使用StorageClass进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes将能够按照用户的需要，自动创建其需要的存储。</p><p>比如，我们可能会在kubernetes集群中安装一些带持久化数据功能的服务，例如redis、mysql、mq、es等。因此，当有这类需求时，我们必须给整个集群给定一个特定的存储方案。本章我们是NFS的网络存储方案</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/kubernetes/storageclass.png" alt="image"></p><a id="more"></a><h2 id="2-部署"><a href="#2-部署" class="headerlink" title="2 部署"></a>2 部署</h2><h2 id="2-1-NFS服务器"><a href="#2-1-NFS服务器" class="headerlink" title="2.1 NFS服务器"></a>2.1 NFS服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install rpcbind  nfs-utils</span><br><span class="line"></span><br><span class="line">mkdir /nfs_data</span><br><span class="line"></span><br><span class="line">chmod +w /nfs_data</span><br><span class="line"></span><br><span class="line">chmod +x /nfs_data</span><br></pre></td></tr></table></figure><p>编辑/etc/exports,内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nfs_data 192.168.11.0/24(rw,no_root_squash)</span><br></pre></td></tr></table></figure><p>启动nfs服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nfs start #启动nfs服务</span><br><span class="line">service rpcbind start  #启动rpc服务</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.11.24 #查看共享盘 ok</span><br></pre></td></tr></table></figure><h2 id="2-2-使用helm部署nfs-client"><a href="#2-2-使用helm部署nfs-client" class="headerlink" title="2.2 使用helm部署nfs-client"></a>2.2 使用helm部署nfs-client</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm search nfs-client</span><br><span class="line">helm fetch nfs-client</span><br></pre></td></tr></table></figure><p>编辑helm的values文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nfs.server=192.168.11.24</span><br><span class="line">nfs.path=/nfs_data</span><br><span class="line">storageClass.defaultClass=true</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install ....</span><br></pre></td></tr></table></figure><h1 id="3-测试"><a href="#3-测试" class="headerlink" title="3 测试"></a>3 测试</h1><p>创建一个pvc使用默认的storageclass，查看pv是否自动创建成功</p><p>如果没有将nfs-client设为默认的storageclass，可使用以下命令进行操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 `&lt;your-class-name&gt;` 是您选择的 StorageClass 的名字。</span></span><br><span class="line">kubectl patch storageclass &lt;your-class-name&gt; -p <span class="string">'&#123;"metadata": &#123;"annotations":&#123;"storageclass.kubernetes.io/is-default-class":"true"&#125;&#125;&#125;'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/storage/storage-classes/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.io/docs/concepts/storage/storage-classes/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-简介&quot;&gt;&lt;a href=&quot;#1-简介&quot; class=&quot;headerlink&quot; title=&quot;1 简介&quot;&gt;&lt;/a&gt;1 简介&lt;/h1&gt;&lt;p&gt; Kubernetes集群管理员通过提供不同的存储类，可以满足用户不同的服务质量级别、备份策略和任意策略要求的存储需求。动态存储卷供应使用StorageClass进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes将能够按照用户的需要，自动创建其需要的存储。&lt;/p&gt;
&lt;p&gt;比如，我们可能会在kubernetes集群中安装一些带持久化数据功能的服务，例如redis、mysql、mq、es等。因此，当有这类需求时，我们必须给整个集群给定一个特定的存储方案。本章我们是NFS的网络存储方案&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/kubernetes/storageclass.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://gongzhao1.coding.me/categories/kubernetes/"/>
    
    
      <category term="storageclass" scheme="https://gongzhao1.coding.me/tags/storageclass/"/>
    
  </entry>
  
  <entry>
    <title>跨域资源共享 CORS 详解</title>
    <link href="https://gongzhao1.coding.me/%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB-CORS-%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.coding.me/跨域资源共享-CORS-详解/</id>
    <published>2020-05-24T08:53:05.000Z</published>
    <updated>2020-05-24T15:38:06.004Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-转载"><a href="#0-转载" class="headerlink" title="0 转载"></a>0 转载</h1><ul><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></li></ul><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p><p>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p><p>因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。</p><a id="more"></a><h1 id="2-两种请求"><a href="#2-两种请求" class="headerlink" title="2 两种请求"></a>2 两种请求</h1><p>浏览器将CORS请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。</p><p>只要同时满足以下两大条件，就属于简单请求。</p><blockquote><p>（1) 请求方法是以下三种方法之一：</p><ul><li>HEAD</li><li>GET</li><li>POST</li></ul><p>（2）HTTP的头信息不超出以下几种字段：</p><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Last-Event-ID</li><li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li></ul></blockquote><p>这是为了兼容表单（form），因为历史上表单一直可以发出跨域请求。AJAX 的跨域设计就是，只要表单可以发，AJAX 就可以直接发。</p><p>凡是不同时满足上面两个条件，就属于非简单请求。</p><p>浏览器对这两种请求的处理，是不一样的。</p><h1 id="3-简单请求"><a href="#3-简单请求" class="headerlink" title="3 简单请求"></a>3 简单请求</h1><h2 id="3-1-基本流程"><a href="#3-1-基本流程" class="headerlink" title="3.1 基本流程"></a>3.1 基本流程</h2><p>对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个<code>Origin</code>字段。</p><p>下面是一个例子，浏览器发现这次跨源AJAX请求是简单请求，就自动在头信息之中，添加一个<code>Origin</code>字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; GET /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的头信息中，<code>Origin</code>字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</p><p>如果<code>Origin</code>指定的源，不在许可范围内，服务器会返回一个正常的HTTP回应。浏览器发现，这个回应的头信息没有包含<code>Access-Control-Allow-Origin</code>字段（详见下文），就知道出错了，从而抛出一个错误，被<code>XMLHttpRequest</code>的<code>onerror</code>回调函数捕获。注意，这种错误无法通过状态码识别，因为HTTP回应的状态码有可能是200。</p><p>如果<code>Origin</code>指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt; Access-Control-Expose-Headers: FooBar</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的头信息之中，有三个与CORS请求相关的字段，都以<code>Access-Control-</code>开头。</p><p><strong>（1）Access-Control-Allow-Origin</strong></p><p>该字段是必须的。它的值要么是请求时<code>Origin</code>字段的值，要么是一个<code>*</code>，表示接受任意域名的请求。</p><p><strong>（2）Access-Control-Allow-Credentials</strong></p><p>该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为<code>true</code>，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为<code>true</code>，如果服务器不要浏览器发送Cookie，删除该字段即可。</p><p><strong>（3）Access-Control-Expose-Headers</strong></p><p>该字段可选。CORS请求时，<code>XMLHttpRequest</code>对象的<code>getResponseHeader()</code>方法只能拿到6个基本字段：<code>Cache-Control</code>、<code>Content-Language</code>、<code>Content-Type</code>、<code>Expires</code>、<code>Last-Modified</code>、<code>Pragma</code>。如果想拿到其他字段，就必须在<code>Access-Control-Expose-Headers</code>里面指定。上面的例子指定，<code>getResponseHeader(&#39;FooBar&#39;)</code>可以返回<code>FooBar</code>字段的值。</p><h2 id="3-2-withCredentials-属性"><a href="#3-2-withCredentials-属性" class="headerlink" title="3.2 withCredentials 属性"></a>3.2 withCredentials 属性</h2><p>上面说到，CORS请求默认不发送Cookie和HTTP认证信息。如果要把Cookie发到服务器，一方面要服务器同意，指定<code>Access-Control-Allow-Credentials</code>字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>另一方面，开发者必须在AJAX请求中打开<code>withCredentials</code>属性。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt; xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>否则，即使服务器同意发送Cookie，浏览器也不会发送。或者，服务器要求设置Cookie，浏览器也不会处理。</p><p>但是，如果省略<code>withCredentials</code>设置，有的浏览器还是会一起发送Cookie。这时，可以显式关闭<code>withCredentials</code>。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; xhr.withCredentials = <span class="literal">false</span>;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>需要注意的是，如果要发送Cookie，<code>Access-Control-Allow-Origin</code>就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的<code>document.cookie</code>也无法读取服务器域名下的Cookie。</p><h1 id="4-非简单请求"><a href="#4-非简单请求" class="headerlink" title="4 非简单请求"></a>4 非简单请求</h1><h2 id="4-1-预检请求"><a href="#4-1-预检请求" class="headerlink" title="4.1 预检请求"></a>4.1 预检请求</h2><p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是<code>PUT</code>或<code>DELETE</code>，或者<code>Content-Type</code>字段的类型是<code>application/json</code>。</p><p>非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p><p>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的<code>XMLHttpRequest</code>请求，否则就报错。</p><p>下面是一段浏览器的JavaScript脚本。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> url = <span class="string">'http://api.alice.com/cors'</span>;</span><br><span class="line">&gt; <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt; xhr.open(<span class="string">'PUT'</span>, url, <span class="literal">true</span>);</span><br><span class="line">&gt; xhr.setRequestHeader(<span class="string">'X-Custom-Header'</span>, <span class="string">'value'</span>);</span><br><span class="line">&gt; xhr.send();</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中，HTTP请求的方法是<code>PUT</code>，并且发送一个自定义头信息<code>X-Custom-Header</code>。</p><p>浏览器发现，这是一个非简单请求，就自动发出一个”预检”请求，要求服务器确认可以这样请求。下面是这个”预检”请求的HTTP头信息。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; OPTIONS /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Request-Method: PUT</span><br><span class="line">&gt; Access-Control-Request-Headers: X-Custom-Header</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>“预检”请求用的请求方法是<code>OPTIONS</code>，表示这个请求是用来询问的。头信息里面，关键字段是<code>Origin</code>，表示请求来自哪个源。</p><p>除了<code>Origin</code>字段，”预检”请求的头信息包括两个特殊字段。</p><p><strong>（1）Access-Control-Request-Method</strong></p><p>该字段是必须的，用来列出浏览器的CORS请求会用到哪些HTTP方法，上例是<code>PUT</code>。</p><p><strong>（2）Access-Control-Request-Headers</strong></p><p>该字段是一个逗号分隔的字符串，指定浏览器CORS请求会额外发送的头信息字段，上例是<code>X-Custom-Header</code>。</p><h2 id="4-2-预检请求的回应"><a href="#4-2-预检请求的回应" class="headerlink" title="4.2 预检请求的回应"></a>4.2 预检请求的回应</h2><p>服务器收到”预检”请求以后，检查了<code>Origin</code>、<code>Access-Control-Request-Method</code>和<code>Access-Control-Request-Headers</code>字段以后，确认允许跨源请求，就可以做出回应。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; HTTP/1.1 200 OK</span><br><span class="line">&gt; Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">&gt; Server: Apache/2.0.61 (Unix)</span><br><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">&gt; Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt; Content-Encoding: gzip</span><br><span class="line">&gt; Content-Length: 0</span><br><span class="line">&gt; Keep-Alive: timeout=2, max=100</span><br><span class="line">&gt; Connection: Keep-Alive</span><br><span class="line">&gt; Content-Type: text/plain</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的HTTP回应中，关键的是<code>Access-Control-Allow-Origin</code>字段，表示<code>http://api.bob.com</code>可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: *</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>如果服务器否定了”预检”请求，会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被<code>XMLHttpRequest</code>对象的<code>onerror</code>回调函数捕获。控制台会打印出如下的报错信息。</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; XMLHttpRequest cannot load http://api.alice.com.</span><br><span class="line">&gt; Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>服务器回应的其他CORS相关字段如下。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">&gt; Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt; Access-Control-Max-Age: 1728000</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p><strong>（1）Access-Control-Allow-Methods</strong></p><p>该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次”预检”请求。</p><p><strong>（2）Access-Control-Allow-Headers</strong></p><p>如果浏览器请求包括<code>Access-Control-Request-Headers</code>字段，则<code>Access-Control-Allow-Headers</code>字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在”预检”中请求的字段。</p><p><strong>（3）Access-Control-Allow-Credentials</strong></p><p>该字段与简单请求时的含义相同。</p><p><strong>（4）Access-Control-Max-Age</strong></p><p>该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是20天（1728000秒），即允许缓存该条回应1728000秒（即20天），在此期间，不用发出另一条预检请求。</p><h2 id="4-3-浏览器的正常请求和回应"><a href="#4-3-浏览器的正常请求和回应" class="headerlink" title="4.3 浏览器的正常请求和回应"></a>4.3 浏览器的正常请求和回应</h2><p>一旦服务器通过了”预检”请求，以后每次浏览器正常的CORS请求，就都跟简单请求一样，会有一个<code>Origin</code>头信息字段。服务器的回应，也都会有一个<code>Access-Control-Allow-Origin</code>头信息字段。</p><p>下面是”预检”请求之后，浏览器的正常CORS请求。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; PUT /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; X-Custom-Header: value</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面头信息的<code>Origin</code>字段是浏览器自动添加的。</p><p>下面是服务器正常的回应。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面头信息中，<code>Access-Control-Allow-Origin</code>字段是每次回应都必定包含的。</p><h1 id="5-与JSONP的比较"><a href="#5-与JSONP的比较" class="headerlink" title="5 与JSONP的比较"></a>5 与JSONP的比较</h1><p>CORS与JSONP的使用目的相同，但是比JSONP更强大。</p><p>JSONP只支持<code>GET</code>请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-转载&quot;&gt;&lt;a href=&quot;#0-转载&quot; class=&quot;headerlink&quot; title=&quot;0 转载&quot;&gt;&lt;/a&gt;0 转载&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/04/cors.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ruanyifeng.com/blog/2016/04/cors.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-简介&quot;&gt;&lt;a href=&quot;#1-简介&quot; class=&quot;headerlink&quot; title=&quot;1 简介&quot;&gt;&lt;/a&gt;1 简介&lt;/h1&gt;&lt;p&gt;CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。&lt;/p&gt;
&lt;p&gt;整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。&lt;/p&gt;
&lt;p&gt;因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。&lt;/p&gt;
    
    </summary>
    
    
      <category term="cors" scheme="https://gongzhao1.coding.me/tags/cors/"/>
    
  </entry>
  
  <entry>
    <title>OAuth详解</title>
    <link href="https://gongzhao1.coding.me/OAuth%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.coding.me/OAuth详解/</id>
    <published>2020-05-24T08:08:24.000Z</published>
    <updated>2020-05-24T15:36:44.984Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考文章"><a href="#0-参考文章" class="headerlink" title="0 参考文章"></a>0 参考文章</h1><ul><li><a href="https://www.jianshu.com/p/b06944c92228" target="_blank" rel="noopener">https://www.jianshu.com/p/b06944c92228</a></li><li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></li></ul><h1 id="1-什么是OAuth"><a href="#1-什么是OAuth" class="headerlink" title="1 什么是OAuth"></a>1 什么是OAuth</h1><p>官网这样说…</p><blockquote><p>An <strong>open protocol</strong> to allow <strong>secure authorization</strong> in a <strong>simple</strong> and <strong>standard</strong> method from web, mobile and desktop applications.</p></blockquote><ul><li>OAuth 即 <strong>O</strong>pen standard for <strong>Auth</strong>orization</li><li>OAuth就是一个网络开放协议。为保证用户资源的安全授权提供了简易的标准</li><li>在知乎上看到了一个比较直观的比喻，有助于初学者理解。<a href="https://link.jianshu.com?t=http://www.zhihu.com/question/19781476" target="_blank" rel="noopener">知乎话题链接</a></li></ul><h1 id="2-OAuth历史版本"><a href="#2-OAuth历史版本" class="headerlink" title="2 OAuth历史版本"></a>2 OAuth历史版本</h1><p><strong>2007-12</strong> OAuth 1.0发布并迅速成为工业标准。</p><p><strong>2008-06</strong> OAuth 1.0 Revision A发布，这是个稍作修改的修订版本，主要修正一个安全方面的漏洞。</p><p><strong>2010-04</strong>，OAuth 1.0 协议发布为 <a href="https://link.jianshu.com?t=http://www.rfcreader.com/#rfc5849" target="_blank" rel="noopener">RFC 5849</a></p><p><strong>2011-05</strong> OAuth 2.0 草案发布</p><p><strong>2012-10</strong> OAuth 2.0 协议发布为 <a href="https://link.jianshu.com?t=http://www.rfcreader.com/#rfc6749" target="_blank" rel="noopener">RFC 6749</a></p><a id="more"></a><h1 id="3-OAuth-1-0"><a href="#3-OAuth-1-0" class="headerlink" title="3 OAuth 1.0"></a>3 OAuth 1.0</h1><p>OAuth 1.0 协议过于复杂，易用性差，所以并没有得到普及，下文中给出了授权的流程图，可以简单了解了解，现在很少有用的了。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/1.webp" alt="image"></p><p>关于OAuth 1.0， 想了解的可以看看这些：</p><ul><li><a href="https://link.jianshu.com/?t=http://www.rfcreader.com/#rfc5849" target="_blank" rel="noopener">RFC 5849</a></li><li><a href="https://link.jianshu.com/?t=http://blog.csdn.net/hereweare2009/article/details/3968582" target="_blank" rel="noopener">OAUTH协议简介</a></li></ul><h1 id="4-OAuth-2-0"><a href="#4-OAuth-2-0" class="headerlink" title="4 OAuth 2.0"></a>4 OAuth 2.0</h1><p>OAuth 2.0是目前的最新版本，OAuth 2.0不兼容OAuth 1.0。这篇文章主要讲讲OAuth 2.0，并以此展开。</p><p><strong>先来说一个场景：</strong>比如你第一次打开简书官网，想要注册一个账号。你会看到简书允许你通过新浪微博账号登陆。当你点击之后，需要你登陆微博。之后会出现“是否同意简书获取你的个人信息”等等，如果你选择授权，之后会跳转回简书。你会发现你在简书的用户名就是你微博的用户名。然后，你会发出一条新的微博比如“我加入了简书，一个基于内容分享的社区！”(这只是举个例子，不知道简书有没有这样做)。</p><p>好了，这回开始进入正题</p><h2 id="4-1-角色（roles）"><a href="#4-1-角色（roles）" class="headerlink" title="4.1 角色（roles）"></a>4.1 角色（roles）</h2><p>OAuth 2.0 定义了<strong>四个角色</strong>：</p><ul><li><strong>资源拥有者(Resource Owner)</strong><br> 资源拥有者其实就是用户(user)，用户将会授权一个第三方应用可以获取他们的账户资源。当然第三方应用程序对于用户账户的操作是有限制的(比如，read access, read and write access)！这个限制就是用户授权时给予的权限范围(<strong>scope</strong>)<br> 上面场景中，微博账户就是资源拥有者。read access就比如读取微博用户名，write access就比如以你的名义发了一个微博。</li><li><strong>客户端(Client)</strong><br> 客户端就是前面说的第三方应用程序，他们想要获取用户的账户资源，但在这么做之前必须经过授权<br> 上面场景中，简书就是客户端</li><li><strong>资源服务器(Resource Server)</strong><br> 资源服务器存放用户账户以及账户信息和资源<br> 上面场景中，新浪微博就是资源服务器，同时也是授权服务器</li><li><strong>授权服务器(Authorization Server)</strong><br> 授权服务器验证用户身份，并为第三方应用程序颁发授权令牌(access token)</li></ul><p>资源服务器与授权服务器可以是同一台服务器，这里分开主要是便于解释清楚OAuth协议。从程序开发者的角度，这两个都是service’s API会执行的事情。</p><p>在了解完OAuth中的四个角色之后，我们看看这四个角色之间是如何互动的。下面是基本运行流程。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/2.webp" alt="image"></p><ol><li>应用程序向用户请求给予授权，以便获取服务器资源</li></ol><ul><li>如果用户同意授权，应用程序将获得相应授权</li><li>应用程序向授权服务器提供自己的身份证明(app key和app secret)和已被授权的证明(authorization grant)，并请求访问令牌(access token)</li><li>如果应用程序的身份被核实，并且授权是有效地，那么授权服务器将会发放访问令牌给应用程序。<strong>此时，授权完成</strong></li><li>应用程序向资源服务器出示访问令牌，并请求资源</li><li>如果访问令牌是有效的(比如：是否伪造，是否越权，是否过期)，资源服务器将会为应用程序提供资源</li></ul><h2 id="4-2-应用程序注册-Application-Registration"><a href="#4-2-应用程序注册-Application-Registration" class="headerlink" title="4.2 应用程序注册(Application Registration)"></a>4.2 应用程序注册(Application Registration)</h2><p>对于一个应用程序来说，如果它想要使用OAuth，那么首先它要在服务提供商那里注册。一般出现在网站的“developer”或者“API”部分。</p><p>应用程序要提供：</p><ul><li>应用程序名称(Application Name)</li><li>应用程序网站(Application Website)</li><li>回调URL(Redirect URI or Callback URL)</li></ul><p>在用户同意授权(或者拒绝)之后，服务提供商会将用户重新导向这个Callback URL，这个Callback URL要来负责处理授权码或者访问令牌。</p><p>应用程序注册完成之后，服务提供商会颁发给应用程序一个“客户端认证信息(client credentials)”。Client Credential包括：</p><ul><li><p>Client Identifier</p><p>(client ID/API key/consumer key)</p><ul><li>提供给服务提供商，用于<strong>识别</strong>(identify)应用程序</li><li>用于构建提供给用户请求授权的URLs</li></ul></li><li><p>Client Secret</p><p>(secret key/API secret/consumer secret)</p><ul><li>提供给服务提供商，用于<strong>验证</strong>(authenticate)应用程序</li><li>只有应用程序和服务提供商两者可知</li></ul></li></ul><h2 id="4-3-授权许可类型-Authorization-grant-types"><a href="#4-3-授权许可类型-Authorization-grant-types" class="headerlink" title="4.3 授权许可类型(Authorization grant types)"></a>4.3 授权许可类型(Authorization grant types)</h2><p><strong>OAuth 2.0 定义了四种授权模式：</strong></p><ul><li><strong>授权码模式</strong>(Authorization Code)<br> used with server-side Applications</li><li><strong>隐式授权模式</strong>(Implicit)<br> used with Mobile Apps or Web Applications (applications that run on the user’s device)</li><li><strong>资源拥有者密码凭证模式</strong>(Resource Owner Password Credentials)<br> used with trusted Applications, such as those owned by the service itself</li><li><strong>客户端模式</strong>(Client Credentials)<br> used with Applications API access</li></ul><h2 id="4-4-授权码模式-Authorization-Code"><a href="#4-4-授权码模式-Authorization-Code" class="headerlink" title="4.4 授权码模式(Authorization Code)"></a>4.4 授权码模式(Authorization Code)</h2><ul><li>授权码模式是最常见的一种授权模式，最为安全和完善。</li><li>对于服务器端应用程序(server-side application)来说，可以保证Client Secret的安全性。应用程序必须能够和用户代理(user agent)进行交互，获取API授权码。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/3.webp" alt="image"></p><p><strong>第一步：客户端把用户代理定向到授权终端(Authorizaiton Endpoint)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com/v1/oauth/authorize?response_type=code&amp;client_id=CLIENT_ID&amp;redirect_uri=CALLBACK_URL&amp;scope=<span class="built_in">read</span></span><br></pre></td></tr></table></figure><ul><li><strong><a href="https://link.jianshu.com?t=http://www.example.com/v1/oauth/authorize" target="_blank" rel="noopener">www.example.com/v1/oauth/authorize</a></strong>: API授权的终端(Authorization Endpoint)</li><li><strong>client_id</strong>: 应用程序的client ID，用于API识别应用程序</li><li><strong>redirect_uri</strong>：获得授权码之后，服务提供商重定向用户代理(比如浏览器)的地址</li><li><strong>response_type</strong>：表明授权类型，默认值是code，即授权码模式(Authorization Code Grant)</li><li><strong>scope</strong>: 即应用程序可以获得的授权级别(access level)，默认值为read</li><li><strong>state</strong>: 表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值，用于抵制CSRF攻击。</li></ul><p><strong>第二步：用户授权应用程序</strong></p><p>用户点击上述URI之后，用户首先要登陆，证明其身份。然后选择同意授权应用程序可以访问他们的账户或者拒绝。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/4.webp" alt="image"></p><p><strong>第三步：应用程序获取授权码</strong></p><p>如果用户同意授权，服务提供商会将用户代理重定向到第一步中的redirect_uri，并且会包含<strong>授权码</strong>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.jianshu.com/callback?code=AUTHORIZATION_CODE</span></span><br></pre></td></tr></table></figure><p><strong>第四步：应用程序请求授权令牌</strong></p><p>应用程序向API token终端发送刚刚获得的授权码，以及认证信息。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/v1/oauth/token?client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET&amp;grant_type=authorization_code&amp;code=AUTHORIZATION_CODE&amp;redirect_uri=CALLBACK_URL</span></span><br></pre></td></tr></table></figure><p>URI中包括：</p><ul><li><strong><a href="https://link.jianshu.com?t=http://www.example.com/v1/oauth/token" target="_blank" rel="noopener">www.example.com/v1/oauth/token</a></strong>： API token的终端</li><li><strong>client_id</strong>：即app key/consumer key，用于验证应用程序</li><li><strong>client_secret</strong>： 即app secret/consumer secret，用于验证应用程序</li><li><strong>grant_type</strong>：刚刚获得的授权码</li><li><strong>redirect_uri</strong>: 重定向URI，与第一步一致</li></ul><p><strong>第五步：应用程序获得授权令牌</strong></p><p>如果上一步验证有效，API将返回一个HTTP回复。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"access_token"</span>:<span class="string">"ACCESS_TOKEN"</span>,<span class="attr">"token_type"</span>:<span class="string">"bearer"</span>,<span class="attr">"expires_in"</span>:<span class="number">2592000</span>,<span class="attr">"refresh_token"</span>:<span class="string">"REFRESH_TOKEN"</span>,<span class="attr">"scope"</span>:<span class="string">"read"</span>&#125;</span><br></pre></td></tr></table></figure><p>HTTP回复中包含：</p><ul><li><strong>access_token</strong>：访问令牌</li><li><strong>token_type</strong>：令牌类型，bearer类型或mac类型。<a href="https://link.jianshu.com?t=http://oauth2.thephpleague.com/token-types/" target="_blank" rel="noopener">详细</a></li><li><strong>expires_in</strong>：过期时间，单位为秒。</li><li><strong>refresh_token</strong>：更新令牌，用来获取下一次的访问令牌，可选项。</li><li><strong>scope</strong>：权限范围，如果与客户端申请的范围一致，此项可省略。</li></ul><h2 id="4-5-隐式授权模式-Implicit"><a href="#4-5-隐式授权模式-Implicit" class="headerlink" title="4.5 隐式授权模式(Implicit)"></a>4.5 隐式授权模式(Implicit)</h2><ul><li>隐式授权模式主要用于客户端应用程序(client-side application)，比如手机应用、桌面客户端应用程序和运行于浏览器上的web应用程序。</li><li>因为没有server端，client secret的保密性不能得到保证。授权令牌给予用户代理(比如，浏览器)，再由用户代理交给应用程序。所以用户设备上的其他应用程序同样可以得到授权令牌。</li><li>隐式授权模式中，应用程序不需要认证。</li><li>隐式授权模式不支持refresh token。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/5.webp" alt="image"></p><p><strong>第一步：客户端把用户代理定向到授权终端(Authorizaiton Endpoint)</strong></p><ul><li>授权终端是<code>https://www.example.com/authorize</code></li><li>与授权码链接类似，只不过response_type=<code>token</code>而不是<code>code</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com/authorize?response_type=token&amp;client_id=CLIENT_ID&amp;redirect_uri=CALLBACK_URL&amp;scope=<span class="built_in">read</span></span><br></pre></td></tr></table></figure><p><strong>第二步：用户授权应用程序</strong></p><p>用户点击上述URI之后，用户首先要登陆，证明其身份。然后选择同意授权应用程序可访问他们的账户或者拒绝。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/6.webp" alt="image"></p><p><strong>第三步：用户代理收到授权令牌</strong></p><p>假设用户同意授权，授权服务器重定向用户代理到第一步提到的redirect_uri。并在URI fragment中包含授权令牌(但不能查看)。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.example.com/callback</span><span class="comment">#token=ACCESS_TOKEN</span></span><br></pre></td></tr></table></figure><p><strong>第四步：用户代理向资源服务器发出请求</strong></p><p>用户代理依照重定向的指令，向资源服务器发出请求，但并不包含上一步中得到的授权令牌(#后面的部分)。用户代理将完整的重定向URI保存在本地。</p><p><strong>第五步：资源服务器返回一个网页</strong></p><p>资源服务器会返回一个网页(通常是一个HTML文件内嵌一段脚本)。这段内嵌的脚本(script)可以访问第三步中用户代理保存在本地的完整的重定向URI，并从中提取授权令牌。</p><p><strong>第六步：用户代理提取授权令牌</strong></p><p>用户代理执行上面提到的脚本，提取出授权令牌。然后将授权令牌传递给应用程序。</p><h2 id="4-6-资源拥有者密码凭证模式-Resource-Owner-Password-Credentials"><a href="#4-6-资源拥有者密码凭证模式-Resource-Owner-Password-Credentials" class="headerlink" title="4.6 资源拥有者密码凭证模式(Resource Owner Password Credentials)"></a>4.6 资源拥有者密码凭证模式(Resource Owner Password Credentials)</h2><ul><li>在资源拥有者密码凭证模式中，用户直接向应用程序提供其认证信息(即用户名和密码)。应用程序依此向授权服务器获取授权令牌。</li><li>这种模式适用于用户对应用程序高度信任的情况。比如是用户操作系统的一部分。</li><li>认证服务器只有在其他授权模式无法执行的情况下，才能考虑使用这种模式。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/7.webp" alt="image"></p><p><strong>第一步：用户传递认证信息</strong></p><p>用户将用户名和密码交给应用程序。</p><p><strong>第二步：应用程序请求授权令牌</strong></p><ul><li>应用程序得到用户认证信息后，向授权服务器请求授权令牌。</li><li>请求授权令牌终端<code>https://www.example.com/token</code></li><li>response_type=<code>password</code>，前面提到的两种分别是<code>code</code>和<code>token</code>。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/token?grant_type=password&amp;username=USERNAME&amp;password=PASSWORD&amp;client_id=CLIENT_ID</span></span><br></pre></td></tr></table></figure><p><strong>第三步：授权服务器返回授权令牌</strong></p><p>如果用户的认证信息得到验证，授权服务器将向应用程序返回授权令牌。</p><h2 id="4-7-客户端模式-Client-Credentials"><a href="#4-7-客户端模式-Client-Credentials" class="headerlink" title="4.7 客户端模式(Client Credentials)"></a>4.7 客户端模式(Client Credentials)</h2><ul><li>客户端模式应用于应用程序想要以自己的名义与授权服务器以及资源服务器进行互动。</li><li>比如应用程序想要修改自身注册信息或者redirect URI。又或者想要获取资源服务器中不与具体用户相关的信息。比如一个应用程序想要获取新浪微博中含有#happy的微博。</li><li>严格意义上说，客户端模式并不是OAuth协议要解决的问题，因为并未涉及授权。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/8.webp" alt="image"></p><p><strong>第一步：应用程序请求授权令牌</strong></p><ul><li>应用程序向授权服务器提供自身认证信息(client ID和client secret)，并请求授权令牌。</li><li>请求授权令牌终端<code>https://www.example.com/token</code></li><li>response_type=<code>client_credentials</code>，前面提到的两种分别是<code>code</code>、<code>token</code>和<code>password</code>。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/token?grant_type=client_credentials&amp;client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET</span></span><br></pre></td></tr></table></figure><p><strong>第二步：授权服务器返回授权令牌</strong></p><p>授权服务器验证认证信息，向应用程序返回授权令牌。</p><h2 id="4-8-更新令牌-Refresh-Token"><a href="#4-8-更新令牌-Refresh-Token" class="headerlink" title="4.8 更新令牌(Refresh Token)"></a>4.8 更新令牌(Refresh Token)</h2><ul><li>如果授权令牌过期，在进行API请求时会报错<code>Invalid Token Error</code></li><li>如果在获取授权令牌时，同时获得了refresh token，那么我们可以向授权服务器申请更新令牌。</li><li>grant_type = <code>refresh_token</code></li><li>scope：表示申请的授权范围，不可以超出上一次申请的范围，如果省略该参数，则表示与上一次一致。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/v1/oauth/token?grant_type=refresh_token&amp;client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET&amp;refresh_token=REFRESH_TOKEN</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考文章&quot;&gt;&lt;a href=&quot;#0-参考文章&quot; class=&quot;headerlink&quot; title=&quot;0 参考文章&quot;&gt;&lt;/a&gt;0 参考文章&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/b06944c92228&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/b06944c92228&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-什么是OAuth&quot;&gt;&lt;a href=&quot;#1-什么是OAuth&quot; class=&quot;headerlink&quot; title=&quot;1 什么是OAuth&quot;&gt;&lt;/a&gt;1 什么是OAuth&lt;/h1&gt;&lt;p&gt;官网这样说…&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An &lt;strong&gt;open protocol&lt;/strong&gt; to allow &lt;strong&gt;secure authorization&lt;/strong&gt; in a &lt;strong&gt;simple&lt;/strong&gt; and &lt;strong&gt;standard&lt;/strong&gt; method from web, mobile and desktop applications.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;OAuth 即 &lt;strong&gt;O&lt;/strong&gt;pen standard for &lt;strong&gt;Auth&lt;/strong&gt;orization&lt;/li&gt;
&lt;li&gt;OAuth就是一个网络开放协议。为保证用户资源的安全授权提供了简易的标准&lt;/li&gt;
&lt;li&gt;在知乎上看到了一个比较直观的比喻，有助于初学者理解。&lt;a href=&quot;https://link.jianshu.com?t=http://www.zhihu.com/question/19781476&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;知乎话题链接&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;2-OAuth历史版本&quot;&gt;&lt;a href=&quot;#2-OAuth历史版本&quot; class=&quot;headerlink&quot; title=&quot;2 OAuth历史版本&quot;&gt;&lt;/a&gt;2 OAuth历史版本&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;2007-12&lt;/strong&gt; OAuth 1.0发布并迅速成为工业标准。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2008-06&lt;/strong&gt; OAuth 1.0 Revision A发布，这是个稍作修改的修订版本，主要修正一个安全方面的漏洞。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2010-04&lt;/strong&gt;，OAuth 1.0 协议发布为 &lt;a href=&quot;https://link.jianshu.com?t=http://www.rfcreader.com/#rfc5849&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 5849&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2011-05&lt;/strong&gt; OAuth 2.0 草案发布&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2012-10&lt;/strong&gt; OAuth 2.0 协议发布为 &lt;a href=&quot;https://link.jianshu.com?t=http://www.rfcreader.com/#rfc6749&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 6749&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="OAuth" scheme="https://gongzhao1.coding.me/tags/OAuth/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes之Ingress</title>
    <link href="https://gongzhao1.coding.me/Kubernetes%E4%B9%8BIngress/"/>
    <id>https://gongzhao1.coding.me/Kubernetes之Ingress/</id>
    <published>2020-04-08T14:50:08.000Z</published>
    <updated>2020-05-24T08:41:54.770Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/qianghaohao/article/details/99354304" target="_blank" rel="noopener">https://blog.csdn.net/qianghaohao/article/details/99354304</a></li><li><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx</a></li><li><a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md</a></li><li><a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/</a></li></ul><h1 id="1-k8s-对外暴露服务的方法"><a href="#1-k8s-对外暴露服务的方法" class="headerlink" title="1 k8s 对外暴露服务的方法"></a>1 k8s 对外暴露服务的方法</h1><p>向 k8s 集群外部暴露服务的方式有三种： nodePort，LoadBalancer 和本文要介绍的 Ingress。每种方式都有各自的优缺点，nodePort 方式在服务变多的情况下会导致节点要开的端口越来越多，不好管理。而 LoadBalancer 更适合结合云提供商的 LB 来使用，但是在 LB 越来越多的情况下对成本的花费也是不可小觑。Ingress 是 k8s 官方提供的用于对外暴露服务的方式，也是在生产环境用的比较多的方式，一般在云环境下是 LB + Ingress Ctroller 方式对外提供服务，这样就可以在一个 LB 的情况下根据域名路由到对应后端的 Service，有点类似于 Nginx 反向代理，只不过在 k8s 集群中，这个反向代理是集群外部流量的统一入口。</p><h1 id="2-Ingress-及-Ingress-Controller-简介"><a href="#2-Ingress-及-Ingress-Controller-简介" class="headerlink" title="2 Ingress 及 Ingress Controller 简介"></a>2 Ingress 及 Ingress Controller 简介</h1><p>Ingress 是 k8s 资源对象，用于对外暴露服务，该资源对象定义了不同主机名（域名）及 URL 和对应后端 Service（k8s Service）的绑定，根据不同的路径路由 http 和 https 流量。而 Ingress Contoller 是一个 pod 服务，封装了一个 web 前端负载均衡器，同时在其基础上实现了动态感知 Ingress 并根据 Ingress 的定义动态生成 前端 web 负载均衡器的配置文件，比如 Nginx Ingress Controller 本质上就是一个 Nginx，只不过它能根据 Ingress 资源的定义动态生成 Nginx 的配置文件，然后动态 Reload。个人觉得 Ingress Controller 的重大作用是将前端负载均衡器和 Kubernetes 完美地结合了起来，一方面在云、容器平台下方便配置的管理，另一方面实现了集群统一的流量入口，而不是像 nodePort 那样给集群打多个孔。<br><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/1.png" alt="image"></p><p>所以，总的来说要使用 Ingress，得先部署 Ingress Controller 实体（相当于前端 Nginx），然后再创建 Ingress （相当于 Nginx 配置的 k8s 资源体现），Ingress Controller 部署好后会动态检测 Ingress 的创建情况生成相应配置。Ingress Controller 的实现有很多种：有基于 Nginx 的，也有基于 HAProxy的，还有基于 OpenResty 的 Kong Ingress Controller 等，更多 Controller 见：<a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于</a> Nginx 的 Ingress Controller：<a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>。</p><a id="more"></a><h1 id="3-helm-部署-Nginx-Ingress-Controller"><a href="#3-helm-部署-Nginx-Ingress-Controller" class="headerlink" title="3 helm 部署 Nginx Ingress Controller"></a>3 helm 部署 Nginx Ingress Controller</h1><p>基于 Nginx 的 Ingress Controller 有两种，一种是 k8s 社区提供的 <a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>，另一种是 Nginx 社区提供的 <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">kubernetes-igress</a>，关于两者的区别见 <a href="https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/nginx-ingress-controllers.md" target="_blank" rel="noopener">这里</a>。</p><p>在这里我们部署 k8s 社区提供的 <a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>，Ingress Controller 对外暴露方式采用 hostNetwork，在裸机环境下更多其他暴露方式见：<a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/</a><br><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/2.png" alt="image"></p><p>使用 Helm 官方提供的 Chart <a href="stable/nginx-ingress">stable/nginx-ingress</a>，修改 values 文件：</p><ul><li>使用 DaemonSet 控制器，默认是 Deployment：controller.kind 设为 DaemonSet；</li><li>pod 使用主机网络：controller.hostNetwork 设为 true；</li><li>在hostNetwork 下 pod 使用集群提供 dns 服务：controller.dnsPolicy 设为 ClusterFirstWithHostNet；</li><li>Service 类型设为 ClusterIP，默认是 LoadBalancer：controller.service.type 设为 ClusterIP；</li><li>默认后端镜像使用 docker hub 提供的镜像，Google 国内无法访问；</li></ul><p>helm 部署(国内可以使用微软的helm源)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install stable/nginx-ingress --name nginx-ingress -f myValues.yaml</span><br></pre></td></tr></table></figure><p>部署完成后我们可以看到 Kubernetes 服务中增加了 <code>nginx-ingress-controller</code> 和 <code>nginx-ingress-default-backend</code> 两个服务。<code>nginx-ingress-controller</code> 为 <code>Ingress Controller</code>，主要做为一个七层的负载均衡器来提供 HTTP 路由、粘性会话、SSL 终止、SSL直通、TCP 和 UDP 负载平衡等功能。<code>nginx-ingress-default-backend</code> 为默认的后端，当集群外部的请求通过 Ingress 进入到集群内部时，如果无法负载到相应后端的 Service 上时，这种未知的请求将会被负载到这个默认的后端上。nginx-ingress-default-backend 默认提供了两个 URL 进行访问，其中的 /healthz 用作健康检查返回 200，而 / 返回 404 错误。</p><h1 id="4-使用-Ingress-对外暴露服务-7层"><a href="#4-使用-Ingress-对外暴露服务-7层" class="headerlink" title="4 使用 Ingress 对外暴露服务-7层"></a>4 使用 Ingress 对外暴露服务-7层</h1><h2 id="4-1-HTTP类型服务"><a href="#4-1-HTTP类型服务" class="headerlink" title="4.1 HTTP类型服务"></a>4.1 HTTP类型服务</h2><p>为了快速体验 Ingress，下面部署一个 nginx 服务，然后通过 Ingress 对外暴露 nginx service 进行访问。<br>首先部署 nginx 服务：<br>Deployment + Service</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.7.9</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>接下来创建 Ingress 对外暴露 nginx service 80 端口：<br>ingress.yml:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="comment"># use the shared ingress-nginx</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">nginx.kube.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>kubernetes.io/ingress.class: “nginx”：Nginx Ingress Controller 根据该注解自动发现 Ingress；</li><li>host: nginx.kube.com：对外访问的域名；</li><li>serviceName: nginx：对外暴露的 Service 名称；</li><li>servicePort: 80：nginx service 监听的端口；</li></ul><blockquote><p>创建的 Ingress 必须要和对外暴露的 Service 在同一命名空间下！</p></blockquote><h2 id="4-2-HTTPS类型服务"><a href="#4-2-HTTPS类型服务" class="headerlink" title="4.2 HTTPS类型服务"></a>4.2 HTTPS类型服务</h2><p><strong>通过 Ingress 访问 kubernetes dashboard（支持 HTTPS 访问）</strong><br>首先，练习使用，先用自签名证书来代替吧：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout kube-dashboard.key -out kube-dashboard.crt -subj <span class="string">"/CN=dashboard.kube.com/O=dashboard.kube.com"</span></span><br></pre></td></tr></table></figure><p>使用生成的证书创建 k8s Secret 资源，下一步创建的 Ingress 会引用这个 Secret：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls kube-dasboard-ssl --key kube-dashboard.key --cert kube-dashboard.crt -n kube-system</span><br></pre></td></tr></table></figure><p>创建 Ingress 资源对象（支持 HTTPS 访问）：</p><p>kube-dashboard-ingress.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ingress-kube-dashboard</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="comment"># use the shared ingress-nginx</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/backend-protocol:</span> <span class="string">"HTTPS"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  tls:</span></span><br><span class="line"><span class="attr">  - hosts:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dashboard.kube.com</span></span><br><span class="line"><span class="attr">    secretName:</span> <span class="string">kube-dasboard-ssl</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">dashboard.kube.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">443</span></span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>kubernetes.io/ingress.class: “nginx”：Inginx Ingress Controller 根据该注解自动发现 Ingress；</li><li>nginx.ingress.kubernetes.io/backend-protocol: Controller 向后端 Service 转发时使用 HTTPS 协议，这个注解必须添加，否则访问会报错</li></ul><ul><li>secretName: kube-dasboard-ssl：https 证书 Secret；</li><li>host: dashboard.kube.com：对外访问的域名；</li><li>serviceName: kubernetes-dashboard：集群对外暴露的 Service 名称；</li><li>servicePort: 443：service 监听的端口；</li></ul><blockquote><p>注意：创建的 Ingress 必须要和对外暴露的 Service 在同一命名空间下！</p></blockquote><p>将域名 dashboard.kube.com绑定到 k8s 任意节点 ip 即可访问.</p><h2 id="4-3-basic-auth认证"><a href="#4-3-basic-auth认证" class="headerlink" title="4.3 basic-auth认证"></a>4.3 basic-auth认证</h2><h3 id="4-3-1-创建用户名密码"><a href="#4-3-1-创建用户名密码" class="headerlink" title="4.3.1 创建用户名密码"></a>4.3.1 创建用户名密码</h3><p>首先需要安装htpasswd二进制文件，通过htpasswd生成一个“auth”文件;用来存取我们创建的用户及加密之后的密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c auth user1</span><br><span class="line">New password: &lt;bar&gt;</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user user1</span><br><span class="line"></span><br><span class="line">htpasswd auth user2</span><br><span class="line">2nd user:</span><br><span class="line">htpasswd auth user2</span><br><span class="line">New password: &lt;bar&gt;</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user user2</span><br></pre></td></tr></table></figure><h3 id="4-3-2-创建kubernetes-secret来存储user-pass-pairs"><a href="#4-3-2-创建kubernetes-secret来存储user-pass-pairs" class="headerlink" title="4.3.2 创建kubernetes secret来存储user/pass pairs"></a>4.3.2 创建kubernetes secret来存储user/pass pairs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n &lt;namespace&gt; create secret generic basic-auth --from-file=auth</span><br><span class="line">secret <span class="string">"basic-auth"</span> created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get secret basic-auth -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  auth: Zm9vOiRhcHIxJE9DRzZYeWJcJGNrKDBGSERBa29YWUlsSDkuY3lzVDAK</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: basic-auth</span><br><span class="line">  namespace: default</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><h3 id="4-3-3-创建Ingress"><a href="#4-3-3-创建Ingress" class="headerlink" title="4.3.3 创建Ingress"></a>4.3.3 创建Ingress</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  annotations:</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-type: basic</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-secret: basic-auth   #此secret需和ingress在用一namespace下</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-realm: &quot;Authentication Required&quot; #提示符</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">    - host: prom.xxxxx.im</span><br><span class="line">      http:</span><br><span class="line">        paths:</span><br><span class="line">          - path: /</span><br><span class="line">            backend:</span><br><span class="line">              serviceName: prometheus-svc</span><br><span class="line">              servicePort: 9090</span><br></pre></td></tr></table></figure><h2 id="4-4-多路径及虚拟主机例子"><a href="#4-4-多路径及虚拟主机例子" class="headerlink" title="4.4 多路径及虚拟主机例子"></a>4.4 多路径及虚拟主机例子</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-ingress</span></span><br><span class="line"><span class="attr">  annotations:</span> </span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/use-regex:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">api.mydomain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">api</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">domain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/web/*</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">backoffice.domain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">backoffice</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><h1 id="5-使用-Ingress-对外暴露服务-4层"><a href="#5-使用-Ingress-对外暴露服务-4层" class="headerlink" title="5 使用 Ingress 对外暴露服务-4层"></a>5 使用 Ingress 对外暴露服务-4层</h1><p>我们可以看到ingress nginx的args里有这两行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span><br><span class="line">- --udp-services-configmap=$(POD_NAMESPACE)/udp-services</span><br></pre></td></tr></table></figure><p>从选项和值可以猜测出，要想代理四层（tcp/udp），得写同namespace里一个名为<code>tcp-service</code>和<code>udp-service</code>的两个configmap的数据 四层的话这边我们创建一个mysql的pod，来代理3306端口到集群外面，则需要写tcp-services这个configmap：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: tcp-services</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">data:</span><br><span class="line">  3306: &quot;default/mysql:3306&quot;</span><br></pre></td></tr></table></figure><p>四层写这两个ConfigMap的data即可，按照这样去写即可<code>out_port: namespaces/svc_name:port</code>，要给每个ingress加一些nginx里的配置可以查看官方的annotation字段以及值（traefik同理）。</p><p><strong>如果我们用如上helm方式部署ingress-nginx的话</strong></p><p>直接编辑它的vales.yaml文件，在TCP/UDP字段之后添加<code>out_port: namespaces/svc_name:port</code>即可，helm会自动帮你生成对应的configmap，并暴露对应的四层端口</p><p><strong>其他例子</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">udp-services</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="number">2200</span><span class="string">:</span> <span class="string">"default/gitlab:22"</span></span><br><span class="line">  <span class="number">3306</span><span class="string">:</span> <span class="string">"kube-public/mysql:3306"</span></span><br><span class="line">  <span class="number">2202</span><span class="string">:</span> <span class="string">"kube-public/centos:22"</span></span><br><span class="line">  <span class="number">2203</span><span class="string">:</span> <span class="string">"kube-public/mongodb:27017"</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">udp-services</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="number">53</span><span class="string">:</span> <span class="string">"kube-system/kube-dns:53"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/qianghaohao/article/details/99354304&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/qianghaohao/article/details/99354304&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/ingress-nginx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/kubernetes/ingress-nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.github.io/ingress-nginx/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-k8s-对外暴露服务的方法&quot;&gt;&lt;a href=&quot;#1-k8s-对外暴露服务的方法&quot; class=&quot;headerlink&quot; title=&quot;1 k8s 对外暴露服务的方法&quot;&gt;&lt;/a&gt;1 k8s 对外暴露服务的方法&lt;/h1&gt;&lt;p&gt;向 k8s 集群外部暴露服务的方式有三种： nodePort，LoadBalancer 和本文要介绍的 Ingress。每种方式都有各自的优缺点，nodePort 方式在服务变多的情况下会导致节点要开的端口越来越多，不好管理。而 LoadBalancer 更适合结合云提供商的 LB 来使用，但是在 LB 越来越多的情况下对成本的花费也是不可小觑。Ingress 是 k8s 官方提供的用于对外暴露服务的方式，也是在生产环境用的比较多的方式，一般在云环境下是 LB + Ingress Ctroller 方式对外提供服务，这样就可以在一个 LB 的情况下根据域名路由到对应后端的 Service，有点类似于 Nginx 反向代理，只不过在 k8s 集群中，这个反向代理是集群外部流量的统一入口。&lt;/p&gt;
&lt;h1 id=&quot;2-Ingress-及-Ingress-Controller-简介&quot;&gt;&lt;a href=&quot;#2-Ingress-及-Ingress-Controller-简介&quot; class=&quot;headerlink&quot; title=&quot;2 Ingress 及 Ingress Controller 简介&quot;&gt;&lt;/a&gt;2 Ingress 及 Ingress Controller 简介&lt;/h1&gt;&lt;p&gt;Ingress 是 k8s 资源对象，用于对外暴露服务，该资源对象定义了不同主机名（域名）及 URL 和对应后端 Service（k8s Service）的绑定，根据不同的路径路由 http 和 https 流量。而 Ingress Contoller 是一个 pod 服务，封装了一个 web 前端负载均衡器，同时在其基础上实现了动态感知 Ingress 并根据 Ingress 的定义动态生成 前端 web 负载均衡器的配置文件，比如 Nginx Ingress Controller 本质上就是一个 Nginx，只不过它能根据 Ingress 资源的定义动态生成 Nginx 的配置文件，然后动态 Reload。个人觉得 Ingress Controller 的重大作用是将前端负载均衡器和 Kubernetes 完美地结合了起来，一方面在云、容器平台下方便配置的管理，另一方面实现了集群统一的流量入口，而不是像 nodePort 那样给集群打多个孔。&lt;br&gt;&lt;img src=&quot;https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/1.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;所以，总的来说要使用 Ingress，得先部署 Ingress Controller 实体（相当于前端 Nginx），然后再创建 Ingress （相当于 Nginx 配置的 k8s 资源体现），Ingress Controller 部署好后会动态检测 Ingress 的创建情况生成相应配置。Ingress Controller 的实现有很多种：有基于 Nginx 的，也有基于 HAProxy的，还有基于 OpenResty 的 Kong Ingress Controller 等，更多 Controller 见：&lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于&lt;/a&gt; Nginx 的 Ingress Controller：&lt;a href=&quot;https://github.com/nginxinc/kubernetes-ingress&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ingress-nginx&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://gongzhao1.coding.me/categories/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://gongzhao1.coding.me/tags/kubernetes/"/>
    
      <category term="ingress" scheme="https://gongzhao1.coding.me/tags/ingress/"/>
    
  </entry>
  
  <entry>
    <title>python模块之logging</title>
    <link href="https://gongzhao1.coding.me/python%E6%A8%A1%E5%9D%97%E4%B9%8Blogging/"/>
    <id>https://gongzhao1.coding.me/python模块之logging/</id>
    <published>2020-03-24T08:24:47.000Z</published>
    <updated>2020-04-08T14:20:25.872Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/yyds/p/6901864.html" target="_blank" rel="noopener">https://www.cnblogs.com/yyds/p/6901864.html</a></li><li><a href="https://www.cnblogs.com/yuanyongqiang/p/11913812.html" target="_blank" rel="noopener">https://www.cnblogs.com/yuanyongqiang/p/11913812.html</a></li><li><a href="https://www.cnblogs.com/nancyzhu/p/8551506.html" target="_blank" rel="noopener">https://www.cnblogs.com/nancyzhu/p/8551506.html</a></li></ul><h1 id="日志相关概念"><a href="#日志相关概念" class="headerlink" title="日志相关概念"></a>日志相关概念</h1><p>日志是一种可以追踪某些软件运行时所发生事件的方法。软件开发人员可以向他们的代码中调用日志记录相关的方法来表明发生了某些事情。一个事件可以用一个可包含可选变量数据的消息来描述。此外，事件也有重要性的概念，这个重要性也可以被称为严重性级别（level）。</p><h2 id="日志的作用"><a href="#日志的作用" class="headerlink" title="日志的作用"></a>日志的作用</h2><p>通过log的分析，可以方便用户了解系统或软件、应用的运行情况；如果你的应用log足够丰富，也可以分析以往用户的操作行为、类型喜好、地域分布或其他更多信息；如果一个应用的log同时也分了多个级别，那么可以很轻易地分析得到该应用的健康状况，及时发现问题并快速定位、解决问题，补救损失。<br>简单来讲就是，我们通过记录和分析日志可以了解一个系统或软件程序运行情况是否正常，也可以在应用程序出现故障时快速定位问题。比如，做运维的同学，在接收到报警或各种问题反馈后，进行问题排查时通常都会先去看各种日志，大部分问题都可以在日志中找到答案。再比如，做开发的同学，可以通过IDE控制台上输出的各种日志进行程序调试。对于运维老司机或者有经验的开发人员，可以快速的通过日志定位到问题的根源。可见，日志的重要性不可小觑。日志的作用可以简单总结为以下3点：</p><ul><li>程序调试</li><li>了解软件程序运行情况，是否正常</li><li>软件程序运行故障分析与问题定位</li></ul><p>如果应用的日志信息足够详细和丰富，还可以用来做用户行为分析，如：分析用户的操作行为、类型洗好、地域分布以及其它更多的信息，由此可以实现改进业务、提高商业利益。</p><h2 id="日志的等级"><a href="#日志的等级" class="headerlink" title="日志的等级"></a>日志的等级</h2><p>我们先来思考下下面的两个问题：</p><ul><li>作为开发人员，在开发一个应用程序时需要什么日志信息？在应用程序正式上线后需要什么日志信息？</li><li>作为应用运维人员，在部署开发环境时需要什么日志信息？在部署生产环境时需要什么日志信息？</li></ul><p>在软件开发阶段或部署开发环境时，为了尽可能详细的查看应用程序的运行状态来保证上线后的稳定性，我们可能需要把该应用程序所有的运行日志全部记录下来进行分析，这是非常耗费机器性能的。当应用程序正式发布或在生产环境部署应用程序时，我们通常只需要记录应用程序的异常信息、错误信息等，这样既可以减小服务器的I/O压力，也可以避免我们在排查故障时被淹没在日志的海洋里。那么，怎样才能在不改动应用程序代码的情况下实现在不同的环境记录不同详细程度的日志呢？这就是日志等级的作用了，我们通过配置文件指定我们需要的日志等级就可以了。</p><p>不同的应用程序所定义的日志等级可能会有所差别，分的详细点的会包含以下几个等级：</p><ul><li>DEBUG</li><li>INFO</li><li>NOTICE</li><li>WARNING</li><li>ERROR</li><li>CRITICAL</li><li>ALERT</li><li>EMERGENCY</li></ul><h2 id="日志字段信息与日志格式"><a href="#日志字段信息与日志格式" class="headerlink" title="日志字段信息与日志格式"></a>日志字段信息与日志格式</h2><p>本节开始问题提到过，一条日志信息对应的是一个事件的发生，而一个事件通常需要包括以下几个内容：</p><ul><li>事件发生时间</li><li>事件发生位置</li><li>事件的严重程度–日志级别</li><li>事件内容</li></ul><p>上面这些都是一条日志记录中可能包含的字段信息，当然还可以包括一些其他信息，如进程ID、进程名称、线程ID、线程名称等。日志格式就是用来定义一条日志记录中包含那些字段的，且日志格式通常都是可以自定义的。</p><blockquote><p>说明：</p><p>输出一条日志时，日志内容和日志级别是需要开发人员明确指定的。对于而其它字段信息，只需要是否显示在日志中就可以了。</p></blockquote><h2 id="日志功能的实现"><a href="#日志功能的实现" class="headerlink" title="日志功能的实现"></a>日志功能的实现</h2><p>几乎所有开发语言都会内置日志相关功能，或者会有比较优秀的第三方库来提供日志操作功能，比如：log4j，log4php等。它们功能强大、使用简单。Python自身也提供了一个用于记录日志的标准库模块–logging。</p><h1 id="logging模块简介"><a href="#logging模块简介" class="headerlink" title="logging模块简介"></a>logging模块简介</h1><p>logging模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。logging模块是Python的一个标准库模块，由标准库模块提供日志记录API的关键好处是所有Python模块都可以使用这个日志记录功能。所以，你的应用日志可以将你自己的日志信息与来自第三方模块的信息整合起来。</p><a id="more"></a><h2 id="logging模块的日志级别"><a href="#logging模块的日志级别" class="headerlink" title="logging模块的日志级别"></a>logging模块的日志级别</h2><p>logging模块默认定义了以下几个日志等级，它允许开发人员自定义其他日志级别，但是这是不被推荐的，尤其是在开发供别人使用的库时，因为这会导致日志级别的混乱。</p><table><thead><tr><th>日志等级（level）</th><th>描述</th></tr></thead><tbody><tr><td>DEBUG</td><td>最详细的日志信息，典型应用场景是 问题诊断</td></tr><tr><td>INFO</td><td>信息详细程度仅次于DEBUG，通常只记录关键节点信息，用于确认一切都是按照我们预期的那样进行工作</td></tr><tr><td>WARNING</td><td>当某些不期望的事情发生时记录的信息（如，磁盘可用空间较低），但是此时应用程序还是正常运行的</td></tr><tr><td>ERROR</td><td>由于一个更严重的问题导致某些功能不能正常运行时记录的信息</td></tr><tr><td>CRITICAL</td><td>当发生严重错误，导致应用程序不能继续运行时记录的信息</td></tr></tbody></table><p>开发应用程序或部署开发环境时，可以使用DEBUG或INFO级别的日志获取尽可能详细的日志信息来进行开发或部署调试；应用上线或部署生产环境时，应该使用WARNING或ERROR或CRITICAL级别的日志来降低机器的I/O压力和提高获取错误日志信息的效率。日志级别的指定通常都是在应用程序的配置文件中进行指定的。</p><blockquote><p>说明：</p><ul><li>上面列表中的日志等级是从上到下依次升高的，即：DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL，而日志的信息量是依次减少的；</li><li>当为某个应用程序指定一个日志级别后，应用程序会记录所有日志级别大于或等于指定日志级别的日志信息，而不是仅仅记录指定级别的日志信息，nginx、php等应用程序以及这里要提高的python的logging模块都是这样的。同样，logging模块也可以指定日志记录器的日志级别，只有级别大于或等于该指定日志级别的日志记录才会被输出，小于该等级的日志记录将会被丢弃。</li></ul></blockquote><h2 id="logging模块的使用方式介绍"><a href="#logging模块的使用方式介绍" class="headerlink" title="logging模块的使用方式介绍"></a>logging模块的使用方式介绍</h2><p>logging模块提供了两种记录日志的方式：</p><ul><li>第一种方式是使用logging提供的模块级别的函数</li><li>第二种方式是使用Logging日志系统的四大组件</li></ul><p>其实，logging所提供的模块级别的日志记录函数也是对logging日志系统相关类的封装而已。</p><p><strong>logging模块定义的模块级别的常用函数</strong></p><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>logging.debug(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为DEBUG的日志记录</td></tr><tr><td><a href="http://logging.info/" target="_blank" rel="noopener">logging.info</a>(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为INFO的日志记录</td></tr><tr><td>logging.warning(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为WARNING的日志记录</td></tr><tr><td>logging.error(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为ERROR的日志记录</td></tr><tr><td>logging.critical(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为CRITICAL的日志记录</td></tr><tr><td>logging.log(level, <em>args, *</em>kwargs)</td><td>创建一条严重级别为level的日志记录</td></tr><tr><td>logging.basicConfig(**kwargs)</td><td>对root logger进行一次性配置</td></tr></tbody></table><p>其中<code>logging.basicConfig(**kwargs)</code>函数用于指定“要记录的日志级别”、“日志格式”、“日志输出位置”、“日志文件的打开模式”等信息，其他几个都是用于记录各个级别日志的函数。</p><p><strong>logging模块的四大组件</strong></p><table><thead><tr><th>组件</th><th>说明</th></tr></thead><tbody><tr><td>loggers</td><td>提供应用程序代码直接使用的接口</td></tr><tr><td>handlers</td><td>用于将日志记录发送到指定的目的位置</td></tr><tr><td>filters</td><td>提供更细粒度的日志过滤功能，用于决定哪些日志记录将会被输出（其它的日志记录将会被忽略）</td></tr><tr><td>formatters</td><td>用于控制日志信息的最终输出格式</td></tr></tbody></table><blockquote><p>说明： logging模块提供的模块级别的那些函数实际上也是通过这几个组件的相关实现类来记录日志的，只是在创建这些类的实例时设置了一些默认值。</p></blockquote><h2 id="使用logging提供的模块级别的函数记录日志"><a href="#使用logging提供的模块级别的函数记录日志" class="headerlink" title="使用logging提供的模块级别的函数记录日志"></a>使用logging提供的模块级别的函数记录日志</h2><p>回顾下前面提到的几个重要信息：</p><ul><li>可以通过logging模块定义的模块级别的方法去完成简单的日志记录</li><li>只有级别大于或等于日志记录器指定级别的日志记录才会被输出，小于该级别的日志记录将会被丢弃。</li></ul><h3 id="最简单的日志输出"><a href="#最简单的日志输出" class="headerlink" title="最简单的日志输出"></a>最简单的日志输出</h3><p>先来试着分别输出一条不同日志级别的日志记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>也可以这样写：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logging.log(logging.DEBUG, &quot;This is a debug log.&quot;)</span><br><span class="line">logging.log(logging.INFO, &quot;This is a info log.&quot;)</span><br><span class="line">logging.log(logging.WARNING, &quot;This is a warning log.&quot;)</span><br><span class="line">logging.log(logging.ERROR, &quot;This is a error log.&quot;)</span><br><span class="line">logging.log(logging.CRITICAL, &quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:This is a warning log.</span><br><span class="line">ERROR:root:This is a error log.</span><br><span class="line">CRITICAL:root:This is a critical log.</span><br></pre></td></tr></table></figure><h3 id="那么问题来了"><a href="#那么问题来了" class="headerlink" title="那么问题来了"></a>那么问题来了</h3><p><strong>问题1：为什么前面两条日志没有被打印出来？</strong></p><p>这是因为logging模块提供的日志记录函数所使用的日志器设置的日志级别是<code>WARNING</code>，因此只有<code>WARNING</code>级别的日志记录以及大于它的<code>ERROR</code>和<code>CRITICAL</code>级别的日志记录被输出了，而小于它的<code>DEBUG</code>和<code>INFO</code>级别的日志记录被丢弃了。</p><p><strong>问题2：打印出来的日志信息中各字段表示什么意思？为什么会这样输出？</strong></p><p>上面输出结果中每行日志记录的各个字段含义分别是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">日志级别:日志器名称:日志内容</span><br></pre></td></tr></table></figure><p>之所以会这样输出，是因为logging模块提供的日志记录函数所使用的日志器设置的日志格式默认是BASIC_FORMAT，其值为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%(levelname)s:%(name)s:%(message)s&quot;</span><br></pre></td></tr></table></figure><p><strong>问题3：如果将日志记录输出到文件中，而不是打印到控制台？</strong></p><p>因为在logging模块提供的日志记录函数所使用的日志器设置的处理器所指定的日志输出位置默认为:<br><code>sys.stderr</code>。</p><p><strong>问题4：我是怎么知道这些的？</strong></p><p>查看这些日志记录函数的实现代码，可以发现：当我们没有提供任何配置信息的时候，这些函数都会去调用<code>logging.basicConfig(**kwargs)</code>方法，且不会向该方法传递任何参数。继续查看<code>basicConfig()</code>方法的代码就可以找到上面这些问题的答案了。</p><p><strong>问题5：怎么修改这些默认设置呢？</strong></p><p>其实很简单，在我们调用上面这些日志记录函数之前，手动调用一下basicConfig()方法，把我们想设置的内容以参数的形式传递进去就可以了。</p><h3 id="logging-basicConfig-函数说明"><a href="#logging-basicConfig-函数说明" class="headerlink" title="logging.basicConfig()函数说明"></a>logging.basicConfig()函数说明</h3><p>该方法用于为logging日志系统做一些基本配置，方法定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(**kwargs)</span><br></pre></td></tr></table></figure><p>该函数可接收的关键字参数如下：</p><table><thead><tr><th>参数名称</th><th>描述</th></tr></thead><tbody><tr><td>filename</td><td>指定日志输出目标文件的文件名，指定该设置项后日志信心就不会被输出到控制台了</td></tr><tr><td>filemode</td><td>指定日志文件的打开模式，默认为’a’。需要注意的是，该选项要在filename指定时才有效</td></tr><tr><td>format</td><td>指定日志格式字符串，即指定日志输出时所包含的字段信息以及它们的顺序。logging模块定义的格式字段下面会列出。</td></tr><tr><td>datefmt</td><td>指定日期/时间格式。需要注意的是，该选项要在format中包含时间字段%(asctime)s时才有效</td></tr><tr><td>level</td><td>指定日志器的日志级别</td></tr><tr><td>stream</td><td>指定日志输出目标stream，如sys.stdout、sys.stderr以及网络stream。需要说明的是，stream和filename不能同时提供，否则会引发 <code>ValueError</code>异常</td></tr><tr><td>style</td><td>Python 3.2中新添加的配置项。指定format格式字符串的风格，可取值为’%’、’{‘和’$’，默认为’%’</td></tr><tr><td>handlers</td><td>Python 3.3中新添加的配置项。该选项如果被指定，它应该是一个创建了多个Handler的可迭代对象，这些handler将会被添加到root logger。需要说明的是：filename、stream和handlers这三个配置项只能有一个存在，不能同时出现2个或3个，否则会引发ValueError异常。</td></tr></tbody></table><h3 id="logging模块定义的格式字符串字段"><a href="#logging模块定义的格式字符串字段" class="headerlink" title="logging模块定义的格式字符串字段"></a>logging模块定义的格式字符串字段</h3><p>我们来列举一下logging模块中定义好的可以用于format格式字符串中字段有哪些：</p><table><thead><tr><th>字段/属性名称</th><th>使用格式</th><th>描述</th></tr></thead><tbody><tr><td>asctime</td><td>%(asctime)s</td><td>日志事件发生的时间–人类可读时间，如：2003-07-08 16:49:45,896</td></tr><tr><td>created</td><td>%(created)f</td><td>日志事件发生的时间–时间戳，就是当时调用time.time()函数返回的值</td></tr><tr><td>relativeCreated</td><td>%(relativeCreated)d</td><td>日志事件发生的时间相对于logging模块加载时间的相对毫秒数（目前还不知道干嘛用的）</td></tr><tr><td>msecs</td><td>%(msecs)d</td><td>日志事件发生事件的毫秒部分</td></tr><tr><td>levelname</td><td>%(levelname)s</td><td>该日志记录的文字形式的日志级别（’DEBUG’, ‘INFO’, ‘WARNING’, ‘ERROR’, ‘CRITICAL’）</td></tr><tr><td>levelno</td><td>%(levelno)s</td><td>该日志记录的数字形式的日志级别（10, 20, 30, 40, 50）</td></tr><tr><td>name</td><td>%(name)s</td><td>所使用的日志器名称，默认是’root’，因为默认使用的是 rootLogger</td></tr><tr><td>message</td><td>%(message)s</td><td>日志记录的文本内容，通过 <code>msg % args</code>计算得到的</td></tr><tr><td>pathname</td><td>%(pathname)s</td><td>调用日志记录函数的源码文件的全路径</td></tr><tr><td>filename</td><td>%(filename)s</td><td>pathname的文件名部分，包含文件后缀</td></tr><tr><td>module</td><td>%(module)s</td><td>filename的名称部分，不包含后缀</td></tr><tr><td>lineno</td><td>%(lineno)d</td><td>调用日志记录函数的源代码所在的行号</td></tr><tr><td>funcName</td><td>%(funcName)s</td><td>调用日志记录函数的函数名</td></tr><tr><td>process</td><td>%(process)d</td><td>进程ID</td></tr><tr><td>processName</td><td>%(processName)s</td><td>进程名称，Python 3.1新增</td></tr><tr><td>thread</td><td>%(thread)d</td><td>线程ID</td></tr><tr><td>threadName</td><td>%(thread)s</td><td>线程名称</td></tr></tbody></table><h3 id="经过配置的日志输出-举例"><a href="#经过配置的日志输出-举例" class="headerlink" title="经过配置的日志输出(举例)"></a>经过配置的日志输出(举例)</h3><p><strong>先简单配置下日志器的日志级别</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:This is a debug log.</span><br><span class="line">INFO:root:This is a info log.</span><br><span class="line">WARNING:root:This is a warning log.</span><br><span class="line">ERROR:root:This is a error log.</span><br><span class="line">CRITICAL:root:This is a critical log.</span><br></pre></td></tr></table></figure><p>所有等级的日志信息都被输出了，说明配置生效了。</p><p><strong>在配置日志器日志级别的基础上，在配置下日志输出目标文件和日志格式</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(message)s&quot;</span><br><span class="line">logging.basicConfig(filename=&apos;my.log&apos;, level=logging.DEBUG, format=LOG_FORMAT)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>此时会发现控制台中已经没有输出日志内容了，但是在python代码文件的相同目录下会生成一个名为’my.log’的日志文件，该文件中的内容为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-05-08 14:29:53,783 - DEBUG - This is a debug log.</span><br><span class="line">2017-05-08 14:29:53,784 - INFO - This is a info log.</span><br><span class="line">2017-05-08 14:29:53,784 - WARNING - This is a warning log.</span><br><span class="line">2017-05-08 14:29:53,784 - ERROR - This is a error log.</span><br><span class="line">2017-05-08 14:29:53,784 - CRITICAL - This is a critical log.</span><br></pre></td></tr></table></figure><p><strong>在上面的基础上，我们再来设置下日期/时间格式</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(message)s&quot;</span><br><span class="line">DATE_FORMAT = &quot;%m/%d/%Y %H:%M:%S %p&quot;</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=&apos;my.log&apos;, level=logging.DEBUG, format=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>此时会在my.log日志文件中看到如下输出内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">05/08/2017 14:29:04 PM - DEBUG - This is a debug log.</span><br><span class="line">05/08/2017 14:29:04 PM - INFO - This is a info log.</span><br><span class="line">05/08/2017 14:29:04 PM - WARNING - This is a warning log.</span><br><span class="line">05/08/2017 14:29:04 PM - ERROR - This is a error log.</span><br><span class="line">05/08/2017 14:29:04 PM - CRITICAL - This is a critical log.</span><br></pre></td></tr></table></figure><p>掌握了上面的内容之后，已经能够满足我们平时开发中需要的日志记录功能。</p><p><strong>另外一个例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=<span class="string">"%(asctime)s %(name)s %(levelname)s %(message)s"</span>,</span><br><span class="line">                    datefmt = <span class="string">'%Y-%m-%d  %H:%M:%S %a'</span>    <span class="comment">#注意月份和天数不要搞乱了，这里的格式化符与time模块相同</span></span><br><span class="line">                    )</span><br><span class="line">logging.debug(<span class="string">"msg1"</span>)</span><br><span class="line">logging.info(<span class="string">"msg2"</span>)</span><br><span class="line">logging.warning(<span class="string">"msg3"</span>)</span><br><span class="line">logging.error(<span class="string">"msg4"</span>)</span><br><span class="line">logging.critical(<span class="string">"msg5"</span>)</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root DEBUG msg1</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root INFO msg2</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root WARNING msg3</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root ERROR msg4</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root CRITICAL msg5</span><br></pre></td></tr></table></figure><p><strong>输出到文件例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG,<span class="comment">#控制台打印的日志级别</span></span><br><span class="line">                    filename=<span class="string">'new.log'</span>,</span><br><span class="line">                    filemode=<span class="string">'a'</span>,<span class="comment">##模式，有w和a，w就是写模式，每次都会重新写日志，覆盖之前的日志</span></span><br><span class="line">                    <span class="comment">#a是追加模式，默认如果不写的话，就是追加模式</span></span><br><span class="line">                    format=</span><br><span class="line">                    <span class="string">'%(asctime)s - %(pathname)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span></span><br><span class="line">                    <span class="comment">#日志格式</span></span><br><span class="line">                    )</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">LOG_FORMAT = <span class="string">"%(asctime)s %(name)s %(levelname)s %(pathname)s %(message)s "</span><span class="comment">#配置输出日志格式</span></span><br><span class="line">DATE_FORMAT = <span class="string">'%Y-%m-%d  %H:%M:%S %a '</span> <span class="comment">#配置输出时间的格式，注意月份和天数不要搞乱了</span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=LOG_FORMAT,</span><br><span class="line">                    datefmt = DATE_FORMAT ,</span><br><span class="line">                    filename=<span class="string">r"d:\test\test.log"</span> <span class="comment">#有了filename参数就不会直接输出显示到控制台，而是直接写入文件</span></span><br><span class="line">                    )</span><br><span class="line">logging.debug(<span class="string">"msg1"</span>)</span><br><span class="line">logging.info(<span class="string">"msg2"</span>)</span><br><span class="line">logging.warning(<span class="string">"msg3"</span>)</span><br><span class="line">logging.error(<span class="string">"msg4"</span>)</span><br><span class="line">logging.critical(<span class="string">"msg5"</span>)</span><br></pre></td></tr></table></figure><p>日志在d:\test目录下，日志具体内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root DEBUG D:/<span class="number">06</span>python/exercise/test_package/test.py msg1</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root INFO D:/<span class="number">06</span>python/exercise/test_package/test.py msg2</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root WARNING D:/<span class="number">06</span>python/exercise/test_package/test.py msg3</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root ERROR D:/<span class="number">06</span>python/exercise/test_package/test.py msg4</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root CRITICAL D:/<span class="number">06</span>python/exercise/test_package/test.py msg5</span><br></pre></td></tr></table></figure><h3 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h3><p><strong>几个要说明的内容：</strong></p><ul><li><code>logging.basicConfig()</code>函数是一个一次性的简单配置工具使，也就是说只有在第一次调用该函数时会起作用，后续再次调用该函数时完全不会产生任何操作的，多次调用的设置并不是累加操作。</li><li>日志器（Logger）是有层级关系的，上面调用的logging模块级别的函数所使用的日志器是<code>RootLogger</code>类的实例，其名称为’root’，它是处于日志器层级关系最顶层的日志器，且该实例是以单例模式存在的。</li><li>如果要记录的日志中包含变量数据，可使用一个格式字符串作为这个事件的描述消息（logging.debug、logging.info等函数的第一个参数），然后将变量数据作为第二个参数*args的值进行传递，如:<code>logging.warning(&#39;%s is %d years old.&#39;, &#39;Tom&#39;, 10)</code>，输出内容为<code>WARNING:root:Tom is 10 years old.</code></li><li>logging.debug(), <a href="http://logging.info/" target="_blank" rel="noopener">logging.info</a>()等方法的定义中，除了msg和args参数外，还有一个**kwargs参数。它们支持3个关键字参数: <code>exc_info, stack_info, extra</code>，下面对这几个关键字参数作个说明。</li></ul><p><strong>关于exc_info, stack_info, extra关键词参数的说明:</strong></p><ul><li><strong>exc_info：</strong> 其值为布尔值，如果该参数的值设置为True，则会将异常异常信息添加到日志消息中。如果没有异常信息则添加None到日志信息中。</li><li><strong>stack_info：</strong> 其值也为布尔值，默认值为False。如果该参数的值设置为True，栈信息将会被添加到日志信息中。</li><li><strong>extra：</strong> 这是一个字典（dict）参数，它可以用来自定义消息格式中所包含的字段，但是它的key不能与logging模块定义的字段冲突。</li></ul><p><strong>一个例子：</strong></p><p>在日志消息中添加exc_info和stack_info信息，并添加两个自定义的字端 ip和user</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(user)s[%(ip)s] - %(message)s&quot;</span><br><span class="line">DATE_FORMAT = &quot;%m/%d/%Y %H:%M:%S %p&quot;</span><br><span class="line"></span><br><span class="line">logging.basicConfig(format=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line">logging.warning(&quot;Some one delete the log file.&quot;, exc_info=True, stack_info=True, extra=&#123;&apos;user&apos;: &apos;Tom&apos;, &apos;ip&apos;:&apos;47.98.53.222&apos;&#125;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">05/08/2017 16:35:00 PM - WARNING - Tom[47.98.53.222] - Some one delete the log file.</span><br><span class="line">NoneType</span><br><span class="line">Stack (most recent call last):</span><br><span class="line">  File &quot;C:/Users/wader/PycharmProjects/LearnPython/day06/log.py&quot;, line 45, in &lt;module&gt;</span><br><span class="line">    logging.warning(&quot;Some one delete the log file.&quot;, exc_info=True, stack_info=True, extra=&#123;&apos;user&apos;: &apos;Tom&apos;, &apos;ip&apos;:&apos;47.98.53.222&apos;&#125;)</span><br></pre></td></tr></table></figure><h2 id="logging模块日志流处理流程"><a href="#logging模块日志流处理流程" class="headerlink" title="logging模块日志流处理流程"></a>logging模块日志流处理流程</h2><p>在介绍logging模块的高级用法之前，很有必要对logging模块所包含的重要组件以及其工作流程做个全面、简要的介绍，这有助于我们更好的理解我们所写的代码（将会触发什么样的操作）。</p><h3 id="logging日志模块四大组件"><a href="#logging日志模块四大组件" class="headerlink" title="logging日志模块四大组件"></a>logging日志模块四大组件</h3><p>在介绍logging模块的日志流处理流程之前，我们先来介绍下logging模块的四大组件：</p><table><thead><tr><th>组件名称</th><th>对应类名</th><th>功能描述</th></tr></thead><tbody><tr><td>日志器</td><td>Logger</td><td>提供了应用程序可一直使用的接口</td></tr><tr><td>处理器</td><td>Handler</td><td>将logger创建的日志记录发送到合适的目的输出</td></tr><tr><td>过滤器</td><td>Filter</td><td>提供了更细粒度的控制工具来决定输出哪条日志记录，丢弃哪条日志记录</td></tr><tr><td>格式器</td><td>Formatter</td><td>决定日志记录的最终输出格式</td></tr></tbody></table><p>logging模块就是通过这些组件来完成日志处理的，上面所使用的logging模块级别的函数也是通过这些组件对应的类来实现的。</p><p><strong>这些组件之间的关系描述：</strong></p><ul><li>日志器（logger）需要通过处理器（handler）将日志信息输出到目标位置，如：文件、sys.stdout、网络等；</li><li>不同的处理器（handler）可以将日志输出到不同的位置；</li><li>日志器（logger）可以设置多个处理器（handler）将同一条日志记录输出到不同的位置；</li><li>每个处理器（handler）都可以设置自己的过滤器（filter）实现日志过滤，从而只保留感兴趣的日志；</li><li>每个处理器（handler）都可以设置自己的格式器（formatter）实现同一条日志以不同的格式输出到不同的地方。</li></ul><p>简单点说就是：日志器（logger）是入口，真正干活儿的是处理器（handler），处理器（handler）还可以通过过滤器（filter）和格式器（formatter）对要输出的日志内容做过滤和格式化等处理操作。</p><h3 id="logging日志模块相关类及其常用方法介绍"><a href="#logging日志模块相关类及其常用方法介绍" class="headerlink" title="logging日志模块相关类及其常用方法介绍"></a>logging日志模块相关类及其常用方法介绍</h3><p>下面介绍下与logging四大组件相关的类：Logger, Handler, Filter, Formatter。</p><h4 id="Logger类"><a href="#Logger类" class="headerlink" title="Logger类"></a>Logger类</h4><p>Logger对象有3个任务要做：</p><ul><li>1）向应用程序代码暴露几个方法，使应用程序可以在运行时记录日志消息；</li><li>2）基于日志严重等级（默认的过滤设施）或filter对象来决定要对哪些日志进行后续处理；</li><li>3）将日志消息传送给所有感兴趣的日志handlers。</li></ul><p>Logger对象最常用的方法分为两类：配置方法 和 消息发送方法</p><p>最常用的配置方法如下：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Logger.setLevel()</td><td>设置日志器将会处理的日志消息的最低严重级别</td></tr><tr><td>Logger.addHandler() 和 Logger.removeHandler()</td><td>为该logger对象添加 和 移除一个handler对象</td></tr><tr><td>Logger.addFilter() 和 Logger.removeFilter()</td><td>为该logger对象添加 和 移除一个filter对象</td></tr></tbody></table><blockquote><p><strong>关于Logger.setLevel()方法的说明：</strong></p><p>内建等级中，级别最低的是DEBUG，级别最高的是CRITICAL。例如setLevel([logging.INFO])，此时函数参数为INFO，那么该logger将只会处理INFO、WARNING、ERROR和CRITICAL级别的日志，而DEBUG级别的消息将会被忽略/丢弃。</p></blockquote><p>Logger对象配置完成后，可以使用下面的方法来创建日志记录：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Logger.debug(), <a href="http://logger.info/" target="_blank" rel="noopener">Logger.info</a>(), Logger.warning(), Logger.error(), Logger.critical()</td><td>创建一个与它们的方法名对应等级的日志记录</td></tr><tr><td>Logger.exception()</td><td>创建一个类似于Logger.error()的日志消息</td></tr><tr><td>Logger.log()</td><td>需要获取一个明确的日志level参数来创建一个日志记录</td></tr></tbody></table><blockquote><p><strong>说明：</strong></p><ul><li>Logger.exception()与Logger.error()的区别在于：Logger.exception()将会输出堆栈追踪信息，另外通常只是在一个exception handler中调用该方法。</li><li>Logger.log()与Logger.debug()、<a href="http://logger.info/" target="_blank" rel="noopener">Logger.info</a>()等方法相比，虽然需要多传一个level参数，显得不是那么方便，但是当需要记录自定义level的日志时还是需要该方法来完成。</li></ul></blockquote><p>那么，怎样得到一个Logger对象呢？一种方式是通过Logger类的实例化方法创建一个Logger类的实例，但是我们通常都是用第二种方式–logging.getLogger()方法。</p><p>logging.getLogger()方法有一个可选参数name，该参数表示将要返回的日志器的名称标识，如果不提供该参数，则其值为’root’。若以相同的name参数值多次调用getLogger()方法，将会返回指向同一个logger对象的引用。</p><blockquote><p><strong>关于logger的层级结构与有效等级的说明：</strong></p><ul><li>logger的名称是一个以’.’分割的层级结构，每个’.’后面的logger都是’.’前面的logger的children，例如，有一个名称为 foo 的logger，其它名称分别为 foo.bar, foo.bar.baz 和 foo.bam都是 foo 的后代。</li><li>logger有一个”有效等级（effective level）”的概念。如果一个logger上没有被明确设置一个level，那么该logger就是使用它parent的level;如果它的parent也没有明确设置level则继续向上查找parent的parent的有效level，依次类推，直到找到个一个明确设置了level的祖先为止。需要说明的是，root logger总是会有一个明确的level设置（默认为 WARNING）。当决定是否去处理一个已发生的事件时，logger的有效等级将会被用来决定是否将该事件传递给该logger的handlers进行处理。</li><li>child loggers在完成对日志消息的处理后，默认会将日志消息传递给与它们的祖先loggers相关的handlers。因此，我们不必为一个应用程序中所使用的所有loggers定义和配置handlers，只需要为一个顶层的logger配置handlers，然后按照需要创建child loggers就可足够了。我们也可以通过将一个logger的propagate属性设置为False来关闭这种传递机制。</li></ul></blockquote><h4 id="Handler类"><a href="#Handler类" class="headerlink" title="Handler类"></a>Handler类</h4><p>Handler对象的作用是（基于日志消息的level）将消息分发到handler指定的位置（文件、网络、邮件等）。Logger对象可以通过addHandler()方法为自己添加0个或者更多个handler对象。比如，一个应用程序可能想要实现以下几个日志需求：</p><ul><li>1）把所有日志都发送到一个日志文件中；</li><li>2）把所有严重级别大于等于error的日志发送到stdout（标准输出）；</li><li>3）把所有严重级别为critical的日志发送到一个email邮件地址。<br>这种场景就需要3个不同的handlers，每个handler复杂发送一个特定严重级别的日志到一个特定的位置。</li></ul><p>一个handler中只有非常少数的方法是需要应用开发人员去关心的。对于使用内建handler对象的应用开发人员来说，似乎唯一相关的handler方法就是下面这几个配置方法：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Handler.setLevel()</td><td>设置handler将会处理的日志消息的最低严重级别</td></tr><tr><td>Handler.setFormatter()</td><td>为handler设置一个格式器对象</td></tr><tr><td>Handler.addFilter() 和 Handler.removeFilter()</td><td>为handler添加 和 删除一个过滤器对象</td></tr></tbody></table><p>需要说明的是，应用程序代码不应该直接实例化和使用Handler实例。因为Handler是一个基类，它只定义了素有handlers都应该有的接口，同时提供了一些子类可以直接使用或覆盖的默认行为。下面是一些常用的Handler：</p><table><thead><tr><th>Handler</th><th>描述</th></tr></thead><tbody><tr><td>logging.StreamHandler</td><td>将日志消息发送到输出到Stream，如std.out, std.err或任何file-like对象。</td></tr><tr><td>logging.FileHandler</td><td>将日志消息发送到磁盘文件，默认情况下文件大小会无限增长</td></tr><tr><td>logging.handlers.RotatingFileHandler</td><td>将日志消息发送到磁盘文件，并支持日志文件按大小切割</td></tr><tr><td>logging.hanlders.TimedRotatingFileHandler</td><td>将日志消息发送到磁盘文件，并支持日志文件按时间切割</td></tr><tr><td>logging.handlers.HTTPHandler</td><td>将日志消息以GET或POST的方式发送给一个HTTP服务器</td></tr><tr><td>logging.handlers.SMTPHandler</td><td>将日志消息发送给一个指定的email地址</td></tr><tr><td>logging.NullHandler</td><td>该Handler实例会忽略error messages，通常被想使用logging的library开发者使用来避免’No handlers could be found for logger XXX’信息的出现。</td></tr></tbody></table><h4 id="Formater类"><a href="#Formater类" class="headerlink" title="Formater类"></a>Formater类</h4><p>Formater对象用于配置日志信息的最终顺序、结构和内容。与logging.Handler基类不同的是，应用代码可以直接实例化Formatter类。另外，如果你的应用程序需要一些特殊的处理行为，也可以实现一个Formatter的子类来完成。</p><p>Formatter类的构造方法定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.Formatter.__init__(fmt=None, datefmt=None, style=&apos;%&apos;)</span><br></pre></td></tr></table></figure><p>可见，该构造方法接收3个可选参数：</p><ul><li>fmt：指定消息格式化字符串，如果不指定该参数则默认使用message的原始值</li><li>datefmt：指定日期格式字符串，如果不指定该参数则默认使用”%Y-%m-%d %H:%M:%S”</li><li>style：Python 3.2新增的参数，可取值为 ‘%’, ‘{‘和 ‘$’，如果不指定该参数则默认使用’%’</li></ul><h4 id="Filter类"><a href="#Filter类" class="headerlink" title="Filter类"></a>Filter类</h4><p>Filter可以被Handler和Logger用来做比level更细粒度的、更复杂的过滤功能。Filter是一个过滤器基类，它只允许某个logger层级下的日志事件通过过滤。该类定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class logging.Filter(name=&apos;&apos;)</span><br><span class="line">    filter(record)</span><br></pre></td></tr></table></figure><p>比如，一个filter实例化时传递的name参数值为’A.B’，那么该filter实例将只允许名称为类似如下规则的loggers产生的日志记录通过过滤：’A.B’，’A.B,C’，’A.B.C.D’，’A.B.D’，而名称为’<a href="http://a.bb/" target="_blank" rel="noopener">A.BB</a>‘, ‘B.A.B’的loggers产生的日志则会被过滤掉。如果name的值为空字符串，则允许所有的日志事件通过过滤。</p><p>filter方法用于具体控制传递的record记录是否能通过过滤，如果该方法返回值为0表示不能通过过滤，返回值为非0表示可以通过过滤。</p><blockquote><p><strong>说明：</strong></p><ul><li>如果有需要，也可以在filter(record)方法内部改变该record，比如添加、删除或修改一些属性。</li><li>我们还可以通过filter做一些统计工作，比如可以计算下被一个特殊的logger或handler所处理的record数量等。</li></ul></blockquote><h3 id="logging日志流处理流程"><a href="#logging日志流处理流程" class="headerlink" title="logging日志流处理流程"></a>logging日志流处理流程</h3><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/13.png" alt="img"></p><p>我们来描述下上面这个图的日志流处理流程：</p><ul><li>1）（在用户代码中进行）日志记录函数调用，如：<a href="http://logger.info/" target="_blank" rel="noopener">logger.info</a>(…)，logger.debug(…)等；</li><li>2）判断要记录的日志级别是否满足日志器设置的级别要求（要记录的日志级别要大于或等于日志器设置的级别才算满足要求），如果不满足则该日志记录会被丢弃并终止后续的操作，如果满足则继续下一步操作；</li><li>3）根据日志记录函数调用时掺入的参数，创建一个日志记录（LogRecord类）对象；</li><li>4）判断日志记录器上设置的过滤器是否拒绝这条日志记录，如果日志记录器上的某个过滤器拒绝，则该日志记录会被丢弃并终止后续的操作，如果日志记录器上设置的过滤器不拒绝这条日志记录或者日志记录器上没有设置过滤器则继续下一步操作–将日志记录分别交给该日志器上添加的各个处理器；</li><li>5）判断要记录的日志级别是否满足处理器设置的级别要求（要记录的日志级别要大于或等于该处理器设置的日志级别才算满足要求），如果不满足记录将会被该处理器丢弃并终止后续的操作，如果满足则继续下一步操作；</li><li>6）判断该处理器上设置的过滤器是否拒绝这条日志记录，如果该处理器上的某个过滤器拒绝，则该日志记录会被当前处理器丢弃并终止后续的操作，如果当前处理器上设置的过滤器不拒绝这条日志记录或当前处理器上没有设置过滤器测继续下一步操作；</li><li>7）如果能到这一步，说明这条日志记录经过了层层关卡允许被输出了，此时当前处理器会根据自身被设置的格式器（如果没有设置则使用默认格式）将这条日志记录进行格式化，最后将格式化后的结果输出到指定位置（文件、网络、类文件的Stream等）；</li><li>8）如果日志器被设置了多个处理器的话，上面的第5-8步会执行多次；</li><li>9）这里才是完整流程的最后一步：判断该日志器输出的日志消息是否需要传递给上一级logger（之前提到过，日志器是有层级关系的）的处理器，如果propagate属性值为1则表示日志消息将会被输出到处理器指定的位置，同时还会被传递给parent日志器的handlers进行处理直到当前日志器的propagate属性为0停止，如果propagate值为0则表示不向parent日志器的handlers传递该消息，到此结束。</li></ul><p>可见，一条日志信息要想被最终输出需要依次经过以下几次过滤：</p><ul><li>日志器等级过滤；</li><li>日志器的过滤器过滤；</li><li>日志器的处理器等级过滤；</li><li>日志器的处理器的过滤器过滤；</li></ul><blockquote><p><strong>需要说明的是：</strong> 关于上面第9个步骤，如果propagate值为1，那么日志消息会直接传递交给上一级logger的handlers进行处理，此时上一级logger的日志等级并不会对该日志消息进行等级过滤。</p></blockquote><p><strong>简化处理流程</strong>:</p><p>1、创建一个logger</p><p>2、设置下logger的日志的等级</p><p>3、创建合适的Handler(FileHandler要有路径)</p><p>4、设置下每个Handler的日志等级</p><p>5、创建下日志的格式</p><p>6、向Handler中添加上面创建的格式</p><p>7、将上面创建的Handler添加到logger中</p><p>8、打印输出logger.debug\logger.info\logger.warning\logger.error\logger.critical</p><h3 id="使用logging四大组件记录日志"><a href="#使用logging四大组件记录日志" class="headerlink" title="使用logging四大组件记录日志"></a>使用logging四大组件记录日志</h3><p>现在，我们对logging模块的重要组件及整个日志流处理流程都应该有了一个比较全面的了解，下面我们来看一个例子。</p><h4 id="1-需求"><a href="#1-需求" class="headerlink" title="1. 需求"></a>1. 需求</h4><p>现在有以下几个日志记录的需求：</p><ul><li>1）要求将所有级别的所有日志都写入磁盘文件中</li><li>2）all.log文件中记录所有的日志信息，日志格式为：日期和时间 - 日志级别 - 日志信息</li><li>3）error.log文件中单独记录error及以上级别的日志信息，日志格式为：日期和时间 - 日志级别 - 文件名[:行号] - 日志信息</li><li>4）要求all.log在每天凌晨进行日志切割</li></ul><h4 id="2-分析"><a href="#2-分析" class="headerlink" title="2. 分析"></a>2. 分析</h4><ul><li>1）要记录所有级别的日志，因此日志器的有效level需要设置为最低级别–DEBUG;</li><li>2）日志需要被发送到两个不同的目的地，因此需要为日志器设置两个handler；另外，两个目的地都是磁盘文件，因此这两个handler都是与FileHandler相关的；</li><li>3）all.log要求按照时间进行日志切割，因此他需要用logging.handlers.TimedRotatingFileHandler; 而error.log没有要求日志切割，因此可以使用FileHandler;</li><li>4）两个日志文件的格式不同，因此需要对这两个handler分别设置格式器；</li></ul><h4 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import logging.handlers</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(&apos;mylogger&apos;)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">rf_handler = logging.handlers.TimedRotatingFileHandler(&apos;all.log&apos;, when=&apos;midnight&apos;, interval=1, backupCount=7, atTime=datetime.time(0, 0, 0, 0))</span><br><span class="line">rf_handler.setFormatter(logging.Formatter(&quot;%(asctime)s - %(levelname)s - %(message)s&quot;))</span><br><span class="line"></span><br><span class="line">f_handler = logging.FileHandler(&apos;error.log&apos;)</span><br><span class="line">f_handler.setLevel(logging.ERROR)</span><br><span class="line">f_handler.setFormatter(logging.Formatter(&quot;%(asctime)s - %(levelname)s - %(filename)s[:%(lineno)d] - %(message)s&quot;))</span><br><span class="line"></span><br><span class="line">logger.addHandler(rf_handler)</span><br><span class="line">logger.addHandler(f_handler)</span><br><span class="line"></span><br><span class="line">logger.debug(&apos;debug message&apos;)</span><br><span class="line">logger.info(&apos;info message&apos;)</span><br><span class="line">logger.warning(&apos;warning message&apos;)</span><br><span class="line">logger.error(&apos;error message&apos;)</span><br><span class="line">logger.critical(&apos;critical message&apos;)</span><br></pre></td></tr></table></figure><p>all.log文件输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-05-13 16:12:40,612 - DEBUG - debug message</span><br><span class="line">2017-05-13 16:12:40,612 - INFO - info message</span><br><span class="line">2017-05-13 16:12:40,612 - WARNING - warning message</span><br><span class="line">2017-05-13 16:12:40,612 - ERROR - error message</span><br><span class="line">2017-05-13 16:12:40,613 - CRITICAL - critical message</span><br></pre></td></tr></table></figure><p>error.log文件输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2017-05-13 16:12:40,612 - ERROR - log.py[:81] - error message</span><br><span class="line">2017-05-13 16:12:40,613 - CRITICAL - log.py[:82] - critical message</span><br></pre></td></tr></table></figure><h4 id="4-其它例子"><a href="#4-其它例子" class="headerlink" title="4.其它例子"></a>4.其它例子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建handler</span></span><br><span class="line">fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置输出日志格式</span></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">    datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意 logging.Formatter的大小写</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#为handler指定输出格式，注意大小写</span></span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">logger.addHandler(fh)</span><br><span class="line">logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出不同级别的log</span></span><br><span class="line">logger.warning(<span class="string">"泰拳警告"</span>)</span><br><span class="line">logger.info(<span class="string">"提示"</span>)</span><br><span class="line">logger.error(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>python logging 重复写日志问题</strong></p><p>用Python的logging模块记录日志时，可能会遇到重复记录日志的问题，第一条记录写一次，第二条记录写两次，第三条记录写三次</p><p><strong>原因：没有移除handler</strong> <strong>解决：在日志记录完之后removeHandler</strong></p><p>例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建handler</span></span><br><span class="line">    fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">    ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置输出日志格式</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">        datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为handler指定输出格式</span></span><br><span class="line">    fh.setFormatter(formatter)</span><br><span class="line">    ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">    logger.addHandler(fh)</span><br><span class="line">    logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 泰拳警告</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 提示</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 提示</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br></pre></td></tr></table></figure><p>分析：可以看到输出结果有重复打印</p><p>原因：第二次调用log的时候，根据getLogger(name)里的name获取同一个logger，而这个logger里已经有了第一次你添加的handler，第二次调用又添加了一个handler，所以，这个logger里有了两个同样的handler，以此类推，调用几次就会有几个handler。</p><p><strong>解决方案1</strong></p><p>添加removeHandler语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建handler</span></span><br><span class="line">    fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">    ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置输出日志格式</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">        datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为handler指定输出格式</span></span><br><span class="line">    fh.setFormatter(formatter)</span><br><span class="line">    ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">    logger.addHandler(fh)</span><br><span class="line">    logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#解决方案1，添加removeHandler语句，每次用完之后移除Handler</span></span><br><span class="line">    logger.removeHandler(fh)</span><br><span class="line">    logger.removeHandler(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>解决方案2</strong></p><p>在log方法里做判断，如果这个logger已有handler，则不再添加handler。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#解决方案2：这里进行判断，如果logger.handlers列表为空，则添加，否则，直接去写日志</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logger.handlers:</span><br><span class="line">        <span class="comment">#创建handler</span></span><br><span class="line">        fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置输出日志格式</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">            datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为handler指定输出格式</span></span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">        logger.addHandler(fh)</span><br><span class="line">        logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>logger调用方式例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#这里进行判断，如果logger.handlers列表为空，则添加，否则，直接去写日志</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logger.handlers:</span><br><span class="line">        <span class="comment">#创建handler</span></span><br><span class="line">        fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置输出日志格式</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">            datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为handler指定输出格式</span></span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">        logger.addHandler(fh)</span><br><span class="line">        logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> logger <span class="comment">#直接返回logger</span></span><br><span class="line"></span><br><span class="line">logger = log()</span><br><span class="line">logger.warning(<span class="string">"泰拳警告"</span>)</span><br><span class="line">logger.info(<span class="string">"提示"</span>)</span><br><span class="line">logger.error(<span class="string">"错误"</span>)</span><br><span class="line">logger.debug(<span class="string">"查错"</span>)</span><br></pre></td></tr></table></figure><h4 id="5-屏幕和文件同时输出"><a href="#5-屏幕和文件同时输出" class="headerlink" title="5.屏幕和文件同时输出"></a>5.屏幕和文件同时输出</h4><p>logging库采取了模块化的设计，提供了许多组件：记录器、处理器、过滤器和格式化器。</p><ul><li>Logger 暴露了应用程序代码能直接使用的接口。</li><li>Handler将（记录器产生的）日志记录发送至合适的目的地。</li><li>Filter提供了更好的粒度控制，它可以决定输出哪些日志记录。</li><li>Formatter 指明了最终输出中日志记录的布局。</li></ul><h5 id="Loggers"><a href="#Loggers" class="headerlink" title="Loggers:"></a>Loggers:</h5><p>Logger 对象要做三件事情。首先，它们向应用代码暴露了许多方法，这样应用可以在运行时记录消息。其次，记录器对象通过严重程度（默认的过滤设施）或者过滤器对象来决定哪些日志消息需要记录下来。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。</p><p>常用的记录器对象的方法分为两类：配置和发送消息。</p><p>这些是最常用的配置方法：</p><p>Logger.setLevel()指定logger将会处理的最低的安全等级日志信息, debug是最低的内置安全等级，critical是最高的内建安全等级。例如，如果严重程度为INFO，记录器将只处理INFO，WARNING，ERROR和CRITICAL消息，DEBUG消息被忽略。<br>Logger.addHandler()和Logger.removeHandler()从记录器对象中添加和删除处理程序对象。处理器详见Handlers。<br>Logger.addFilter()和Logger.removeFilter()从记录器对象添加和删除过滤器对象。</p><h5 id="Handlers"><a href="#Handlers" class="headerlink" title="Handlers"></a>Handlers</h5><p><code>处理程序</code>对象负责将适当的日志消息（基于日志消息的严重性）分派到处理程序的指定目标。<code>Logger</code> 对象可以通过<code>addHandler()</code>方法增加零个或多个handler对象。举个例子，一个应用可以将所有的日志消息发送至日志文件，所有的错误级别（error）及以上的日志消息发送至标准输出，所有的严重级别（critical）日志消息发送至某个电子邮箱。在这个例子中需要三个独立的处理器，每一个负责将特定级别的消息发送至特定的位置。</p><p>常用的有4种： </p><p><strong>1)    logging.StreamHandler -&gt; 控制台输出</strong> </p><p>使用这个Handler可以向类似与sys.stdout或者sys.stderr的任何文件对象(file object)输出信息。</p><p>它的构造函数是：<br><code>StreamHandler([strm])</code><br>其中strm参数是一个文件对象。默认是sys.stderr</p><p>2)   <strong>logging.FileHandler  -&gt; 文件输出</strong></p><p>和StreamHandler类似，用于向一个文件输出日志信息。不过FileHandler会帮你打开这个文件。它的构造函数是：<br><code>FileHandler(filename[,mode])</code><br>filename是文件名，必须指定一个文件名。<br>mode是文件的打开方式。默认是’a’，即添加到文件末尾。</p><p>3)   <strong>logging.handlers.RotatingFileHandler</strong> <strong>-&gt; 按照大小自动分割日志文件，一旦达到指定的大小重新生成文件</strong> </p><p>这个Handler类似于上面的FileHandler，但是它可以管理文件大小。当文件达到一定大小之后，它会自动将当前日志文件改名，然后创建 一个新的同名日志文件继续输出。比如日志文件是chat.log。当chat.log达到指定的大小之后，RotatingFileHandler自动把 文件改名为chat.log.1。不过，如果chat.log.1已经存在，会先把chat.log.1重命名为chat.log.2。最后重新创建 chat.log，继续输出日志信息。它的构造函数是：<br><code>RotatingFileHandler( filename[, mode[, maxBytes[, backupCount]]])</code><br>其中filename和mode两个参数和FileHandler一样。<br>maxBytes用于指定日志文件的最大文件大小。如果maxBytes为0，意味着日志文件可以无限大，这时上面描述的重命名过程就不会发生。<br>backupCount用于指定保留的备份文件的个数。比如，如果指定为2，当上面描述的重命名过程发生时，原有的chat.log.2并不会被更名，而是被删除。</p><p>4)   <strong>logging.handlers.TimedRotatingFileHandler  -&gt;</strong> <strong>按照时间自动分割日志文件</strong> </p><p>这个Handler和RotatingFileHandler类似，不过，它没有通过判断文件大小来决定何时重新创建日志文件，而是间隔一定时间就 自动创建新的日志文件。重命名的过程与RotatingFileHandler类似，不过新的文件不是附加数字，而是当前时间。它的构造函数是：<br><code>TimedRotatingFileHandler( filename [,when [,interval [,backupCount]]])</code><br>其中filename参数和backupCount参数和RotatingFileHandler具有相同的意义。<br>interval是时间间隔。<br>when参数是一个字符串。表示时间间隔的单位，不区分大小写。它有以下取值：<br>S 秒<br>M 分<br>H 小时<br>D 天<br>W 每星期（interval==0时代表星期一）<br>midnight 每天凌晨</p><h5 id="Formatters"><a href="#Formatters" class="headerlink" title="Formatters"></a>Formatters</h5><p>Formatter对象设置日志信息最后的规则、结构和内容，默认的时间格式为<code>%Y-%m-%d %H:%M:%S</code>，下面是Formatter常用的一些信息</p><table><thead><tr><th>%(name)s</th><th>Logger的名字</th></tr></thead><tbody><tr><td>%(levelno)s</td><td>数字形式的日志级别</td></tr><tr><td>%(levelname)s</td><td>文本形式的日志级别</td></tr><tr><td>%(pathname)s</td><td>调用日志输出函数的模块的完整路径名，可能没有</td></tr><tr><td>%(filename)s</td><td>调用日志输出函数的模块的文件名</td></tr><tr><td>%(module)s</td><td>调用日志输出函数的模块名</td></tr><tr><td>%(funcName)s</td><td>调用日志输出函数的函数名</td></tr><tr><td>%(lineno)d</td><td>调用日志输出函数的语句所在的代码行</td></tr><tr><td>%(created)f</td><td>当前时间，用UNIX标准的表示时间的浮 点数表示</td></tr><tr><td>%(relativeCreated)d</td><td>输出日志信息时的，自Logger创建以 来的毫秒数</td></tr><tr><td>%(asctime)s</td><td>字符串形式的当前时间。默认格式是 “2003-07-08 16:49:45,896”。逗号后面的是毫秒</td></tr><tr><td>%(thread)d</td><td>线程ID。可能没有</td></tr><tr><td>%(threadName)s</td><td>线程名。可能没有</td></tr><tr><td>%(process)d</td><td>进程ID。可能没有</td></tr><tr><td>%(message)s</td><td>用户输出的消息</td></tr></tbody></table><h5 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h5><p>输出log到控制台以及将日志写入log文件。<br>保存2种类型的log， all.log 保存debug, info, warning, critical 信息， error.log则只保存error信息，同时按照时间自动分割日志文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> handlers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span><span class="params">(object)</span>:</span></span><br><span class="line">    level_relations = &#123;</span><br><span class="line">        <span class="string">'debug'</span>:logging.DEBUG,</span><br><span class="line">        <span class="string">'info'</span>:logging.INFO,</span><br><span class="line">        <span class="string">'warning'</span>:logging.WARNING,</span><br><span class="line">        <span class="string">'error'</span>:logging.ERROR,</span><br><span class="line">        <span class="string">'crit'</span>:logging.CRITICAL</span><br><span class="line">    &#125;<span class="comment">#日志级别关系映射</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,filename,level=<span class="string">'info'</span>,when=<span class="string">'D'</span>,backCount=<span class="number">3</span>,fmt=<span class="string">'%(asctime)s - %(pathname)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span>)</span>:</span></span><br><span class="line">        self.logger = logging.getLogger(filename)</span><br><span class="line">        format_str = logging.Formatter(fmt)<span class="comment">#设置日志格式</span></span><br><span class="line">        self.logger.setLevel(self.level_relations.get(level))<span class="comment">#设置日志级别</span></span><br><span class="line">        sh = logging.StreamHandler()<span class="comment">#往屏幕上输出</span></span><br><span class="line">        sh.setFormatter(format_str) <span class="comment">#设置屏幕上显示的格式</span></span><br><span class="line">        th = handlers.TimedRotatingFileHandler(filename=filename,when=when,backupCount=backCount,encoding=<span class="string">'utf-8'</span>)<span class="comment">#往文件里写入#指定间隔时间自动生成文件的处理器</span></span><br><span class="line">        <span class="comment">#实例化TimedRotatingFileHandler</span></span><br><span class="line">        <span class="comment">#interval是时间间隔，backupCount是备份文件的个数，如果超过这个个数，就会自动删除，when是间隔的时间单位，单位有以下几种：</span></span><br><span class="line">        <span class="comment"># S 秒</span></span><br><span class="line">        <span class="comment"># M 分</span></span><br><span class="line">        <span class="comment"># H 小时、</span></span><br><span class="line">        <span class="comment"># D 天、</span></span><br><span class="line">        <span class="comment"># W 每星期（interval==0时代表星期一）</span></span><br><span class="line">        <span class="comment"># midnight 每天凌晨</span></span><br><span class="line">        th.setFormatter(format_str)<span class="comment">#设置文件里写入的格式</span></span><br><span class="line">        self.logger.addHandler(sh) <span class="comment">#把对象加到logger里</span></span><br><span class="line">        self.logger.addHandler(th)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    log = Logger(<span class="string">'all.log'</span>,level=<span class="string">'debug'</span>)</span><br><span class="line">    log.logger.debug(<span class="string">'debug'</span>)</span><br><span class="line">    log.logger.info(<span class="string">'info'</span>)</span><br><span class="line">    log.logger.warning(<span class="string">'警告'</span>)</span><br><span class="line">    log.logger.error(<span class="string">'报错'</span>)</span><br><span class="line">    log.logger.critical(<span class="string">'严重'</span>)</span><br><span class="line">    Logger(<span class="string">'error.log'</span>, level=<span class="string">'error'</span>).logger.error(<span class="string">'error'</span>)</span><br></pre></td></tr></table></figure><p>屏幕上结果如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:25] - DEBUG: debug</span><br><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:26] - INFO: info</span><br><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:27] - WARNING: 警告</span><br><span class="line">2018-03-13 21:06:46,099 - D:/write_to_log.py[line:28] - ERROR: 报错</span><br><span class="line">2018-03-13 21:06:46,099 - D:/write_to_log.py[line:29] - CRITICAL: 严重</span><br><span class="line">2018-03-13 21:06:46,100 - D:/write_to_log.py[line:30] - ERROR: error</span><br></pre></td></tr></table></figure><h2 id="配置logging的几种方式"><a href="#配置logging的几种方式" class="headerlink" title="配置logging的几种方式"></a>配置logging的几种方式</h2><hr><p>作为开发者，我们可以通过以下3中方式来配置logging:</p><ul><li>1）使用Python代码显式的创建loggers, handlers和formatters并分别调用它们的配置函数；</li><li>2）创建一个日志配置文件，然后使用<code>fileConfig()</code>函数来读取该文件的内容；</li><li>3）创建一个包含配置信息的dict，然后把它传递个<code>dictConfig()</code>函数；</li></ul><p>具体说明请参考另一篇博文<a href="http://www.cnblogs.com/yyds/p/6885182.html" target="_blank" rel="noopener"> 《python之配置日志的几种方式》</a></p><h2 id="向日志输出中添加上下文信息"><a href="#向日志输出中添加上下文信息" class="headerlink" title="向日志输出中添加上下文信息"></a>向日志输出中添加上下文信息</h2><hr><p>除了传递给日志记录函数的参数外，有时候我们还想在日志输出中包含一些额外的上下文信息。比如，在一个网络应用中，可能希望在日志中记录客户端的特定信息，如：远程客户端的IP地址和用户名。这里我们来介绍以下几种实现方式：</p><ul><li>通过向日志记录函数传递一个<code>extra</code>参数引入上下文信息</li><li>使用LoggerAdapters引入上下文信息</li><li>使用Filters引入上下文信息</li></ul><p>具体说明请参考另一篇博文<a href="http://www.cnblogs.com/yyds/p/6897964.html" target="_blank" rel="noopener"> 《Python之向日志输出中添加上下文信息》</a></p><p>关于Python logging的更多高级用法，请参考文档<a href="https://docs.python.org/3.5/howto/logging-cookbook.html" target="_blank" rel="noopener">&lt;&lt; Logging CookBook &gt;&gt;</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/yyds/p/6901864.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/yyds/p/6901864.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/yuanyongqiang/p/11913812.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/yuanyongqiang/p/11913812.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/nancyzhu/p/8551506.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/nancyzhu/p/8551506.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;日志相关概念&quot;&gt;&lt;a href=&quot;#日志相关概念&quot; class=&quot;headerlink&quot; title=&quot;日志相关概念&quot;&gt;&lt;/a&gt;日志相关概念&lt;/h1&gt;&lt;p&gt;日志是一种可以追踪某些软件运行时所发生事件的方法。软件开发人员可以向他们的代码中调用日志记录相关的方法来表明发生了某些事情。一个事件可以用一个可包含可选变量数据的消息来描述。此外，事件也有重要性的概念，这个重要性也可以被称为严重性级别（level）。&lt;/p&gt;
&lt;h2 id=&quot;日志的作用&quot;&gt;&lt;a href=&quot;#日志的作用&quot; class=&quot;headerlink&quot; title=&quot;日志的作用&quot;&gt;&lt;/a&gt;日志的作用&lt;/h2&gt;&lt;p&gt;通过log的分析，可以方便用户了解系统或软件、应用的运行情况；如果你的应用log足够丰富，也可以分析以往用户的操作行为、类型喜好、地域分布或其他更多信息；如果一个应用的log同时也分了多个级别，那么可以很轻易地分析得到该应用的健康状况，及时发现问题并快速定位、解决问题，补救损失。&lt;br&gt;简单来讲就是，我们通过记录和分析日志可以了解一个系统或软件程序运行情况是否正常，也可以在应用程序出现故障时快速定位问题。比如，做运维的同学，在接收到报警或各种问题反馈后，进行问题排查时通常都会先去看各种日志，大部分问题都可以在日志中找到答案。再比如，做开发的同学，可以通过IDE控制台上输出的各种日志进行程序调试。对于运维老司机或者有经验的开发人员，可以快速的通过日志定位到问题的根源。可见，日志的重要性不可小觑。日志的作用可以简单总结为以下3点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;程序调试&lt;/li&gt;
&lt;li&gt;了解软件程序运行情况，是否正常&lt;/li&gt;
&lt;li&gt;软件程序运行故障分析与问题定位&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果应用的日志信息足够详细和丰富，还可以用来做用户行为分析，如：分析用户的操作行为、类型洗好、地域分布以及其它更多的信息，由此可以实现改进业务、提高商业利益。&lt;/p&gt;
&lt;h2 id=&quot;日志的等级&quot;&gt;&lt;a href=&quot;#日志的等级&quot; class=&quot;headerlink&quot; title=&quot;日志的等级&quot;&gt;&lt;/a&gt;日志的等级&lt;/h2&gt;&lt;p&gt;我们先来思考下下面的两个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;作为开发人员，在开发一个应用程序时需要什么日志信息？在应用程序正式上线后需要什么日志信息？&lt;/li&gt;
&lt;li&gt;作为应用运维人员，在部署开发环境时需要什么日志信息？在部署生产环境时需要什么日志信息？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在软件开发阶段或部署开发环境时，为了尽可能详细的查看应用程序的运行状态来保证上线后的稳定性，我们可能需要把该应用程序所有的运行日志全部记录下来进行分析，这是非常耗费机器性能的。当应用程序正式发布或在生产环境部署应用程序时，我们通常只需要记录应用程序的异常信息、错误信息等，这样既可以减小服务器的I/O压力，也可以避免我们在排查故障时被淹没在日志的海洋里。那么，怎样才能在不改动应用程序代码的情况下实现在不同的环境记录不同详细程度的日志呢？这就是日志等级的作用了，我们通过配置文件指定我们需要的日志等级就可以了。&lt;/p&gt;
&lt;p&gt;不同的应用程序所定义的日志等级可能会有所差别，分的详细点的会包含以下几个等级：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DEBUG&lt;/li&gt;
&lt;li&gt;INFO&lt;/li&gt;
&lt;li&gt;NOTICE&lt;/li&gt;
&lt;li&gt;WARNING&lt;/li&gt;
&lt;li&gt;ERROR&lt;/li&gt;
&lt;li&gt;CRITICAL&lt;/li&gt;
&lt;li&gt;ALERT&lt;/li&gt;
&lt;li&gt;EMERGENCY&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;日志字段信息与日志格式&quot;&gt;&lt;a href=&quot;#日志字段信息与日志格式&quot; class=&quot;headerlink&quot; title=&quot;日志字段信息与日志格式&quot;&gt;&lt;/a&gt;日志字段信息与日志格式&lt;/h2&gt;&lt;p&gt;本节开始问题提到过，一条日志信息对应的是一个事件的发生，而一个事件通常需要包括以下几个内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;事件发生时间&lt;/li&gt;
&lt;li&gt;事件发生位置&lt;/li&gt;
&lt;li&gt;事件的严重程度–日志级别&lt;/li&gt;
&lt;li&gt;事件内容&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面这些都是一条日志记录中可能包含的字段信息，当然还可以包括一些其他信息，如进程ID、进程名称、线程ID、线程名称等。日志格式就是用来定义一条日志记录中包含那些字段的，且日志格式通常都是可以自定义的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;说明：&lt;/p&gt;
&lt;p&gt;输出一条日志时，日志内容和日志级别是需要开发人员明确指定的。对于而其它字段信息，只需要是否显示在日志中就可以了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;日志功能的实现&quot;&gt;&lt;a href=&quot;#日志功能的实现&quot; class=&quot;headerlink&quot; title=&quot;日志功能的实现&quot;&gt;&lt;/a&gt;日志功能的实现&lt;/h2&gt;&lt;p&gt;几乎所有开发语言都会内置日志相关功能，或者会有比较优秀的第三方库来提供日志操作功能，比如：log4j，log4php等。它们功能强大、使用简单。Python自身也提供了一个用于记录日志的标准库模块–logging。&lt;/p&gt;
&lt;h1 id=&quot;logging模块简介&quot;&gt;&lt;a href=&quot;#logging模块简介&quot; class=&quot;headerlink&quot; title=&quot;logging模块简介&quot;&gt;&lt;/a&gt;logging模块简介&lt;/h1&gt;&lt;p&gt;logging模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。logging模块是Python的一个标准库模块，由标准库模块提供日志记录API的关键好处是所有Python模块都可以使用这个日志记录功能。所以，你的应用日志可以将你自己的日志信息与来自第三方模块的信息整合起来。&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.coding.me/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.coding.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python模块之时间模块</title>
    <link href="https://gongzhao1.coding.me/python%E6%A8%A1%E5%9D%97%E4%B9%8B%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9D%97/"/>
    <id>https://gongzhao1.coding.me/python模块之时间模块/</id>
    <published>2020-03-15T07:53:22.000Z</published>
    <updated>2020-04-08T14:20:25.873Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://itopic.org/python-time-module.html" target="_blank" rel="noopener">https://itopic.org/python-time-module.html</a></li><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616</a></li><li><a href="https://blog.csdn.net/watfe/article/details/84943732" target="_blank" rel="noopener">https://blog.csdn.net/watfe/article/details/84943732</a></li></ul><a id="more"></a><h1 id="time模块"><a href="#time模块" class="headerlink" title="time模块"></a>time模块</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(time.__doc__)</span><br><span class="line"></span><br><span class="line">Functions:</span><br><span class="line"></span><br><span class="line">time() -- <span class="keyword">return</span> current time <span class="keyword">in</span> seconds since the Epoch <span class="keyword">as</span> a float</span><br><span class="line">clock() -- <span class="keyword">return</span> CPU time since process start <span class="keyword">as</span> a float</span><br><span class="line">sleep() -- delay <span class="keyword">for</span> a number of seconds given <span class="keyword">as</span> a float</span><br><span class="line">gmtime() -- convert seconds since Epoch to UTC tuple</span><br><span class="line">localtime() -- convert seconds since Epoch to local time tuple</span><br><span class="line">asctime() -- convert time tuple to string</span><br><span class="line">ctime() -- convert time <span class="keyword">in</span> seconds to string</span><br><span class="line">mktime() -- convert local time tuple to seconds since Epoch</span><br><span class="line">strftime() -- convert time tuple to string according to format specification</span><br><span class="line">strptime() -- parse string to time tuple according to format specification</span><br><span class="line">tzset() -- change the local timezone</span><br></pre></td></tr></table></figure><h2 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a>获取时间戳</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.time()</span><br><span class="line"><span class="number">1552827527.447389</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int(time.time())</span><br><span class="line"><span class="number">1552827538</span></span><br></pre></td></tr></table></figure><h2 id="停留x秒"><a href="#停留x秒" class="headerlink" title="停留x秒"></a>停留x秒</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> time.sleep.__doc__</span><br><span class="line">sleep(seconds)</span><br><span class="line"></span><br><span class="line">Delay execution <span class="keyword">for</span> a given number of seconds.  The argument may be</span><br><span class="line">a floating point number <span class="keyword">for</span> subsecond precision.</span><br></pre></td></tr></table></figure><h2 id="time与字符串互转"><a href="#time与字符串互转" class="headerlink" title="time与字符串互转"></a>time与字符串互转</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print time.strftime.__doc__</span><br><span class="line">strftime(format[, tuple]) -&gt; string</span><br><span class="line"></span><br><span class="line">Convert a time tuple to a string according to a format specification.</span><br><span class="line">See the library reference manual for formatting codes. When the time tuple</span><br><span class="line">is not present, current time as returned by localtime() is used.</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print time.strptime.__doc__</span><br><span class="line">strptime(string, format) -&gt; struct_time</span><br><span class="line"></span><br><span class="line">Parse a string to a time tuple according to a format specification.</span><br><span class="line">See the library reference manual for formatting codes (same as strftime()).</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 格式化成2016-03-20 11:45:39形式</span><br><span class="line">print (time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime()))</span><br><span class="line"></span><br><span class="line"># 格式化成Sat Mar 28 22:24:24 2016形式</span><br><span class="line">print (time.strftime(&quot;%a %b %d %H:%M:%S %Y&quot;, time.localtime()))</span><br><span class="line">  </span><br><span class="line"># 将格式字符串转换为时间戳</span><br><span class="line">a = &quot;Sat Mar 28 22:24:24 2016&quot;</span><br><span class="line">print (time.mktime(time.strptime(a,&quot;%a %b %d %H:%M:%S %Y&quot;)))</span><br></pre></td></tr></table></figure><h1 id="datetime模块"><a href="#datetime模块" class="headerlink" title="datetime模块"></a>datetime模块</h1><h2 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now() <span class="comment"># 获取当前datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">16</span>:<span class="number">28</span>:<span class="number">07.198690</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(now))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>注意到<code>datetime</code>是模块，<code>datetime</code>模块还包含一个<code>datetime</code>类，通过<code>from datetime import datetime</code>导入的才是<code>datetime</code>这个类。</p><p>如果仅导入<code>import datetime</code>，则必须引用全名<code>datetime.datetime</code>。</p><p><code>datetime.now()</code>返回当前日期和时间，其类型是<code>datetime</code>。</p><h2 id="获取指定日期和时间"><a href="#获取指定日期和时间" class="headerlink" title="获取指定日期和时间"></a>获取指定日期和时间</h2><p>要指定某个日期和时间，我们直接用参数构造一个<code>datetime</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>) <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="datetime转换为timestamp"><a href="#datetime转换为timestamp" class="headerlink" title="datetime转换为timestamp"></a>datetime转换为timestamp</h2><p>在计算机中，时间实际上是用数字表示的。我们把1970年1月1日 00:00:00 UTC+00:00时区的时刻称为epoch time，记为<code>0</code>（1970年以前的时间timestamp为负数），当前时间就是相对于epoch time的秒数，称为timestamp。</p><p>你可以认为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestamp = <span class="number">0</span> = <span class="number">1970</span><span class="number">-1</span><span class="number">-1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> UTC+<span class="number">0</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><p>对应的北京时间是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestamp = 0 = 1970-1-1 08:00:00 UTC+8:00</span><br></pre></td></tr></table></figure><p>可见timestamp的值与时区毫无关系，因为timestamp一旦确定，其UTC时间就确定了，转换到任意时区的时间也是完全确定的，这就是为什么计算机存储的当前时间是以timestamp表示的，因为全球各地的计算机在任意时刻的timestamp都是完全相同的（假定时间已校准）。</p><p>把一个<code>datetime</code>类型转换为timestamp只需要简单调用<code>timestamp()</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>) <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.timestamp() <span class="comment"># 把datetime转换为timestamp</span></span><br><span class="line"><span class="number">1429417200.0</span></span><br></pre></td></tr></table></figure><p>注意Python的timestamp是一个浮点数。如果有小数位，小数位表示毫秒数。</p><p>某些编程语言（如Java和JavaScript）的timestamp使用整数表示毫秒数，这种情况下只需要把timestamp除以1000就得到Python的浮点表示方法。</p><h2 id="timestamp转换为datetime"><a href="#timestamp转换为datetime" class="headerlink" title="timestamp转换为datetime"></a>timestamp转换为datetime</h2><p>要把timestamp转换为<code>datetime</code>，使用<code>datetime</code>提供的<code>fromtimestamp()</code>方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t = 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t))</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure><p>注意到timestamp是一个浮点数，它没有时区的概念，而datetime是有时区的。上述转换是在timestamp和本地时间做转换。</p><p>本地时间是指当前操作系统设定的时区。例如北京时区是东8区，则本地时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure><p>实际上就是UTC+8:00时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 12:20:00 UTC+8:00</span><br></pre></td></tr></table></figure><p>而此刻的格林威治标准时间与北京时间差了8小时，也就是UTC+0:00时区的时间应该是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 04:20:00 UTC+0:00</span><br></pre></td></tr></table></figure><p>timestamp也可以直接被转换到UTC标准时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t = 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t)) # 本地时间</span><br><span class="line">2015-04-19 12:20:00</span><br><span class="line">&gt;&gt;&gt; print(datetime.utcfromtimestamp(t)) # UTC时间</span><br><span class="line">2015-04-19 04:20:00</span><br></pre></td></tr></table></figure><h2 id="str转换为datetime"><a href="#str转换为datetime" class="headerlink" title="str转换为datetime"></a>str转换为datetime</h2><p>很多时候，用户输入的日期和时间是字符串，要处理日期和时间，首先必须把str转换为datetime。转换方法是通过<code>datetime.strptime()</code>实现，需要一个日期和时间的格式化字符串：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; cday = datetime.strptime(&apos;2015-6-1 18:19:59&apos;, &apos;%Y-%m-%d %H:%M:%S&apos;)</span><br><span class="line">&gt;&gt;&gt; print(cday)</span><br><span class="line">2015-06-01 18:19:59</span><br></pre></td></tr></table></figure><p>字符串<code>&#39;%Y-%m-%d %H:%M:%S&#39;</code>规定了日期和时间部分的格式。详细的说明请参考<a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" target="_blank" rel="noopener">Python文档</a>。</p><p>注意转换后的datetime是没有时区信息的。</p><h2 id="datetime转换为str"><a href="#datetime转换为str" class="headerlink" title="datetime转换为str"></a>datetime转换为str</h2><p>如果已经有了datetime对象，要把它格式化为字符串显示给用户，就需要转换为str，转换方法是通过<code>strftime()</code>实现的，同样需要一个日期和时间的格式化字符串：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; print(now.strftime(&apos;%a, %b %d %H:%M&apos;))</span><br><span class="line">Mon, May 05 16:28</span><br></pre></td></tr></table></figure><h2 id="datetime加减"><a href="#datetime加减" class="headerlink" title="datetime加减"></a>datetime加减</h2><p>对日期和时间进行加减实际上就是把datetime往后或往前计算，得到新的datetime。加减可以直接用<code>+</code>和<code>-</code>运算符，不过需要导入<code>timedelta</code>这个类：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(hours=10)</span><br><span class="line">datetime.datetime(2015, 5, 19, 2, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now - timedelta(days=1)</span><br><span class="line">datetime.datetime(2015, 5, 17, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(days=2, hours=12)</span><br><span class="line">datetime.datetime(2015, 5, 21, 4, 57, 3, 540997)</span><br></pre></td></tr></table></figure><p>可见，使用<code>timedelta</code>你可以很容易地算出前几天和后几天的时刻。</p><h2 id="本地时间转换为UTC时间"><a href="#本地时间转换为UTC时间" class="headerlink" title="本地时间转换为UTC时间"></a>本地时间转换为UTC时间</h2><p>本地时间是指系统设定时区的时间，例如北京时间是UTC+8:00时区的时间，而UTC时间指UTC+0:00时区的时间。</p><p>一个<code>datetime</code>类型有一个时区属性<code>tzinfo</code>，但是默认为<code>None</code>，所以无法区分这个<code>datetime</code>到底是哪个时区，除非强行给<code>datetime</code>设置一个时区：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta, timezone</span><br><span class="line">&gt;&gt;&gt; tz_utc_8 = timezone(timedelta(hours=8)) # 创建时区UTC+8:00</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 17, 2, 10, 871012)</span><br><span class="line">&gt;&gt;&gt; dt = now.replace(tzinfo=tz_utc_8) # 强制设置为UTC+8:00</span><br><span class="line">&gt;&gt;&gt; dt</span><br><span class="line">datetime.datetime(2015, 5, 18, 17, 2, 10, 871012, tzinfo=datetime.timezone(datetime.timedelta(0, 28800)))</span><br></pre></td></tr></table></figure><p>如果系统时区恰好是UTC+8:00，那么上述代码就是正确的，否则，不能强制设置为UTC+8:00时区。</p><p><strong>时区转换</strong></p><p>我们可以先通过<code>utcnow()</code>拿到当前的UTC时间，再转换为任意时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 拿到UTC时间，并强制设置时区为UTC+0:00:</span><br><span class="line">&gt;&gt;&gt; utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">&gt;&gt;&gt; print(utc_dt)</span><br><span class="line">2015-05-18 09:05:12.377316+00:00</span><br><span class="line"># astimezone()将转换时区为北京时间:</span><br><span class="line">&gt;&gt;&gt; bj_dt = utc_dt.astimezone(timezone(timedelta(hours=8)))</span><br><span class="line">&gt;&gt;&gt; print(bj_dt)</span><br><span class="line">2015-05-18 17:05:12.377316+08:00</span><br><span class="line"># astimezone()将转换时区为东京时间:</span><br><span class="line">&gt;&gt;&gt; tokyo_dt = utc_dt.astimezone(timezone(timedelta(hours=9)))</span><br><span class="line">&gt;&gt;&gt; print(tokyo_dt)</span><br><span class="line">2015-05-18 18:05:12.377316+09:00</span><br><span class="line"># astimezone()将bj_dt转换时区为东京时间:</span><br><span class="line">&gt;&gt;&gt; tokyo_dt2 = bj_dt.astimezone(timezone(timedelta(hours=9)))</span><br><span class="line">&gt;&gt;&gt; print(tokyo_dt2)</span><br><span class="line">2015-05-18 18:05:12.377316+09:00</span><br></pre></td></tr></table></figure><p>时区转换的关键在于，拿到一个<code>datetime</code>时，要获知其正确的时区，然后强制设置时区，作为基准时间。</p><p>利用带时区的<code>datetime</code>，通过<code>astimezone()</code>方法，可以转换到任意时区。</p><p>注：不是必须从UTC+0:00时区转换到其他时区，任何带时区的<code>datetime</code>都可以正确转换，例如上述<code>bj_dt</code>到<code>tokyo_dt</code>的转换。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>datetime</code>表示的时间需要时区信息才能确定一个特定的时间，否则只能视为本地时间。</p><p>如果要存储<code>datetime</code>，最佳方法是将其转换为timestamp再存储，因为timestamp的值与时区完全无关。</p><h1 id="dateutil模块"><a href="#dateutil模块" class="headerlink" title="dateutil模块"></a>dateutil模块</h1><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-dateutil</span><br></pre></td></tr></table></figure><h2 id="parser"><a href="#parser" class="headerlink" title="parser"></a>parser</h2><p>parser是根据字符串解析成datetime,字符串可以很随意，可以用时间日期的英文单词，可以用横线、逗号、空格等做分隔符，可以包含时区。<br>没指定时间默认是0点，没指定日期默认是今天，没指定年份默认是今年。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"2018-10-21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"20181021"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"2018/10/21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"10-21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"10/21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2 id="rrule"><a href="#rrule" class="headerlink" title="rrule"></a>rrule</h2><p>rrule(self, freq, dtstart=None, interval=1, wkst=None,count=None, until=None, bysetpos=None,bymonth=None, bymonthday=None, byyearday=None, byeaster=None,byweekno=None, byweekday=None, byhour=None, byminute=None, bysecond=None,cache=False)</p><ul><li>freq:可以理解为单位。可以是 YEARLY, MONTHLY, WEEKLY,DAILY, HOURLY, MINUTELY, SECONDLY。即年月日周时分秒</li><li>dtstart,until:是开始和结束时间</li><li>wkst:周开始时间</li><li>interval:间隔</li><li>count:指定生成多少个</li><li>byxxx:指定匹配的周期。比如byweekday=(MO,TU)则只有周一周二的匹配。byweekday可以指定MO,TU,WE,TH,FR,SA,SU。即周一到周日。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil <span class="keyword">import</span> rrule</span><br><span class="line"></span><br><span class="line">生成一个连续的日期列表</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">间隔一天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,interval=<span class="number">2</span>,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只保留前<span class="number">3</span>个元素</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,count=<span class="number">3</span>,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只要周一的</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,byweekday=rrule.MO,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只要周六和周日的</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,byweekday=(rrule.SA,rrule.SU),dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">以月为间隔</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-7-30'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br></pre></td></tr></table></figure><p><strong>计算时间差</strong></p><p>rrule可计算出两个datetime对象间相差的年月日等时间数量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">两个日期相差<span class="number">10</span>天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-10'</span>)).count()</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line">某个日期到今天相差多少天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=datetime.date.today()).count()</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>两个日期相差几个月<br>前一个月为m月，后一个月为n月，当日期不满整月时，差的月数按n-m算，当日期满整月后，差的月数按n-m+1算。<br>差的年数同月数的情况一样。<br>例子如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-11-10'</span>)).count()</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-11-20'</span>)).count()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.YEARLY,dtstart=parse(<span class="string">'2016-3-15'</span>),until=parse(<span class="string">'2018-2-10'</span>)).count()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.YEARLY,dtstart=parse(<span class="string">'2016-3-15'</span>),until=parse(<span class="string">'2018-3-15'</span>)).count()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><h1 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h1><h2 id="当前时间转文本"><a href="#当前时间转文本" class="headerlink" title="当前时间转文本"></a>当前时间转文本</h2><p>无论是<code>time</code>或<code>datetime</code>，哪个模块都可以，具体怎么输出，自行调整格式参数<code>&#39;%Y-%m-%d %H:%M:%S&#39;</code></p><table><thead><tr><th>%字符</th><th>表意</th><th>数值范围</th></tr></thead><tbody><tr><td>%y</td><td>年(2位)</td><td>00, 01, …, 99</td></tr><tr><td>%Y</td><td>年(4位)</td><td>0001, 0002, …, 2013, 2014, …, 9998, 9999</td></tr><tr><td>%m</td><td>月</td><td>01, 02, …, 12</td></tr><tr><td>%d</td><td>日</td><td>01, 02, …, 31</td></tr><tr><td>%H</td><td>时(24小时制)</td><td>00, 01, …, 23</td></tr><tr><td>%M</td><td>分</td><td>00, 01, …, 59</td></tr><tr><td>%S</td><td>秒</td><td>00, 01, …, 59</td></tr><tr><td>%f</td><td>毫秒</td><td>000000, 000001, …, 999999</td></tr><tr><td>%z</td><td>时区</td><td>(empty), +0000, -0400, +1030, +063415, -030712.345216</td></tr></tbody></table><p>这里只列一下我用到的，更多可以看官方文档：<br><a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior" target="_blank" rel="noopener">https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior</a></p><p><strong>【注意】：time、datetime两种时间模块虽然都有strftime，但是(格式,时间)参数位置正好相反。</strong></p><p>time模块（格式在前，时间在后）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>,time.localtime())</span><br><span class="line">print(type(t),t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2019-05-25 08:</span><span class="number">56</span>:<span class="number">45</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p>datetime模块（格式在后，时间在前）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt = datetime.datetime.strftime(datetime.datetime.now(),<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2019-05-25 08:</span><span class="number">56</span>:<span class="number">45</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><h2 id="文本转日期"><a href="#文本转日期" class="headerlink" title="文本转日期"></a>文本转日期</h2><p><strong>常规方法<code>strptime(&quot;日期时间文本&quot;,&quot;文本格式&quot;)</code></strong></p><p>制定时间格式，进行解析</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt = datetime.datetime.strptime(<span class="string">'2019-05-25T07:46:45.743+0000'</span>,<span class="string">'%Y-%m-%dT%H:%M:%S.%f%z'</span>)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 07:</span><span class="number">46</span>:<span class="number">45.743000</span>+<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><p><strong>万能方法<code>parse(&quot;日期时间文本&quot;)</code></strong></p><p>自动解析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from dateutil.parser import parse</span><br><span class="line">dt = parse(&apos;2019-05-25 07:46:45&apos;)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">&lt;class &apos;datetime.datetime&apos;&gt; 2019-05-25 07:46:45</span><br></pre></td></tr></table></figure><p>该方法适用于很多类型时间格式，建议使用前自行测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">dt = [&quot;2001.07.04 AD at 12:08:56 PDT&quot;,</span><br><span class="line">&quot;Wed, 4 Jul 2001 12:08:56 -0700&quot;,</span><br><span class="line">&quot;190525&quot;,&quot;2018-08-06T10:00:00.000Z&quot;,</span><br><span class="line">&quot;Wed, Jul 4&quot;,</span><br><span class="line">&quot;12:08 PM&quot;,</span><br><span class="line">&quot;02001.July.04 AD 12:08 PM&quot;,</span><br><span class="line">&quot;20190525083855-0700&quot;,</span><br><span class="line">&quot;2001-07-04T12:08:56.235-0700&quot;,</span><br><span class="line">&quot;Thu Oct 16 07:13:48 GMT 2014&quot;]</span><br><span class="line"></span><br><span class="line">for i in dt:</span><br><span class="line">print(parse(i))</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">2001-07-04 12:08:56</span><br><span class="line">2001-07-04 12:08:56-07:00</span><br><span class="line">2025-05-19 00:00:00</span><br><span class="line">2018-08-06 10:00:00+00:00</span><br><span class="line">2019-07-04 00:00:00</span><br><span class="line">2019-05-25 12:08:00</span><br><span class="line">2001-07-04 12:08:00</span><br><span class="line">2019-05-25 08:38:55-07:00</span><br><span class="line">2001-07-04 12:08:56.235000-07:00</span><br><span class="line">2014-10-16 07:13:48+00:00</span><br></pre></td></tr></table></figure><p>但是注意，国外日期时间的常用格式和国内不一样。单写<code>19-05-25</code>会被解析成<code>2025年5月19日</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(parse(<span class="string">"19-05-25"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="number">2025</span><span class="number">-05</span><span class="number">-19</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure><p>如果是<code>2019-05-25</code>就不会错了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(parse(<span class="string">"2019-05-25"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="时间戳相关"><a href="#时间戳相关" class="headerlink" title="时间戳相关"></a>时间戳相关</h2><p>生成10或13位时间戳（做一些网页爬虫或构造提交时候可能用到）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t = time.time()</span><br><span class="line">print(type(t),t)</span><br><span class="line">print(<span class="string">'10位时间戳:'</span>,str(int(t)))</span><br><span class="line">print(<span class="string">'13位时间戳:'</span>,str(int(t*<span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">float</span>'&gt; 1558750679.0872486</span></span><br><span class="line"><span class="class">10位时间戳:</span> <span class="number">1558750679</span></span><br><span class="line"><span class="number">13</span>位时间戳: <span class="number">1558750679087</span></span><br><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure><p>时间戳转日期时间（10位或13位通用）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">ts = <span class="string">'1517302458364'</span> <span class="comment"># 该值为int或string类型均可</span></span><br><span class="line">dt1 = datetime.datetime.fromtimestamp(float(ts)/<span class="number">10</span>**(len(str(ts))<span class="number">-10</span>))</span><br><span class="line">print(type(dt1),dt1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2018-01-30 16:</span><span class="number">54</span>:<span class="number">18.364000</span></span><br></pre></td></tr></table></figure><h2 id="时间差计算"><a href="#时间差计算" class="headerlink" title="时间差计算"></a>时间差计算</h2><p>如果是两个<code>datatime</code>格式的日期，直接计算一下差值即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt1 = datetime.datetime.fromtimestamp(<span class="number">1517302458</span>)</span><br><span class="line">dt2 = datetime.datetime.now()</span><br><span class="line"><span class="comment">#print(type(dt1),dt1)</span></span><br><span class="line"><span class="comment">#print(type(dt2),dt2)</span></span><br><span class="line">td = dt2-dt1</span><br><span class="line"><span class="comment">#print(type(td),td)</span></span><br><span class="line">output = <span class="string">'相差%d天%.1f小时'</span>%(td.days,td.seconds/<span class="number">60</span>/<span class="number">60</span>)</span><br><span class="line">print(output)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2018-01-30 16:</span><span class="number">54</span>:<span class="number">18</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-12-16 16:</span><span class="number">18</span>:<span class="number">37.443000</span></span><br><span class="line">&lt;class 'datetime.timedelta'&gt; 684 days, 23:24:19.443000</span><br><span class="line">相差<span class="number">684</span>天<span class="number">23.4</span>小时</span><br><span class="line"><span class="number">123456789101112131415</span></span><br></pre></td></tr></table></figure><p>如果是两个文本格式的日期，用<code>parse()</code>转换成<code>datetime</code>，同样计算差值即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line">arr = [<span class="string">'2018-01-30 16:54:18'</span>,<span class="string">'2019-12-16 16:18:37'</span>]</span><br><span class="line">td = parse(arr[<span class="number">1</span>])-parse(arr[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'相差%d天%.1f小时'</span>%(td.days,td.seconds/<span class="number">60</span>/<span class="number">60</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">相差<span class="number">684</span>天<span class="number">23.4</span>小时</span><br></pre></td></tr></table></figure><h2 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h2><p>直接获取0时区的<code>datetime</code>，并转化为东8区<code>datetime</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line">dt0 = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">dt8 = dt0.astimezone(timezone(timedelta(hours=<span class="number">8</span>))) <span class="comment"># 转换时区到东八区</span></span><br><span class="line">print(<span class="string">'UTC协调世界时 \t%s\nUTC+8北京时间\t%s'</span>%(dt0,dt8))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">UTC协调世界时 <span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">02</span>:<span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">UTC+<span class="number">8</span>北京时间<span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="number">12345678</span></span><br></pre></td></tr></table></figure><p>如果是想将文本格式的<code>2019-05-25T02:48:54.281741+00:00</code>转化到东8区<code>datetime</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line">dt0_str = <span class="string">'2019-05-25T02:48:54.281741+00:00'</span></span><br><span class="line">dt0 = parse(dt0_str)</span><br><span class="line">dt8 = dt0.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</span><br><span class="line">print(type(dt0),dt0)</span><br><span class="line">print(type(dt8),dt8)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 02:</span><span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 10:</span><span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">08</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="获取常用时间"><a href="#获取常用时间" class="headerlink" title="获取常用时间"></a>获取常用时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from datetime import datetime, timedelta</span><br><span class="line"></span><br><span class="line">t1 = datetime.now()</span><br><span class="line"></span><br><span class="line"># 获取本月第一天</span><br><span class="line">t2 = datetime(t1.year, t1.month, 1)</span><br><span class="line">print(t2.strftime(&quot;%Y-%m-%d&quot;))</span><br><span class="line"></span><br><span class="line"># 本月最后一天</span><br><span class="line">t3 = datetime(year=t1.year, month=t1.month+1, day=1) - timedelta(days=1)</span><br><span class="line">print(t3.strftime(&quot;%Y-%m-%d&quot;))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://itopic.org/python-time-module.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://itopic.org/python-time-module.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/watfe/article/details/84943732&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/watfe/article/details/84943732&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.coding.me/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.coding.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python之基础知识</title>
    <link href="https://gongzhao1.coding.me/python%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <id>https://gongzhao1.coding.me/python之基础知识/</id>
    <published>2020-03-15T07:37:14.000Z</published>
    <updated>2020-04-08T14:20:25.871Z</updated>
    
    <content type="html"><![CDATA[<h1 id="python变量下划线小结"><a href="#python变量下划线小结" class="headerlink" title="python变量下划线小结"></a>python变量下划线小结</h1><h2 id="下划线类型"><a href="#下划线类型" class="headerlink" title="下划线类型"></a>下划线类型</h2><p>在python模块或类里面，一些变量的命名上有时会有下划线，表示了变量的特性和被访问限制</p><table><thead><tr><th>描述</th><th>例如</th><th>访问限制</th></tr></thead><tbody><tr><td>前面单下划线</td><td><code>_var</code></td><td>变量所在模块/类以外的地方也能访问该变量，但最好不要</td></tr><tr><td>前面双下划线</td><td><code>__privateVar</code></td><td>变量所在模块/类以外的地方不能访问该变量，这是私有变量</td></tr><tr><td>前后双下划线</td><td>如<code>__name__</code>和<code>__init__</code></td><td>Python内置特殊变量，哪儿都可以访问</td></tr></tbody></table><h2 id="什么是-name"><a href="#什么是-name" class="headerlink" title="什么是__name__"></a>什么是<code>__name__</code></h2><p>一个python脚本，比如 hello.py，就是一个模块，这个模块的名字叫hello；一个模块既可以被其它模块导入（importable），也可以被直接执行（executable）.</p><p><code>__name__</code>是python的内置变量。如果一个模块是被直接执行的话，那么这个模块的<code>__name__</code>变量的值就是 <code>__main__</code>值；而如果这个模块是被其它模块导入的，那么这个模块的<code>__name__</code>变量的值就是模块的名字。</p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;python变量下划线小结&quot;&gt;&lt;a href=&quot;#python变量下划线小结&quot; class=&quot;headerlink&quot; title=&quot;python变量下划线小结&quot;&gt;&lt;/a&gt;python变量下划线小结&lt;/h1&gt;&lt;h2 id=&quot;下划线类型&quot;&gt;&lt;a href=&quot;#下划线类型&quot; class=&quot;headerlink&quot; title=&quot;下划线类型&quot;&gt;&lt;/a&gt;下划线类型&lt;/h2&gt;&lt;p&gt;在python模块或类里面，一些变量的命名上有时会有下划线，表示了变量的特性和被访问限制&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;例如&lt;/th&gt;
&lt;th&gt;访问限制&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;前面单下划线&lt;/td&gt;
&lt;td&gt;&lt;code&gt;_var&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;变量所在模块/类以外的地方也能访问该变量，但最好不要&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;前面双下划线&lt;/td&gt;
&lt;td&gt;&lt;code&gt;__privateVar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;变量所在模块/类以外的地方不能访问该变量，这是私有变量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;前后双下划线&lt;/td&gt;
&lt;td&gt;如&lt;code&gt;__name__&lt;/code&gt;和&lt;code&gt;__init__&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Python内置特殊变量，哪儿都可以访问&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2 id=&quot;什么是-name&quot;&gt;&lt;a href=&quot;#什么是-name&quot; class=&quot;headerlink&quot; title=&quot;什么是__name__&quot;&gt;&lt;/a&gt;什么是&lt;code&gt;__name__&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;一个python脚本，比如 hello.py，就是一个模块，这个模块的名字叫hello；一个模块既可以被其它模块导入（importable），也可以被直接执行（executable）.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;__name__&lt;/code&gt;是python的内置变量。如果一个模块是被直接执行的话，那么这个模块的&lt;code&gt;__name__&lt;/code&gt;变量的值就是 &lt;code&gt;__main__&lt;/code&gt;值；而如果这个模块是被其它模块导入的，那么这个模块的&lt;code&gt;__name__&lt;/code&gt;变量的值就是模块的名字。&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.coding.me/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.coding.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python之小技巧</title>
    <link href="https://gongzhao1.coding.me/python%E4%B9%8B%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://gongzhao1.coding.me/python之小技巧/</id>
    <published>2020-03-15T07:02:09.000Z</published>
    <updated>2020-04-08T14:20:25.871Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="python字符串中包含大括号时怎么使用string的-format方法？"><a href="#python字符串中包含大括号时怎么使用string的-format方法？" class="headerlink" title="python字符串中包含大括号时怎么使用string的.format方法？"></a>python字符串中包含大括号时怎么使用string的.format方法？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'hello &#123;name&#125;'</span>.format(name=<span class="string">'world'</span>)的时候大括号是特殊转义字符，如果需要原始的大括号，用&#123;&#123;代替&#123;, 用&#125;&#125;代替&#125;， 如下:</span><br><span class="line">&gt;&gt;&gt; <span class="string">'hello &#123;&#123;worlds in braces!&#125;&#125;, &#123;name&#125;'</span>.format(name=<span class="string">'zhangsan'</span>)</span><br><span class="line"><span class="string">'hello &#123;worlds in braces!&#125;, zhangsan'</span></span><br></pre></td></tr></table></figure><h1 id="python将一组数分成每3个一组的实例"><a href="#python将一组数分成每3个一组的实例" class="headerlink" title="python将一组数分成每3个一组的实例"></a>python将一组数分成每3个一组的实例</h1><p>如下所示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>]</span><br><span class="line">step = <span class="number">3</span></span><br><span class="line">b = [a[i:i+step] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),step)]</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">1</span>]</span><br><span class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="Python中字符串、列表、元组、字典之间的相互转换"><a href="#Python中字符串、列表、元组、字典之间的相互转换" class="headerlink" title="Python中字符串、列表、元组、字典之间的相互转换"></a>Python中字符串、列表、元组、字典之间的相互转换</h1><p><a href="https://www.jb51.net/article/174331.htm" target="_blank" rel="noopener">https://www.jb51.net/article/174331.htm</a></p><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="字符串转换为列表"><a href="#字符串转换为列表" class="headerlink" title="字符串转换为列表"></a>字符串转换为列表</h3><ol><li>使用list()方法</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str_1 = <span class="string">"1235"</span></span><br><span class="line">str_2 = <span class="string">'zhangsan'</span></span><br><span class="line">str_3 = <span class="string">'''lisi'''</span></span><br><span class="line">tuple_1 = list(str_1)</span><br><span class="line">tuple_2 = list(str_2)</span><br><span class="line">tuple_3 = list(str_3)</span><br><span class="line">print(type(tuple_1))</span><br><span class="line">print(type(tuple_2))</span><br><span class="line">print(type(tuple_3))</span><br><span class="line">print(tuple_1)</span><br><span class="line">print(tuple_2)</span><br><span class="line">print(tuple_3)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/1.png" alt="img"></p><ol start="2"><li><p>使用Python中字符串的内置方法split()</p><blockquote><p>Python split() 通过指定分隔符对字符串进行切片，如果参数 num 有指定值，则分隔 num+1 个子字符串<br>语法：str.split(str=””, num=string.count(str)).<br>①str – 分隔符，默认为所有的空字符，包括空格、换行(\n)、制表符(\t)等。<br>②num – 分割次数。默认为 -1, 即分隔所有。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">str_1 = <span class="string">"12 35 213"</span></span><br><span class="line">str_2 = <span class="string">'zhang san shi a '</span></span><br><span class="line">str_3 = <span class="string">'zhang san shi a '</span></span><br><span class="line">str_4 = <span class="string">'''li si wang wu'''</span></span><br><span class="line">list_1 = str_1.split(<span class="string">" "</span>)</span><br><span class="line">list_2 = str_2.split(<span class="string">" "</span>,<span class="number">1</span>)</span><br><span class="line">list_3 = str_3.split(<span class="string">" "</span>)</span><br><span class="line">list_4 = str_4.split(<span class="string">" "</span>,<span class="number">2</span>)</span><br><span class="line">print(type(list_1))</span><br><span class="line">print(type(list_2))</span><br><span class="line">print(type(list_3))</span><br><span class="line">print(type(list_4))</span><br><span class="line">print(list_1)</span><br><span class="line">print(list_2)</span><br><span class="line">print(list_3)</span><br><span class="line">print(list_4)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/2.png" alt="img"></p><p>​</p></li></ol><h3 id="字符串-转换为-元组"><a href="#字符串-转换为-元组" class="headerlink" title="字符串 转换为 元组"></a>字符串 转换为 元组</h3><p>使用tuple()方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str_1 = <span class="string">"1235"</span></span><br><span class="line">str_2 = <span class="string">'zhangsan'</span></span><br><span class="line">str_3 = <span class="string">'''lisi'''</span></span><br><span class="line">list_1 = tuple(str_1)</span><br><span class="line">list_2 = tuple(str_2)</span><br><span class="line">list_3 = tuple(str_3)</span><br><span class="line">print(type(list_1))</span><br><span class="line">print(type(list_2))</span><br><span class="line">print(type(list_3))</span><br><span class="line">print(list_1)</span><br><span class="line">print(list_2)</span><br><span class="line">print(list_3)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/3.png" alt="img"></p><h3 id="字符串-转换为-字典"><a href="#字符串-转换为-字典" class="headerlink" title="字符串 转换为 字典"></a>字符串 转换为 字典</h3><p><strong>利用eval()方法，可以将字典格式的字符串转换为字典</strong></p><blockquote><p>eval() 函数用来执行一个字符串表达式，并返回表达式的值。<br>语法：eval(expression[, globals[, locals]])<br>①expression – 表达式。<br>②globals – 变量作用域，全局命名空间，如果被提供，则必须是一个字典对象。③locals – 变量作用域，局部命名空间，如果被提供，可以是任何映射对象。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str_1 = <span class="string">"&#123;'name':'zhangsan','age':14,'gender':'girl'&#125;"</span></span><br><span class="line">dict_1 = eval(str_1)</span><br><span class="line">print(type(dict_1))</span><br><span class="line">print(dict_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/4.png" alt="img"></p><p><strong>利用json.loads()方法，可以将字典格式的字符串转换为字典</strong></p><blockquote><p>json.loads 用于解码 JSON 数据。该函数返回 Python 字段的数据类型。<br>语法：json.loads(s[, encoding[, cls[, object_hook[, parse_float[, parse_int[, parse_constant[, object_pairs_hook[, **kw]]]]]]]])</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">str_1 = <span class="string">'&#123;"name":"xiaoming","age":18&#125;'</span></span><br><span class="line">dict_1 = json.loads(str_1)</span><br><span class="line">print(type(dict_1))</span><br><span class="line">print(dict_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/5.png" alt="img"></p><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="列表转字符串"><a href="#列表转字符串" class="headerlink" title="列表转字符串"></a>列表转字符串</h3><p>利用‘’.join()将列表中的内容拼接程一个字符串</p><blockquote><p>Python join() 方法用于将序列中的元素（必须是str） 以指定的字符(‘’中指定的) 连接生成一个新的字符串。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list_1 = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">str_1 = <span class="string">''</span>.join(list_1)</span><br><span class="line">print(type(str_1))</span><br><span class="line">print(str_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/6.png" alt="img"></p><h3 id="列表转字典"><a href="#列表转字典" class="headerlink" title="列表转字典"></a>列表转字典</h3><p><strong>利用for in rang将两个列表转换为字典</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">list_1 = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">list_2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">dict_1 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(list_1)):</span><br><span class="line"> dict_1[list_1[i]] = list_2[i]</span><br><span class="line">print(type(dict_1))</span><br><span class="line">print(dict_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/7.png" alt="img"></p><p><strong>利用python内置方法dict()和zip()将两个列表转换为字典</strong></p><blockquote><p>dict() 函数用于创建一个字典。<br>语法：class dict(<strong>kwarg)<br>class dict(mapping, *<em>kwarg)<br>class dict(iterable, *</em>kwarg)①</strong>kwargs – 关键字<br>②mapping – 元素的容器。<br>③iterable – 可迭代对象。</p></blockquote><blockquote><p>zip() 函数用于将可迭代的对象作为参数，将对象中对应的元素打包成一个个元组，然后返回由这些元组组成的列表。<br>语法：zip([iterable, …])<br>iterabl – 一个或多个迭代器;</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">list_1 = [<span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">list_2 = [<span class="string">'zhangsan'</span>,<span class="number">18</span>]</span><br><span class="line">dict_1 = dict(zip(list_1, list_2))</span><br><span class="line">print(type(dict_1))</span><br><span class="line">print(dict_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/8.png" alt="img"></p><h2 id="元组（tuple）"><a href="#元组（tuple）" class="headerlink" title="元组（tuple）"></a>元组（tuple）</h2><h3 id="元组转换为字符串"><a href="#元组转换为字符串" class="headerlink" title="元组转换为字符串"></a>元组转换为字符串</h3><ul><li>使用方法<code>__str__</code></li><li>返回一个对象的描述信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tuple_1 = (1, 2, 3)</span><br><span class="line">str_1 = tuple_1.__str__()</span><br><span class="line">print(type(str_1))</span><br><span class="line">print(str_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/9.png" alt="img"></p><h3 id="元组转换为列表"><a href="#元组转换为列表" class="headerlink" title="元组转换为列表"></a>元组转换为列表</h3><p>使用方法list()</p><blockquote><p>list() 方法用于将元组转换为列表。<br>语法：list( tup )<br>tup – 要转换为列表的元组。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tuple_1 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">list_1 = list(tuple_1)</span><br><span class="line">print(type(list_1))</span><br><span class="line">print(list_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/10.png" alt="img"></p><h2 id="字典-dict"><a href="#字典-dict" class="headerlink" title="字典(dict)"></a>字典(dict)</h2><h3 id="字典转换为字符串"><a href="#字典转换为字符串" class="headerlink" title="字典转换为字符串"></a>字典转换为字符串</h3><p>使用 json.dumps()方法</p><blockquote><p>json.dumps 用于将 Python 对象编码成 JSON 字符串。<br>json.dumps(obj, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, encoding=“utf-8”, default=None, sort_keys=False, **kw)</p></blockquote><h3 id="字典转换为元组"><a href="#字典转换为元组" class="headerlink" title="字典转换为元组"></a>字典转换为元组</h3><ul><li>使用方法 tuple()</li><li>字典在转换为元组之后，只会保存关键字</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dict_1 = &#123;&quot;name&quot;:&quot;zhangsan&quot;,</span><br><span class="line">   &quot;age&quot;:18&#125;</span><br><span class="line">tuple_1 = tuple(dict_1)</span><br><span class="line">print(type(tuple_1))</span><br><span class="line">print(tuple_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/11.png" alt="img"></p><h3 id="字典转换为列表"><a href="#字典转换为列表" class="headerlink" title="字典转换为列表"></a>字典转换为列表</h3><ul><li>使用方法 list()</li><li>字典在转换为列表之后，只会保存关键字</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dict_1 = &#123;<span class="string">"name"</span>:<span class="string">"zhangsan"</span>,</span><br><span class="line">   <span class="string">"age"</span>:<span class="number">18</span>&#125;</span><br><span class="line">list_1 = list(dict_1)</span><br><span class="line">print(type(list_1))</span><br><span class="line">print(list_1)</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/12.png" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;python字符串中包含大括号时怎么使用string的-format方法？&quot;&gt;&lt;a href=&quot;#python字符串中包含大括号时怎么使用string的-format方法？&quot; class=&quot;headerlink&quot; title=&quot;python字符串中包含大括号时怎么使用string的.format方法？&quot;&gt;&lt;/a&gt;python字符串中包含大括号时怎么使用string的.format方法？&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;hello &amp;#123;name&amp;#125;&#39;&lt;/span&gt;.format(name=&lt;span class=&quot;string&quot;&gt;&#39;world&#39;&lt;/span&gt;)的时候大括号是特殊转义字符，如果需要原始的大括号，用&amp;#123;&amp;#123;代替&amp;#123;, 用&amp;#125;&amp;#125;代替&amp;#125;， 如下:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;hello &amp;#123;&amp;#123;worlds in braces!&amp;#125;&amp;#125;, &amp;#123;name&amp;#125;&#39;&lt;/span&gt;.format(name=&lt;span class=&quot;string&quot;&gt;&#39;zhangsan&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;hello &amp;#123;worlds in braces!&amp;#125;, zhangsan&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&quot;python将一组数分成每3个一组的实例&quot;&gt;&lt;a href=&quot;#python将一组数分成每3个一组的实例&quot; class=&quot;headerlink&quot; title=&quot;python将一组数分成每3个一组的实例&quot;&gt;&lt;/a&gt;python将一组数分成每3个一组的实例&lt;/h1&gt;&lt;p&gt;如下所示&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;a = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;step = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b = [a[i:i+step] &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,len(a),step)]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(b)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;结果：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], [&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;], [&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;], [&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.coding.me/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.coding.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python模块之subprocess</title>
    <link href="https://gongzhao1.coding.me/python%E6%A8%A1%E5%9D%97%E4%B9%8Bsubprocess/"/>
    <id>https://gongzhao1.coding.me/python模块之subprocess/</id>
    <published>2020-03-15T03:04:49.000Z</published>
    <updated>2020-04-08T14:20:25.872Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>subprocess最早在2.4版本引入。用来生成子进程，并可以通过管道连接他们的输入/输出/错误，以及获得他们的返回值。</p><p>subprocess用来替换多个旧模块和函数：</p><ul><li>os.system</li><li>os.spawn*</li><li>os.popen*</li><li>popen2.*</li><li>commands.*</li></ul><p>运行python的时候，我们都是在创建并运行一个进程，linux中一个进程可以fork一个子进程，并让这个子进程exec另外一个程序。在python中，我们通过标准库中的subprocess包来fork一个子进程，并且运行一个外部的程序。subprocess包中定义有数个创建子进程的函数，这些函数分别以不同的方式创建子进程，所欲我们可以根据需要来从中选取一个使用。另外subprocess还提供了一些管理标准流(standard stream)和管道(pipe)的工具，从而在进程间使用文本通信。</p><a id="more"></a><h1 id="subprocess模块"><a href="#subprocess模块" class="headerlink" title="subprocess模块"></a>subprocess模块</h1><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>subprocess.run()</td><td>Python 3.5中新增的函数。执行指定的命令，等待命令执行完成后返回一个包含执行结果的CompletedProcess类的实例。</td></tr><tr><td>subprocess.call()</td><td>执行指定的命令，返回命令执行状态，其功能类似于os.system(cmd)。</td></tr><tr><td>subprocess.check_call()</td><td>Python 2.5中新增的函数。 执行指定的命令，如果执行成功则返回状态码，否则抛出异常。其功能等价于subprocess.run(…, check=True)。</td></tr><tr><td>subprocess.check_output()</td><td>Python 2.7中新增的的函数。执行指定的命令，如果执行状态码为0则返回命令执行结果，否则抛出异常。</td></tr><tr><td>subprocess.getoutput(cmd)</td><td>接收字符串格式的命令，执行命令并返回执行结果，其功能类似于os.popen(cmd).read()和commands.getoutput(cmd)。</td></tr><tr><td>subprocess.getstatusoutput(cmd)</td><td>执行cmd命令，返回一个元组(命令执行状态, 命令执行结果输出)，其功能类似于commands.getstatusoutput()。</td></tr></tbody></table><blockquote><p><strong>说明：</strong></p><ol><li>在Python 3.5之后的版本中，官方文档中提倡通过subprocess.run()函数替代其他函数来使用subproccess模块的功能；</li><li>在Python 3.5之前的版本中，我们可以通过subprocess.call()，subprocess.getoutput()等上面列出的其他函数来使用subprocess模块的功能；</li><li>subprocess.run()、subprocess.call()、subprocess.check_call()和subprocess.check_output()都是通过对subprocess.Popen的封装来实现的高级函数，因此如果我们需要更复杂功能时，可以通过subprocess.Popen来完成。</li><li>subprocess.getoutput()和subprocess.getstatusoutput()函数是来自Python 2.x的commands模块的两个遗留函数。它们隐式的调用系统shell，并且不保证其他函数所具有的安全性和异常处理的一致性。另外，它们从Python 3.3.4开始才支持Windows平台。</li></ol></blockquote><h2 id="subprocess-run"><a href="#subprocess-run" class="headerlink" title="subprocess.run()"></a><strong>subprocess.run()</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import subprocess</span><br><span class="line"><span class="comment"># python 解析则传入命令的每个参数的列表</span></span><br><span class="line">&gt;&gt;&gt; subprocess.run([<span class="string">"df"</span>,<span class="string">"-h"</span>])</span><br><span class="line">Filesystem      Size Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup-LogVol00</span><br><span class="line">           289G  70G 204G 26% /</span><br><span class="line">tmpfs         64G   0  64G  0% /dev/shm</span><br><span class="line">/dev/sda1       283M  27M 241M 11% /boot</span><br><span class="line">CompletedProcess(args=[<span class="string">'df'</span>, <span class="string">'-h'</span>], returncode=0)</span><br><span class="line"><span class="comment"># 需要交给Linux shell自己解析，则:传入命令字符串，shell=True</span></span><br><span class="line">&gt;&gt;&gt; subprocess.run(<span class="string">"df -h|grep /dev/sda1"</span>,shell=True)</span><br><span class="line">/dev/sda1       283M  27M 241M 11% /boot</span><br><span class="line">CompletedProcess(args=<span class="string">'df -h|grep /dev/sda1'</span>, returncode=0)</span><br></pre></td></tr></table></figure><h2 id="subprocess-call"><a href="#subprocess-call" class="headerlink" title="subprocess.call()"></a><strong>subprocess.call()</strong></h2><p>执行命令，返回命令的结果和执行状态，0或者非0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; res = subprocess.call([<span class="string">"ls"</span>,<span class="string">"-l"</span>])</span><br><span class="line">总用量 28</span><br><span class="line">-rw-r--r-- 1 root root   0 6月 16 10:28 1</span><br><span class="line">drwxr-xr-x 2 root root 4096 6月 22 17:48 _1748</span><br><span class="line">-rw-------. 1 root root 1264 4月 28 20:51 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x 2 root root 4096 5月 25 14:45 monitor</span><br><span class="line">-rw-r--r-- 1 root root 13160 5月  9 13:36 npm-debug.log</span><br><span class="line"><span class="comment"># 命令执行状态</span></span><br><span class="line">&gt;&gt;&gt; res</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h2 id="subprocess-check-call"><a href="#subprocess-check-call" class="headerlink" title="subprocess.check_call()"></a><strong>subprocess.check_call()</strong></h2><p>执行命令，返回结果和状态，正常为0 ，执行错误则抛出异常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; subprocess.check_call([<span class="string">"ls"</span>,<span class="string">"-l"</span>])</span><br><span class="line">总用量 28</span><br><span class="line">-rw-r--r-- 1 root root   0 6月 16 10:28 1</span><br><span class="line">drwxr-xr-x 2 root root 4096 6月 22 17:48 _1748</span><br><span class="line">-rw-------. 1 root root 1264 4月 28 20:51 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x 2 root root 4096 5月 25 14:45 monitor</span><br><span class="line">-rw-r--r-- 1 root root 13160 5月  9 13:36 npm-debug.log</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt; subprocess.check_call([<span class="string">"lm"</span>,<span class="string">"-l"</span>])</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> File <span class="string">"&lt;stdin&gt;"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line"> File <span class="string">"/usr/lib64/python2.7/subprocess.py"</span>, line 537, <span class="keyword">in</span> check_call</span><br><span class="line">  retcode = call(*popenargs, **kwargs)</span><br><span class="line"> File <span class="string">"/usr/lib64/python2.7/subprocess.py"</span>, line 524, <span class="keyword">in</span> call</span><br><span class="line">  <span class="built_in">return</span> Popen(*popenargs, **kwargs).<span class="built_in">wait</span>()</span><br><span class="line"> File <span class="string">"/usr/lib64/python2.7/subprocess.py"</span>, line 711, <span class="keyword">in</span> __init__</span><br><span class="line">  errread, errwrite)</span><br><span class="line"> File <span class="string">"/usr/lib64/python2.7/subprocess.py"</span>, line 1327, <span class="keyword">in</span> _execute_child</span><br><span class="line">  raise child_exception</span><br><span class="line">OSError: [Errno 2] No such file or directory</span><br></pre></td></tr></table></figure><h2 id="subprocess-getoutput"><a href="#subprocess-getoutput" class="headerlink" title="subprocess.getoutput()"></a><strong>subprocess.getoutput()</strong></h2><p>接受字符串形式的命令，放回执行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; subprocess.getoutput(<span class="string">'pwd'</span>)</span><br><span class="line"><span class="string">'/root'</span></span><br></pre></td></tr></table></figure><h2 id="subprocess-getstatusoutput"><a href="#subprocess-getstatusoutput" class="headerlink" title="subprocess.getstatusoutput()"></a><strong>subprocess.getstatusoutput()</strong></h2><p>接受字符串形式的命令，返回 一个元组形式的结果，第一个元素是命令执行状态，第二个为执行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行正确</span></span><br><span class="line">&gt;&gt;&gt; subprocess.getstatusoutput(<span class="string">'pwd'</span>)</span><br><span class="line">(0, <span class="string">'/root'</span>)</span><br><span class="line"><span class="comment">#执行错误</span></span><br><span class="line">&gt;&gt;&gt; subprocess.getstatusoutput(<span class="string">'pd'</span>)</span><br><span class="line">(127, <span class="string">'/bin/sh: pd: command not found'</span>)</span><br></pre></td></tr></table></figure><h2 id="subprocess-check-output"><a href="#subprocess-check-output" class="headerlink" title="subprocess.check_output()"></a><strong>subprocess.check_output()</strong></h2><p>如果当返回值为0时，直接返回输出结果，如果返回值不为0，直接抛出异常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; res = subprocess.check_output(<span class="string">"pwd"</span>)</span><br><span class="line">&gt;&gt;&gt; res</span><br><span class="line">b<span class="string">'/root\n'</span> <span class="comment"># 结果以字节形式返回</span></span><br></pre></td></tr></table></figure><h2 id="subprocess-Popen"><a href="#subprocess-Popen" class="headerlink" title="subprocess.Popen()"></a><strong>subprocess.Popen()</strong></h2><p>其实以上subprocess使用的方法，都是对subprocess.Popen的封装，下面我们就来看看这个Popen方法。</p><h3 id="subprocess-Popen的构造函数"><a href="#subprocess-Popen的构造函数" class="headerlink" title="subprocess.Popen的构造函数"></a>subprocess.Popen的构造函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">subprocess</span>.<span class="title">Popen</span><span class="params">(args, bufsize=<span class="number">-1</span>, executable=None, stdin=None, stdout=None, stderr=None, </span></span></span><br><span class="line"><span class="class"><span class="params">    preexec_fn=None, close_fds=True, shell=False, cwd=None, env=None, universal_newlines=False,</span></span></span><br><span class="line"><span class="class"><span class="params">    startup_info=None, creationflags=<span class="number">0</span>, restore_signals=True, start_new_session=False, pass_fds=<span class="params">()</span>)</span></span></span><br></pre></td></tr></table></figure><blockquote><p>参数说明：</p><ul><li><strong>args：</strong> 要执行的shell命令，可以是字符串，也可以是命令各个参数组成的序列。当该参数的值是一个字符串时，该命令的解释过程是与平台相关的，因此通常建议将args参数作为一个序列传递。</li><li><strong>bufsize：</strong> 指定缓存策略，0表示不缓冲，1表示行缓冲，其他大于1的数字表示缓冲区大小，负数 表示使用系统默认缓冲策略。</li><li><strong>stdin, stdout, stderr：</strong> 分别表示程序标准输入、输出、错误句柄。</li><li><strong>preexec_fn：</strong> 用于指定一个将在子进程运行之前被调用的可执行对象，只在Unix平台下有效。</li><li><strong>close_fds：</strong> 如果该参数的值为True，则除了0,1和2之外的所有文件描述符都将会在子进程执行之前被关闭。</li><li><strong>shell：</strong> 该参数用于标识是否使用shell作为要执行的程序，如果shell值为True，则建议将args参数作为一个字符串传递而不要作为一个序列传递。</li><li><strong>cwd：</strong> 如果该参数值不是None，则该函数将会在执行这个子进程之前改变当前工作目录。</li><li><strong>env：</strong> 用于指定子进程的环境变量，如果env=None，那么子进程的环境变量将从父进程中继承。如果env!=None，它的值必须是一个映射对象。</li><li><strong>universal_newlines：</strong> 如果该参数值为True，则该文件对象的stdin，stdout和stderr将会作为文本流被打开，否则他们将会被作为二进制流被打开。</li><li><strong>startupinfo和creationflags：</strong> 这两个参数只在Windows下有效，它们将被传递给底层的CreateProcess()函数，用于设置子进程的一些属性，如主窗口的外观，进程优先级等。</li></ul></blockquote><h3 id="stdout"><a href="#stdout" class="headerlink" title="stdout"></a>stdout</h3><p>标准输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; res = subprocess.Popen(<span class="string">"ls /tmp/yum.log"</span>, shell=True, stdout=subprocess.PIPE) <span class="comment"># 使用管道</span></span><br><span class="line">&gt;&gt;&gt; res.stdout.read()  <span class="comment"># 标准输出</span></span><br><span class="line">b<span class="string">'/tmp/yum.log\n'</span></span><br><span class="line">res.stdout.close()  <span class="comment"># 关闭</span></span><br></pre></td></tr></table></figure><h3 id="stderr"><a href="#stderr" class="headerlink" title="stderr"></a>stderr</h3><p>标准错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import subprocess</span><br><span class="line">&gt;&gt;&gt; res = subprocess.Popen(<span class="string">"lm -l"</span>,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line"><span class="comment"># 标准输出为空</span></span><br><span class="line">&gt;&gt;&gt; res.stdout.read()</span><br><span class="line">b<span class="string">''</span></span><br><span class="line"><span class="comment">#标准错误中有错误信息</span></span><br><span class="line">&gt;&gt;&gt; res.stderr.read()</span><br><span class="line">b<span class="string">'/bin/sh: lm: command not found\n'</span></span><br></pre></td></tr></table></figure><h3 id="poll"><a href="#poll" class="headerlink" title="poll()"></a>poll()</h3><p>定时检查命令有没有执行完毕，执行完毕后返回执行结果的状态，没有执行完毕返回None</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; res = subprocess.Popen(<span class="string">"sleep 10;echo 'hello'"</span>,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(res.poll())</span><br><span class="line">None</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(res.poll())</span><br><span class="line">None</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(res.poll())</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h3 id="wait"><a href="#wait" class="headerlink" title="wait()"></a>wait()</h3><p>等待命令执行完成，并且返回结果状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; obj = subprocess.Popen(<span class="string">"sleep 10;echo 'hello'"</span>,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line">&gt;&gt;&gt; obj.wait()</span><br><span class="line"><span class="comment"># 中间会一直等待</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure><h3 id="terminate"><a href="#terminate" class="headerlink" title="terminate()"></a>terminate()</h3><p>结束进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import subprocess</span><br><span class="line">&gt;&gt;&gt; res = subprocess.Popen(<span class="string">"sleep 20;echo 'hello'"</span>,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line">&gt;&gt;&gt; res.terminate() <span class="comment"># 结束进程</span></span><br><span class="line">&gt;&gt;&gt; res.stdout.read()</span><br><span class="line">b<span class="string">''</span></span><br></pre></td></tr></table></figure><h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>获取当前执行子shell的程序的进程号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import subprocess</span><br><span class="line">&gt;&gt;&gt; res = subprocess.Popen(<span class="string">"sleep 5;echo 'hello'"</span>,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)</span><br><span class="line">&gt;&gt;&gt; res.pid <span class="comment"># 获取这个linux shell 的 进程号</span></span><br><span class="line">2778</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;subprocess最早在2.4版本引入。用来生成子进程，并可以通过管道连接他们的输入/输出/错误，以及获得他们的返回值。&lt;/p&gt;
&lt;p&gt;subprocess用来替换多个旧模块和函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;os.system&lt;/li&gt;
&lt;li&gt;os.spawn*&lt;/li&gt;
&lt;li&gt;os.popen*&lt;/li&gt;
&lt;li&gt;popen2.*&lt;/li&gt;
&lt;li&gt;commands.*&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;运行python的时候，我们都是在创建并运行一个进程，linux中一个进程可以fork一个子进程，并让这个子进程exec另外一个程序。在python中，我们通过标准库中的subprocess包来fork一个子进程，并且运行一个外部的程序。subprocess包中定义有数个创建子进程的函数，这些函数分别以不同的方式创建子进程，所欲我们可以根据需要来从中选取一个使用。另外subprocess还提供了一些管理标准流(standard stream)和管道(pipe)的工具，从而在进程间使用文本通信。&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.coding.me/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.coding.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>shadowsocks服务端搭建</title>
    <link href="https://gongzhao1.coding.me/shadowsocks%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%90%AD%E5%BB%BA/"/>
    <id>https://gongzhao1.coding.me/shadowsocks服务端搭建/</id>
    <published>2020-03-05T03:56:55.000Z</published>
    <updated>2020-04-08T14:20:25.873Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools &amp;&amp; easy_install pip </span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/shadowsocks</span><br><span class="line">sudo vi /etc/shadowsocks/shadowsocks.json</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">    &quot;server_port&quot;: 8838,</span><br><span class="line">    &quot;method&quot;: &quot;rc4-md5&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;abcd1234&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks/shadowsocks.json -d start</span><br></pre></td></tr></table></figure><h1 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure><h1 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h1><p>服务器的TCP端口8838要放行</p><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><h2 id="最大连接数"><a href="#最大连接数" class="headerlink" title="最大连接数"></a>最大连接数</h2><p>提高最大连接数,添加如下参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">* soft nofile 51200</span><br><span class="line">* hard nofile 51200</span><br></pre></td></tr></table></figure><h2 id="内核参数"><a href="#内核参数" class="headerlink" title="内核参数"></a>内核参数</h2><p>调整内核参数的目标是：</p><p>1.尽可能重用连接和端口号</p><p>2.尽可能增大队列和缓冲区</p><p>3.为高延迟和高流量选择合适的TCP拥塞算法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">fs.file-max = 51200</span><br><span class="line">net.core.rmem_max = 67108864</span><br><span class="line">net.core.wmem_max = 67108864</span><br><span class="line">net.core.netdev_max_backlog = 250000</span><br><span class="line">net.core.somaxconn = 4096</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line">net.ipv4.ip_local_port_range = 10000 65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 5000</span><br><span class="line">net.ipv4.tcp_fastopen = 3</span><br><span class="line">net.ipv4.tcp_mem = 25600 51200 102400</span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 67108864</span><br><span class="line">net.ipv4.tcp_wmem = 4096 65536 67108864</span><br><span class="line">net.ipv4.tcp_mtu_probing = 1</span><br><span class="line">net.ipv4.tcp_congestion_control = hybla</span><br></pre></td></tr></table></figure><p>使生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install python-setuptools &amp;amp;&amp;amp; easy_install pip &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install shadowsocks&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="科学上网" scheme="https://gongzhao1.coding.me/categories/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
    
      <category term="shadowsocks" scheme="https://gongzhao1.coding.me/tags/shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>基金经理之陈洲</title>
    <link href="https://gongzhao1.coding.me/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86%E4%B9%8B%E9%99%88%E6%B4%B2/"/>
    <id>https://gongzhao1.coding.me/基金经理之陈洲/</id>
    <published>2020-03-02T13:32:11.000Z</published>
    <updated>2020-04-08T14:20:25.883Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://mp.weixin.qq.com/s/aqRaTx2FF-AzTH22UcaHyg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/aqRaTx2FF-AzTH22UcaHyg</a></p><p>资产管理行业，是一个责任、经验和知识并重的行业。那些常年默默无闻，努力为投资者获取长期稳健收益的基金经理，会受到投资者的认可和尊重。在我的印象中，在2016年年底就有上海的持有人自发众筹请基金经理吃饭的事儿，在资管界传为美谈。这位基金经理，就是国泰基金的程洲。他管理的国泰聚信价值优势在牛市中能涨、股灾中抗跌，从基金成立日起持有五年平均收益翻倍，让部分持有人收获了满满的幸福感。</p><a id="more"></a><h1 id="公募老将"><a href="#公募老将" class="headerlink" title="公募老将"></a>公募老将</h1><p>程洲自2000年就进入证券行业，从业经历长达19年。他在2004年加盟国泰基金，2008年开始担任基金经理，担任过11年的基金经理，是一位十足的公募老将。其管理的国泰聚信价值优势获得了2016年的金牛奖和三年持续回报明星基金奖，程洲本人也获得过3年期英华奖。</p><p>程洲管理过对“长期稳健收益”要求极高的社保基金。多年的投资实践中，他逐渐形成了对风险控制高度重视的“稳健收益”投资理念，为获取长期优秀的业绩奠定了基础。</p><h1 id="过往业绩优秀"><a href="#过往业绩优秀" class="headerlink" title="过往业绩优秀"></a>过往业绩优秀</h1><p>目前程洲管理的基金资产约48亿，并且产品类型多样，有开放式也有定开式，有混合型也有股票型，有灵活配置型也有行业主题型，还管理社保基金，是一位资产管理的多面手。</p><p>我们从中选取两个代表性的产品进行重点分析，一个是灵活配置型的国泰聚信价值（000362）；另一个是行业主题基金国泰大农业（001579）。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/8.png" alt="img"></p><p>国泰聚信价值成立于2013年12月，是灵活配置型基金（股票投资比例范围30%-95%）。程洲自基金成立任职至今（10月23日），任期已接近6年，任职回报157%，同类排名TOP5%(WIND，90/1939，一级分类，截止2019-10-23）。</p><p>国泰大农业成立于2017年6月，是行业主题型基金（股票投资比例不低于80%），规模2.4亿。程洲也是自基金成立开始任职至今，任期2.4年，任职回报55%，同类排名TOP2%（WIND，83/6023，一级分类，截止2019-10-23）。</p><p>这两只基金虽然投资范围、类型不一样，但业绩在同类中排名都非常靠前。可见程洲的投资管理能力比较全面，没有明显的短板，能驾驭各种类型的产品，应对各种市场行情。</p><h1 id="风险控制"><a href="#风险控制" class="headerlink" title="风险控制"></a>风险控制</h1><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/9.png" alt="img"></p><p>程洲在管理国泰聚信价值期间，任职回报相对于同期沪深300指数的超额收益达到94%。该基金年化收益率高达20%，远高于沪深300指数的9%。尤其是年化波动率和区间最大回撤也远低于沪深300指数，这一点难能可贵。凭借优异的业绩，该基金在2016年度获得一年期开放式混合型金牛基金、三年持续回报平衡混合型明星基金奖。</p><p>在管理国泰大农业期间，任职回报相对于中证大农业指数的超额收益达到41%。该基金的年化收益率高达22%，远高于中证大农业指数的6%。年化波动率和区间最大回撤也低于中证大农业指数。</p><p>从上述数据分析，程洲的投资风格是追求稳健收益，最大程度的控制回撤，减小净值波动。他管理的基金获取超额收益的能力较强，回撤控制的较好，风险收益比较高。</p><h1 id="上马击狂胡：自上而下能择时"><a href="#上马击狂胡：自上而下能择时" class="headerlink" title="上马击狂胡：自上而下能择时"></a>上马击狂胡：自上而下能择时</h1><p>程洲的投资框架可以概括为“取势、明道、优术”。取势，就是判断影响市场的主流发展趋势，进行大类资产配置，追求稳健组合回报。明道，就是善于极端行情下择时，在泡沫严重时及时离场。优术，即坚持简单可靠的基本面投资，选出优质的投资标的。</p><p>程洲具有宏观策略研究经验，具备自上而下的判断能力，在“取势”、“明道”方面相具有独特的优势。他是业内为数不多的具备择时能力、并成功进行择时操作的基金经理。在十多年的牛熊轮回中，择时次数不多，但是往往都在关键点上，有效控制了净值的波动和回撤。</p><p>以仓位灵活的国泰聚信价值为例，2015年上半年在牛市最疯狂的时候，程洲未雨绸缪，大幅将股票仓位从一季度末的87%降至三季度末的35%，并在2016年保持较低的仓位，不仅成功守住了2014-2015年那场牛市中的收益，还降低了2016年初“熔断”期间的损失。</p><p>2018年年初，白马股慢牛行情的末期，程洲也表现出敏锐的嗅觉，将国泰聚信价值的股票仓位从一季度末的91%大幅降至二季度末的59%。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/10.webp" alt="img"></p><p>程洲的择时周期相对较长，更多的是在极端情况下的择时操作，是一种资产泡沫严重时的避险行为。也从侧面反映出程洲的理性和冷静，以及对市场的敬畏。</p><h1 id="下马草军书：自下而上能择股"><a href="#下马草军书：自下而上能择股" class="headerlink" title="下马草军书：自下而上能择股"></a>下马草军书：自下而上能择股</h1><p>经过长期的投资实践，程洲选股的思路也很明确，即三大标准：行业龙头、现金流好、估值低。</p><p>行业龙头公司在各自的领域内有较强的护城河和竞争优势，具备稳定的发展前景。程洲也非常关注小行业中的龙头股，虽然市值小，但是在细分领域内具有很强的话语权，即“小行业中的大公司”。</p><p>现金流好（持续为正），是为了确保企业经营业绩的真实和可靠，一方面寻找出内生增长能力强的优质企业。另一方面，可以过滤掉一些财务问题比较多的公司，比如因缺钱大量融资，负债率很高，一旦遇到危机，容易出大问题。</p><p>而估值低则提供了安全边际，如果出现个股价格明显低于内在价值的情况，经过研究后认为机会不错，就买入并长期持有。一方面以较低的持有成本享受获取企业盈利增长的收益，另一方面还有机会获得估值回归的收益。</p><p>整体来看，程洲的持仓行业较为分散，持股集中度中等，以价值投资风格为主，持仓比较稳定。在市场风格变化较大时，他也会在一定程度上适应市场的风格。这样，他在获得长期稳定业绩的同时，又不失收益弹性。</p><p>程洲投资思路非常清晰、稳定，不追逐热点行业板块，不参与机构抱团。比如2015年上半年计算机、传媒被热捧，2017年以来大消费被机构抱团，国泰聚信价值并没有刻意去配置，依然按照一贯的投资思路管理。</p><p>程洲的持股周期有长有短，有格力电器、中国平安等持股周期3年以上的，也有的持有短于一年。在长期持有（1年以上）的个股中，多数都取得了超额收益。</p><h1 id="追求稳健收益，历史波动低、回撤小，基民可当“甩手掌柜”"><a href="#追求稳健收益，历史波动低、回撤小，基民可当“甩手掌柜”" class="headerlink" title="追求稳健收益，历史波动低、回撤小，基民可当“甩手掌柜”"></a>追求稳健收益，历史波动低、回撤小，基民可当“甩手掌柜”</h1><p>对大多数投资者而言，对波动和风险都比较厌恶。大家所期望的，就是能够找到一位值得托付的基金经理，以高度的责任心和专业的管理能力，为自己的资产保驾护航。自己能安心做一个“甩手掌柜”，这也是基民最大的幸福。而程洲正是这样一位不可多得的基金经理。</p><p>岁月就是一把筛子，将程洲这样优秀的基金经理筛了出来。有如一坛老酒，愈久弥香。</p><p>程洲历经多轮牛熊，对市场充满敬畏之心，以追求稳健收益为目标，控制回撤能力强，在收益指标、风险指标上均位居同类基金前列。历史上他管理的基金常常能先于大盘创新高，使买入并持有的投资者能够收获“时间的玫瑰”。赚到了真金白银，这或许也是持有人众筹请他吃饭的主要原因吧。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/11.png" alt="img"></p><h1 id="新基金"><a href="#新基金" class="headerlink" title="新基金"></a>新基金</h1><p>国泰鑫睿混合（007835），这是程洲的新近发的一只基金。在整体的产品设计上和国泰聚信价值比较相似，为混合型产品。股票投资比例范围是35%-80%，有利于程洲延续一贯灵活配置的投资风格，发挥多行业（偏向特色原料药、新材料和自主可控行业）配置、极端情况下择时、严控回撤等优势。国泰鑫睿混合也将稳健管理，力争为持有人贡献稳定的回报。</p><p>在以前的文章中，我多次给大家分析过，成立于3000点附近的主动偏股基金，在长期往往有不俗的业绩。此时发新基金，对于把握低位建仓的十分有利。并且随着A股市场日益成熟，慢牛行情可期，目前就是不错的配置时点。</p><p>国泰鑫睿混合已于2019年10月21日开始发行，认购期11月8日结束，各银行、券商、第三方销售机构均有销售。期望获得长期稳健收益的投资者可以考虑参与，将资产托付给程洲这样的基金经理，从此做一个幸福的基民。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/aqRaTx2FF-AzTH22UcaHyg&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/aqRaTx2FF-AzTH22UcaHyg&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;资产管理行业，是一个责任、经验和知识并重的行业。那些常年默默无闻，努力为投资者获取长期稳健收益的基金经理，会受到投资者的认可和尊重。在我的印象中，在2016年年底就有上海的持有人自发众筹请基金经理吃饭的事儿，在资管界传为美谈。这位基金经理，就是国泰基金的程洲。他管理的国泰聚信价值优势在牛市中能涨、股灾中抗跌，从基金成立日起持有五年平均收益翻倍，让部分持有人收获了满满的幸福感。&lt;/p&gt;
    
    </summary>
    
      <category term="基金经理" scheme="https://gongzhao1.coding.me/categories/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    
    
      <category term="基金" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91/"/>
    
      <category term="基金经理" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>基金经理之董承非</title>
    <link href="https://gongzhao1.coding.me/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86%E4%B9%8B%E8%91%A3%E6%89%BF%E9%9D%9E/"/>
    <id>https://gongzhao1.coding.me/基金经理之董承非/</id>
    <published>2020-03-02T13:13:10.000Z</published>
    <updated>2020-04-08T14:20:25.883Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MDQxODY5MQ==&amp;mid=2247487742&amp;idx=1&amp;sn=feb16135c29e9e96889f7de394c696f6&amp;source=41#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzA5MDQxODY5MQ==&amp;mid=2247487742&amp;idx=1&amp;sn=feb16135c29e9e96889f7de394c696f6&amp;source=41#wechat_redirect</a></p><p>兴全新视野是一只定期开放式的偏股混合型基金，成立于2015年7月1日，成立至今（2019年10月24日），基金收益率41.16%。而同期上证指数由4053点下跌到2940点，跌幅27.46%，基金收益率大幅战胜上证指数68.62%。</p><p>而现在，从2019年10月25日-31日，新视野再次开放了！那么这只基金值得买吗？分析后的结论或许会让你大吃一惊。</p><a id="more"></a><h1 id="优秀的基金"><a href="#优秀的基金" class="headerlink" title="优秀的基金"></a>优秀的基金</h1><p><strong>战胜指数</strong></p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/1.png" alt="image"></p><p>上图为今年以来兴全新视野与上证指数的走势对比图，可以很明显的看出：</p><p><strong>在上涨行情中，基金涨幅跟得上</strong></p><p><strong>在下跌行情中，基金下跌明显较慢</strong></p><p><strong>近几个月震荡行情中，显著超越上证指数</strong></p><hr><p><strong>任意一次开放时买入持有至今，都是盈利的</strong></p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/2.png" alt="img"></p><p>昨天（2019年10月24日）的净值为1.4116元，是成立以来所有开放期的最高净值，这代表<strong>所有购买该基金的投资者，都是赚钱的</strong>！</p><hr><p><strong>十年老将，明星基金经理董承非</strong></p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/3.png" alt="img"></p><p>董承非管理时间较长的基金共有3只，其中兴全趋势和兴全全球视野在他任职期间的复合收益率都达到了18%。</p><p>兴全新视野因为成立的点位较高，年化收益只有8.31%，但考虑同期指数表现，还是十分牛逼。</p><hr><p><strong>非常有实力的基金公司</strong></p><p>兴全基金旗下所有基金，在业内排名均十分靠前，优秀是其一贯的传统。</p><p>众所周知，我一直是兴全基金的铁杆粉丝，多次推荐兴全基金公司<a href="http://mp.weixin.qq.com/s?__biz=MzU4Mzg0NDIyMA==&mid=2247485415&idx=1&sn=9c10a201d32acff9f14c0b5fc07921e9&chksm=fda3aff4cad426e22554c0266c540191cab58b043b2a76070ebbe6aed96dca57b048731e4e06&scene=21#wechat_redirect" target="_blank" rel="noopener">《你应该知道的一家基金公司</a>》。</p><p>并且我也是董承非的铁杆粉丝，我自己定投的主动型基金中，就有董承非管理的基金。</p><p><strong>那么，兴全新视野开放了，是不是可以买入呢？</strong></p><h1 id="公募外衣的私募产品设计"><a href="#公募外衣的私募产品设计" class="headerlink" title="公募外衣的私募产品设计"></a>公募外衣的私募产品设计</h1><p>下面我来分析一下兴全新视野这个基金。新视野是公募基金，但是从产品设计结构上讲，更像是私募。主要体现在3个地方：</p><ol><li><p>封闭期</p></li><li><p>股票仓位占比</p></li><li><p>业绩报酬</p></li></ol><h2 id="封闭期"><a href="#封闭期" class="headerlink" title="封闭期"></a>封闭期</h2><p>兴全趋势是普通的开放式基金，随时可以进行申购赎回。而兴全新视野是定期开放型，每3个月才开放一次。</p><p>从好的方面看，有的人心态不好，容易受短期行情的影响而随意赎回基金，有封闭期可以限制短期冲动产生的赎回欲望。更容易坚持长期持有，才能真的赚到钱。</p><p>从坏的方面说，基金有封闭期，定期开放申购赎回，对投资者的便利性会有一定影响。</p><p>我认为<strong>3个月封闭期应该是中性的，有好有坏</strong></p><h2 id="股票仓位"><a href="#股票仓位" class="headerlink" title="股票仓位"></a>股票仓位</h2><p>传统的偏股混合型基金，都有股票的最低仓位限制，比如兴全趋势最低股票持仓比例为30%。这代表即使是牛市最高点，也必须<strong>最少持有30%</strong>的股票持仓。</p><p>而兴全新视野的股票仓位为<strong>0-95%</strong>。如果基金经理认为市场行情不好，完全<strong>可以将基金仓位降低到0%</strong>，股市再怎么跌也没关系。因为兴全新视野成立于2015年7月1日，处于市场高位。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/4.png" alt="img"></p><p>在基金成立初期，兴全新视野因为<strong>0仓位优势</strong>，基本上<strong>完全不受市场下跌</strong>的影响。净值走势十分稳健。</p><p>但是随着产品的运行，且目前处于估值低位，0仓位的意义较小</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/5.png" alt="img"></p><p>上图为兴全趋势与兴全新视野的仓位对比，可以看出，<strong>两只基金的仓位目前基本贴合到一起</strong>。</p><p>从业绩表现上看：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/6.png" alt="img"></p><p>上图为2017年至今，兴全趋势与兴全新视野业绩对比。看图可以发现2017年以来，兴全趋势与新视野<strong>走势高度重合</strong>。并且兴全趋势还略高于兴全新视野</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/fund-manager/7.png" alt="img"></p><p>上图是兴全新视野与兴全趋势在2019年的业绩表现对比。延续了以前的趋势，两个基金的业绩走势图，<strong>基本完全重合</strong>。</p><p><strong>从基金仓位和业绩表现上：兴全趋势与兴全新视野</strong>的仓位基本接近一致，且两只基金的业绩差别并不大。</p><h2 id="业绩报酬"><a href="#业绩报酬" class="headerlink" title="业绩报酬"></a>业绩报酬</h2><p>兴全新视野最大的特点是也像私募一样会计提业绩报酬。</p><p>业绩报酬计提规则也很简单：<strong>单个封闭期收益超过1.5%且净值要创新高</strong>（高于过往开放时的最高累计净值），收益超过1.5%的部分，基金公司分成20%。</p><p><strong>计提过程举个例子：</strong></p><p>如果某人于2019年7月25日买入10000份兴全新视野，净值1.304元，总资产13040元。</p><p>1.5%的收益为195.6元</p><p>假设本次开放时净值为1.343元，<strong>10000份</strong>，总资产为13430元。</p><p>盈利为390元，超出部分为194.4元。需要计提业绩报酬 = 194.4 * 0.2 = 38.88元。</p><p>基金公司将对该投资收取38.88元的业绩分成，<strong>收取的方式为扣减份额</strong>。</p><p>38.88元相当于28.95份。</p><p>在计提完业绩报酬后，实际持有的<strong>份额为9971.05份</strong>，净值1.343元，总资产13391.12元。</p><p>虽然从基金收益上看，兴全趋势和兴全新视野的业绩表现差不多，但考虑业绩报酬后，<strong>兴全新视野的实际收益大幅下降</strong>。</p><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><ol><li><p>毫无疑问，董承非是长期业绩十分优秀的牛基基金经理。</p></li><li><p>其旗下管理的两只基金兴全趋势与兴全新视野业绩都很好</p></li><li><p>从业绩上看，两者近几年表现相当</p></li><li><p>兴全新视野的3个月封闭期，我认为有利有弊</p></li><li><p>从费用上说，20%的业绩报酬，将会较大影响投资者的实际收益水平。</p></li><li><p><strong>如果看好董承非，我更推荐购买兴全趋势</strong>。</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzA5MDQxODY5MQ==&amp;amp;mid=2247487742&amp;amp;idx=1&amp;amp;sn=feb16135c29e9e96889f7de394c696f6&amp;amp;source=41#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s?__biz=MzA5MDQxODY5MQ==&amp;amp;mid=2247487742&amp;amp;idx=1&amp;amp;sn=feb16135c29e9e96889f7de394c696f6&amp;amp;source=41#wechat_redirect&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;兴全新视野是一只定期开放式的偏股混合型基金，成立于2015年7月1日，成立至今（2019年10月24日），基金收益率41.16%。而同期上证指数由4053点下跌到2940点，跌幅27.46%，基金收益率大幅战胜上证指数68.62%。&lt;/p&gt;
&lt;p&gt;而现在，从2019年10月25日-31日，新视野再次开放了！那么这只基金值得买吗？分析后的结论或许会让你大吃一惊。&lt;/p&gt;
    
    </summary>
    
      <category term="基金经理" scheme="https://gongzhao1.coding.me/categories/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    
    
      <category term="基金" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91/"/>
    
      <category term="基金经理" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>基金之优秀的基金经理</title>
    <link href="https://gongzhao1.coding.me/%E5%9F%BA%E9%87%91%E4%B9%8B%E4%BC%98%E7%A7%80%E7%9A%84%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    <id>https://gongzhao1.coding.me/基金之优秀的基金经理/</id>
    <published>2020-03-01T04:12:29.000Z</published>
    <updated>2020-04-08T14:20:25.876Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="转载（二鸟说）"><a href="#转载（二鸟说）" class="headerlink" title="转载（二鸟说）"></a>转载（二鸟说）</h1><ul><li><a href="https://mp.weixin.qq.com/s/Fz6phgA53lrWeC4Cb7T9uw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Fz6phgA53lrWeC4Cb7T9uw</a></li><li><a href="https://mp.weixin.qq.com/s/npdQZWezBIvYoFdSM7KcGg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/npdQZWezBIvYoFdSM7KcGg</a></li></ul><h2 id="公募基金主动管理TOP50"><a href="#公募基金主动管理TOP50" class="headerlink" title="公募基金主动管理TOP50"></a>公募基金主动管理TOP50</h2><blockquote><p>需要说明一下，指数基金仅有体现主动管理能力的指数增强基金入选，被动管理的指数基金不在此之列。债券基金也是只有体现大类资产配置和权益管理能力的二级债基、绝对收益基金入选，纯债基金不在研究范围。</p></blockquote><p>权益类公募赚钱不少，但投资者体验较差，这已经是讨论了多年的话题。除了投资者追涨杀跌、高买低卖之外，基金的实际表现与投资者预期的差距也是不容忽视的原因。</p><p>很多投资者认为：主动型基金你既然提计了1.5%的管理费，那你就应该给我把活全干了。首先你要给我做大类资产配置，还要给我择股选券，然后还要给我择时。再说白一点，既要涨的快、赚钱多，又要波动低、回撤小。这就是很多基民的要求。</p><p>要求无可厚非，但现实与理想还是有较大差距的。基金经理是人不是神。大类资产配置、择股选券、择时这三大能力很少有人能通吃的。能做好一项，就是成功的基金经理了，能做好两项绝对是TOP级。基金经理都有自己的能力圈。你要求他的能力圈无限扩大，这是违背客观规律的。</p><p>对基金经理来说，承认自己的能力圈、恪守自己的能力圈，这也是对基民负责。投资者应该是要较为深刻的了解基金经理的投资体系和能力圈，进而选择适合自己的产品。</p><p>成功的基金经理，都有自己的风格，基本都能贴个标签。这个基金是什么特点、怎么使用，基民一目了然。标签实际上就是把晦涩难懂的投资术语通俗化的过程。</p><p>下面我把《<a href="http://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&mid=2247485713&idx=1&sn=47fd68182d73b98126ead3c492b9e338&chksm=eba7108fdcd0999913691a6a2cb155e66af88da7a155d855c103151f808cf7fd3cfe8f75a6e3&scene=21#wechat_redirect" target="_blank" rel="noopener">公募基金主动管理TOP50人名单，价值连城，拿走不谢</a>》里面列的主要基金经理，都贴一个标签，供大家参考。（名单有所调整和补充）</p><a id="more"></a><h2 id="易方达"><a href="#易方达" class="headerlink" title="易方达"></a>易方达</h2><ul><li><p>张坤（易方达中小盘110011）</p><p>价值投资、高ROE、白酒、长期持有、长线绩优</p></li><li><p>萧楠（易方达消费行业110022）</p><p>消费、白酒、择股、长期持有、长线绩优</p></li><li><p>张清华（易方达安心回报110027）</p><p>长期绩优债基、激进二级债基、转债、大类资产配置</p></li><li><p>胡剑（易方达稳健收益110008）</p><p>长期绩优债基、稳健二级债基、大类资产配置、控制回撤</p></li><li><p>陈皓</p></li></ul><h2 id="博时"><a href="#博时" class="headerlink" title="博时"></a>博时</h2><ul><li><p>王俊（博时主题行业160505）</p><p>十年十倍、价值投资、合理估值、控制回撤、稳健</p></li><li><p>过钧（博时信用债券050011）</p><p>长期绩优债基、激进二级债基、转债、大类资产配置</p></li></ul><h2 id="华夏"><a href="#华夏" class="headerlink" title="华夏"></a>华夏</h2><ul><li><p>蔡向阳（华夏回报002001）</p><p>十年十倍、到点分红、价值投资、稳健</p></li></ul><h2 id="广发"><a href="#广发" class="headerlink" title="广发"></a>广发</h2><ul><li><p>傅友兴（广发稳健增长270002）</p><p>股债均衡、大类资产配置、价值投资、控制回撤、长线绩优</p></li><li><p>谭昌杰（广发趋势优选000215）</p><p>绝对收益、大类资产配置、控制回撤、稳健</p></li></ul><h2 id="南方"><a href="#南方" class="headerlink" title="南方"></a>南方</h2><ul><li><p>史博（南方绩优成长202003）</p><p>二十年老将、副总、价值投资、稳健</p></li><li><p>骆帅（南方优选成长202023）</p><p>潜力新秀、价值投资、高ROE、稳健</p></li></ul><h2 id="工银瑞信"><a href="#工银瑞信" class="headerlink" title="工银瑞信"></a>工银瑞信</h2><ul><li><p>鄢耀/王君正（工银金融地产000251）</p><p>金融地产、稳健、长线绩优</p></li><li><p>袁芳（工银文体产业001714）</p><p>潜力新秀、择股、稳健、灵活</p></li><li><p>欧阳凯（工银双利485111）</p><p>长期绩优债基、稳健二级债基、大类资产配置、控制回撤</p></li></ul><h2 id="富国"><a href="#富国" class="headerlink" title="富国"></a>富国</h2><ul><li><p>朱少醒（富国天惠161006）</p><p>二十年老将、副总、十年十倍、成长股投资</p></li><li><p>李笑薇（富国沪深300增强100038）</p><p>副总、海龟、量化、指数增强</p></li><li><p>张峰（富国中国中小盘100061）</p><p>长期绩优QDII、港股及海外、择股</p></li></ul><h2 id="兴全"><a href="#兴全" class="headerlink" title="兴全"></a>兴全</h2><ul><li><p>董承非（兴全趋势163402）</p><p>二十年老将、副总、十年十倍、稳健、择股</p></li><li><p>谢治宇（兴全合润163406）</p><p>300亿操盘手、均衡配置、择股、稳健、长线绩优</p></li><li><p>乔迁（兴全商业模式163415）</p><p>潜力新秀、择股、稳健、灵活</p></li><li><p>申庆（兴全沪深300指数163407）</p><p>二十年老将、量化、指数增强</p></li></ul><h2 id="景顺长城"><a href="#景顺长城" class="headerlink" title="景顺长城"></a>景顺长城</h2><ul><li><p>刘彦春（景顺长城新兴成长260108）</p><p>十年十倍、价值投资、高ROE、择股、白酒、长期持有</p></li><li><p>黎海威（景顺长城量化新动力001974）</p><p>副总、海龟、量化、指数增强</p></li><li><p>余广（景顺长城核心竞争力260116）</p><p>价值投资、高ROE、择股、长期持有</p></li><li><p>鲍无可（景顺长城能源基建260112）</p><p>稳健、高股息、低估值、控制回撤</p></li></ul><h2 id="中欧"><a href="#中欧" class="headerlink" title="中欧"></a>中欧</h2><ul><li><p>曹名长（中欧潜力价值001810）</p><p>价值投资、高股息、低估值</p></li><li><p>周应波（中欧时代先锋001938）</p><p>成长股投资、择股、灵活、长线绩优</p></li><li><p>周蔚文（中欧新蓝筹166022）</p><p>二十年老将、副总、成长股投资、择股</p></li><li><p>葛兰（中欧医疗健康003095）</p><p>医药、潜力新秀、医药科班、择股</p></li></ul><h2 id="汇添富"><a href="#汇添富" class="headerlink" title="汇添富"></a>汇添富</h2><ul><li><p>劳杰男（汇添富价值精选519069）</p><p>价值投资、长期持有、择股、高ROE、稳健、长线绩优</p></li><li><p>雷鸣（汇添富蓝筹稳健519066）</p><p>价值投资、长期持有、择股、高ROE、稳健、灵活、长线绩优</p></li><li><p>王栩（汇添富优势精选519008）</p><p>十年十倍、成长股投资、择股</p></li><li><p>赵鹏飞（汇添富高端制造001725）</p><p>暂无</p></li><li><p>郑磊（汇添富创新医药混合006113）</p><p>医药、择股、医药科班、控制回撤</p></li></ul><h2 id="长安"><a href="#长安" class="headerlink" title="长安"></a>长安</h2><ul><li><p>林忠晶（长安鑫利001281）</p><p>林忠晶：价值投资、高ROE、择股、择时</p></li><li><p>杜振业（长安鑫益002146）</p><p>杜振业：绝对收益、潜力新秀、控制回撤</p></li></ul><h2 id="华安"><a href="#华安" class="headerlink" title="华安"></a>华安</h2><ul><li><p>杨明（华安策略优选040008）</p><p>杨明：价值投资、择股、大金融、长线绩优</p></li><li><p>苏圻涵(华安沪港深通精选001581）</p><p>苏圻涵：长线绩优QDII、港股及海外、择股</p></li><li><p>胡宜斌</p><p>胡宜斌：成长股投资、潜力新秀、择股、科技、5G</p></li></ul><h2 id="交银"><a href="#交银" class="headerlink" title="交银"></a>交银</h2><ul><li><p>王崇（交银新成长518736）</p><p>王崇：均衡配置、择股、稳健、长线绩优</p></li><li><p>何帅（交银优势行业519697）</p><p>何帅：成长股投资、择股、控制回撤、长线绩优</p></li><li><p>杨浩（交银新生活力519772）</p><p>杨浩：成长股投资、择股、TMT</p></li></ul><h2 id="嘉实"><a href="#嘉实" class="headerlink" title="嘉实"></a>嘉实</h2><ul><li><p>归凯（嘉实泰和000595）</p><p>归凯：十年十倍、GRAP、稳健、择股</p></li><li><p>谭丽（嘉实价值优势070019）</p><p>谭丽：价值投资、高股息、低估值、稳健</p></li><li><p>张金涛（嘉实沪港深精选001878）</p><p>暂无</p></li><li><p>洪流</p><p>洪流：二十年老将、GRAP（合理估值下的成长）、稳健、择股</p></li></ul><h2 id="华泰柏瑞"><a href="#华泰柏瑞" class="headerlink" title="华泰柏瑞"></a>华泰柏瑞</h2><ul><li><p>田汉卿（华泰柏瑞量化增强000172）</p><p>田汉卿：副总、海龟、量化、指数增强</p></li></ul><h2 id="东方红"><a href="#东方红" class="headerlink" title="东方红"></a>东方红</h2><ul><li><p>林鹏（东方红沪港深002803）</p><p>林鹏：二十年老将、副总、价值投资、择股、高ROE、长期持有、长线绩优</p></li></ul><h2 id="睿远"><a href="#睿远" class="headerlink" title="睿远"></a>睿远</h2><ul><li><p>傅鹏博（睿远成长价值007119）</p><p>傅鹏博：二十年老将、副总、十年十倍、成长股投资、择股、长线绩优</p></li></ul><h2 id="中庚"><a href="#中庚" class="headerlink" title="中庚"></a>中庚</h2><ul><li><p>丘栋荣（中庚价值领航006551）</p><p>丘栋荣：价值投资、PB-ROE、长线绩优</p></li></ul><h2 id="信达澳银1人："><a href="#信达澳银1人：" class="headerlink" title="信达澳银1人："></a>信达澳银1人：</h2><ul><li><p>冯明远（信达澳银新能源001410）</p><p>冯明远：潜力新秀、成长股投资、择股、科技、5G</p></li></ul><h2 id="国富"><a href="#国富" class="headerlink" title="国富"></a>国富</h2><ul><li><p>徐成（国富沪港深成长精选001605）</p><p>徐成：港股及海外、绩优沪港深、择股</p></li></ul><h2 id="海富通"><a href="#海富通" class="headerlink" title="海富通"></a>海富通</h2><ul><li><p>杜晓海（海富通阿尔法对冲519062）</p><p>杜晓海：对冲、绝对收益、控制回撤、稳健</p></li></ul><h2 id="泓德"><a href="#泓德" class="headerlink" title="泓德"></a>泓德</h2><ul><li><p>邬传雁（泓德远见回报001500）</p><p>邬传雁：副总、成长股投资、稳健、择股、长线绩优</p></li></ul><h2 id="鹏华"><a href="#鹏华" class="headerlink" title="鹏华"></a>鹏华</h2><ul><li>王宗合：价值投资、择股、高ROE、长期持有、白酒、长线绩优</li></ul><h2 id="前海开源"><a href="#前海开源" class="headerlink" title="前海开源"></a>前海开源</h2><ul><li>邱杰：择时、择股、大波段、长线绩优</li></ul><blockquote><p>大家可以看的出来，有4人入选的基金公司共五家：易方达、兴全、中欧、汇添富、景顺长城，这些都是比较注重主动权益产品的基金公司。</p><p>另外，东方红、睿远也都比较强调主动管理能力。东方红由于风格都差不多，只列了林鹏一人。睿远目前只有一只基金。</p></blockquote><h1 id="投资风格梳理"><a href="#投资风格梳理" class="headerlink" title="投资风格梳理"></a>投资风格梳理</h1><p>按照投资风格和基金的类别，再次梳理一遍：</p><p><strong>价值</strong>：张坤、王俊、蔡向阳、史博、骆帅、董承非、谢治宇、曹名长、刘彦春、余广、劳杰男、雷鸣、赵鹏飞、林忠晶、杨明、谭丽、林鹏、丘栋荣</p><p><strong>成长</strong>：袁芳、朱少醒、乔迁、周应波、周蔚文、王栩、王崇、何帅、杨浩、归凯、傅鹏博、冯明远、邬传雁</p><p><strong>量化及指数增强</strong>：李笑薇、黎海威、申庆、田汉卿</p><p><strong>股债平衡</strong>：傅友兴、鲍无可</p><p><strong>港股及海外</strong>：张峰、徐成、张金涛、苏圻涵</p><p><strong>行业主题</strong>：萧楠（消费）、葛兰（医药）、鄢耀/王君正（金融地产）</p><p><strong>激进二级债券</strong>：张清华、过钧</p><p><strong>稳健二级债券</strong>：胡剑、欧阳凯</p><p><strong>绝对收益</strong>：谭昌杰、杜振业</p><p><strong>对冲</strong>：杜晓海</p><blockquote><p>二鸟老师做组合的基金，基本来源于这50人名单。像价值五剑，有几个攻守均衡、风格稳重的老将坐镇，构成基本盘。在今年一季度行情好时，使用了像信达澳银新能源这样极富攻击性的基金去冲锋；去年行情不好时，使用了广发优企精选、富国沪港深行业精选这样比较注重控制回撤的基金去防守。在牛市走到中后期，市场喧嚣、牛熊难辨时，则可能会使用激进二级债基，让张清华、过钧这些擅长宏观研究的牛人来判断。</p><p>绝对收益目标组合，主要是使用的做绝对收益的谭昌杰、杜振业、做对冲的杜晓海以及稳健二级债基胡剑的基金。净值曲线稳步向上，接近于一条15度斜率的直线，不断创新高。</p></blockquote><p>在实战角度的话，我不怕你业绩不好，就怕你没风格。你一会价值，一会成长，来回变来变去的话，这样的基金我是没法使用的。在选基金的时候，像这样的标签如果找不出三个以上的话，就不能入选。</p><p>有特点和风格的基金，即使是业绩暂时落后，我也能理解。比如老曹的中欧恒利，今年被骂的很厉害。但我是不会去骂的。老曹的择股风格是低估值、高股息，比较注重安全性。这两年市场呈“强者恒强”特征，低估值高股息策略在今年是暂时失效的。你不要因为这两年业绩不佳而质疑他的能力，只能说他的风格暂时不适合当前行情。但后面会怎样，这个说不好。风格都是轮动的，没有永远涨的股，也没有永远跌的票。他坚持自己的投资体系，这没问题。相反，如果他把那些低估值的票割肉，去追茅台之类的话，这就是瞎搞了。</p><p>再比如像冯明远的信达澳银新能源，这是一个具有鲜明科技风格的成长型基金，但波动也较大，价值五剑曾使用过一段时间。虽然现在没使用了，但我从来没否定过这只基金。这个基金长期持有没问题，这个我知道。我自己个人账户的话，肯定是不会卖的。价值五剑是公众跟投账户，完全是两码事。把这个基金替换下来，主要是出于控制组合波动考虑的，后面也不排除会阶段性再使用。类似的基金还有胡宜斌的华安媒体互联网。</p><p>对于投资者来说，鲜明的标签也便于基民识别和使用。你认可价值投资长期持有，就去找东方红、睿远、兴全；相信GRAP，就去找嘉实洪流、归凯他们；低估值高股息策略是老曹、谭丽；看好科技板块，能承受一定的波动，就使用冯明远、胡宜斌的基金；要求绝对收益，去找谭昌杰、杜振业；要做择时，还只有前海开源王宏远他们有这个能力；医药的话，得找葛兰、郑磊这些医药科班出身的基金经理；搞消费、白酒，去找萧楠、王宗合。</p><p>主动型基金的风格飘移，这是投资者最头疼的问题。建议每一位基金经理都要承认自己的能力圈、恪守自己的能力圈，进而拓展自己的能力圈。主动基金的基金经理，最好每个人都要有个标签。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;转载（二鸟说）&quot;&gt;&lt;a href=&quot;#转载（二鸟说）&quot; class=&quot;headerlink&quot; title=&quot;转载（二鸟说）&quot;&gt;&lt;/a&gt;转载（二鸟说）&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/Fz6phgA53lrWeC4Cb7T9uw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/Fz6phgA53lrWeC4Cb7T9uw&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/npdQZWezBIvYoFdSM7KcGg&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/npdQZWezBIvYoFdSM7KcGg&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;公募基金主动管理TOP50&quot;&gt;&lt;a href=&quot;#公募基金主动管理TOP50&quot; class=&quot;headerlink&quot; title=&quot;公募基金主动管理TOP50&quot;&gt;&lt;/a&gt;公募基金主动管理TOP50&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;需要说明一下，指数基金仅有体现主动管理能力的指数增强基金入选，被动管理的指数基金不在此之列。债券基金也是只有体现大类资产配置和权益管理能力的二级债基、绝对收益基金入选，纯债基金不在研究范围。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;权益类公募赚钱不少，但投资者体验较差，这已经是讨论了多年的话题。除了投资者追涨杀跌、高买低卖之外，基金的实际表现与投资者预期的差距也是不容忽视的原因。&lt;/p&gt;
&lt;p&gt;很多投资者认为：主动型基金你既然提计了1.5%的管理费，那你就应该给我把活全干了。首先你要给我做大类资产配置，还要给我择股选券，然后还要给我择时。再说白一点，既要涨的快、赚钱多，又要波动低、回撤小。这就是很多基民的要求。&lt;/p&gt;
&lt;p&gt;要求无可厚非，但现实与理想还是有较大差距的。基金经理是人不是神。大类资产配置、择股选券、择时这三大能力很少有人能通吃的。能做好一项，就是成功的基金经理了，能做好两项绝对是TOP级。基金经理都有自己的能力圈。你要求他的能力圈无限扩大，这是违背客观规律的。&lt;/p&gt;
&lt;p&gt;对基金经理来说，承认自己的能力圈、恪守自己的能力圈，这也是对基民负责。投资者应该是要较为深刻的了解基金经理的投资体系和能力圈，进而选择适合自己的产品。&lt;/p&gt;
&lt;p&gt;成功的基金经理，都有自己的风格，基本都能贴个标签。这个基金是什么特点、怎么使用，基民一目了然。标签实际上就是把晦涩难懂的投资术语通俗化的过程。&lt;/p&gt;
&lt;p&gt;下面我把《&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485713&amp;idx=1&amp;sn=47fd68182d73b98126ead3c492b9e338&amp;chksm=eba7108fdcd0999913691a6a2cb155e66af88da7a155d855c103151f808cf7fd3cfe8f75a6e3&amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;公募基金主动管理TOP50人名单，价值连城，拿走不谢&lt;/a&gt;》里面列的主要基金经理，都贴一个标签，供大家参考。（名单有所调整和补充）&lt;/p&gt;
    
    </summary>
    
      <category term="基金经理" scheme="https://gongzhao1.coding.me/categories/%E5%9F%BA%E9%87%91%E7%BB%8F%E7%90%86/"/>
    
    
      <category term="基金" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91/"/>
    
  </entry>
  
  <entry>
    <title>基金之绝对收益基金</title>
    <link href="https://gongzhao1.coding.me/%E5%9F%BA%E9%87%91%E4%B9%8B%E7%BB%9D%E5%AF%B9%E6%94%B6%E7%9B%8A%E5%9F%BA%E9%87%91/"/>
    <id>https://gongzhao1.coding.me/基金之绝对收益基金/</id>
    <published>2020-02-27T16:10:58.000Z</published>
    <updated>2020-04-08T14:20:25.877Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="转载（二鸟说）"><a href="#转载（二鸟说）" class="headerlink" title="转载（二鸟说）"></a>转载（二鸟说）</h1><ul><li><a href="https://mp.weixin.qq.com/s/GzzOK5upb4uBRvcO-OBxSA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/GzzOK5upb4uBRvcO-OBxSA</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485851&amp;idx=1&amp;sn=a9f245e0ad556add1b25b53ff830853b&amp;chksm=eba71005dcd099138b92795378bfe66d078adafc21755ee92062aa8efaf9f728a6ae070f0382&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485851&amp;idx=1&amp;sn=a9f245e0ad556add1b25b53ff830853b&amp;chksm=eba71005dcd099138b92795378bfe66d078adafc21755ee92062aa8efaf9f728a6ae070f0382&amp;scene=21#wechat_redirect</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485728&amp;idx=1&amp;sn=c997f8688cb49f7ba91ab249706a66d3&amp;chksm=eba710bedcd099a859aeb47d9166543f27672e2e9ae8d0d8d5360555d31e920f3b511d18626f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485728&amp;idx=1&amp;sn=c997f8688cb49f7ba91ab249706a66d3&amp;chksm=eba710bedcd099a859aeb47d9166543f27672e2e9ae8d0d8d5360555d31e920f3b511d18626f&amp;scene=21#wechat_redirect</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485888&amp;idx=1&amp;sn=f9e925a3ca905bcea8f5d749ca07e1ea&amp;chksm=eba7105edcd099480ae44bb824f787aa29598e988c527abf2546f8c9d815132a4562d14503f1&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;mid=2247485888&amp;idx=1&amp;sn=f9e925a3ca905bcea8f5d749ca07e1ea&amp;chksm=eba7105edcd099480ae44bb824f787aa29598e988c527abf2546f8c9d815132a4562d14503f1&amp;scene=21#wechat_redirect</a></li></ul><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>随着最后一只保本基金的转型，保本基金已经成为历史名称。但投资者对于“类保本”产品的需求并不会因此而消失，绝对收益目标基金应运而生。</p><p>所谓绝对收益目标基金，即以追求绝对收益为目标，不与某个资产价格指数进行比较，而以某个固定的收益值进行比较。由此可见，绝对收益基金在运作策略方面与追求相对收益的普通开放式基金存在明显差异。</p><p>绝对收益策略主要包括“固收+”、保本、对冲、以及多种混合策略等。保本策略对应的就是避险策略基金。这实际上是保本基金转型的产品。这类产品现在很少有基金公司愿意发行。具体原因我在《<a href="http://mp.weixin.qq.com/s?__biz=MzU0MDU0MTk0Mw==&mid=2247483974&idx=1&sn=90d9734f4de7e03f34674073d681fdee&chksm=fb36d4decc415dc8b828ad82c9f53b2141fe0ec5e4f2ddea46c6b2b39cd14253d312a2227761&scene=21#wechat_redirect" target="_blank" rel="noopener">保本基金为何纷纷“大逃亡”</a>》进行了分析。</p><p>所以，目前主要采用固收+和对冲这两种策略。“固收+”策略的本质是以中短期绝对收益率为目标、以安全资产为底仓提供基础收益，并在严格控制回撤的前提下寻求利用高弹性资产增强收益的机会。具体有固收+股票、固收+转债、固收+打新等策略。对冲策略则是利用衍生产品对投资组合进行对冲，将组合的系统性风险控制在一定的范围内，从而达到降低波动，控制回撤的效果。</p><p>无论采用哪种策略，都对基金公司和基金经理的实力提出了较高的要求。管理这类基金，不仅要同时具备固收和权益的投资能力，还需要具备大类资产配置、衍生品交易以及打新等方面的能力。因此，绝对收益目标基金并不是任何基金经理都能管得好的，由此决定了这类产品的稀缺性。</p><p>按合规要求，基金公司原则上是不能公开宣传“绝对收益”的，光从基金名称是看不出什么名堂来的。你要深入研究他的投资策略和净值表现才能确定。因此，在海量的基金中选出这类产品，就是一项极其费脑筋的工作。</p><p>为此，我们通过细致认真地研究，甄选出五个在运作中执行了绝对收益策略的产品。我们认为这几个基金还是比较靠谱的。现详细介绍如下，以供大家参考。</p><a id="more"></a><h1 id="“固收-”策略产品"><a href="#“固收-”策略产品" class="headerlink" title="“固收+”策略产品"></a><strong>“固收+”策略产品</strong></h1><ol><li><p>光大保德信安和/安诚债券（003109）</p></li><li><p>长城新优选混合（002227）</p></li><li><p>银华汇利灵活配置混合（001289）</p></li></ol><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/1.webp" alt="image"></p><p>这三只基金中，光大保德信的产品为二级债基，长城和银华的产品为混合基金，目前均开放申赎。从上图中三只产品的业绩走势：平缓的增长伴随极小的回撤，我们可以判断出它们都是按照绝对收益策略进行运作的。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/2.png" alt="image"></p><p>在收益表现方面，三只产品在存续期内走势十分平稳，累积收益随时间持续增长，并在各个期间均取得了正收益。其中长城新优选表现抢眼，在各个期间内均取得了最高的收益，三年累积收益高达25.6%，年化收益超过8%。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/3.png" alt="image"></p><p>此外，三只产品在斩获理想的收益同时，也很好的控制了净值回撤。从上图可以看出，它们在存续期内绝大多数的时候，最大回撤都控制在-0.5%以内，即便在极端市场行情中，最大回撤也都控制在了-1.5%以内。这充分体现了绝对收益目标基金在控制回撤方面的严格性，而这也正是这类产品与普通二级债基以及增强债基的区别。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/4.png" alt="image"></p><p>从资产配置方面可以看出，三只产品均为典型的“固收+”组合，底仓均由债券构成，并少量持有股票寻求收益增强。在以固收+股票为主的同时，也少量运用了转债和打新策略。其中长城新优选持有股票比重最大，组合整体的历史波动也是最高的，这在一定程度上解释了为何它在三只产品中收益最高。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/5.webp" alt="img"></p><p>从上面持有人结构数据可以看出，机构十分青睐这类产品。一方面是由机构资金的风险偏好决定的。另一方面，这类产品受“聪明资金”追捧的程度，也能从侧面反映出其稀缺程度。其中长城优选机构资金占比高达97%，银华汇利机构资金占比也超过90%，几乎可以视为“机构定制版”产品。</p><p><strong>另外三个优秀产品</strong>：</p><ol start="4"><li>广发趋势优选（000215）</li><li>长安鑫益（002146）</li><li>安信稳健增值（001316）</li></ol><p>这次为大家选出的三只样本基金是长安鑫益增强（002146，自2018年2季度定位于绝对收益）、安信稳健增值(001316)、广发趋势优选(000215)。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/6.png" alt="img"></p><p>长安鑫益增强自2018年二季度以来，安信稳健增值、广发趋势优选自成立以来，累计净值曲线都平稳向上，实现了年年正收益。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/7.png" alt="img"></p><p>再细化到季度。最近8个季度中，长安鑫益增强和安信稳健增值连续实现季度正收益，广发趋势优选仅有一个季度没有实现正收益，而同期同类平均和沪深300均有五次是负收益。这种绝对收益无疑给了投资者极佳的投资体验。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/8.webp" alt="img"></p><p>在回撤控制方面，这三只基金也做的很出色。2015年6月至2019年8月，A股经历了熊市、反弹、震荡等七个阶段的行情。</p><p>2015/12/26—2016/1/29期间，A股急速下跌，短短24个交易日，沪深300急跌23.2%，最大回撤24.2%，同期安信稳健增值最大回撤仅为0.7%，广发趋势优选最大回撤仅为1.7%。</p><p>2019/4/20—2019/8/7股市震荡下行期间，沪深300最大回撤为11.5%，但是三只基金最大回撤均得到了很好的控制，长安鑫益增强最大回撤为0.1%，安信稳健增值为1%，广发趋势优选为0.8%。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/9.png" alt="img"></p><p>从阶段收益可以看出，时间周期越长，这类基金积累的收益越多。</p><p>近1年长安鑫益增强累计收益达到了20.31%，安信稳健增值为8.89%、广发趋势优选为6.75%。近2年，安信稳健增值累计收益17.02%，广发趋势优选累计收益15.75%，同期沪深300下跌2.32%。</p><p>正如广发趋势优选基金经理谭昌杰所言：只要方向正确，慢就是快。这类基金虽然每年的收益未必很高，但回撤小，长期下来经过复利的积累，做出的累积收益依然惊人。像运作时间最长的广发趋势优选，成立不到6年，累计净值已超过1.82。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/10.png" alt="img"></p><p>上述三只基金之所以能实现绝对收益目标，主要是做好了以下三个方面：第一、做好固定收益投资，获取长期稳健收益；第二、根据股市行情变化，灵活操作股票，在严格控制回撤前提下，获取弹性收益；第三、基金经理管理思路明确，长期坚守交易纪律。</p><p>简单的说，就是股市涨时赚固定收益加股市上涨的钱；股市下跌时，只赚固定收益的钱，回避股市下跌的损失，即“债券打底，择机炒股，严控回撤，积少成多”。</p><p>长安鑫益增强自2018年2季度定位于绝对收益基金之后，坚持以债券配置为主，股票配置为辅。在债券方面根据情况在利率债和信用债之间进行灵活配置，比如2019年主要采用长久期利率债和短久期高收益信用债搭配的策略。</p><p>在股票方面，持仓范围是0-30%，操作策略是“低仓位+短线”。无论股票行情好还是不好，都保持着极低的仓位（6%以下），在趋势性、震荡、反弹行情中进行短线操作，及时止盈止损，确保不会对净值造成太大的影响。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/11.png" alt="img"></p><p>安信稳健增值在债券配置方面，主要投资高评级的国企债券和利率债、可转债，维持一定的杠杆水平，债券市值占资产净值比长期维持在100%以上。</p><p>该基金股票持仓范围是0%–95%，采用“长期持有+择时调仓”的策略。坚持价值投资，精选优质并且估值合理的蓝筹股，长期持有，持仓基本控制在0%-15%之间。一旦有发生系统性风险的可能，便会果断降低股票仓位。比如2018年四季度末股票持仓将至6%，2019年一季度末股票持仓提升至12%，持仓比例调整比较频繁。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/12.png" alt="img"></p><p>广发趋势优选主要是通过 “自上而下选择低相关性的、风险较低的多类别资产构建组合，重视风险控制，及时做好止损”来实现绝对收益的。</p><p>在债券配置方面，偏好于选择1-3年期AAA国企债作为底仓，为绝对收益的构建足够的安全垫。在股票配置方面，会在行业和个股层面进行分散，单只个股的集中度尽量不超过2%，此外，还制定了严格的止损标准，投资标的跌到一定程度，必须卖出。</p><p>该基金股票持仓范围是0%–95%，采用“自上而下+择时调仓”的策略。从历史数据来看，该基金股票市值占资产净值比波动较大，在2017年牛行情中维持在40%左右，2018年熊市中则迅速降低至20%以下。表明该基金是通过择时，在下跌市场降低股票仓位，在上涨市场增加股票仓位，获取绝对收益。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/13.png" alt="img"></p><p>上述基金实现绝对收益的原理，通俗说的话就是：债券投资为收益打底，股票投资提供弹性。当然，这只是我们从投资者的角度，通过公开信息进行的研究。基金经理所采取的策略要远比这个复杂，而且实际操作难度很大。绝对收益策略堪称基金公司和基金经理的“绝活”。</p><p>在资管行业，其实大家都很希望能给投资者提供产品，收益还不错，最重要的是投资体验极佳。但到目前为止，经历过牛熊检验，真正跑出来的屈指可数，这类产品极度稀缺。道理很简单，对绝对收益产品而言玩股票就像在走钢丝绳，稍有不慎回撤控制不住就垮下去了。而不使用权益资产，仅靠债券是难以做出满意的收益的。</p><p>二鸟老师主理的“绝对收益目标组合”也是以追求绝对收益为目标，自成立以来年化收益接近10%，最大回撤低于2%，实现了“稳稳的幸福”。</p><h1 id="对冲策略产品"><a href="#对冲策略产品" class="headerlink" title="对冲策略产品"></a><strong>对冲策略产品</strong></h1><ol><li><p>南方绝对收益（000844）</p></li><li><p>汇添富绝对收益（000762）</p></li></ol><p>这两只产品是市面上十分少见的在名称中包含“绝对收益”字样的产品，两者均采用了对冲策略。其中南方绝对收益是市场上屈指可数的几个纯粹对冲策略产品之一，汇添富绝对收益则属于“固收+”、对冲、打新等共存的多策略产品。关于这一点，我们可以从两只产品的资产配置上很清楚的看到。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/14.png" alt="img"></p><p>南方绝对收益在持有股票的同时大量持有衍生品，组合中没有债券。而汇添富绝对收益组合中债券的权重接近40%，而衍生品的权重较小。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/15.webp" alt="img"></p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/16.png" alt="img"></p><p>从业绩表现上看，两只产品累积收益增长平稳，且在所有区间上都获得了正收益，策略应用十分成功。其中汇添富的收益表现相对更好一些，今年对冲策略运用较少，持有的债券和股票贡献了较多的收益。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/17.webp" alt="img"></p><p>在控制回撤方面，这两只产品相对于之前介绍过的三只纯“固收+”产品而言相对较大，在多数时间里最大回撤控制在1%以内，极端市场中控制在2%左右。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/fund/bird/18.png" alt="img"></p><p>这两只基金均为定期开放产品。最近一期开放日期：南方绝对收收益是2019年12月12日至19日，汇添富绝对收益是2019年11月8日至22日，过期不候。</p><p>另外还有一个海富通阿尔法对冲（519062），这是目前市场上为数不多的日常开放的对冲产品。运作时间最长，业绩非常优秀。这个基金我之前曾多次介绍过，这里不详细说了。</p><p>至于两类策略孰优孰劣，不能简单对比收益，应该进行综合评判。就反映收益/风险比的夏普比率而言，我们发现纯“固收+”的产品表现更好，而纯对冲策略的南方绝对收益较弱。介于两者之间的汇添富绝对收益，由于采取了混合策略，表现居中。当然，由于研究的样本较小，对两种策略的优劣尚不宜得出结论。</p><p>考虑到目前我国资本市场可以用于对冲的衍生品工具还不完备，且衍生品交易存在诸多限制，因此对冲组合有可能存在较大的基差，进而影响对冲的效果。因此，我们认为“固收+”具有更强的可操作性，从而成为绝对收益目标基金的主流策略。</p><h1 id="绝对收益目标组合"><a href="#绝对收益目标组合" class="headerlink" title="绝对收益目标组合"></a>绝对收益目标组合</h1><h2 id="初心"><a href="#初心" class="headerlink" title="初心"></a>初心</h2><p>如何才能帮投资者赚到钱？这也是我写公号、开组合的初心。实践已证明，最简单可行的方法就是让跟投人长期持有。</p><p>第一个是相对收益思路：优选基金、动态管理。通过对主流指数（如沪深300）的大幅超越，树立跟投人信心。同时做好投资者陪伴服务，一起渡过市场低迷的时段。通过长期持有优质基金，静待时间玫瑰的绽放。这就是价值五剑。</p><p>第二个是绝对收益思路。如果能把净值曲线做成一条接近斜率15度的直线，回撤小，稳步上行的话，跟投人就能具备极佳的投资体验。这样甚至投资者陪伴服务都可以不需要了。因为跟投人不论何时买入都能盈利。</p><p>这种思路其实已经跑出样板了：我要稳稳的幸福。我最初的想法是：对标“我要稳稳的幸福”，适当放大一些波动，力争做出更高一点的收益。在2018年10月31日，股市一片哀嚎声中，我在且慢上开仓建了这个组合。相比于交银，我们最大的优势就是能全市场择基（我要稳稳的幸福是交银的内部FOF），择天下英才而用之。</p><h2 id="求索"><a href="#求索" class="headerlink" title="求索"></a>求索</h2><p>做绝对收益最核心的是严控回撤，一般是采用CPPI或风险平价策略。我要稳稳的幸福就是采用风险平价策略。我本人并非金融工程科班出身，对量化、建模这一块并没有优势，我的优势在于优选基金。经过再三考虑，我采用的是优选绝对收益目标基金+大类资产配置的策略。选出优秀的绝对收益目标基金，通过基金经理的管理作为第一层保障。同时主理人进行大类资产配置和基金池的动态管理，严控组合净值的回撤，作为第二层保障。</p><p>在优选基金时，注意投资方法的分散化和多样化。最初是按配置策略、短债策略、对冲策略、综合策略去选基金。随着收益安全垫的积累，将短债策略更换为更为积极的长债策略，同时加入了小仓位的股债平衡型基金以增加组合收益的弹性。随着科创板开市，打新的制度红利较为明显，后续也加入了打新策略。</p><p>按照“固收+”的观点，“固收+股票”、“固收+转债”、“固收+打新”的思想皆有体现。同时还使用了对冲基金（市场中性策略）。绝对收益目标组合实现了投资方法和收益来源的多样化。</p><p>最初还尝试使用小仓位的基金进行波段操作以进一步增厚收益，但在实践中发现异常困难。研判的工作量、难度与仓位的大小并没有关系。哪怕是极小仓位，也不能有任何闪失。所以后面彻底放弃。</p><h2 id="韧性"><a href="#韧性" class="headerlink" title="韧性"></a>韧性</h2><p>绝对收益目标组合目前使用了6只成分基金，这一年股、债两市都有较大的波动，但这些基金都表现出了极强的韧性。反映在组合上面，就是净值异常坚挺。</p><p>易方达稳健收益（110008）：由易方达固收总经理胡剑老师亲自执掌，近8年时间除2011年年微亏外，其余年份全部取得正收益。这虽然是一只普通二级债基，并非采用绝对收益策略，但我仍给予高度信任。建仓初期由于股市点位较低，直接赋予了30%的仓位。现在虽有所降低，仍有25%的仓位。</p><p>广发趋势优选（000215）：这是一个默默的数钱、不声张的基金。名字里没有“绝对收益”这四个字，实际上是采用绝对收益策略。2015年2月谭昌杰接手之后，净值曲线基本就是一条斜率为15度的直线。</p><p>长安鑫益增强（002146）：这个更牛，几乎没有回撤，天天飘红不说，收益更是高的令人发指。他到底用了何种策略？神一般的存在。但他天天飘红不假，已经两年了。</p><p>海富通阿尔法对冲（519062）：运行时间最长，收益最好的且每日开放的对冲基金，极其稀缺。这个基金在成分基金里面收益虽不是最高，但对组合极其重要。他不仅自身能实现正收益，而且独立于股、债两市，经常是与股市反向波动，较好的平抑了组合的波动率。</p><p>光大保德信诚鑫（003116）：固收+打新的基金，底仓以银行股为主，相对安全。这只基金调入较晚，错过了科创板开市那几天的涨幅。不然组合的净值还能提升0.5个点。</p><p>广发稳健增长（270002）、泓德致远（004965）：两个优秀的股债平衡型基金，具备净值不断创新高的能力，具备极高的风险收益比。组合小仓位使用，用于增厚收益。</p><h2 id="远方"><a href="#远方" class="headerlink" title="远方"></a>远方</h2><p>随着组合的影响力不断增大，也有人提出了一些质疑。比较典型的就是：组合的混合型基金占比较大，股票仓位较高，对未来能否保持高收益低回撤表示怀疑。在此我做一下解释。</p><p>先说股票仓位和回撤的问题。组合的股票总仓位我们控制在20%以内，对标二级债基，而且还使用了对冲的手段。这些基金表面上是混合基金，实际上都是以绝对收益为目标的基金，基金经理本身就在控制回撤。说股票仓位高的人，明显是对这几个基金的风格不太了解。只要这些基金不改变现有投资策略，组合的波动和回撤的控制是没有问题的。况且我还天天盯着，在进行二次把关。</p><p>再说一下收益的问题。组合成立以来，正好赶上了股债双牛的好时光，因而取得了将近10%的收益。随着时间的拉长，年化收益率可能会缓慢的降下来。这个组合的首要目标是控制回撤，收益并不是摆在首位的。在产品说明书里也写的很清楚：“力争实现5%的年化收益率”，我们也从未宣传和强调组合的高收益率。</p><p>未来随着时间的推移，组合的年化收益率如果降到5%-7%的区间，这都是很正常的事。如果未来仍维持着这个高收益，那是你们自己的福气。我找对了人，你们也找对了人。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;转载（二鸟说）&quot;&gt;&lt;a href=&quot;#转载（二鸟说）&quot; class=&quot;headerlink&quot; title=&quot;转载（二鸟说）&quot;&gt;&lt;/a&gt;转载（二鸟说）&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/GzzOK5upb4uBRvcO-OBxSA&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/GzzOK5upb4uBRvcO-OBxSA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485851&amp;amp;idx=1&amp;amp;sn=a9f245e0ad556add1b25b53ff830853b&amp;amp;chksm=eba71005dcd099138b92795378bfe66d078adafc21755ee92062aa8efaf9f728a6ae070f0382&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485851&amp;amp;idx=1&amp;amp;sn=a9f245e0ad556add1b25b53ff830853b&amp;amp;chksm=eba71005dcd099138b92795378bfe66d078adafc21755ee92062aa8efaf9f728a6ae070f0382&amp;amp;scene=21#wechat_redirect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485728&amp;amp;idx=1&amp;amp;sn=c997f8688cb49f7ba91ab249706a66d3&amp;amp;chksm=eba710bedcd099a859aeb47d9166543f27672e2e9ae8d0d8d5360555d31e920f3b511d18626f&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485728&amp;amp;idx=1&amp;amp;sn=c997f8688cb49f7ba91ab249706a66d3&amp;amp;chksm=eba710bedcd099a859aeb47d9166543f27672e2e9ae8d0d8d5360555d31e920f3b511d18626f&amp;amp;scene=21#wechat_redirect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485888&amp;amp;idx=1&amp;amp;sn=f9e925a3ca905bcea8f5d749ca07e1ea&amp;amp;chksm=eba7105edcd099480ae44bb824f787aa29598e988c527abf2546f8c9d815132a4562d14503f1&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s?__biz=MzI4MTYyODkxMw==&amp;amp;mid=2247485888&amp;amp;idx=1&amp;amp;sn=f9e925a3ca905bcea8f5d749ca07e1ea&amp;amp;chksm=eba7105edcd099480ae44bb824f787aa29598e988c527abf2546f8c9d815132a4562d14503f1&amp;amp;scene=21#wechat_redirect&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;随着最后一只保本基金的转型，保本基金已经成为历史名称。但投资者对于“类保本”产品的需求并不会因此而消失，绝对收益目标基金应运而生。&lt;/p&gt;
&lt;p&gt;所谓绝对收益目标基金，即以追求绝对收益为目标，不与某个资产价格指数进行比较，而以某个固定的收益值进行比较。由此可见，绝对收益基金在运作策略方面与追求相对收益的普通开放式基金存在明显差异。&lt;/p&gt;
&lt;p&gt;绝对收益策略主要包括“固收+”、保本、对冲、以及多种混合策略等。保本策略对应的就是避险策略基金。这实际上是保本基金转型的产品。这类产品现在很少有基金公司愿意发行。具体原因我在《&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU0MDU0MTk0Mw==&amp;mid=2247483974&amp;idx=1&amp;sn=90d9734f4de7e03f34674073d681fdee&amp;chksm=fb36d4decc415dc8b828ad82c9f53b2141fe0ec5e4f2ddea46c6b2b39cd14253d312a2227761&amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;保本基金为何纷纷“大逃亡”&lt;/a&gt;》进行了分析。&lt;/p&gt;
&lt;p&gt;所以，目前主要采用固收+和对冲这两种策略。“固收+”策略的本质是以中短期绝对收益率为目标、以安全资产为底仓提供基础收益，并在严格控制回撤的前提下寻求利用高弹性资产增强收益的机会。具体有固收+股票、固收+转债、固收+打新等策略。对冲策略则是利用衍生产品对投资组合进行对冲，将组合的系统性风险控制在一定的范围内，从而达到降低波动，控制回撤的效果。&lt;/p&gt;
&lt;p&gt;无论采用哪种策略，都对基金公司和基金经理的实力提出了较高的要求。管理这类基金，不仅要同时具备固收和权益的投资能力，还需要具备大类资产配置、衍生品交易以及打新等方面的能力。因此，绝对收益目标基金并不是任何基金经理都能管得好的，由此决定了这类产品的稀缺性。&lt;/p&gt;
&lt;p&gt;按合规要求，基金公司原则上是不能公开宣传“绝对收益”的，光从基金名称是看不出什么名堂来的。你要深入研究他的投资策略和净值表现才能确定。因此，在海量的基金中选出这类产品，就是一项极其费脑筋的工作。&lt;/p&gt;
&lt;p&gt;为此，我们通过细致认真地研究，甄选出五个在运作中执行了绝对收益策略的产品。我们认为这几个基金还是比较靠谱的。现详细介绍如下，以供大家参考。&lt;/p&gt;
    
    </summary>
    
      <category term="基金" scheme="https://gongzhao1.coding.me/categories/%E5%9F%BA%E9%87%91/"/>
    
    
      <category term="基金" scheme="https://gongzhao1.coding.me/tags/%E5%9F%BA%E9%87%91/"/>
    
  </entry>
  
</feed>
