<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GZ</title>
  
  <subtitle>对痛苦的思考才是财富</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://gongzhao1.gitee.io/"/>
  <updated>2021-04-21T12:53:23.688Z</updated>
  <id>https://gongzhao1.gitee.io/</id>
  
  <author>
    <name>弓昭</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>test</title>
    <link href="https://gongzhao1.gitee.io/test/"/>
    <id>https://gongzhao1.gitee.io/test/</id>
    <published>2021-04-21T12:48:24.000Z</published>
    <updated>2021-04-21T12:53:23.688Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Test&quot;&gt;&lt;a href=&quot;#Test&quot; class=&quot;headerlink&quot; title=&quot;Test&quot;&gt;&lt;/a&gt;Test&lt;/h1&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>使用cert-manager签发免费证书</title>
    <link href="https://gongzhao1.gitee.io/%E4%BD%BF%E7%94%A8cert-manager%E7%AD%BE%E5%8F%91%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6/"/>
    <id>https://gongzhao1.gitee.io/使用cert-manager签发免费证书/</id>
    <published>2021-02-07T07:17:58.000Z</published>
    <updated>2021-04-21T12:39:05.303Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://cloud.tencent.com/document/product/457/49368#dns-01-.E6.A0.A1.E9.AA.8C.E6.96.B9.E5.BC.8F.E7.AD.BE.E5.8F.91.E8.AF.81.E4.B9.A6" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/457/49368#dns-01-.E6.A0.A1.E9.AA.8C.E6.96.B9.E5.BC.8F.E7.AD.BE.E5.8F.91.E8.AF.81.E4.B9.A6</a></li><li><a href="https://cert-manager.io/docs/" target="_blank" rel="noopener">https://cert-manager.io/docs/</a></li><li><a href="https://artifacthub.io/packages/helm/jetstack/cert-manager/1.1.0" target="_blank" rel="noopener">https://artifacthub.io/packages/helm/jetstack/cert-manager/1.1.0</a></li><li><a href="https://xuchao918.github.io/2019/03/14/%E4%BD%BF%E7%94%A8cert-manager%E5%AE%9E%E7%8E%B0Ingress-https/" target="_blank" rel="noopener">https://xuchao918.github.io/2019/03/14/%E4%BD%BF%E7%94%A8cert-manager%E5%AE%9E%E7%8E%B0Ingress-https/</a></li><li><a href="https://github.com/topics/cert-manager-webhook" target="_blank" rel="noopener">https://github.com/topics/cert-manager-webhook</a></li></ul><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>随着 HTTPS 不断普及，大多数网站开始由 HTTP 升级到 HTTPS。使用 HTTPS 需要向权威机构申请证书，并且需要付出一定的成本，如果需求数量多，则开支也相对增加。cert-manager 是 Kubernetes 上的全能证书管理工具，支持利用 cert-manager 基于 ACME 协议与 Let’s Encrypt 签发免费证书并为证书自动续期，实现永久免费使用证书。</p><a id="more"></a><h1 id="操作原理"><a href="#操作原理" class="headerlink" title="操作原理"></a>操作原理</h1><p><strong>cert-manager 工作原理</strong><br>cert-manager 部署到 Kubernetes 集群后会查阅其所支持的自定义资源 CRD，可通过创建 CRD 资源来指示 cert-manager 签发证书并为证书自动续期。如下图所示：<br><img src="./images/1612682604526.png" alt="enter description here"></p><ul><li>Issuer/ClusterIssuer：用于指示 cert-manager 签发证书的方式，本文主要讲解签发免费证书的 ACME 方式。</li><li>Certificate：用于向 cert-manager 传递域名证书的信息、签发证书所需要的配置，以及对 Issuer/ClusterIssuer 的引用。</li></ul><blockquote><p>说明：<br>Issuer 与 ClusterIssuer 之间的区别是：Issuer 只能用来签发自身所在 namespace 下的证书，ClusterIssuer 可以签发任意 namespace 下的证书。</p></blockquote><h1 id="免费证书签发原理"><a href="#免费证书签发原理" class="headerlink" title="免费证书签发原理"></a>免费证书签发原理</h1><p>Let’s Encrypt 利用 ACME 协议校验域名的归属，校验成功后可以自动颁发免费证书。免费证书有效期只有90天，需在到期前再校验一次实现续期。使用 cert-manager 可以自动续期，即实现永久使用免费证书。校验域名归属的两种方式分别是 HTTP-01 和 DNS-01，校验原理详情可参见 <a href="https://letsencrypt.org/zh-cn/how-it-works/" target="_blank" rel="noopener">Let’s Encrypt 的运作方式</a></p><h2 id="HTTP-01-校验原理"><a href="#HTTP-01-校验原理" class="headerlink" title="HTTP-01 校验原理"></a>HTTP-01 校验原理</h2><p>HTTP-01 的校验原理是给域名指向的 HTTP 服务增加一个临时 location。此方法仅适用于给使用 Ingress 暴露流量的服务颁发证书，并且不支持泛域名证书。<br>例如，Let’s Encrypt 会发送 HTTP 请求到 <code>http://&lt;YOUR_DOMAIN&gt;/.well-known/acme-challenge/&lt;TOKEN&gt;</code>。YOUR_DOMAIN 是被校验的域名。TOKEN 是 ACME 协议客户端负责放置的文件，在此处 ACME 客户端即 cert-manager，通过修改或创建 Ingress 规则来增加临时校验路径并指向提供 TOKEN 的服务。Let’s Encrypt 会对比 TOKEN 是否符合预期，校验成功后就会颁发证书。</p><h2 id="DNS-01-校验原理"><a href="#DNS-01-校验原理" class="headerlink" title="DNS-01 校验原理"></a>DNS-01 校验原理</h2><p>DNS-01 的校验原理是利用 DNS 提供商的 API Key 拿到用户 DNS 控制权限。此方法不需要使用 Ingress，并且支持泛域名证书。<br>在 Let’s Encrypt 为 ACME 客户端提供令牌后，ACME 客户端 <code>\(cert-manager\)</code> 将创建从该令牌和帐户密钥派生的 TXT 记录，并将该记录放在<code>_acme-challenge.&lt;YOUR_DOMAIN&gt;</code>。Let’s Encrypt 将向 DNS 系统查询该记录，找到匹配项即可颁发证书。</p><h2 id="校验方式对比"><a href="#校验方式对比" class="headerlink" title="校验方式对比"></a>校验方式对比</h2><p>HTTP-01 校验方式的优点是配置简单通用，不同 DNS 提供商均可使用相同的配置方法。缺点是需要依赖 Ingress，若仅适用于服务支持 Ingress 暴露流量，不支持泛域名证书。<br>DNS-01 校验方式的优点是不依赖 Ingress，并支持泛域名。缺点是不同 DNS 提供商的配置方式不同，DNS 提供商过多而 cert-manager 的 Issuer 不能全部支持。部分可以通过部署实现 cert-manager 的 Webhook 服务来扩展 Issuer 进行支持。例如 DNSPod 和 阿里 DNS，详情请参见 <a href="https://cert-manager.io/docs/configuration/acme/dns01/#webhook" target="_blank" rel="noopener">Webhook 列表</a>。</p><h1 id="安装cert-manager"><a href="#安装cert-manager" class="headerlink" title="安装cert-manager"></a>安装cert-manager</h1><h2 id="相关信息"><a href="#相关信息" class="headerlink" title="相关信息"></a>相关信息</h2><p>kubernetes version: v1.15.6<br>helm version: v2.16.1<br>cert-manager version: v1.1.0</p><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="安装crd资源"><a href="#安装crd资源" class="headerlink" title="安装crd资源"></a>安装crd资源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kubernetes 1.15+</span></span><br><span class="line">$ kubectl apply --validate=<span class="literal">false</span> -f https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager.crds.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kubernetes &lt;1.15</span></span><br><span class="line">$ kubectl apply --validate=<span class="literal">false</span> -f https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager-legacy.crds.yaml</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Create namespace</span></span><br><span class="line">kubectl create ns cert-manager</span><br><span class="line"></span><br><span class="line"><span class="comment">## Add the Jetstack Helm repository</span></span><br><span class="line">$ helm repo add jetstack https://charts.jetstack.io</span><br><span class="line"></span><br><span class="line"><span class="comment">## Install the cert-manager helm chart</span></span><br><span class="line">$ helm install --name cert-manager --namespace cert-manager --version v1.1.0 jetstack/cert-manager</span><br></pre></td></tr></table></figure><h1 id="使用阿里webhook签发泛域名证书"><a href="#使用阿里webhook签发泛域名证书" class="headerlink" title="使用阿里webhook签发泛域名证书"></a>使用阿里webhook签发泛域名证书</h1><p>install alidns-webhook</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install alidns-webhook to cert-manager namespace. </span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/pragkent/alidns-webhook/master/deploy/bundle.yaml</span><br></pre></td></tr></table></figure><p>Create secret contains alidns credentials</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">alidns-secret</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">cert-manager</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  access-key:</span> <span class="string">****base64</span></span><br><span class="line"><span class="attr">  secret-key:</span> <span class="string">****base64</span></span><br></pre></td></tr></table></figure><p>Example Issuer</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">cert-manager.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterIssuer</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">letsencrypt-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  acme:</span></span><br><span class="line">    <span class="comment"># Change to your letsencrypt email</span></span><br><span class="line"><span class="attr">    email:</span> <span class="string">certmaster@example.com</span></span><br><span class="line"><span class="attr">    server:</span> <span class="attr">https://acme-v02.api.letsencrypt.org/directory</span></span><br><span class="line"><span class="attr">    privateKeySecretRef:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">letsencrypt-test-account-key</span></span><br><span class="line"><span class="attr">    solvers:</span></span><br><span class="line"><span class="attr">    - dns01:</span></span><br><span class="line"><span class="attr">        webhook:</span></span><br><span class="line"><span class="attr">          groupName:</span> <span class="string">acme.yourcompany.com</span></span><br><span class="line"><span class="attr">          solverName:</span> <span class="string">alidns</span></span><br><span class="line"><span class="attr">          config:</span></span><br><span class="line"><span class="attr">            region:</span> <span class="string">""</span></span><br><span class="line"><span class="attr">            accessKeySecretRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">alidns-secret</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">access-key</span></span><br><span class="line"><span class="attr">            secretKeySecretRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">alidns-secret</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">secret-key</span></span><br></pre></td></tr></table></figure><p>Issue a certificate</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">cert-manager.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Certificate</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">letsencrypt-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  secretName:</span> <span class="string">letsencrypt-test</span></span><br><span class="line"><span class="attr">  dnsNames:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">"*.example.com"</span></span><br><span class="line"><span class="attr">  issuerRef:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">letsencrypt-test</span></span><br><span class="line"><span class="attr">    kind:</span> <span class="string">ClusterIssuer</span></span><br></pre></td></tr></table></figure><h1 id="获取和使用证书"><a href="#获取和使用证书" class="headerlink" title="获取和使用证书"></a>获取和使用证书</h1><p>创建 Certificate 后，即可通过 kubectl 查看证书是否签发成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get certificate -n namespace</span><br></pre></td></tr></table></figure><p>READY 为 False：则表示签发失败，可以通过 describe 命令查看 event 来排查失败原因。<br>READY 为 True：则表示签发成功，证书将保存在所指定的 Secret 中。例如，default/test-mydomain-com-tls。</p><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>如果有多个ingress需要使用证书，并且这些ingress在不同的集群或者不同的namespace中，则</p><ul><li>多集群：每个集群需要部署cert-manager，并且每个namespace需要创建certificate</li><li>多namespace：每个namespace需要创建certificate</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.tencent.com/document/product/457/49368#dns-01-.E6.A0.A1.E9.AA.8C.E6.96.B9.E5.BC.8F.E7.AD.BE.E5.8F.91.E8.AF.81.E4.B9.A6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://cloud.tencent.com/document/product/457/49368#dns-01-.E6.A0.A1.E9.AA.8C.E6.96.B9.E5.BC.8F.E7.AD.BE.E5.8F.91.E8.AF.81.E4.B9.A6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cert-manager.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://cert-manager.io/docs/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://artifacthub.io/packages/helm/jetstack/cert-manager/1.1.0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://artifacthub.io/packages/helm/jetstack/cert-manager/1.1.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xuchao918.github.io/2019/03/14/%E4%BD%BF%E7%94%A8cert-manager%E5%AE%9E%E7%8E%B0Ingress-https/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://xuchao918.github.io/2019/03/14/%E4%BD%BF%E7%94%A8cert-manager%E5%AE%9E%E7%8E%B0Ingress-https/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/topics/cert-manager-webhook&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/topics/cert-manager-webhook&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;p&gt;随着 HTTPS 不断普及，大多数网站开始由 HTTP 升级到 HTTPS。使用 HTTPS 需要向权威机构申请证书，并且需要付出一定的成本，如果需求数量多，则开支也相对增加。cert-manager 是 Kubernetes 上的全能证书管理工具，支持利用 cert-manager 基于 ACME 协议与 Let’s Encrypt 签发免费证书并为证书自动续期，实现永久免费使用证书。&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://gongzhao1.gitee.io/categories/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://gongzhao1.gitee.io/tags/kubernetes/"/>
    
      <category term="cert-manager" scheme="https://gongzhao1.gitee.io/tags/cert-manager/"/>
    
  </entry>
  
  <entry>
    <title>python3之requests模块</title>
    <link href="https://gongzhao1.gitee.io/python3%E4%B9%8Brequests%E6%A8%A1%E5%9D%97/"/>
    <id>https://gongzhao1.gitee.io/python3之requests模块/</id>
    <published>2021-01-21T02:29:00.000Z</published>
    <updated>2021-04-21T12:39:05.295Z</updated>
    
    <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>Requests 是使用 Apache2 Licensed 许可证的 基于Python开发的HTTP 库，其在Python内置模块的基础上进行了高度的封装，从而使得Pythoner进行网络请求时，变得美好了许多，使用Requests可以轻而易举的完成浏览器可有的任何操作。<br><strong>特性：</strong></p><ul><li>Keep-Alive &amp; 连接池</li><li>国际化域名和 URL</li><li>带持久 Cookie 的会话</li><li>浏览器式的 SSL 认证</li><li>自动内容解码</li><li>基本/摘要式的身份认证</li><li>优雅的 key/value Cookie</li><li>自动解压</li><li>Unicode 响应体</li><li>HTTP(S) 代理支持</li><li>文件分块上传</li><li>流下载</li><li>连接超时</li><li>分块请求</li><li>支持 .netrc</li></ul><a id="more"></a><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br><span class="line">pip install --upgrade requests</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 无参数示例</span></span><br><span class="line">r = requests.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line"><span class="comment"># 有参数示例</span></span><br><span class="line">r = requets.get(<span class="string">'http://httpbin.org/get'</span>, params=d)</span><br><span class="line"></span><br><span class="line">传递URL参数：</span><br><span class="line">    在URL中常见?符号，http://httpbin.org/get?key=val 这种带有?传递关键字参数的方式，requests可以通过params实现。</span><br><span class="line">d = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>, <span class="string">'k2'</span>:<span class="string">'v2'</span>, <span class="string">'k3'</span>:<span class="keyword">None</span>, <span class="string">'k4'</span>:[<span class="string">'v4'</span>,<span class="string">'v5'</span>]&#125;  </span><br><span class="line">    <span class="comment"># 字典中键值为None的键不会被添加到URL中</span></span><br><span class="line">    <span class="comment"># 多个键值中间用&amp;符号连接</span></span><br><span class="line">    <span class="comment"># 键值可是列表 例如'k4'</span></span><br><span class="line">print(r.url)</span><br><span class="line">执行结果为：http://httpbin.org/get?k1=v1&amp;k2=v2&amp;k4=v4&amp;k4=v5</span><br></pre></td></tr></table></figure><h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># 1、基本POST实例</span><br><span class="line"> </span><br><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">payload = &#123;&apos;key1&apos;: &apos;value1&apos;, &apos;key2&apos;: &apos;value2&apos;&#125;</span><br><span class="line">ret = requests.post(&quot;http://httpbin.org/post&quot;, data=payload)</span><br><span class="line">print(ret.text)</span><br><span class="line"># 输出结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;&#125;, </span><br><span class="line">  &quot;data&quot;: &quot;&quot;, </span><br><span class="line">  &quot;files&quot;: &#123;&#125;, </span><br><span class="line">  &quot;form&quot;: &#123;</span><br><span class="line">    &quot;key1&quot;: &quot;value1&quot;, </span><br><span class="line">    &quot;key2&quot;: &quot;value2&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;*/*&quot;, </span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, </span><br><span class="line">    &quot;Connection&quot;: &quot;close&quot;, </span><br><span class="line">    &quot;Content-Length&quot;: &quot;23&quot;, </span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;python-requests/2.18.4&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;json&quot;: null, </span><br><span class="line">  &quot;origin&quot;: &quot;不告诉你这里返回的是你的IP地址&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;http://httpbin.org/post&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"># 2、发送请求头和数据实例</span><br><span class="line"> </span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">url = &apos;https://api.github.com/some/endpoint&apos;</span><br><span class="line">payload = &#123;&apos;some&apos;: &apos;data&apos;&#125;</span><br><span class="line">headers = &#123;&apos;content-type&apos;: &apos;application/json&apos;&#125;</span><br><span class="line">ret = requests.post(url, data=json.dumps(payload), headers=headers)</span><br><span class="line">print(ret.text)</span><br><span class="line">print(ret.cookies)</span><br><span class="line"># 输出结果</span><br><span class="line">&#123;&quot;message&quot;:&quot;Not Found&quot;,&quot;documentation_url&quot;:&quot;https://developer.github.com/v3&quot;&#125;</span><br><span class="line">&lt;RequestsCookieJar[]&gt;</span><br></pre></td></tr></table></figure><h2 id="响应内容"><a href="#响应内容" class="headerlink" title="响应内容"></a>响应内容</h2><p>requests模块的返回对象是一个Response对象，可以从这个对象中获取需要的信息。下面 r 代表Response对象。</p><ul><li>r.text         文本响应内容</li><li>r.context   二进制响应内容</li><li>r.json()      JSON响应内容</li><li>r.raw         原始相应内容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 文本响应内容</span><br><span class="line">    Response对象包含很多信息，Requests可以自动对大多数unicode字符集无缝解码。</span><br><span class="line">    请求发出后，Requests会基于HTTP头部对响应的编码做出有根据的推测。</span><br><span class="line">    我们可以通过r.encoding得到编码，也可以使用r.encoding属性改变编码</span><br><span class="line"></span><br><span class="line">#二进制响应内容</span><br><span class="line">      对于非文本请求r.content，Requests会自动解码gzip和deflate传输编码的响应内容。</span><br><span class="line"></span><br><span class="line"># JSON相应内容</span><br><span class="line">    需要注意如果JSON解码失败，r.json()会抛出异常。然而成功调用r.json()并不意味着响应成功，因为某些服务器失败</span><br><span class="line">    的相应中也会包含一个JSON对象，这种JSON会被解码返回。如果要判断请求是否成功，可以使用r.raise_for_status()</span><br><span class="line">    或者检查r.status_code是否和预期相同。</span><br><span class="line"></span><br><span class="line"># 原始相应内容</span><br><span class="line">    如果需要获取服务器的原始套接字相应，可以使用r.raw，使用时要确保在初始请求中设置了 stream=True</span><br><span class="line">r = requests.get(&apos;https://httpbin.org/get&apos;, stream=True)</span><br><span class="line">print(r.raw)</span><br><span class="line">print(r.raw.read(10))</span><br><span class="line"># 结果输出</span><br><span class="line">&lt;urllib3.response.HTTPResponse object at 0x061665F0&gt;</span><br><span class="line">b&apos;&#123;\n  &quot;args&quot;</span><br></pre></td></tr></table></figure><h2 id="定制请求头"><a href="#定制请求头" class="headerlink" title="定制请求头"></a>定制请求头</h2><p>如果想要添加HTTP头部，只需要传递一个字典给headers参数即可。注意: 所有的 header 值必须是 string、bytestring 或者 unicode。尽管传递 unicode header 也是允许的，但不建议这样做。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url = &apos;https://api.github.com/some/endpoint&apos;</span><br><span class="line">headers = &#123;&apos;user-agent&apos;: &apos;my-app/0.0.1&apos;&#125;</span><br><span class="line">r = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure><h2 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h2><p>可以通过响应状态码得知请求的结果，一般 200表示请求成功，Requests还附带一个内置的状态码查询对象 request.codes:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code == requests.codes.ok</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 Response.raise_for_status() 来抛出异常：</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r = requests.get(<span class="string">'http://httpbin.org/status/404'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.status_code</span><br><span class="line"><span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.raise_for_status()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"requests/models.py"</span>, line <span class="number">832</span>, <span class="keyword">in</span> raise_for_status</span><br><span class="line">    <span class="keyword">raise</span> http_error</span><br><span class="line">requests.exceptions.HTTPError: <span class="number">404</span> Client Error</span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是，由于我们的例子中 r 的 status_code 是 200 ，当我们调用 raise_for_status() 时，得到的是：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.raise_for_status()</span><br><span class="line"><span class="keyword">None</span></span><br></pre></td></tr></table></figure><h2 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; r.headers</span><br><span class="line">&#123;</span><br><span class="line">    &apos;content-encoding&apos;: &apos;gzip&apos;,</span><br><span class="line">    &apos;transfer-encoding&apos;: &apos;chunked&apos;,</span><br><span class="line">    &apos;connection&apos;: &apos;close&apos;,</span><br><span class="line">    &apos;server&apos;: &apos;nginx/1.0.4&apos;,</span><br><span class="line">    &apos;x-runtime&apos;: &apos;148ms&apos;,</span><br><span class="line">    &apos;etag&apos;: &apos;&quot;e1ca502697e5c9317743dc078f67693f&quot;&apos;,</span><br><span class="line">    &apos;content-type&apos;: &apos;application/json&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#但是这个字典比较特殊：它是仅为 HTTP 头部而生的。根据 RFC 2616， HTTP 头部是大小写不敏感的。</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; r.headers[&apos;Content-Type&apos;]</span><br><span class="line">&apos;application/json&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; r.headers.get(&apos;content-type&apos;)</span><br><span class="line">&apos;application/json&apos;</span><br></pre></td></tr></table></figure><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://example.com/some/cookie/setting/url'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.cookies[<span class="string">'example_cookie_name'</span>]</span><br><span class="line"><span class="string">'example_cookie_value'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果想要发送你的cookies到服务器，可以使用cookies参数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/cookies'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cookies = dict(cookies_are=<span class="string">'working'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=cookies)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</span><br><span class="line"><span class="string">'&#123;"cookies": &#123;"cookies_are": "working"&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cookie 的返回对象为 RequestsCookieJar，它的行为和字典类似，但界面更为完整，适合跨域名跨路径使用。你还可以把 Cookie Jar 传到 Requests 中：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jar = requests.cookies.RequestsCookieJar()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jar.set(<span class="string">'tasty_cookie'</span>, <span class="string">'yum'</span>, domain=<span class="string">'httpbin.org'</span>, path=<span class="string">'/cookies'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jar.set(<span class="string">'gross_cookie'</span>, <span class="string">'blech'</span>, domain=<span class="string">'httpbin.org'</span>, path=<span class="string">'/elsewhere'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/cookies'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=jar)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</span><br><span class="line"><span class="string">'&#123;"cookies": &#123;"tasty_cookie": "yum"&#125;&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h2><p>你可以告诉 requests 在经过以 timeout 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'http://github.com'</span>, timeout=<span class="number">0.001</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">requests.exceptions.Timeout: HTTPConnectionPool(host=<span class="string">'github.com'</span>, port=<span class="number">80</span>): Request timed out. (timeout=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意事项</span></span><br><span class="line">    timeout 仅对连接过程有效，与响应体的下载无关。 timeout 并不是整个下载响应的时间限制，而是如果服务器在 timeout 秒内没有应答，</span><br><span class="line">    将会引发一个异常（更精确地说，是在 timeout 秒内没有从基础套接字上接收到任何字节的数据时）</span><br><span class="line">    If no timeout <span class="keyword">is</span> specified explicitly, requests do <span class="keyword">not</span> time out.</span><br></pre></td></tr></table></figure><h2 id="错误与异常"><a href="#错误与异常" class="headerlink" title="错误与异常"></a>错误与异常</h2><p>遇到网络问题（如：DNS 查询失败、拒绝连接等）时，Requests 会抛出一个 ConnectionError 异常。<br>如果 HTTP 请求返回了不成功的状态码， Response.raise_for_status() 会抛出一个 HTTPError 异常。<br>若请求超时，则抛出一个 Timeout 异常。<br>若请求超过了设定的最大重定向次数，则会抛出一个 TooManyRedirects 异常。<br>所有Requests显式抛出的异常都继承自 requests.exceptions.RequestException 。</p><h2 id="其它请求"><a href="#其它请求" class="headerlink" title="其它请求"></a>其它请求</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">requests.get(url, params=<span class="keyword">None</span>, **kwargs)</span><br><span class="line">requests.post(url, data=<span class="keyword">None</span>, json=<span class="keyword">None</span>, **kwargs)</span><br><span class="line">requests.put(url, data=<span class="keyword">None</span>, **kwargs)</span><br><span class="line">requests.head(url, **kwargs)</span><br><span class="line">requests.delete(url, **kwargs)</span><br><span class="line">requests.patch(url, data=<span class="keyword">None</span>, **kwargs)</span><br><span class="line">requests.options(url, **kwargs)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 以上方法均是在此方法的基础上构建</span></span><br><span class="line">requests.request(method, url, **kwargs)</span><br></pre></td></tr></table></figure><h2 id="会话对象"><a href="#会话对象" class="headerlink" title="会话对象"></a>会话对象</h2><p>会话对象让你能够跨请求保持某些参数。它也会在同一个 Session 实例发出的所有请求之间保持 cookie， 期间使用 urllib3 的 connection pooling 功能。所以如果你向同一主机发送多个请求，底层的 TCP 连接将会被重用，从而带来显著的性能提升。 (参见 HTTP persistent connection).<br>会话对象具有主要的 Requests API 的所有方法。<br>我们来跨请求保持一些 cookie:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span>)</span><br><span class="line">r = s.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># '&#123;"cookies": &#123;"sessioncookie": "123456789"&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p>会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.auth = (<span class="string">'user'</span>, <span class="string">'pass'</span>)</span><br><span class="line">s.headers.update(&#123;<span class="string">'x-test'</span>: <span class="string">'true'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># both 'x-test' and 'x-test2' are sent</span></span><br><span class="line">s.get(<span class="string">'http://httpbin.org/headers'</span>, headers=&#123;<span class="string">'x-test2'</span>: <span class="string">'true'</span>&#125;)</span><br></pre></td></tr></table></figure><p>任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。<br>不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 cookie ，而非第二个：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">r = s.get(<span class="string">'http://httpbin.org/cookies'</span>, cookies=&#123;<span class="string">'from-my'</span>: <span class="string">'browser'</span>&#125;)</span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># '&#123;"cookies": &#123;"from-my": "browser"&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line">r = s.get(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># '&#123;"cookies": &#123;&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p>如果你要手动为会话添加 cookie，就使用 Cookie utility 函数 来操纵 Session.cookies。<br>会话还可以用作前后文管理器：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    s.get(<span class="string">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span>)</span><br></pre></td></tr></table></figure><p>这样就能确保 with 区块退出后会话能被关闭，即使发生了异常也一样。<br>从字典参数中移除一个值<br>有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 None ，那个键就会被自动省略掉。<br>包含在一个会话中的所有数据你都可以直接使用。</p><h2 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h2><p>Requests 可以为 HTTPS 请求验证 SSL 证书，就像 web 浏览器一样。SSL 验证默认是开启的，如果证书验证失败，Requests 会抛出 SSLError:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://requestb.in&apos;)</span><br><span class="line">requests.exceptions.SSLError: hostname &apos;requestb.in&apos; doesn&apos;t match either of &apos;*.herokuapp.com&apos;, &apos;herokuapp.com&apos;</span><br></pre></td></tr></table></figure><p>在该域名上我没有设置 SSL，所以失败了。但 Github 设置了 SSL:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://github.com&apos;, verify=True)</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>如果你将 verify 设置为 False，Requests 也能忽略对 SSL 证书的验证。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://kennethreitz.org&apos;, verify=False)</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>你可以为 verify 传入 CA_BUNDLE 文件的路径，或者包含可信任 CA 证书文件的文件夹路径：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://github.com&apos;, verify=&apos;/path/to/certfile&apos;)</span><br></pre></td></tr></table></figure><p>或者将其保持在会话中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.verify = &apos;/path/to/certfile&apos;</span><br></pre></td></tr></table></figure><blockquote><p>如果 verify 设为文件夹路径，文件夹必须通过 OpenSSL 提供的 c_rehash 工具处理。<br>你还可以通过 REQUESTS_CA_BUNDLE 环境变量定义可信任 CA 列表。</p></blockquote><h2 id="客户端证书"><a href="#客户端证书" class="headerlink" title="客户端证书"></a>客户端证书</h2><p>你也可以指定一个本地证书用作客户端证书，可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://kennethreitz.org&apos;, cert=(&apos;/path/client.cert&apos;, &apos;/path/client.key&apos;))</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>或者保持在会话中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.cert = &apos;/path/client.cert&apos;</span><br></pre></td></tr></table></figure><p>如果你指定了一个错误路径或一个无效的证书:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://kennethreitz.org&apos;, cert=&apos;/wrong_path/client.pem&apos;)</span><br><span class="line">SSLError: [Errno 336265225] _ssl.c:347: error:140B0009:SSL routines:SSL_CTX_use_PrivateKey_file:PEM lib</span><br></pre></td></tr></table></figure><blockquote><p>本地证书的私有 key 必须是解密状态。目前，Requests 不支持使用加密的 key。</p></blockquote><h2 id="CA证书"><a href="#CA证书" class="headerlink" title="CA证书"></a>CA证书</h2><p>Requests 默认附带了一套它信任的根证书，来自于 Mozilla trust store。然而它们在每次 Requests 更新时才会更新。这意味着如果你固定使用某一版本的 Requests，你的证书有可能已经 太旧了。<br>从 Requests 2.4.0 版之后，如果系统中装了 certifi 包，Requests 会试图使用它里边的 证书。这样用户就可以在不修改代码的情况下更新他们的可信任证书。<br>为了安全起见，我们建议你经常更新 certifi！</p><h2 id="响应体内容工作流"><a href="#响应体内容工作流" class="headerlink" title="响应体内容工作流"></a>响应体内容工作流</h2><p>默认情况下，当你进行网络请求后，响应体会立即被下载。你可以通过 stream 参数覆盖这个行为，推迟下载响应体直到访问 Response.content 属性：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tarball_url = &apos;https://github.com/kennethreitz/requests/tarball/master&apos;</span><br><span class="line">r = requests.get(tarball_url, stream=True)</span><br></pre></td></tr></table></figure><p>此时仅有响应头被下载下来了，连接保持打开状态，因此允许我们根据条件获取内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if int(r.headers[&apos;content-length&apos;]) &lt; TOO_LONG:</span><br><span class="line">  content = r.content</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>你可以进一步使用 Response.iter_content 和 Response.iter_lines 方法来控制工作流，或者以Response.raw 从底层 urllib3 的 urllib3.HTTPResponse &lt;urllib3.response.HTTPResponse 读取未解码的相应体。<br>如果你在请求中把 stream 设为 True，Requests 无法将连接释放回连接池，除非你 消耗了所有的数据，或者调用了 Response.close。 这样会带来连接效率低下的问题。如果你发现你在使用stream=True 的同时还在部分读取请求的 body（或者完全没有读取 body），那么你就应该考虑使用 with 语句发送请求，这样可以保证请求一定会被关闭：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with requests.get(&apos;http://httpbin.org/get&apos;, stream=True) as r:</span><br><span class="line">    # 在此处理响应。</span><br></pre></td></tr></table></figure><h2 id="保持活动状态（持久连接）"><a href="#保持活动状态（持久连接）" class="headerlink" title="保持活动状态（持久连接）"></a>保持活动状态（持久连接）</h2><p>好消息——归功于 urllib3，同一会话内的持久连接是完全自动处理的！同一会话内你发出的任何请求都会自动复用恰当的连接！<br>注意：只有所有的响应体数据被读取完毕连接才会被释放为连接池；所以确保将 stream 设置为False 或读取 Response 对象的 content 属性。</p><h2 id="流式上传"><a href="#流式上传" class="headerlink" title="流式上传"></a>流式上传</h2><p>Requests支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&apos;massive-body&apos;) as f:</span><br><span class="line">    requests.post(&apos;http://some.url/streamed&apos;, data=f)</span><br></pre></td></tr></table></figure><p>我们强烈建议你用二进制模式（binary mode）打开文件。这是因为 requests 可能会为你提供 header 中的 Content-Length，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。</p><h2 id="事件挂钩"><a href="#事件挂钩" class="headerlink" title="事件挂钩"></a>事件挂钩</h2><p>Requests有一个钩子系统，你可以用来操控部分请求过程，或信号事件处理。<br>可用的钩子:<br>response: 从一个请求产生的响应<br>你可以通过传递一个 <code>{hook_name: callback_function}</code>字典给 hooks 请求参数为每个请求分配一个钩子函数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hooks=dict(response=print_url)</span><br></pre></td></tr></table></figure><p>callback_function 会接受一个数据块作为它的第一个参数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def print_url(r, *args, **kwargs):</span><br><span class="line">    print(r.url)</span><br></pre></td></tr></table></figure><p>若执行你的回调函数期间发生错误，系统会给出一个警告。<br>若回调函数返回一个值，默认以该值替换传进来的数据。若函数未返回任何东西，也没有什么其他的影响。<br>我们来在运行期间打印一些请求方法的参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;http://httpbin.org&apos;, hooks=dict(response=print_url))</span><br><span class="line">http://httpbin.org</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><h2 id="流式请求"><a href="#流式请求" class="headerlink" title="流式请求"></a>流式请求</h2><p>使用 Response.iter_lines() 你可以很方便地对流式 API （例如 Twitter 的流式 API ） 进行迭代。简单地设置 stream 为 True 便可以使用 iter_lines 对相应进行迭代：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://httpbin.org/stream/20'</span>, stream=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> r.iter_lines():</span><br><span class="line"></span><br><span class="line">    <span class="comment"># filter out keep-alive new lines</span></span><br><span class="line">    <span class="keyword">if</span> line:</span><br><span class="line">        decoded_line = line.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        print(json.loads(decoded_line))</span><br></pre></td></tr></table></figure><p>当使用 decode_unicode=True 在 Response.iter_lines() 或 Response.iter_content() 中时，你需要提供一个回退编码方式，以防服务器没有提供默认回退编码，从而导致错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(&apos;http://httpbin.org/stream/20&apos;, stream=True)</span><br><span class="line"></span><br><span class="line">if r.encoding is None:</span><br><span class="line">    r.encoding = &apos;utf-8&apos;</span><br><span class="line"></span><br><span class="line">for line in r.iter_lines(decode_unicode=True):</span><br><span class="line">    if line:</span><br><span class="line">        print(json.loads(line))</span><br></pre></td></tr></table></figure><p>iter_lines 不保证重进入时的安全性。多次调用该方法 会导致部分收到的数据丢失。如果你要在多处调用它，就应该使用生成的迭代器对象:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lines = r.iter_lines()</span><br><span class="line"><span class="comment"># 保存第一行以供后面使用，或者直接跳过</span></span><br><span class="line"></span><br><span class="line">first_line = next(lines)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    print(line)</span><br></pre></td></tr></table></figure><h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><p>如果需要使用代理，你可以通过为任意请求方法提供 proxies 参数来配置单个请求:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://10.10.1.10:3128"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"http://10.10.1.10:1080"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">"http://example.org"</span>, proxies=proxies)</span><br></pre></td></tr></table></figure><p>你也可以通过环境变量 HTTP_PROXY 和 HTTPS_PROXY 来配置代理。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ export HTTP_PROXY=&quot;http://10.10.1.10:3128&quot;</span><br><span class="line">$ export HTTPS_PROXY=&quot;http://10.10.1.10:1080&quot;</span><br><span class="line"></span><br><span class="line">$ python</span><br><span class="line">&gt;&gt;&gt; import requests</span><br><span class="line">&gt;&gt;&gt; requests.get(&quot;http://example.org&quot;)</span><br></pre></td></tr></table></figure><p>若你的代理需要使用HTTP Basic Auth，可以使用 <code>http://user:password@host/</code> 语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123;</span><br><span class="line">    &quot;http&quot;: &quot;http://user:pass@10.10.1.10:3128/&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要为某个特定的连接方式或者主机设置代理，使用 scheme://hostname 作为 key， 它会针对指定的主机和连接方式进行匹配。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123;&apos;http://10.20.1.128&apos;: &apos;http://10.10.1.10:5323&apos;&#125;</span><br></pre></td></tr></table></figure><p>注意，代理 URL 必须包含连接方式。</p><h2 id="SOCKS"><a href="#SOCKS" class="headerlink" title="SOCKS"></a>SOCKS</h2><p>2.10.0 新版功能.<br>除了基本的 HTTP 代理，Request 还支持 SOCKS 协议的代理。这是一个可选功能，若要使用， 你需要安装第三方库。<br>你可以用 pip 获取依赖:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install requests[socks]</span><br></pre></td></tr></table></figure><p>安装好依赖以后，使用 SOCKS 代理和使用 HTTP 代理一样简单：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123;</span><br><span class="line">    &apos;http&apos;: &apos;socks5://user:pass@host:port&apos;,</span><br><span class="line">    &apos;https&apos;: &apos;socks5://user:pass@host:port&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编码方式"><a href="#编码方式" class="headerlink" title="编码方式"></a>编码方式</h2><p>当你收到一个响应时，Requests 会猜测响应的编码方式，用于在你调用 Response.text 方法时对响应进行解码。Requests 首先在 HTTP 头部检测是否存在指定的编码方式，如果不存在，则会使用charade 来尝试猜测编码方式。<br>只有当 HTTP 头部不存在明确指定的字符集，并且 Content-Type 头部字段包含 text 值之时， Requests 才不去猜测编码方式。在这种情况下， RFC 2616 指定默认字符集必须是 ISO-8859-1 。Requests 遵从这一规范。如果你需要一种不同的编码方式，你可以手动设置 Response.encoding 属性，或使用原始的 Response.content。</p><h2 id="超时-1"><a href="#超时-1" class="headerlink" title="超时"></a>超时</h2><p>为防止服务器不能及时响应，大部分发至外部服务器的请求都应该带着 timeout 参数。在默认情况下，除非显式指定了 timeout 值，requests 是不会自动进行超时处理的。如果没有 timeout，你的代码可能会挂起若干分钟甚至更长时间。</p><p>连接超时指的是在你的客户端实现到远端机器端口的连接时，Request 会等待的秒数。一个很好的实践方法是把连接超时设为比 3 的倍数略大的一个数值，因为 TCP 数据包重传窗口 (TCP packet retransmission window) 的默认大小是 3。</p><p>一旦你的客户端连接到了服务器并且发送了 HTTP 请求，读取超时指的就是客户端等待服务器发送请求的时间。（特定地，它指的是客户端要等待服务器发送字节之间的时间。在 99.9% 的情况下这指的是服务器发送第一个字节之前的时间）。</p><p>如果你制订了一个单一的值作为 timeout，如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(&apos;https://github.com&apos;, timeout=5)</span><br></pre></td></tr></table></figure><p>这一 timeout 值将会用作 connect 和 read 二者的 timeout。如果要分别制定，就传入一个元组：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(&apos;https://github.com&apos;, timeout=(3.05, 27))</span><br></pre></td></tr></table></figure><p>如果远端服务器很慢，你可以让 Request 永远等待，传入一个 None 作为 timeout 值，然后就冲咖啡去吧。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(&apos;https://github.com&apos;, timeout=None)</span><br></pre></td></tr></table></figure><h2 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h2><p>本篇文档讨论如何配合 Requests 使用多种身份认证方式。</p><p>许多 web 服务都需要身份认证，并且也有多种不同的认证类型。 以下，我们会从简单到复杂概述 Requests 中可用的几种身份认证形式。</p><h3 id="基本身份认证"><a href="#基本身份认证" class="headerlink" title="基本身份认证"></a>基本身份认证</h3><p>许多要求身份认证的web服务都接受 HTTP Basic Auth。这是最简单的一种身份认证，并且 Requests 对这种认证方式的支持是直接开箱即可用。<br>以 HTTP Basic Auth 发送请求非常简单：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from requests.auth import HTTPBasicAuth</span><br><span class="line">&gt;&gt;&gt; requests.get(&apos;https://api.github.com/user&apos;, auth=HTTPBasicAuth(&apos;user&apos;, &apos;pass&apos;))</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>事实上，HTTP Basic Auth 如此常见，Requests 就提供了一种简写的使用方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; requests.get(&apos;https://api.github.com/user&apos;, auth=(&apos;user&apos;, &apos;pass&apos;))</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>像这样在一个元组中提供认证信息与前一个 HTTPBasicAuth 例子是完全相同的。</p><h3 id="摘要式身份认证"><a href="#摘要式身份认证" class="headerlink" title="摘要式身份认证"></a>摘要式身份认证</h3><p>另一种非常流行的 HTTP 身份认证形式是摘要式身份认证，Requests 对它的支持也是开箱即可用的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from requests.auth import HTTPDigestAuth</span><br><span class="line">&gt;&gt;&gt; url = &apos;http://httpbin.org/digest-auth/auth/user/pass&apos;</span><br><span class="line">&gt;&gt;&gt; requests.get(url, auth=HTTPDigestAuth(&apos;user&apos;, &apos;pass&apos;))</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><h3 id="OAuth-1-认证"><a href="#OAuth-1-认证" class="headerlink" title="OAuth 1 认证"></a>OAuth 1 认证</h3><p>Oauth 是一种常见的 Web API 认证方式。 requests-oauthlib 库可以让 Requests 用户简单地创建 OAuth 认证的请求：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import requests</span><br><span class="line">&gt;&gt;&gt; from requests_oauthlib import OAuth1</span><br><span class="line">&gt;&gt;&gt; url = &apos;https://api.twitter.com/1.1/account/verify_credentials.json&apos;</span><br><span class="line">&gt;&gt;&gt; auth = OAuth1(&apos;YOUR_APP_KEY&apos;, &apos;YOUR_APP_SECRET&apos;,</span><br><span class="line">...               &apos;USER_OAUTH_TOKEN&apos;, &apos;USER_OAUTH_TOKEN_SECRET&apos;)</span><br><span class="line">&gt;&gt;&gt; requests.get(url, auth=auth)</span><br><span class="line">&lt;Response [200]&gt;</span><br></pre></td></tr></table></figure><p>关于 OAuth 工作流程的更多信息，请参见 OAuth 官方网站。 关于 requests-oauthlib 的文档和用例，请参见 GitHub 的 requests_oauthlib 代码库。</p><h3 id="OAuth-2-与-OpenID-连接认证"><a href="#OAuth-2-与-OpenID-连接认证" class="headerlink" title="OAuth 2 与 OpenID 连接认证"></a>OAuth 2 与 OpenID 连接认证</h3><p>requests-oauthlib 库还可以处理 OAuth 2，OAuth 2 是 OpenID 连接的基础机制。 请查看requests-oauthlib OAuth2 documentation 文档以了解 OAuth 2 的各种认证管理流程：</p><h3 id="其他身份认证形式"><a href="#其他身份认证形式" class="headerlink" title="其他身份认证形式"></a>其他身份认证形式</h3><p>Requests 的设计允许其他形式的身份认证用简易的方式插入其中。开源社区的成员时常为更复杂或不那么常用的身份认证形式编写认证处理插件。其中一些最优秀的已被收集在 Requests organization 页面中，包括:</p><ul><li>Kerberos</li><li>NTLM</li></ul><p>如果你想使用其中任何一种身份认证形式，直接去它们的 GitHub 页面，依照说明进行。</p><h3 id="自定义身份认证"><a href="#自定义身份认证" class="headerlink" title="自定义身份认证"></a>自定义身份认证</h3><p>Requests 允许你使用自己指定的身份验证机制。<br>任何传递给请求方法的 auth 参数的可调用对象，在请求发出之前都有机会修改请求。<br>自定义的身份验证机制是作为 requests.auth.AuthBase 的子类来实现的，也非常容易定义。Requests 在 requests.auth 中提供了两种常见的的身份验证方案： HTTPBasicAuth 和HTTPDigestAuth 。<br>假设我们有一个web服务，仅在 X-Pizza 头被设置为一个密码值的情况下才会有响应。虽然这不太可能，但就以它为例好了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> AuthBase</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaAuth</span><span class="params">(AuthBase)</span>:</span></span><br><span class="line">    <span class="string">"""Attaches HTTP Pizza Authentication to the given Request object."""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username)</span>:</span></span><br><span class="line">        <span class="comment"># setup any auth-related data here</span></span><br><span class="line">        self.username = username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, r)</span>:</span></span><br><span class="line">        <span class="comment"># modify and return the request</span></span><br><span class="line">        r.headers[<span class="string">'X-Pizza'</span>] = self.username</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">然后就可以使用我们的PizzaAuth来进行网络请求:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'http://pizzabin.org/admin'</span>, auth=PizzaAuth(<span class="string">'kenneth'</span>))</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure><p>当一个身份认证模块被附加到一个请求上，在设置 request 期间就会调用该模块。因此<code>__call__</code>方法必须完成使得身份认证生效的所有事情。一些身份认证形式会额外地添加钩子来提供进一步的功能。</p><h2 id="Http-Post请求四种请求体实现"><a href="#Http-Post请求四种请求体实现" class="headerlink" title="Http Post请求四种请求体实现"></a>Http Post请求四种请求体实现</h2><h3 id="Content-Type定义"><a href="#Content-Type定义" class="headerlink" title="Content-Type定义"></a>Content-Type定义</h3><p>要了解Content-Type首先我们要先对HTTP/1.1 协议有一定的了解。</p><p>众所周知，HTTP/1.1 规定的 HTTP 请求方法有 OPTIONS、GET、HEAD、POST、PUT、DELETE、TRACE、CONNECT 8种，其中 POST 一般用来向服务端提交数据。<br>但是可能很多人不知道的是，虽然HTTP/1.1协议规定 了POST 提交的数据必须放在消息主体（entity-body）中，但并没有规定数据必须使用什么样的编码方式。也就是说，开发者完全可以自己决定消息主体的格式。</p><p>但是数据除了请求方发送之外，还要服务端能够解析才有意义。而这个解析操作的第一步通常就是是根据请求头（headers）中的 Content-Type 字段来获知请求中的消息主体的编码方式，然后再对数据进行对应的解析操作。也就是说请求头中的Content-Type字段用于规定请求体的编码格式，服务端代码需要使用它对接收到的消息主体进行解析。</p><h3 id="Content-Type的格式种类"><a href="#Content-Type的格式种类" class="headerlink" title="Content-Type的格式种类"></a>Content-Type的格式种类</h3><p>我们前面说了HTTP/1.1没有规定协议编码方式，但是随着协议的应用推广，已经慢慢的形成了四种最常用的编码方式，基本上形成了相应的规范，即基本固定的Content-Type取值application/x-www-form-urlencoded（默认格式）、application/json、text/xml、multipart/form-data，与默认传递的urlencoded、json格式、xml格式、文件格式一 一对应。</p><p>接下来我们会每个编码方式的应用场景及Python实现分别进行介绍。我们此次主要使用<a href="http://httpbin.org" target="_blank" rel="noopener">http://httpbin.org</a></p><p>httpbin是一个专门用来测试 HTTP 请求及响应的网站，其github开源地址是<a href="https://github.com/requests/httpbin" target="_blank" rel="noopener">https://github.com/requests/httpbin</a> 作者另外一个开源库就是大名鼎鼎的requests，它也是我们演示代码中重要的部分。</p><h3 id="application-x-www-form-urlencoded格式"><a href="#application-x-www-form-urlencoded格式" class="headerlink" title="application/x-www-form-urlencoded格式"></a>application/x-www-form-urlencoded格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">datas = &#123;<span class="string">"param1"</span>: <span class="string">"Detector"</span>, <span class="string">"param2"</span>: <span class="string">"cnblogs"</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, data=datas)</span><br><span class="line">print(r.text)</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure><h3 id="application-json格式"><a href="#application-json格式" class="headerlink" title="application/json格式"></a>application/json格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">datas = json.dumps(&#123;<span class="string">"param1"</span>: <span class="string">"Detector"</span>, <span class="string">"param2"</span>: <span class="string">"cnblogs"</span>&#125;)</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, data=datas, headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="text-xml数据格式"><a href="#text-xml数据格式" class="headerlink" title="text/xml数据格式"></a>text/xml数据格式</h3><p>它是一种使用 HTTP 作为传输协议，XML 作为编码方式的远程调用规范。典型的 XML-RPC（XML Remote Procedure Call） 请求数据是这样的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/xml"</span>&#125;</span><br><span class="line">datas = <span class="string">"""&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;methodCall&gt;</span></span><br><span class="line"><span class="string">    &lt;methodName&gt;examples.getStateName&lt;/methodName&gt;</span></span><br><span class="line"><span class="string">    &lt;params&gt;</span></span><br><span class="line"><span class="string">        &lt;param&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;&lt;i4&gt;41&lt;/i4&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">        &lt;/param&gt;</span></span><br><span class="line"><span class="string">    &lt;/params&gt;</span></span><br><span class="line"><span class="string">&lt;/methodCall&gt;"""</span></span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, data=datas, headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="multipart-form-data数据格式"><a href="#multipart-form-data数据格式" class="headerlink" title="multipart/form-data数据格式"></a>multipart/form-data数据格式</h3><p>multipart/form-data主要用于文件上传，当我们使用它时，必须让 form表单的enctype 等于 multipart/form-data。直接来看一个请求示例，主要实现了上传本地的test.txt文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">files = &#123;<span class="string">"file"</span>: open(<span class="string">"C:/Users/Administrator/Desktop/test.txt"</span>, <span class="string">"rb"</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h1&gt;&lt;p&gt;Requests 是使用 Apache2 Licensed 许可证的 基于Python开发的HTTP 库，其在Python内置模块的基础上进行了高度的封装，从而使得Pythoner进行网络请求时，变得美好了许多，使用Requests可以轻而易举的完成浏览器可有的任何操作。&lt;br&gt;&lt;strong&gt;特性：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Keep-Alive &amp;amp; 连接池&lt;/li&gt;
&lt;li&gt;国际化域名和 URL&lt;/li&gt;
&lt;li&gt;带持久 Cookie 的会话&lt;/li&gt;
&lt;li&gt;浏览器式的 SSL 认证&lt;/li&gt;
&lt;li&gt;自动内容解码&lt;/li&gt;
&lt;li&gt;基本/摘要式的身份认证&lt;/li&gt;
&lt;li&gt;优雅的 key/value Cookie&lt;/li&gt;
&lt;li&gt;自动解压&lt;/li&gt;
&lt;li&gt;Unicode 响应体&lt;/li&gt;
&lt;li&gt;HTTP(S) 代理支持&lt;/li&gt;
&lt;li&gt;文件分块上传&lt;/li&gt;
&lt;li&gt;流下载&lt;/li&gt;
&lt;li&gt;连接超时&lt;/li&gt;
&lt;li&gt;分块请求&lt;/li&gt;
&lt;li&gt;支持 .netrc&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
      <category term="requests" scheme="https://gongzhao1.gitee.io/tags/requests/"/>
    
  </entry>
  
  <entry>
    <title>Javascript实现Base64、Hex、Bytes、String之间的互相转换</title>
    <link href="https://gongzhao1.gitee.io/Javascript%E5%AE%9E%E7%8E%B0Base64%E3%80%81Hex%E3%80%81Bytes%E3%80%81String%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E6%8D%A2/"/>
    <id>https://gongzhao1.gitee.io/Javascript实现Base64、Hex、Bytes、String之间的互相转换/</id>
    <published>2021-01-20T03:37:01.000Z</published>
    <updated>2021-04-21T12:39:05.293Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.jb51.net/article/95352.htm" target="_blank" rel="noopener">https://www.jb51.net/article/95352.htm</a></li><li><a href="https://blog.csdn.net/weixin_42420703/article/details/81384901" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42420703/article/details/81384901</a><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1>为什么会有Base64编码呢？因为有些网络传送渠道并不支持所有的字节，例如传统的邮件只支持可见字符的传送，像ASCII码的控制字符就 不能通过邮件传送。这样用途就受到了很大的限制，比如图片二进制流的每个字节不可能全部是可见字符，所以就传送不了。最好的方法就是在不改变传统协议的情 况下，做一种扩展方案来支持二进制文件的传送。把不可打印的字符也能用可打印字符来表示，问题就解决了。Base64编码应运而生，Base64就是一种 基于64个可打印字符来表示二进制数据的表示方法。<br>所谓Base64，就是选出64个字符作为一个基本字符集（A-Z，a-z，0-9，+，/，再加上作为垫字的”=”，实际是65个字符），其它所有符号都转换成这个字符集中的字符。<ul><li>第一步，将每三个字节作为一组，一共是24个二进制位。</li><li>第二步，将这24个二进制位分为四组，每个组有6个二进制位。</li><li>第三步，在每组前面加两个00，扩展成32个二进制位，即四个字节。</li><li>第四步，根据下表，得到扩展后的每个字节的对应符号，这就是Base64的编码值。</li></ul></li></ul><a id="more"></a><h2 id="如何编码"><a href="#如何编码" class="headerlink" title="如何编码"></a>如何编码</h2><p>例如：<br>“dog”</p><blockquote><p>d: ASCII值 100 ，二进制为 0110 0100<br>o: ASCII值 111 ，二进制为 0110 1111<br>g: ASCII值 103，二进制为 0110 0111<br>这24个二进制位 0110 0100 0110 1111 0110 0111 分为四组：<br>011001 000110 111101 100111<br>每组前面加两个00，即：<br>00011001 00000110 00111101 00100111<br>对应码值分别为：25、6、61、39<br>查找下表，可以知道得到编码后的字符串为：ZG9n</p></blockquote><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/xiaoshujiang/2021/1/20/1611126454274.png" alt="enter description here"></p><p>那如果字节数不足3呢？</p><blockquote><p>a）2个字节的情况：将这2个字节的一共16个二进制位，按照上面的规则，转成三组(6,6,4)，最后一组除了前面加两个0以外，后面也要加两个0。这样得到一个三位的Base64编码，再在末尾补上一个”=”号。<br>比如，“Ma”这个字符串是两个字节，可以转化成三组00010011、00010110、00000100以后，对应Base64值分别为T、W、E，再补上一个”=”号，因此”Ma”的Base64编码就是TWE=。</p></blockquote><blockquote><p>b）1个字节的情况：将这1个字节的8个二进制位，按照上面的规则转成2组(6,2)，最后一组除了前面加二个0以外，后面再加4个0。这样得到一个二位的Base64编码，再在末尾补上两个”=”号。<br>比如，“M”这个字母是一个字节，可以转化为二组00010011、00010000，对应的Base64值分别为T、Q，再补上二个”=”号，因此”M”的Base64编码就是TQ==</p></blockquote><h2 id="如何解码"><a href="#如何解码" class="headerlink" title="如何解码"></a>如何解码</h2><p>了解了编码规则之后，解码就很容易理解了，就是编码过程的逆过程</p><ul><li>第一步，将每4个字符为一组，查找上表，找到每个字符对应的ASCII值</li><li>第二步，将4个ASCII值写成二进制形式，并将每个二进制的前2个00去掉</li><li>第三步，将剩下的24位二进制位分成3份，即3个字节</li><li>第四步，查找ASCII值表（下表），找到每个字节对应的字符。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/xiaoshujiang/2021/1/20/1611126454280.png" alt="enter description here"></p><h1 id="javascript中实现Base64编码解码"><a href="#javascript中实现Base64编码解码" class="headerlink" title="javascript中实现Base64编码解码"></a>javascript中实现Base64编码解码</h1><h2 id="atob、btoa"><a href="#atob、btoa" class="headerlink" title="atob、btoa"></a>atob、btoa</h2><p>window有两个函数atob、btoa，但是这两个函数并不支持Unicode字符的编码，需结合encodeURIComponent、decodeURIComponent函数来使用</p><h3 id="btoa"><a href="#btoa" class="headerlink" title="btoa"></a>btoa</h3><p>binary to ascii，用于将binary数据用ascii码表示。常用于编码字符串。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"This is a string"</span>;</span><br><span class="line"><span class="keyword">var</span> encoded_str = btoa(str);</span><br><span class="line"><span class="built_in">console</span>.log(encoded_str); <span class="comment">// Outputs: "VGhpcyBpcyBhIHN0cmluZw=="</span></span><br></pre></td></tr></table></figure><p>但是不能编码Unicode字符</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"hello, 中国"</span>;</span><br><span class="line"><span class="keyword">var</span> encoded_str = btoa(str);</span><br><span class="line"><span class="built_in">console</span>.log(encoded_str);</span><br><span class="line">VM666:<span class="number">2</span> Uncaught DOMException: Failed to execute <span class="string">'btoa'</span> on <span class="string">'Window'</span>: The string to be encoded contains characters outside <span class="keyword">of</span> the Latin1 range.</span><br><span class="line">    at &lt;anonymous&gt;:<span class="number">2</span>:<span class="number">19</span></span><br></pre></td></tr></table></figure><h3 id="atob"><a href="#atob" class="headerlink" title="atob"></a>atob</h3><p>ascii to binary，用于将ascii码解析成binary数据。用于解码Base64编码的字符串。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> encoded_str = <span class="string">"VGhpcyBpcyBhIHN0cmluZw=="</span>;</span><br><span class="line"><span class="keyword">var</span> str= atob(encoded_str);</span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// Outputs: "This is a string"</span></span><br></pre></td></tr></table></figure><h3 id="如何让btoa支持Unicode字符编码"><a href="#如何让btoa支持Unicode字符编码" class="headerlink" title="如何让btoa支持Unicode字符编码"></a>如何让btoa支持Unicode字符编码</h3><blockquote><p>编码时，先用encodeURIComponent对字符串进行编码，再进行btoa进行Base64编码<br>解码时，先用atob对Base64编码的串进行解码，再用decodeURIComponent对字符串进行解码</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"hello,中国"</span>;</span><br><span class="line"><span class="keyword">var</span> encoded_str = btoa(<span class="built_in">encodeURIComponent</span>(str));</span><br><span class="line"><span class="keyword">var</span> decoded_str = <span class="built_in">decodeURIComponent</span>(atob(encoded_str));</span><br><span class="line"><span class="built_in">console</span>.log(encoded_str); <span class="comment">// Outputs: "aGVsbG8lMkMlRTQlQjglQUQlRTUlOUIlQkQ="</span></span><br><span class="line"><span class="built_in">console</span>.log(decoded_str); <span class="comment">// Outputs: "hello,中国"</span></span><br></pre></td></tr></table></figure><h2 id="通用的编解码方法"><a href="#通用的编解码方法" class="headerlink" title="通用的编解码方法"></a>通用的编解码方法</h2><p>对于IE9不支持这两种编码解码方式，可以使用公共类库来兼容IE9：<br><strong>如下函数实现了Base64、Hex、Bytes、String之间的互相转换</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base64EncodeChars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>,</span><br><span class="line">    base64DecodeChars = <span class="keyword">new</span> <span class="built_in">Array</span>((<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), <span class="number">62</span>, (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), <span class="number">63</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>), (<span class="number">-1</span>));</span><br><span class="line"><span class="keyword">var</span> base64encode = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t;</span><br><span class="line">    <span class="keyword">for</span> (c = e.length, a = <span class="number">0</span>, r = <span class="string">''</span>; a &lt; c;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e.charCodeAt(a++), a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span>),</span><br><span class="line">                r += <span class="string">'=='</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o = e.charCodeAt(a++), a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">                r += <span class="string">'='</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        t = e.charCodeAt(a++),</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span> | (<span class="number">192</span> &amp; t) &gt;&gt; <span class="number">6</span>),</span><br><span class="line">            r += base64EncodeChars.charAt(<span class="number">63</span> &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> base64decode = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t, d;</span><br><span class="line">    <span class="keyword">for</span> (t = e.length, o = <span class="number">0</span>, d = <span class="string">''</span>; o &lt; t;) &#123;</span><br><span class="line">        <span class="keyword">do</span> r = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; r == <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">do</span> a = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; a == <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode(r &lt;&lt; <span class="number">2</span> | (<span class="number">48</span> &amp; a) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (c = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == c) <span class="keyword">return</span> d;</span><br><span class="line">            c = base64DecodeChars[c]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; c == <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode((<span class="number">15</span> &amp; a) &lt;&lt; <span class="number">4</span> | (<span class="number">60</span> &amp; c) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == h) <span class="keyword">return</span> d;</span><br><span class="line">            h = base64DecodeChars[h]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; h == <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (h == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode((<span class="number">3</span> &amp; c) &lt;&lt; <span class="number">6</span> | h)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> hexToBytes = <span class="function"><span class="keyword">function</span> (<span class="params">hex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> bytes = [], c = <span class="number">0</span>; c &lt; hex.length; c += <span class="number">2</span>)</span><br><span class="line">        bytes.push(<span class="built_in">parseInt</span>(hex.substr(c, <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bytesToHex = <span class="function"><span class="keyword">function</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> hex = [], i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">        hex.push((bytes[i] &gt;&gt;&gt; <span class="number">4</span>).toString(<span class="number">16</span>));</span><br><span class="line">        hex.push((bytes[i] &amp; <span class="number">0xF</span>).toString(<span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hex.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bytesToString = <span class="function"><span class="keyword">function</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">    arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arr);</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        str += <span class="built_in">String</span>.fromCharCode(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stringToBytes = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ch, st, re = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        ch = str.charCodeAt(i);</span><br><span class="line">        st = [];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            st.push(ch &amp; <span class="number">0xFF</span>);</span><br><span class="line">            ch = ch &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (ch);</span><br><span class="line">        re = re.concat(st.reverse())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bytesToBase64 = <span class="function"><span class="keyword">function</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use browser-native function if it exists</span></span><br><span class="line">    <span class="comment">// if (typeof btoa == "function") return btoa(bytesToString(bytes));</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> base64 = [], i = <span class="number">0</span>; i &lt; bytes.length; i += <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> triplet = (bytes[i] &lt;&lt; <span class="number">16</span>) | (bytes[i + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | bytes[i + <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i * <span class="number">8</span> + j * <span class="number">6</span> &lt;= bytes.length * <span class="number">8</span>)</span><br><span class="line">                base64.push(base64EncodeChars.charAt((triplet &gt;&gt;&gt; <span class="number">6</span> * (<span class="number">3</span> - j)) &amp; <span class="number">0x3F</span>));</span><br><span class="line">            <span class="keyword">else</span> base64.push(<span class="string">"="</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> base64ToBytes = <span class="function"><span class="keyword">function</span> (<span class="params">base64</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use browser-native function if it exists</span></span><br><span class="line">    <span class="comment">// if (typeof atob == "function") return stringToBytes(atob(base64));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove non-base-64 characters</span></span><br><span class="line">    base64 = base64.replace(<span class="regexp">/[^A-Z0-9+\/]/ig</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> bytes = [], i = <span class="number">0</span>, imod4 = <span class="number">0</span>; i &lt; base64.length; imod4 = ++i % <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (imod4 == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        bytes.push(((base64EncodeChars.indexOf(base64.charAt(i - <span class="number">1</span>)) &amp; (<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">-2</span> * imod4 + <span class="number">8</span>) - <span class="number">1</span>)) &lt;&lt; (imod4 * <span class="number">2</span>)) |</span><br><span class="line">            (base64EncodeChars.indexOf(base64.charAt(i)) &gt;&gt;&gt; (<span class="number">6</span> - imod4 * <span class="number">2</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> hexToString = <span class="function"><span class="keyword">function</span> (<span class="params">hex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = hex.split(<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">var</span> out = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length / <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = <span class="string">"0x"</span> + arr[i * <span class="number">2</span>] + arr[i * <span class="number">2</span> + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">var</span> charValue = <span class="built_in">String</span>.fromCharCode(tmp);</span><br><span class="line">        out += charValue</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stringToHex = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val == <span class="string">""</span>)</span><br><span class="line">            val = str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            val += str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    val += <span class="string">"0a"</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> hexToBase64 = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base64encode(<span class="built_in">String</span>.fromCharCode.apply(<span class="literal">null</span>, str.replace(<span class="regexp">/\r|\n/g</span>, <span class="string">""</span>).replace(<span class="regexp">/([\da-fA-F]&#123;2&#125;) ?/g</span>, <span class="string">"0x$1 "</span>).replace(<span class="regexp">/ +$/</span>, <span class="string">""</span>).split(<span class="string">" "</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> base64ToHex = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">             bin = base64decode(str.replace(<span class="regexp">/[ \r\n]+$/</span>, <span class="string">""</span>)), hex = []; i &lt; bin.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = bin.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span> (tmp.length === <span class="number">1</span>) tmp = <span class="string">"0"</span> + tmp;</span><br><span class="line">        hex[hex.length] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hex.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> raw_hex = <span class="string">'f0c6'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(hexToBase64(raw_hex));</span><br><span class="line"><span class="built_in">console</span>.log(hexToString(raw_hex));</span><br><span class="line"><span class="built_in">console</span>.log(hexToBytes(raw_hex));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> raw_base64 = <span class="string">"8MY="</span>;</span><br><span class="line"><span class="built_in">console</span>.log(base64ToHex(raw_base64));</span><br><span class="line"><span class="built_in">console</span>.log(base64ToBytes(raw_base64));</span><br></pre></td></tr></table></figure><h1 id="Node-js中的Base64编码和解码"><a href="#Node-js中的Base64编码和解码" class="headerlink" title="Node.js中的Base64编码和解码"></a>Node.js中的Base64编码和解码</h1><p>不幸的是，Node.js不支持用于Base64编码的标准JavaScript函数，例如atob()和btoa()。这些方法是窗口对象的一部分，仅在浏览器中可用。<br>幸运的是，Node.js提供了一个称为Buffer的本地模块，可用于执行Base64编码和解码。缓冲区可用作全局对象，这意味着您无需在应用程序中显式包含此模块。</p><p>在内部，Buffer以字节序列的形式表示二进制数据。 Buffer对象提供了几种方法来执行不同的编码和解码转换。这包括往返于UTF-8，UCS2，Base64，ASCII，UTF-16甚至HEX编码方案。</p><p>让我们看下面的示例，这些示例解释了如何使用Buffer对象在Node.js应用程序中执行Base64编码和解码。</p><h2 id="Base64-编码"><a href="#Base64-编码" class="headerlink" title="Base64 编码"></a>Base64 编码</h2><p>要将字符串转换为Base64编码的字符串，我们首先需要使用Buffer.from()方法根据给定的字符串创建一个缓冲区。 此方法采用两个参数，即纯文本字符串和字符编码，并为给定的编码创建缓冲区或二进制数据数组。 如果未指定字符编码，则将使用UTF-8作为默认值。</p><p>这里有一个例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plain-text string</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'Base64 Encoding in Node.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a buffer</span></span><br><span class="line"><span class="keyword">const</span> buff = Buffer.from(str, <span class="string">'utf-8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// encode buffer as Base64</span></span><br><span class="line"><span class="keyword">const</span> base64 = buff.toString(<span class="string">'base64'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// print Base64 string</span></span><br><span class="line"><span class="built_in">console</span>.log(base64);</span><br><span class="line"></span><br><span class="line"><span class="comment">// QmFzZTY0IEVuY29kaW5nIGluIE5vZGUuanM=</span></span><br></pre></td></tr></table></figure><blockquote><p>在上面的示例中，我们从字符串创建了一个缓冲区，并使用toString()方法将缓冲区编码为Base64字符串。 当您处理纯文本（UTF-8）字符串时，Buffer.from()中的第二个参数是可选的。</p></blockquote><h2 id="Base64解码"><a href="#Base64解码" class="headerlink" title="Base64解码"></a>Base64解码</h2><p>Base64解码过程与编码过程非常相似。 您需要做的就是通过使用base64作为Buffer.from()的第二个参数从Base64编码字符串中创建一个缓冲区，然后使用toString()方法将其解码为UTF-8字符串。</p><p>看起来是这样的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base64 encoded string</span></span><br><span class="line"><span class="keyword">const</span> base64 = <span class="string">'QmFzZTY0IEVuY29kaW5nIGluIE5vZGUuanM='</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a buffer</span></span><br><span class="line"><span class="keyword">const</span> buff = Buffer.from(base64, <span class="string">'base64'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// decode buffer as UTF-8</span></span><br><span class="line"><span class="keyword">const</span> str = buff.toString(<span class="string">'utf-8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// print normal string</span></span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64 Encoding in Node.js</span></span><br></pre></td></tr></table></figure><h2 id="base64编解码并转成hex"><a href="#base64编解码并转成hex" class="headerlink" title="base64编解码并转成hex"></a>base64编解码并转成hex</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'JavaScript'</span>);</span><br><span class="line"><span class="keyword">var</span> s = b.toString(<span class="string">'base64'</span>);</span><br><span class="line"><span class="comment">// SmF2YVNjcmlwdA==</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'SmF2YVNjcmlwdA=='</span>, <span class="string">'base64'</span>)</span><br><span class="line"><span class="keyword">var</span> s = b.toString();</span><br><span class="line"><span class="comment">// JavaScript</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'SmF2YVNjcmlwdA=='</span>, <span class="string">'base64'</span>)</span><br><span class="line"><span class="keyword">var</span> s = b.toString(<span class="string">'hex'</span>);</span><br><span class="line"><span class="comment">// 4a617661536372697074</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'4a617661536372697074'</span>, <span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">var</span> s = b.toString(<span class="string">'utf8'</span>);</span><br><span class="line"><span class="comment">// JavaScript</span></span><br></pre></td></tr></table></figure><h2 id="node-js编码解码图片"><a href="#node-js编码解码图片" class="headerlink" title="node.js编码解码图片"></a>node.js编码解码图片</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// function to encode file data to base64 encoded string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64_encode</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// read binary data</span></span><br><span class="line">  <span class="keyword">var</span> bitmap = fs.readFileSync(file);</span><br><span class="line">  <span class="comment">// convert binary data to base64 encoded string</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Buffer(bitmap).toString(<span class="string">'base64'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function to create file from base64 encoded string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64_decode</span>(<span class="params">base64str, file</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// create buffer object from base64 encoded string, it is important to tell the constructor that the string is base64 encoded</span></span><br><span class="line">  <span class="keyword">var</span> bitmap = <span class="keyword">new</span> Buffer(base64str, <span class="string">'base64'</span>);</span><br><span class="line">  <span class="comment">// write buffer to file</span></span><br><span class="line">  fs.writeFileSync(file, bitmap);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'******** File created from base64 encoded string ********'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert image to base64 encoded string</span></span><br><span class="line"><span class="keyword">var</span> base64str = base64_encode(<span class="string">'kitten.jpg'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(base64str);</span><br><span class="line"><span class="comment">// convert base64 string back to image </span></span><br><span class="line">base64_decode(base64str, <span class="string">'copy.jpg'</span>);</span><br></pre></td></tr></table></figure><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>这就是Node.js中Base64编码和解码的全部内容。 我们研究了如何使用本机Buffer模块在Node.js应用程序中执行Base64编码和解码。 Buffer对象不仅限于Base64转换。 您甚至可以使用它执行ASCII，HEX，UTF-16和UCS2编码和解码。</p><h1 id="Base64编码的实际运用"><a href="#Base64编码的实际运用" class="headerlink" title="Base64编码的实际运用"></a>Base64编码的实际运用</h1><p>前端在实现页面时，对于一些简单图片，通常会选择将图片内容直接内嵌在页面中，避免不必要的外部资源加载，增大页面加载时间，但是图片数据是二进制数据，该怎么嵌入呢？绝大多数现代浏览器都支持一种名为 Data URL 的特性，允许使用Base64对图片或其他文件的二进制数据进行编码，将其作为文本字符串嵌入网页中。<br>可以使用在线图片编码工具<br><a href="http://tool.chinaz.com/tools/imgtobase/" target="_blank" rel="noopener">http://tool.chinaz.com/tools/imgtobase/</a><br>例如我编码了一张图片之后，其编码结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACRCAYAAAAl8ZFnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJ0SURBVHhe7dYxalRRFIBhl+AKXEzqNNZuwzKNnVZTBRtJkyUELCysBRtxHdM9El5k4MkLpMhwYQb8rd5XfN053c+599U0TQtUBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERWrzQd3//rXMtzdP7n/+GM5wvk0HNV/vluXN6xf+XL0fznKezQa1XqbjmJ49fL0b7nDaZoMaXadnjx8/DHc4bbNBrdGMYlqt/6nRDqcJ6sjh8mKZ9vvhDqcJ6ojn7t8ISlApQQkqJShBpQQlqJSgBJUSlKBSghJUSlCCSglKUClBCSolKEGlBCWolKAElRKUoFKCElRKUIJKCUpQKUEJKiUoQaUEJaiUoASVEpSgUoISVEpQgkoJSlApQQkqJShBpQQlqJSgBJUSlKBSghJUSlCCSglKUClBCSolKEGlBCWolKAElRKUoFKCElRKUIJKCUpQKUEJKiUoQaUEJaiUoASVEpSgUoISVEpQgkoJSlApQQkqJShBpQQlqJSgBJUSlKBSghJUSlCCSglKUClBCSolKEGlBCWolKAElRKUoFKCElRqu0HtPgnqP9hsUA/fvw2Dmm9vhvOcZ7NBrQ7v3r6I6XB5sUz7/XCW82w6qNX85fPTMzdf78QU2HxQtARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQpARFSlCkBEVKUKQERUpQhKblL8jJczAt5hHJAAAAAElFTkSuQmCC</span><br></pre></td></tr></table></figure><p>用此方式可以将图片直接内嵌到网页中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACRCA...&quot;/&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jb51.net/article/95352.htm&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jb51.net/article/95352.htm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_42420703/article/details/81384901&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/weixin_42420703/article/details/81384901&lt;/a&gt;&lt;h1 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h1&gt;为什么会有Base64编码呢？因为有些网络传送渠道并不支持所有的字节，例如传统的邮件只支持可见字符的传送，像ASCII码的控制字符就 不能通过邮件传送。这样用途就受到了很大的限制，比如图片二进制流的每个字节不可能全部是可见字符，所以就传送不了。最好的方法就是在不改变传统协议的情 况下，做一种扩展方案来支持二进制文件的传送。把不可打印的字符也能用可打印字符来表示，问题就解决了。Base64编码应运而生，Base64就是一种 基于64个可打印字符来表示二进制数据的表示方法。&lt;br&gt;所谓Base64，就是选出64个字符作为一个基本字符集（A-Z，a-z，0-9，+，/，再加上作为垫字的”=”，实际是65个字符），其它所有符号都转换成这个字符集中的字符。&lt;ul&gt;
&lt;li&gt;第一步，将每三个字节作为一组，一共是24个二进制位。&lt;/li&gt;
&lt;li&gt;第二步，将这24个二进制位分为四组，每个组有6个二进制位。&lt;/li&gt;
&lt;li&gt;第三步，在每组前面加两个00，扩展成32个二进制位，即四个字节。&lt;/li&gt;
&lt;li&gt;第四步，根据下表，得到扩展后的每个字节的对应符号，这就是Base64的编码值。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://gongzhao1.gitee.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="https://gongzhao1.gitee.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>python多线程和多进程</title>
    <link href="https://gongzhao1.gitee.io/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B/"/>
    <id>https://gongzhao1.gitee.io/python多线程和多进程/</id>
    <published>2020-12-24T13:50:41.000Z</published>
    <updated>2021-04-21T12:39:05.302Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><ul><li>进程是操作系统分配资源的最小单元, 线程是操作系统调度的最小单元。</li><li>一个应用程序至少包括1个进程，而1个进程包括1个或多个线程，线程的尺度更小。</li><li>每个进程在执行过程中拥有独立的内存单元，而一个进程的多个线程在执行过程中共享内存。<a id="more"></a><h1 id="python多线程"><a href="#python多线程" class="headerlink" title="python多线程"></a>python多线程</h1>python多线程有两种实现方式<ol><li>实例化一个threading.Thread的对象，并传入一个初始化函数对象（initial function )作为线程执行的入口</li><li>继承threading.Thread，并重写run函数</li></ol></li></ul><h2 id="多线程实现"><a href="#多线程实现" class="headerlink" title="多线程实现"></a>多线程实现</h2><p><strong>方式一</strong><br>创建threading.Thread对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tstart</span><span class="params">(arg)</span>:</span></span><br><span class="line"> time.sleep(<span class="number">0.5</span>)</span><br><span class="line"> print(<span class="string">"%s running...."</span> % arg)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"> t1 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 1'</span>,))</span><br><span class="line"> t2 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 2'</span>,))</span><br><span class="line"> t1.start()</span><br><span class="line"> t2.start()</span><br><span class="line"> print(<span class="string">"This is main function"</span>)</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This is main function</span><br><span class="line">This is thread 2 running....</span><br><span class="line">This is thread 1 running....</span><br></pre></td></tr></table></figure><p><strong>方式二</strong><br>继承threading.Thread，并重写run</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, thread_name)</span>:</span></span><br><span class="line">  <span class="comment"># step 1: call base __init__ function</span></span><br><span class="line">  super(CustomThread, self).__init__(name=thread_name)</span><br><span class="line">  self._tname = thread_name</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="comment"># step 2: overide run function</span></span><br><span class="line">  time.sleep(<span class="number">0.5</span>)</span><br><span class="line">  print(<span class="string">"This is %s running...."</span> % self._tname)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"> t1 = CustomThread(<span class="string">"thread 1"</span>)</span><br><span class="line"> t2 = CustomThread(<span class="string">"thread 2"</span>)</span><br><span class="line"> t1.start()</span><br><span class="line"> t2.start()</span><br><span class="line"> print(<span class="string">"This is main function"</span>)</span><br></pre></td></tr></table></figure><p> 结果<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> This is main function</span><br><span class="line">This is thread 2 running....</span><br><span class="line">This is thread 1 running....</span><br></pre></td></tr></table></figure></p><p>上面两种方法本质上都是直接或者间接使用threading.Thread类</p><blockquote><p>threading.Thread(group=None, target=None, name=None, args=(), kwargs={})</p></blockquote><p>关联上面两种创建线程的方式:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, thread_name, target = None)</span>:</span></span><br><span class="line">  <span class="comment"># step 1: call base __init__ function</span></span><br><span class="line">  super(CustomThread, self).__init__(name=thread_name, target=target, args = (thread_name,))</span><br><span class="line">  self._tname = thread_name</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="comment"># step 2: overide run function</span></span><br><span class="line">  <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">  <span class="comment"># print("This is %s running....@run" % self._tname)</span></span><br><span class="line">  super(CustomThread, self).run()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">target</span><span class="params">(arg)</span>:</span></span><br><span class="line"> time.sleep(<span class="number">0.5</span>)</span><br><span class="line"> print(<span class="string">"This is %s running....@target"</span> % arg)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"> t1 = CustomThread(<span class="string">"thread 1"</span>, target)</span><br><span class="line"> t2 = CustomThread(<span class="string">"thread 2"</span>, target)</span><br><span class="line"> t1.start()</span><br><span class="line"> t2.start()</span><br><span class="line"> print(<span class="string">"This is main function"</span>)</span><br></pre></td></tr></table></figure><p> 结果：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> This is main function</span><br><span class="line">This is thread 1 running....@target</span><br><span class="line">This is thread 2 running....@target</span><br></pre></td></tr></table></figure></p><p>上面这段代码说明：</p><ol><li>两种方式创建线程，指定的参数最终都会传给threading.Thread类；</li><li>传给线程的目标函数是在基类Thread的run函数体中被调用的，如果run没有被重写的话。</li></ol><p>threading模块的一些属性和方法可以参照官网，这里重点介绍一下threading.Thread对象的方法<br>下面是threading.Thread提供的线程对象方法和属性：</p><ul><li>start()：创建线程后通过start启动线程，等待CPU调度，为run函数执行做准备；</li><li>run()：线程开始执行的入口函数，函数体中会调用用户编写的target函数，或者执行被重载的run函数；</li><li>join([timeout])：阻塞挂起调用该函数的线程，直到被调用线程执行完成或超时。通常会在主线程中调用该方法，等待其他线程执行完成。</li><li>name、getName()&amp;setName()：线程名称相关的操作；</li><li>ident：整数类型的线程标识符，线程开始执行前（调用start之前）为None；</li><li>isAlive()、is_alive()：start函数执行之后到run函数执行完之前都为True；</li><li>daemon、isDaemon()&amp;setDaemon()：守护线程相关；</li></ul><p>这些是我们创建线程之后通过线程对象对线程进行管理和获取线程信息的方法。</p><h2 id="多线程执行"><a href="#多线程执行" class="headerlink" title="多线程执行"></a>多线程执行</h2><p>在主线程中创建若线程之后，他们之间没有任何协作和同步，除主线程之外每个线程都是从run开始被执行，直到执行完毕。<br><strong>join</strong><br>我们可以通过join方法让主线程阻塞，等待其创建的线程执行完成。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tstart</span><span class="params">(arg)</span>:</span></span><br><span class="line"> print(<span class="string">"%s running....at: %s"</span> % (arg,time.time()))</span><br><span class="line"> time.sleep(<span class="number">1</span>)</span><br><span class="line"> print(<span class="string">"%s is finished! at: %s"</span> % (arg,time.time()))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"> t1 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 1'</span>,))</span><br><span class="line"> t1.start()</span><br><span class="line"> t1.join() <span class="comment"># 当前线程阻塞，等待t1线程执行完成</span></span><br><span class="line"> print(<span class="string">"This is main function at：%s"</span> % time.time())</span><br></pre></td></tr></table></figure><p> 结果：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> This is thread 1 running....at: 1564906617.43</span><br><span class="line">This is thread 1 is finished! at: 1564906618.43</span><br><span class="line">This is main function at：1564906618.43</span><br></pre></td></tr></table></figure></p><p>如果不加任何限制，当主线程执行完毕之后，当前程序并不会结束，必须等到所有线程都结束之后才能结束当前进程。<br>将上面程序中的t1.join()去掉，执行结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This is thread 1 running....at: 1564906769.52</span><br><span class="line">This is main function at：1564906769.52</span><br><span class="line">This is thread 1 is finished! at: 1564906770.52</span><br></pre></td></tr></table></figure><p><strong>deamon守护线程</strong><br>可以通过将创建的线程指定为守护线程（daemon），这样主线程执行完毕之后会立即结束未执行完的线程，然后结束程序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tstart</span><span class="params">(arg)</span>:</span></span><br><span class="line">  print(<span class="string">"%s running....at: %s"</span> % (arg,time.time()))</span><br><span class="line">  time.sleep(<span class="number">1</span>)</span><br><span class="line">  print(<span class="string">"%s is finished! at: %s"</span> % (arg,time.time()))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  t1 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 1'</span>,))</span><br><span class="line">  t1.setDaemon(<span class="keyword">True</span>)</span><br><span class="line">  t1.start()</span><br><span class="line">  <span class="comment"># t1.join()  # 当前线程阻塞，等待t1线程执行完成</span></span><br><span class="line">  print(<span class="string">"This is main function at：%s"</span> % time.time())</span><br></pre></td></tr></table></figure><p>  结果：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  This is thread 1 running....at: 1564906847.85</span><br><span class="line">This is main function at：1564906847.85</span><br></pre></td></tr></table></figure></p><h1 id="python多进程"><a href="#python多进程" class="headerlink" title="python多进程"></a>python多进程</h1><p>相比较于threading模块用于创建python多线程，python提供multiprocessing用于创建多进程。先看一下创建进程的两种方式。</p><h2 id="多进程实现"><a href="#多进程实现" class="headerlink" title="多进程实现"></a>多进程实现</h2><p>创建进程的方式和创建线程的方式类似：<br>1.实例化一个multiprocessing.Process的对象，并传入一个初始化函数对象（initial function )作为新建进程执行入口；<br>2.继承multiprocessing.Process，并重写run函数；</p><p><strong>方式一</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process </span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pstart</span><span class="params">(name)</span>:</span></span><br><span class="line">  <span class="comment"># time.sleep(0.1)</span></span><br><span class="line">  print(<span class="string">"Process name: %s, pid: %s "</span>%(name, os.getpid()))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>: </span><br><span class="line">  subproc = Process(target=pstart, args=(<span class="string">'subprocess'</span>,)) </span><br><span class="line">  subproc.start() </span><br><span class="line">  subproc.join()</span><br><span class="line">  print(<span class="string">"subprocess pid: %s"</span>%subproc.pid)</span><br><span class="line">  print(<span class="string">"current process pid: %s"</span> % os.getpid())</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Process name: subprocess, pid: 4888 </span><br><span class="line">subprocess pid: 4888</span><br><span class="line">current process pid: 9912</span><br></pre></td></tr></table></figure><p><strong>方式二</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process </span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomProcess</span><span class="params">(Process)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, p_name, target=None)</span>:</span></span><br><span class="line">    <span class="comment"># step 1: call base __init__ function()</span></span><br><span class="line">    super(CustomProcess, self).__init__(name=p_name, target=target, args=(p_name,))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># step 2:</span></span><br><span class="line">    <span class="comment"># time.sleep(0.1)</span></span><br><span class="line">    print(<span class="string">"Custom Process name: %s, pid: %s "</span>%(self.name, os.getpid()))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  p1 = CustomProcess(<span class="string">"process_1"</span>)</span><br><span class="line">  p1.start()</span><br><span class="line">  p1.join()</span><br><span class="line">  print(<span class="string">"subprocess pid: %s"</span>%p1.pid)</span><br><span class="line">  print(<span class="string">"current process pid: %s"</span> % os.getpid())</span><br></pre></td></tr></table></figure><h1 id="python多进程和多线程比较"><a href="#python多进程和多线程比较" class="headerlink" title="python多进程和多线程比较"></a>python多进程和多线程比较</h1><p>先来看两个例子：</p><p>开启两个python线程分别做一亿次加一操作，和单独使用一个线程做一亿次加一操作：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tstart</span><span class="params">(arg)</span>:</span></span><br><span class="line">  var = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">100000000</span>):</span><br><span class="line">    var += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  t1 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 1'</span>,))</span><br><span class="line">  t2 = threading.Thread(target=tstart, args=(<span class="string">'This is thread 2'</span>,))</span><br><span class="line">  start_time = time.time()</span><br><span class="line">  t1.start()</span><br><span class="line">  t2.start()</span><br><span class="line">  t1.join()</span><br><span class="line">  t2.join()</span><br><span class="line">  print(<span class="string">"Two thread cost time: %s"</span> % (time.time() - start_time))</span><br><span class="line">  start_time = time.time()</span><br><span class="line">  tstart(<span class="string">"This is thread 0"</span>)</span><br><span class="line">  print(<span class="string">"Main thread cost time: %s"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Two thread cost time: 20.6570000648</span><br><span class="line">Main thread cost time: 2.52800011635</span><br></pre></td></tr></table></figure><p>使用两个进程进行上面的操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pstart</span><span class="params">(arg)</span>:</span></span><br><span class="line">  var = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">100000000</span>):</span><br><span class="line">    var += <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  p1 = Process(target = pstart, args = (<span class="string">"1"</span>, ))</span><br><span class="line">  p2 = Process(target = pstart, args = (<span class="string">"2"</span>, ))</span><br><span class="line">  start_time = time.time()</span><br><span class="line">  p1.start()</span><br><span class="line">  p2.start()</span><br><span class="line">  p1.join()</span><br><span class="line">  p2.join()</span><br><span class="line">  print(<span class="string">"Two process cost time: %s"</span> % (time.time() - start_time))</span><br><span class="line">  start_time = time.time()</span><br><span class="line">  pstart(<span class="string">"0"</span>)</span><br><span class="line">  print(<span class="string">"Current process cost time: %s"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Two process cost time: 2.91599988937</span><br><span class="line">Current process cost time: 2.52400016785</span><br></pre></td></tr></table></figure><p><strong>对比分析</strong><br>双进程并行执行和单进程执行相同的运算代码，耗时基本相同，双进程耗时会稍微多一些，可能的原因是进程创建和销毁会进行系统调用，造成额外的时间开销。</p><p>但是对于python线程，双线程并行执行耗时比单线程要高的多，效率相差近10倍。如果将两个并行线程改成串行执行，即：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.start()</span><br><span class="line">t2.join()</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Two thread cost time: 5.12199997902</span><br><span class="line">Main thread cost time: 2.54200005531</span><br></pre></td></tr></table></figure><p>可以看到三个线程串行执行，每一个执行的时间基本相同。</p><p>本质原因双线程是并发执行的，而不是真正的并行执行。原因就在于GIL锁。<br><strong>GIL锁</strong><br>提起python多线程就不得不提一下GIL(Global Interpreter Lock 全局解释器锁)，这是目前占统治地位的python解释器CPython中为了保证数据安全所实现的一种锁。不管进程中有多少线程，只有拿到了GIL锁的线程才可以在CPU上运行，即时是多核处理器。对一个进程而言，不管有多少线程，任一时刻，只会有一个线程在执行。对于CPU密集型的线程，其效率不仅仅不高，反而有可能比较低。python多线程比较适用于IO密集型的程序。对于的确需要并行运行的程序，可以考虑多进程。</p><p>多线程对锁的争夺，CPU对线程的调度，线程之间的切换等均会有时间开销。<br><strong>下面简单的比较一下线程与进程</strong></p><ul><li>进程是资源分配的基本单位，线程是CPU执行和调度的基本单位；</li><li>通信/同步方式：<ul><li>进程：<ul><li>通信方式：管道，FIFO，消息队列，信号，共享内存，socket，stream流；</li><li>同步方式：PV信号量，管程</li></ul></li><li>线程：<ul><li>同步方式：互斥锁，递归锁，条件变量，信号量</li><li>通信方式：位于同一进程的线程共享进程资源，因此线程间没有类似于进程间用于数据传递的通信方式，线程间的通信主要是用于线程同步。</li></ul></li></ul></li><li>CPU上真正执行的是线程，线程比进程轻量，其切换和调度代价比进程要小；</li><li>线程间对于共享的进程数据需要考虑线程安全问题，由于进程之间是隔离的，拥有独立的内存空间资源，相对比较安全，只能通过上面列出的IPC(Inter-Process Communication)进行数据传输；</li><li>系统有一个个进程组成，每个进程包含代码段、数据段、堆空间和栈空间，以及操作系统共享部分 ，有等待，就绪和运行三种状态；</li><li>一个进程可以包含多个线程，线程之间共享进程的资源（文件描述符、全局变量、堆空间等），寄存器变量和栈空间等是线程私有的；</li><li>操作系统中一个进程挂掉不会影响其他进程，如果一个进程中的某个线程挂掉而且OS对线程的支持是多对一模型，那么会导致当前进程挂掉；</li><li>如果CPU和系统支持多线程与多进程，多个进程并行执行的同时，每个进程中的线程也可以并行执行，这样才能最大限度的榨取硬件的性能；</li></ul><p><strong>线程和进程的上下文切换</strong><br>进程切换过程切换牵涉到非常多的东西，寄存器内容保存到任务状态段TSS，切换页表，堆栈等。简单来说可以分为下面两步：</p><ol><li>页全局目录切换，使CPU到新进程的线性地址空间寻址；</li><li>切换内核态堆栈和硬件上下文，硬件上下文包含CPU寄存器的内容，存放在TSS中；</li></ol><p>线程运行于进程地址空间，切换过程不涉及到空间的变换，只牵涉到第二步；<br><strong>使用多线程还是多进程</strong></p><ul><li>CPU密集型：程序需要占用CPU进行大量的运算和数据处理；</li><li>I/O密集型：程序中需要频繁的进行I/O操作；例如网络中socket数据传输和读取等；</li></ul><p>由于python多线程并不是并行执行，因此较适合与I/O密集型程序，多进程并行执行适用于CPU密集型程序；</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;进程是操作系统分配资源的最小单元, 线程是操作系统调度的最小单元。&lt;/li&gt;
&lt;li&gt;一个应用程序至少包括1个进程，而1个进程包括1个或多个线程，线程的尺度更小。&lt;/li&gt;
&lt;li&gt;每个进程在执行过程中拥有独立的内存单元，而一个进程的多个线程在执行过程中共享内存。
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python3之os,shutil模块</title>
    <link href="https://gongzhao1.gitee.io/python3%E4%B9%8Bos-shutil%E6%A8%A1%E5%9D%97/"/>
    <id>https://gongzhao1.gitee.io/python3之os-shutil模块/</id>
    <published>2020-12-23T14:57:45.000Z</published>
    <updated>2021-04-21T12:39:05.295Z</updated>
    
    <content type="html"><![CDATA[<p>Python的os和shutil模块封装了常见的文件和目录操作如copy，cd，mv，rm以及解压等等操作。<br>直接看用法<br>首先import</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import os, shutil</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="shutil模块"><a href="#shutil模块" class="headerlink" title="shutil模块"></a>shutil模块</h1><p>shutil可以简单地理解为sh + util，shell工具的意思。shutil模块是对os模块的补充，主要针对文件的拷贝、删除、移动、压缩和解压操作。<br><strong>拷贝文件</strong><br>shutil会自动识别拷贝的到底是文件还是文件夹, 如果存在同名的文件将会自动进行覆盖。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutil.copy($file_path, $dir_path)</span><br></pre></td></tr></table></figure><p><strong>移动或重命名文件</strong><br>但如果路径下已有重名的文件，将报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutil.move($file_path, $dir_path) # 移动到另外一个文件夹中</span><br><span class="line">shutil.move($file_path, $new_file_path) # 重命名为新的绝对路径</span><br></pre></td></tr></table></figure><p><strong>拷贝文件夹/删除文件夹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutil.copytree($file_path, $dir_path) # 拷贝所有文件到新的文件夹下，保持原有的文件结构。</span><br><span class="line">shutil.rmtree($dir_path) # 删除此路径的文件夹</span><br></pre></td></tr></table></figure><p><strong>生成压缩文件</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutil.make_archive(base_name, &apos;gztar&apos;, root_dir, [base_dir)</span><br></pre></td></tr></table></figure><ul><li>base_name : 创建的目标文件名，包括路径，减去任何特定格式的扩展。</li><li>format : 压缩包格式。”zip”, “tar”, “bztar”或”gztar”中的一个。</li><li>root_dir : 需要打包的文件夹路径。打包完成时存储在上一级目录。</li><li>base_dir : 使用后会将base_dir作为路径，解压后有个有层级的文件夹，而仅非只有单独的打包内容。</li></ul><p><strong>解压文件</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutil.unpack_archive(filename[, extract_dir[, format]])</span><br></pre></td></tr></table></figure><ul><li>filename是压缩文档的完整路径</li><li>extract_dir是解压缩路径，默认为当前目录。</li><li>format是压缩格式。默认使用文件后缀名代码的压缩格式。”zip”, “tar”, “bztar”或”gztar”中的一个。</li></ul><h1 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h1><p>Python的os模块封装了常见的文件和目录操作<br><strong>判断使用的平台</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 获取平台名称</span><br><span class="line">os.name</span><br><span class="line"># 获取系统的核心数</span><br><span class="line">os.cpu_count()</span><br></pre></td></tr></table></figure><p><strong>工作目录与路径相关的操作</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 获取路径和文件名等</span><br><span class="line">os.getcwd()    函数得到当前工作目录，即当前Python脚本工作的目录路径</span><br><span class="line">os.path.abspath($name)  当前目录下文件或文件夹的绝对路径</span><br><span class="line">os.path.basename(path)   返回文件名</span><br><span class="line">os.path.dirname(path)    返回文件的上级路径</span><br><span class="line">os.path.split()          分离文件名和上级路径</span><br><span class="line">os.path.join()           合并文件名和指定路径</span><br><span class="line">os.path.splitext()      分离文件名与扩展名，返回的扩展名包括了&apos;.&apos;符号，默认只返回第一个&apos;.后缀&apos;和前缀。</span><br><span class="line"></span><br><span class="line"># 改变工作目录到dirname</span><br><span class="line">os.chdir($dirname)</span><br><span class="line"></span><br><span class="line"># 列出路径中的文件</span><br><span class="line">os.listdir($path)  返回指定目录下的所有文件和目录名</span><br><span class="line"></span><br><span class="line"># 创建、重命名文件夹</span><br><span class="line">os.mkdir($path)    创建一个目录</span><br><span class="line">os.rmdir($path)    删除一个目录</span><br><span class="line">os.rename(src, dst)  记得不能有同名文件存在</span><br><span class="line"></span><br><span class="line"># 获取文件大小信息</span><br><span class="line">os.path.getsize(name)    获得文件大小，如果name是目录返回0L</span><br><span class="line"></span><br><span class="line"># 改变权限</span><br><span class="line">os.chmod(path, mode)</span><br></pre></td></tr></table></figure><p><strong>判断文件是否存在</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.path.isfile()   函数分别检验给出的路径是一个文件?</span><br><span class="line">os.path.isdir()    函数分别检验给出的路径是一个目录?</span><br><span class="line">os.path.exists()   函数用来检验给出的路径是否真地存在</span><br></pre></td></tr></table></figure><p><strong>执行外部shell命令</strong><br>推荐使用subprocess模块替代</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.system(&apos;&apos;)      执行外部shell命令。</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Python的os和shutil模块封装了常见的文件和目录操作如copy，cd，mv，rm以及解压等等操作。&lt;br&gt;直接看用法&lt;br&gt;首先import&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;import os, shutil&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python3-base64加密</title>
    <link href="https://gongzhao1.gitee.io/python3-base64%E5%8A%A0%E5%AF%86/"/>
    <id>https://gongzhao1.gitee.io/python3-base64加密/</id>
    <published>2020-12-23T14:25:57.000Z</published>
    <updated>2021-04-21T12:39:05.294Z</updated>
    
    <content type="html"><![CDATA[<p>在python3中base64模块中的参数是字节流，不是字符串，所以python3 base64加密字符串有两种写法</p><h1 id="普通字符串编解码"><a href="#普通字符串编解码" class="headerlink" title="普通字符串编解码"></a>普通字符串编解码</h1><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p><strong>方法一：字符串切割</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import base64</span><br><span class="line">&gt;&gt;&gt; a = &apos;string&apos;</span><br><span class="line">&gt;&gt;&gt; encrypt = base64.b64encode(a.encode(&apos;utf-8&apos;))</span><br><span class="line">&gt;&gt;&gt; encrypt</span><br><span class="line">b&apos;c3RyaW5n&apos;</span><br><span class="line">&gt;&gt;&gt; b = str(encrypt)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">&quot;b&apos;c3RyaW5n&apos;&quot;</span><br><span class="line">&gt;&gt;&gt; print(b[2:-1])</span><br><span class="line">c3RyaW5n</span><br></pre></td></tr></table></figure><p><strong>方法二：直接转换操作</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import base64</span><br><span class="line">&gt;&gt;&gt; a = &apos;testzifuchuan&apos;</span><br><span class="line">&gt;&gt;&gt; d = base64.b64encode(a.encode(&apos;utf-8&apos;))</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">b&apos;dGVzdHppZnVjaHVhbg==&apos;</span><br><span class="line">&gt;&gt;&gt; d.decode(&apos;utf-8&apos;)</span><br><span class="line">&apos;dGVzdHppZnVjaHVhbg==&apos;</span><br><span class="line">&gt;&gt;&gt; str(d,&apos;utf-8&apos;)</span><br><span class="line">&apos;dGVzdHppZnVjaHVhbg==&apos;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">'testzifuchuan'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = base64.b64encode(a.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line"><span class="string">b'dGVzdHppZnVjaHVhbg=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'dGVzdHppZnVjaHVhbg=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(d.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="string">b'testzifuchuan'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(d.decode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'testzifuchuan'</span></span><br></pre></td></tr></table></figure><h1 id="将十六进制字符串用base64编解码"><a href="#将十六进制字符串用base64编解码" class="headerlink" title="将十六进制字符串用base64编解码"></a>将十六进制字符串用base64编解码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg = <span class="string">"f0c6"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = bytes.fromhex(msg) <span class="comment">#将hex的数据转换为str,并以Byte 形式存储</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">b'\xf0\xc6'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>encoded = base64.b64encode(s) <span class="comment">#base64编码后的形式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>encoded</span><br><span class="line"><span class="string">b'8MY='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(encoded)[<span class="number">2</span>:<span class="number">-1</span>] <span class="comment">#转成字符串</span></span><br><span class="line"><span class="string">'8MY='</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>decoded = base64.b64decode(encoded) <span class="comment">#解码</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>decoded</span><br><span class="line"><span class="string">b'\xf0\xc6'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>decoded.hex() <span class="comment">#将byte转换成16进制字符串</span></span><br><span class="line"><span class="string">'f0c6'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在python3中base64模块中的参数是字节流，不是字符串，所以python3 base64加密字符串有两种写法&lt;/p&gt;
&lt;h1 id=&quot;普通字符串编解码&quot;&gt;&lt;a href=&quot;#普通字符串编解码&quot; class=&quot;headerlink&quot; title=&quot;普通字符串编解码&quot;&gt;&lt;/a&gt;普通字符串编解码&lt;/h1&gt;&lt;h2 id=&quot;编码&quot;&gt;&lt;a href=&quot;#编码&quot; class=&quot;headerlink&quot; title=&quot;编码&quot;&gt;&lt;/a&gt;编码&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;方法一：字符串切割&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; import base64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; a = &amp;apos;string&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; encrypt = base64.b64encode(a.encode(&amp;apos;utf-8&amp;apos;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; encrypt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b&amp;apos;c3RyaW5n&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; b = str(encrypt)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;b&amp;apos;c3RyaW5n&amp;apos;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; print(b[2:-1])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;c3RyaW5n&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;方法二：直接转换操作&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; import base64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; a = &amp;apos;testzifuchuan&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; d = base64.b64encode(a.encode(&amp;apos;utf-8&amp;apos;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b&amp;apos;dGVzdHppZnVjaHVhbg==&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; d.decode(&amp;apos;utf-8&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;apos;dGVzdHppZnVjaHVhbg==&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; str(d,&amp;apos;utf-8&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;apos;dGVzdHppZnVjaHVhbg==&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
      <category term="base64" scheme="https://gongzhao1.gitee.io/tags/base64/"/>
    
  </entry>
  
  <entry>
    <title>keytool常用命令</title>
    <link href="https://gongzhao1.gitee.io/keytool%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://gongzhao1.gitee.io/keytool常用命令/</id>
    <published>2020-09-29T07:06:02.000Z</published>
    <updated>2021-04-21T12:39:05.294Z</updated>
    
    <content type="html"><![CDATA[<h1 id="keyStore和truststore区别"><a href="#keyStore和truststore区别" class="headerlink" title="keyStore和truststore区别"></a>keyStore和truststore区别</h1><p>我们自己的应用中通常所说的keystore或者truststore主要是针对于应用本身的需求来的。<br>keystore和truststore从其文件格式来看其实是一个东西，只是为了方便管理将其分开<br>keystore中一般保存的是我们的私钥，用来加解密或者为别人做签名<br><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/xiaoshujiang/2020/9/29/1601393391033.png" alt="enter description here"><br>truststore中保存的是一些可信任的证书，主要是java在代码中访问某个https的时候对被访问者进行认证的，以确保其实可信任的。truststore是必须的，如果我们没有显式的指定，那么java会默认指定为$JAVA_HOME/lib/security/cacerts 这个文件。<br>如果要指定的话，可以在java的参数中进行指定</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-Djavax.net.ssl.keyStore=clientKeys   </span><br><span class="line">-Djavax.net.ssl.keyStorePassword=password   </span><br><span class="line">-Djavax.net.ssl.trustStore=clientTrust   </span><br><span class="line">-Djavax.net.ssl.trustStorePassword=password</span><br></pre></td></tr></table></figure><p>keystore可以看成一个放key的库，key就是公钥，私钥，数字签名等组成的一个信息。</p><p>truststore是放信任的证书的一个store。</p><p>truststore和keystore的性质是一样的，都是存放key的一个仓库，区别在于，truststore里存放的是只包含公钥的数字证书，代表了可以信任的证书，而keystore是包含私钥的。</p><a id="more"></a><h1 id="Keytool常用命令"><a href="#Keytool常用命令" class="headerlink" title="Keytool常用命令"></a>Keytool常用命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">keytool密钥和证书管理工具</span><br><span class="line"></span><br><span class="line">命令:</span><br><span class="line"></span><br><span class="line"> -certreq            生成证书请求</span><br><span class="line"> -changealias        更改条目的别名</span><br><span class="line"> -delete             删除条目</span><br><span class="line"> -exportcert         导出证书</span><br><span class="line"> -genkeypair         生成密钥对</span><br><span class="line"> -genseckey          生成密钥</span><br><span class="line"> -gencert            根据证书请求生成证书</span><br><span class="line"> -importcert         导入证书或证书链</span><br><span class="line"> -importpass         导入口令</span><br><span class="line"> -importkeystore     从其他密钥库导入一个或所有条目</span><br><span class="line"> -keypasswd          更改条目的密钥口令</span><br><span class="line"> -list               列出密钥库中的条目</span><br><span class="line"> -printcert          打印证书内容</span><br><span class="line"> -printcertreq       打印证书请求的内容</span><br><span class="line"> -printcrl           打印 CRL 文件的内容</span><br><span class="line"> -storepasswd        更改密钥库的存储口令</span><br><span class="line"></span><br><span class="line">使用 &quot;keytool -help&quot; 获取所有可用命令</span><br><span class="line">使用 &quot;keytool -command_name -help&quot; 获取 command_name 的用法</span><br></pre></td></tr></table></figure><h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><p>生成jks格式的keystore</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkeypair -alias abc -keyalg RSA -keypass abc -keystore abc.jks -storepass abc -validity 3650</span><br></pre></td></tr></table></figure><p>可以将jks格式的keystore转化成pfx格式<br>jks-&gt;p12</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -v -importkeystore -srckeystore abc.jks -srcstoretype jks -srcstorepass abc -destkeystore abc.pfx -deststoretype pkcs12 -deststorepass abc -destkeypass abc</span><br></pre></td></tr></table></figure><p>p12-&gt;jks</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -srckeystore keystore.p12 -srcstoretype PKCS12 -deststoretype JKS -destkeystore keystore.jks</span><br></pre></td></tr></table></figure><p>将现有p12证书导入至jks格式的keystore中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -destkeystore keystore.jks -srckeystore server.p12 -srcstoretype PKCS12 -alias 1 -storepass daniel</span><br><span class="line">or</span><br><span class="line">keytool -importkeystore -deststorepass changeit -destkeypass changeit -destkeystore bbb.jks -deststoretype jks -srckeystore aaa.jks -srcstoretype jks -srcstorepass changeit -alias tomcat</span><br></pre></td></tr></table></figure><h2 id="提取公钥"><a href="#提取公钥" class="headerlink" title="提取公钥"></a>提取公钥</h2><p>用keytool只能提取cert格式的公钥<br>从jks导出cert</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -rfc -keystore abc.jks -storepass abc</span><br><span class="line">or</span><br><span class="line">keytool -export -alias cert0001 -keystore trust.jks -storepass 123456 -file cert0001.cer</span><br></pre></td></tr></table></figure><p>通过openssl可以提取PUBLIC KEY格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过通道符号把cert格式转成public key格式</span><br><span class="line">keytool -list -rfc --keystore wood.jks | openssl x509 -inform pem -pubkey</span><br></pre></td></tr></table></figure><h2 id="导入公钥"><a href="#导入公钥" class="headerlink" title="导入公钥"></a>导入公钥</h2><p>将cert导入jks,生成truststore</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -import -v -alias cert001 -file cert001.cer -keystore trust.jks -storepass 123456 -noprompt</span><br></pre></td></tr></table></figure><h2 id="提取私钥"><a href="#提取私钥" class="headerlink" title="提取私钥"></a>提取私钥</h2><p>需要把证书先转成pfx格式<br>jks-&gt;p12</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -v -importkeystore -srckeystore abc.jks -srcstoretype jks -srcstorepass abc -destkeystore abc.pfx -deststoretype pkcs12 -deststorepass abc -destkeypass abc</span><br></pre></td></tr></table></figure><p>利用p12提取私钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -in abc.pfx -nocerts -nodes -out abc.key</span><br></pre></td></tr></table></figure><h1 id="用keytool创建Keystore和Truststore文件"><a href="#用keytool创建Keystore和Truststore文件" class="headerlink" title="用keytool创建Keystore和Truststore文件"></a>用keytool创建Keystore和Truststore文件</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>1.目的：JSSE使用Truststore和Keystore文件来提供客户端和服务器之间的安全数据传输。</p><p>2.描述：Keytool 是一个Java数据证书的管理工具 ,Keytool将密钥（key）和证书（certificates）存在一个称为keystore的文件中. 在keystore里，包含两种数据:密钥实体（Key entity）-密钥（secret key）或者是私钥和配对公钥（采用非对称加密）;可信任的证书实体（trusted certificate entries）-只包含公钥.</p><p>即：keytool是一个工具可以用来创建包含公钥和密钥的的keystore文件，并且利用keystore文件来创建只包含公钥的truststore文件。 </p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="生成一个含有一个私钥的keystore文件"><a href="#生成一个含有一个私钥的keystore文件" class="headerlink" title="生成一个含有一个私钥的keystore文件"></a>生成一个含有一个私钥的keystore文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -alias certificatekey  -keyalg RSA -validity 700  -keystore keystore.jks</span><br></pre></td></tr></table></figure><p>说明： </p><ul><li>genkey：在用户主目录中创建一个默认文件”.keystore”,还会产生一个mykey的别名，mykey中包含用户的公钥、私钥和证书 </li><li>alias:别名 </li><li>keyalg:指定密钥的算法（如：RSA ,DSA  默认值为：DSA） </li><li>validity: 指定创建的证书有效期多少天(默认 90) </li><li>keystore: 指定密钥库的名称( 产生的各类信息将不在.keystore文件中,而是在keystore.jks中)   </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -genkey -alias certificatekey  -keyalg RSA -validity 700  -keystore keystore.jks</span><br><span class="line"></span><br><span class="line">输入密钥库口令:*****</span><br><span class="line">再次输入新口令:*****</span><br><span class="line">您的名字与姓氏是什么?</span><br><span class="line">  [Unknown]:  peng...</span><br><span class="line">您的组织单位名称是什么?</span><br><span class="line">  [Unknown]:  asia..</span><br><span class="line">您的组织名称是什么?</span><br><span class="line">  [Unknown]:  mall</span><br><span class="line">您所在的城市或区域名称是什么?</span><br><span class="line">  [Unknown]:  beijing</span><br><span class="line">您所在的省/市/自治区名称是什么?</span><br><span class="line">  [Unknown]:  beijing</span><br><span class="line">该单位的双字母国家/地区代码是什么?</span><br><span class="line">  [Unknown]:  ZG</span><br><span class="line">CN=peng..., OU=..., O=mall, L=beijing, ST=beijing, C=ZG是否正确?</span><br><span class="line">  [否]:  Y</span><br><span class="line"></span><br><span class="line">输入 &lt;certificatekey&gt; 的密钥口令:****</span><br><span class="line">  (如果和密钥库口令相同, 按回车):</span><br><span class="line">再次输入新口令:****</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3 id="验证生成的keystore文件和证书信息"><a href="#验证生成的keystore文件和证书信息" class="headerlink" title="验证生成的keystore文件和证书信息"></a>验证生成的keystore文件和证书信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -list -v -keystore keystore.jks -alias certificatekey</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -list -v -keystore keystore.jks</span><br><span class="line">输入密钥库口令:****</span><br><span class="line">密钥库类型: JKS</span><br><span class="line">密钥库提供方: SUN</span><br><span class="line">您的密钥库包含 1 个条目</span><br><span class="line">别名: certificatekey</span><br><span class="line">创建日期: 2015-11-25</span><br><span class="line">条目类型: PrivateKeyEntry</span><br><span class="line">证书链长度: 1</span><br><span class="line">证书[1]:</span><br><span class="line">所有者: CN=peng.., OU=asiai.., O=mall, L=beijing, ST=beijing, C=ZG</span><br><span class="line">发布者: CN=peng.., OU=asia.., O=mall, L=beijing, ST=beijing, C=ZG</span><br><span class="line">序列号: 51c8a241</span><br><span class="line">有效期开始日期: Wed Nov 25 15:37:07 CST 2015, 截止日期: Wed Oct 25 15:37:07 CST 2017</span><br><span class="line">证书指纹:</span><br><span class="line">   MD5: 9B:A7:CC:B4:2B:E2:31:F0:7A:E0:36:..</span><br><span class="line">   SHA1: 4E:45:3A:A2:4F:B7:BA:84:0A:F2:CF:E....</span><br><span class="line">   SHA256: 5F:4B:8..</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><h3 id="从keystore-jks导出公钥证书"><a href="#从keystore-jks导出公钥证书" class="headerlink" title="从keystore.jks导出公钥证书"></a>从keystore.jks导出公钥证书</h3><p>用keytool只能提取cert格式的公钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -export -alias  certificatekey -keystore keystore.jks -rfc -file gongyaoCert.cer</span><br><span class="line">输入密钥库口令:*******</span><br><span class="line">存储在文件 &lt;gongyaoCert.cer&gt; 中的证书</span><br></pre></td></tr></table></figure><h3 id="Truststore的生成以及公钥证书的导入"><a href="#Truststore的生成以及公钥证书的导入" class="headerlink" title="Truststore的生成以及公钥证书的导入"></a>Truststore的生成以及公钥证书的导入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -import -alias certificatekey  -file gongyaoCert.cer  -keystore truststore.jks</span><br><span class="line"></span><br><span class="line">输入密钥库口令:******</span><br><span class="line">再次输入新口令:******</span><br><span class="line"></span><br><span class="line">所有者: CN=peng.., OU=asia.., O=mall, L=beijing, ST=beijing, C=ZG</span><br><span class="line">发布者: CN=peng..., OU=asi..., O=mall, L=beijing, ST=beijing, C=ZG</span><br><span class="line"></span><br><span class="line">序列号: 51c8a24</span><br><span class="line">有效期开始日期: Wed Nov 25 15:37:07 CST 2015, 截止日期: Wed Oct 25 15:37:07 CST 2017</span><br><span class="line">证书指纹:</span><br><span class="line">   MD5: 9B:A7:CC:B4:2B:E2:31:F0:7A:E...</span><br><span class="line">   SHA1: 4E:45:3A:A2:4F:B7:BA:84:0A:F2....</span><br><span class="line">   SHA256: 5F:4B:8B:43:BA:A1:60:B0:3A:C5:71:CB:4E:C4:0A:B....</span><br><span class="line">   签名算法名称: SHA2...</span><br><span class="line">   版本: 3</span><br><span class="line">扩展:</span><br><span class="line">#1: ObjectId: 2.5.29.14 Criticality=false</span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">   KeyIdentifier [</span><br><span class="line">        0000: ED 64 B3 D4 34 6E 84 28 ..... DB  .d..4n.(!..uw/..</span><br><span class="line">        0010: 57 9D B6 44                                        W..D</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line">是否信任此证书? [否]:  y</span><br><span class="line">证书已添加到密钥库中</span><br></pre></td></tr></table></figure><h3 id="验证公钥truststore-jks文件"><a href="#验证公钥truststore-jks文件" class="headerlink" title="验证公钥truststore.jks文件"></a>验证公钥truststore.jks文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -list -v -keystore truststore.jks</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;keyStore和truststore区别&quot;&gt;&lt;a href=&quot;#keyStore和truststore区别&quot; class=&quot;headerlink&quot; title=&quot;keyStore和truststore区别&quot;&gt;&lt;/a&gt;keyStore和truststore区别&lt;/h1&gt;&lt;p&gt;我们自己的应用中通常所说的keystore或者truststore主要是针对于应用本身的需求来的。&lt;br&gt;keystore和truststore从其文件格式来看其实是一个东西，只是为了方便管理将其分开&lt;br&gt;keystore中一般保存的是我们的私钥，用来加解密或者为别人做签名&lt;br&gt;&lt;img src=&quot;https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/xiaoshujiang/2020/9/29/1601393391033.png&quot; alt=&quot;enter description here&quot;&gt;&lt;br&gt;truststore中保存的是一些可信任的证书，主要是java在代码中访问某个https的时候对被访问者进行认证的，以确保其实可信任的。truststore是必须的，如果我们没有显式的指定，那么java会默认指定为$JAVA_HOME/lib/security/cacerts 这个文件。&lt;br&gt;如果要指定的话，可以在java的参数中进行指定&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-Djavax.net.ssl.keyStore=clientKeys   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Djavax.net.ssl.keyStorePassword=password   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Djavax.net.ssl.trustStore=clientTrust   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Djavax.net.ssl.trustStorePassword=password&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;keystore可以看成一个放key的库，key就是公钥，私钥，数字签名等组成的一个信息。&lt;/p&gt;
&lt;p&gt;truststore是放信任的证书的一个store。&lt;/p&gt;
&lt;p&gt;truststore和keystore的性质是一样的，都是存放key的一个仓库，区别在于，truststore里存放的是只包含公钥的数字证书，代表了可以信任的证书，而keystore是包含私钥的。&lt;/p&gt;
    
    </summary>
    
      <category term="证书" scheme="https://gongzhao1.gitee.io/categories/%E8%AF%81%E4%B9%A6/"/>
    
    
      <category term="keytool" scheme="https://gongzhao1.gitee.io/tags/keytool/"/>
    
  </entry>
  
  <entry>
    <title>Nginx之多级证书的双向认证</title>
    <link href="https://gongzhao1.gitee.io/Nginx%E4%B9%8B%E5%A4%9A%E7%BA%A7%E8%AF%81%E4%B9%A6%E7%9A%84%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/"/>
    <id>https://gongzhao1.gitee.io/Nginx之多级证书的双向认证/</id>
    <published>2020-07-02T15:35:28.000Z</published>
    <updated>2020-07-02T15:49:46.947Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-准备"><a href="#1-准备" class="headerlink" title="1 准备"></a>1 准备</h1><p>请参考我之前的博客准备好三级证书</p><h1 id="2-Nginx配置文件"><a href="#2-Nginx配置文件" class="headerlink" title="2 Nginx配置文件"></a>2 Nginx配置文件</h1><p>将生成的证书，组成证书链（三级证书链，从上至下顺序，最上面为第三级证书）</p><p>server-chain.pem</p><blockquote><p>rootca-&gt;secondca-&gt;server</p></blockquote><p>client-chain.pem：</p><blockquote><p>rootca-&gt;clientca</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate         /etc/nginx/ssl/server-chain.pem;</span><br><span class="line">        ssl_certificate_key     /etc/nginx/ssl/server.key;</span><br><span class="line">        ssl_verify_client       on;</span><br><span class="line">        ssl_client_certificate  /etc/nginx/ssl/client-chain.pem;</span><br><span class="line">        ssl_verify_depth        5;</span><br><span class="line">        server_name test.com;</span><br><span class="line">        listen 443 default_server deferred;</span><br><span class="line"></span><br><span class="line">        error_log /var/log/nginx/ssl_auth_error.log debug;</span><br><span class="line">        access_log /var/log/nginx/ssl_auth_access.log;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                #proxy_pass http://test;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为要使用双向认证，所以需要生成客户端证书，因为客户端证书链是由rootca和clientca组成，所以客户端证书可以由这两个证书中的任意一个去生成。</p><p>这里我们用clientca去生成了一个device的证书，分别是device.pem和device.key</p><a id="more"></a><h1 id="3-测试方法"><a href="#3-测试方法" class="headerlink" title="3 测试方法"></a>3 测试方法</h1><h2 id="3-1-curl"><a href="#3-1-curl" class="headerlink" title="3.1 curl"></a>3.1 curl</h2><p>curl命令有可能会因为一些环境而导致执行结果不同，不建议使用curl去测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --cacert trusted-chain.pem --cert device.pem --key device.key https://test.com</span><br></pre></td></tr></table></figure><p>trusted-chain.pem</p><blockquote><p>rootca-&gt;secondca</p></blockquote><h2 id="3-2-openssl-s-client"><a href="#3-2-openssl-s-client" class="headerlink" title="3.2 openssl s_client"></a>3.2 openssl s_client</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect test.com:443 -cert device.pem -key device.key -CAfile trusted-chain.pem</span><br><span class="line">.....</span><br><span class="line">GET /</span><br></pre></td></tr></table></figure><h2 id="3-3-Postman"><a href="#3-3-Postman" class="headerlink" title="3.3 Postman"></a>3.3 Postman</h2><p>略</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-准备&quot;&gt;&lt;a href=&quot;#1-准备&quot; class=&quot;headerlink&quot; title=&quot;1 准备&quot;&gt;&lt;/a&gt;1 准备&lt;/h1&gt;&lt;p&gt;请参考我之前的博客准备好三级证书&lt;/p&gt;
&lt;h1 id=&quot;2-Nginx配置文件&quot;&gt;&lt;a href=&quot;#2-Nginx配置文件&quot; class=&quot;headerlink&quot; title=&quot;2 Nginx配置文件&quot;&gt;&lt;/a&gt;2 Nginx配置文件&lt;/h1&gt;&lt;p&gt;将生成的证书，组成证书链（三级证书链，从上至下顺序，最上面为第三级证书）&lt;/p&gt;
&lt;p&gt;server-chain.pem&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rootca-&amp;gt;secondca-&amp;gt;server&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;client-chain.pem：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rootca-&amp;gt;clientca&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_certificate         /etc/nginx/ssl/server-chain.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_certificate_key     /etc/nginx/ssl/server.key;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_verify_client       on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_client_certificate  /etc/nginx/ssl/client-chain.pem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssl_verify_depth        5;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        server_name test.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listen 443 default_server deferred;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        error_log /var/log/nginx/ssl_auth_error.log debug;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        access_log /var/log/nginx/ssl_auth_access.log;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                #proxy_pass http://test;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;因为要使用双向认证，所以需要生成客户端证书，因为客户端证书链是由rootca和clientca组成，所以客户端证书可以由这两个证书中的任意一个去生成。&lt;/p&gt;
&lt;p&gt;这里我们用clientca去生成了一个device的证书，分别是device.pem和device.key&lt;/p&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginx之SSL配置项解析</title>
    <link href="https://gongzhao1.gitee.io/Nginx%E4%B9%8BSSL%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%A7%A3%E6%9E%90/"/>
    <id>https://gongzhao1.gitee.io/Nginx之SSL配置项解析/</id>
    <published>2020-07-02T15:09:31.000Z</published>
    <updated>2020-07-02T15:22:54.352Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h1><ul><li>ssl_certificate 证书其实是个公钥，它会被发送到连接服务器的每个客户端</li><li>ssl_certificate_key 私钥是用来解密的，所以它的权限要得到保护但nginx的主进程能够读取。</li><li>ssl_session_timeout  客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</li><li>ssl_session_cache shared:SSL:10m; : 设置ssl/tls会话缓存的类型和大小。<ul><li>shared 所有工作进程之间共享缓存。缓存大小以字节为单位指定；一兆字节可以存储大约4000个session。每个共享缓存都应该有一个任意名称。具有相同名称的缓存可以用于多个虚拟服务器。</li><li>off 严禁使用session缓存：nginx明确告诉客户端session可能不会被重用。</li><li>none session缓存的使用被禁止：nginx告诉客户端session可能会被重用，但实际上并不会将session参数存储在缓存中。</li><li>builtin 在OpenSSL中构建的缓存；仅由一个工作进程使用。缓存大小在session中指定。如果没有给出大小，则等于20480个会话。使用内置高速缓存可能导致内存碎片。</li><li>注意： builtin和shared可以同时使用，但是Nginx官方说只使用shared缓存，而不使用built-in缓存的性能应该会更高。配置案例：<br>ssl_session_cache builtin:1000 shared:SSL:10m;</li></ul></li><li>设置较长的keepalive_timeout也可以减少请求ssl会话协商的开销，但同时得考虑线程的并发数了。</li><li>ssl_protocols指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。</li><li>ssl_ciphers选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher ‘RC4:HIGH:!aNULL:!MD5’（后面是你所指定的套件加密算法） 来看所支持算法。<ul><li>加密套件 之间用冒号分隔，加密套件 前有感叹号的表示必须废弃。</li></ul></li><li>ssl_prefer_server_ciphers on设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</li></ul><a id="more"></a><h1 id="HSTS（HTTP-Strict-Transport-Security，严格传输安全）"><a href="#HSTS（HTTP-Strict-Transport-Security，严格传输安全）" class="headerlink" title="HSTS（HTTP Strict Transport Security，严格传输安全）"></a>HSTS（HTTP Strict Transport Security，严格传输安全）</h1><ul><li><p>HSTS 简单说就是在一定时间内强制客户端使用 HTTPS 访问页面。原理如下：</p><p>在服务器响应头中添加 Strict-Transport-Security，可以设置 max-age<br>用户访问时，服务器种下这个头<br>下次如果使用 HTTP 访问，只要 max-age 未过期，客户端会进行内部跳转，可以看到 307 Redirect Internel 的响应码（注意是客户端浏览器相应的，这里给服务器省下了一次 302 跳转）<br>变成 HTTPS 访问源服务器</p></li><li><p>这个过程有效避免了中间人对 80 端口的劫持。但是这里存在一个问题：如果用户在劫持状态，并且没有访问过源服务器，那么源服务器是没有办法给客户端种下 Strict-Transport-Security 响应头的（都被中间人挡下来了）。如何解决？</p></li><li><p>需要注意的是，只有启用 preload（预加载） 之后才是严格意义上安全的 HTTPS。否则都可能在最薄弱环节被攻破。比如：</p><ul><li>允许 SSL 连接但不强制从 HTTP 跳转到 HTTPS，用户访问 HTTP 被劫持</li><li>部署了 HSTS，但用户第一次访问是 HTTP 的，Strict-Transport-Security 的响应头没有作用的机会，还是被劫持。</li></ul></li></ul><h1 id="OSCP-Stapling"><a href="#OSCP-Stapling" class="headerlink" title="OSCP Stapling"></a>OSCP Stapling</h1><ul><li><p>当我们通过HTTPS访问网站的时候，客户端会通过证书颁发机构的证书吊销列表（CRL）或者数字证书在线状态协议(OCSP)记录验证网站服务器的证书是否有效。前一种验证方式是最低效的，CA会不断向CRL文件添加证书吊销记录，CRL文件就会变得越来越大，客户端在验证前就需要耗费越来越长的时间来下载CRL文件。</p></li><li><p>相比 CRL 验证方式，OCSP 就更加高效，OCSP 每次只查询并获取一条记录。然而这些默认查询 OCSP 的客户端在获得查询结果的响应前势必会一直阻塞后续的事件，在网络情况堪忧的情况下（尤其是大陆地区）会造成较长时间的页面空白。并且一旦有黑客或者组织对CA的OCSP发动DDos攻击（分布式拒绝攻击），客户端便无法从 OCSP 服务器获取查询结果并完成证书验证, 客户端就可能会提示网站不受信任。</p></li><li><p>而 OCSP Stapling ，顾名思义，是将查询 OCSP 接口的工作交给服务器来做，服务器除了可以直接查询 OCSP 信息，还可以仅进行少数次查询并将响应缓存起来。当有客户端向服务器发起 TLS 握手请求时，服务器将证书的 OCSP 信息随证书链一同发送给客户端，从而避免了客户端验证会产生的阻塞问题。由于 OCSP 响应是无法伪造的，因此这一过程也不会产生额外的安全问题。</p></li><li><p>值得注意的是：Nginx会在客户端的HELLO握手信息中返回OCSP记录，并且只有当客户端对Nginx发出OCSP信息请求的情况下，Nginx才会发送缓存的OCSP 权威记录到客户端。</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ssl_stapling on;</span><br><span class="line"># OCSP Stapling 开启。OCSP是用于在线查询证书吊销情况的服务，使用OCSP Stapling能将证书有效状态的信息缓存到服务器，提高 TLS 握手速度</span><br><span class="line"> </span><br><span class="line">ssl_stapling_verify on; </span><br><span class="line"># OCSP Stapling 验证开启</span><br><span class="line"> </span><br><span class="line">ssl_trusted_certificate /etc/nginx/cert/trustchain.crt; </span><br><span class="line"># OCSP Stapling 的证书位置（完整的证书链）</span><br><span class="line"> </span><br><span class="line">resolver 233.5.5.5 233.6.6.6 valid=300s; </span><br><span class="line"># 用于查询 OCSP 服务器的DNS</span><br><span class="line"> </span><br><span class="line">resolver_timeout 5s;</span><br><span class="line">#查询域名超时时间</span><br></pre></td></tr></table></figure><h1 id="缓存连接凭据"><a href="#缓存连接凭据" class="headerlink" title="缓存连接凭据"></a>缓存连接凭据</h1><ul><li>缓存 SSL 连接凭据可以避免频繁握手带来的速度降低和性能损耗。</li><li>TLS 协议有两类会话缓存机制：会话标识 session ID 与会话记录 session ticket。session ID 由服务器端支持，协议中的标准字段，因此基本所有服务器都支持，服务器端保存会话ID以及协商的通信信息，Nginx 中1M 内存约可以保存4000个 session ID 机器相关信息，占用服务器资源较多；而 session ticket 属于一个 TLS 扩展字段，需要服务器和客户端都支持。</li><li>二者对比，主要是保存协商信息的位置与方式不同，类似与 HTTP 中的 session 与 cookie。都存在的情况下，Nginx 优先使用 session_ticket。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_cache shared:SSL:20m; </span><br><span class="line"># SSL session 缓存区大小</span><br><span class="line"># 这条语句加在server段里话，在SSL Lab的测试中识别不出来，因为它假设客户端不支持SNI协议，但实际上是可以加在server段的</span><br><span class="line"> </span><br><span class="line">ssl_session_tickets on;</span><br><span class="line"># 开启浏览器的 Session Ticket 缓存</span><br><span class="line"> </span><br><span class="line">ssl_session_timeout 60m; </span><br><span class="line"># 过期时间，分钟</span><br></pre></td></tr></table></figure><h1 id="301-跳转"><a href="#301-跳转" class="headerlink" title="301 跳转"></a>301 跳转</h1><p>跳转到https</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">    listen 80; </span><br><span class="line">    return 301 https://$host$request_uri; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="HTTP-2"><a href="#HTTP-2" class="headerlink" title="HTTP/2"></a>HTTP/2</h1><p>尽管 HTTP/2 协议本身并不要求一定开启 SSL，但大多数主流浏览器要求一定要启用 SSL 才能使用 HTTP/2。要使用 HTTP/2，把 listen directive 改成 listen 443 ssl http2 即可。HTTP/2 是 SPDY 的演进版本，性能上相比 HTTP 1.1 最主要的是增加了多路复用 multiplexing、header 压缩和二进制格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="双向认证配置proxy-ssl-verify-depth"><a href="#双向认证配置proxy-ssl-verify-depth" class="headerlink" title="双向认证配置proxy_ssl_verify_depth"></a>双向认证配置proxy_ssl_verify_depth</h1><blockquote><p>The depth actually is the maximum number of intermediate certificate issuers, i.e. the number of CA certificates which are max allowed to be followed while verifying the client certificate. A depth of 0 means that self-signed client certificates are accepted only, the default depth of 1 means the client certificate can be self-signed or has to be signed by a CA which is directly known to the server (i.e. the CA’s certificate is under SSLCACertificatePath), etc.</p></blockquote><p>当待验证的客户端证书是由intermediate-CA签发，而非有root-CA签发时，需要在proxy_ssl_trusted_certificate中配置intermediate-CA和root-CA组成的证书链文件<br>也就是说，直接尝试使用中级 CA 来验证客户端是无法通过的，openssl 会自动的去找中级 CA 的签发者一层层验证上去，直到找到根。</p><p>因此，在实际使用的时候，需要注意一下两点：</p><ul><li>CA 文件中必须同时存在 中级 CA 和 根 CA，必须构成完整证书链，不能少任何一个；</li><li>默认的验证深度 SslVerifyDepth ssl_verify_depth 是 1，也就是说只要是中级 CA 签发的客户端证书一律无法通过认证，需要增大该值。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;常见参数&quot;&gt;&lt;a href=&quot;#常见参数&quot; class=&quot;headerlink&quot; title=&quot;常见参数&quot;&gt;&lt;/a&gt;常见参数&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ssl_certificate 证书其实是个公钥，它会被发送到连接服务器的每个客户端&lt;/li&gt;
&lt;li&gt;ssl_certificate_key 私钥是用来解密的，所以它的权限要得到保护但nginx的主进程能够读取。&lt;/li&gt;
&lt;li&gt;ssl_session_timeout  客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。&lt;/li&gt;
&lt;li&gt;ssl_session_cache shared:SSL:10m; : 设置ssl/tls会话缓存的类型和大小。&lt;ul&gt;
&lt;li&gt;shared 所有工作进程之间共享缓存。缓存大小以字节为单位指定；一兆字节可以存储大约4000个session。每个共享缓存都应该有一个任意名称。具有相同名称的缓存可以用于多个虚拟服务器。&lt;/li&gt;
&lt;li&gt;off 严禁使用session缓存：nginx明确告诉客户端session可能不会被重用。&lt;/li&gt;
&lt;li&gt;none session缓存的使用被禁止：nginx告诉客户端session可能会被重用，但实际上并不会将session参数存储在缓存中。&lt;/li&gt;
&lt;li&gt;builtin 在OpenSSL中构建的缓存；仅由一个工作进程使用。缓存大小在session中指定。如果没有给出大小，则等于20480个会话。使用内置高速缓存可能导致内存碎片。&lt;/li&gt;
&lt;li&gt;注意： builtin和shared可以同时使用，但是Nginx官方说只使用shared缓存，而不使用built-in缓存的性能应该会更高。配置案例：&lt;br&gt;ssl_session_cache builtin:1000 shared:SSL:10m;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;设置较长的keepalive_timeout也可以减少请求ssl会话协商的开销，但同时得考虑线程的并发数了。&lt;/li&gt;
&lt;li&gt;ssl_protocols指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &amp;gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。&lt;/li&gt;
&lt;li&gt;ssl_ciphers选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher ‘RC4:HIGH:!aNULL:!MD5’（后面是你所指定的套件加密算法） 来看所支持算法。&lt;ul&gt;
&lt;li&gt;加密套件 之间用冒号分隔，加密套件 前有感叹号的表示必须废弃。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ssl_prefer_server_ciphers on设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>openssl生成多级证书</title>
    <link href="https://gongzhao1.gitee.io/openssl%E7%94%9F%E6%88%90%E5%A4%9A%E7%BA%A7%E8%AF%81%E4%B9%A6/"/>
    <id>https://gongzhao1.gitee.io/openssl生成多级证书/</id>
    <published>2020-07-02T14:19:25.000Z</published>
    <updated>2020-07-02T16:00:51.789Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/u010129119/article/details/53419581" target="_blank" rel="noopener">https://blog.csdn.net/u010129119/article/details/53419581</a></li><li><a href="https://www.jianshu.com/p/7d940d7a07d9" target="_blank" rel="noopener">https://www.jianshu.com/p/7d940d7a07d9</a></li></ul><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>Centos7.6</p><h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line"><span class="built_in">echo</span> 01 &gt; /etc/pki/CA/serial</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="制作证书"><a href="#制作证书" class="headerlink" title="制作证书"></a>制作证书</h1><h2 id="生成RootCA证书（Common-Name填RootCA）"><a href="#生成RootCA证书（Common-Name填RootCA）" class="headerlink" title="生成RootCA证书（Common Name填RootCA）"></a>生成RootCA证书（Common Name填RootCA）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out rootca.key 2048</span><br><span class="line"><span class="comment">#可以用openssl命令查看私钥的明细</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> rootca.key -noout -text</span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl req -new -x509 -days 3650 -key rootca.key -out rootca.crt -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=RootCA/emailAddress=rootca@world.com"</span></span><br><span class="line"><span class="comment">#查看生成的证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> rootca.crt -noout -text</span><br></pre></td></tr></table></figure><h2 id="生成二级CA证书（Common-Name填SecondCA）"><a href="#生成二级CA证书（Common-Name填SecondCA）" class="headerlink" title="生成二级CA证书（Common Name填SecondCA）"></a>生成二级CA证书（Common Name填SecondCA）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out secondca.key 2048</span><br><span class="line"><span class="comment">#生成证书签名请求</span></span><br><span class="line">openssl req -new -key secondca.key -out secondca.csr -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=SecondCA/emailAddress=secondca@world.com"</span></span><br><span class="line"><span class="comment">#通过openssl命令查看证书请求文件的明细</span></span><br><span class="line">openssl req -noout -text -<span class="keyword">in</span> secondca.csr</span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl ca -extensions v3_ca -<span class="keyword">in</span> secondca.csr -out secondca.crt -cert rootca.crt -keyfile rootca.key -days 3650</span><br></pre></td></tr></table></figure><h2 id="生成服务器证书（Common-Name填真实域名）"><a href="#生成服务器证书（Common-Name填真实域名）" class="headerlink" title="生成服务器证书（Common Name填真实域名）"></a>生成服务器证书（Common Name填真实域名）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成私钥</span></span><br><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line"><span class="comment">#生成证书签名请求</span></span><br><span class="line">openssl req -new -key serve.key -out server.csr -subj <span class="string">"/C=CN/ST=JS/L=NJ/O=Huawei/OU=Dev/CN=test.com/emailAddress=test@world.com"</span></span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">openssl ca -<span class="keyword">in</span> server.csr -out server.crt -cert secondca.crt -keyfile secondca.key -days 3650</span><br></pre></td></tr></table></figure><p>P.S.</p><ul><li><p>指定证书内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-subj /C=CN/ST=Guangdong/L=Shenzhen/O=PAX/OU=Common Software/CN=Server CA/emailAddress=qiaojx@paxsz.com</span><br></pre></td></tr></table></figure></li><li><p>去掉key加密的输入提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">去掉 -des3</span><br><span class="line">openssl genrsa -des3 -out server.key 2048</span><br></pre></td></tr></table></figure></li><li><p>crt转pem格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> mycert.crt -out mycert.pem -outform PEM</span><br></pre></td></tr></table></figure></li></ul><h1 id="吊销证书"><a href="#吊销证书" class="headerlink" title="吊销证书"></a>吊销证书</h1><p>一般由于用户私钥泄露等情况才需要吊销一个未过期的证书。（当然我们用本测试CA时其时很少用到该命令，除非专门用于测试吊销证书的情况）<br>假设需要被吊销的证书文件为client.pem，则执行以下命令吊销证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 00 &gt; /etc/pki/CA/crlnumber</span><br><span class="line">openssl ca -revoke client.pem -cert RootCA.pem -keyfile RootCA.key -config /etc/pki/tls/openssl.cnf</span><br></pre></td></tr></table></figure><p>生成证书吊销列表文件（CRL）<br>准备公开被吊销的证书列表时，可以生成证书吊销列表（CRL），执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -gencrl -out client.crl -cert RootCA.pem -keyfile RootCA.key -config /etc/pki/tls/openssl.cnf</span><br></pre></td></tr></table></figure><p>还可以添加-crldays和-crlhours参数来说明下一个吊销列表将在多少天后（或多少小时候）发布。</p><p>可以用以下命令检查client.crl的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl crl -<span class="keyword">in</span> client.crl -text -noout</span><br></pre></td></tr></table></figure><h1 id="使用X509生成pem格式证书"><a href="#使用X509生成pem格式证书" class="headerlink" title="使用X509生成pem格式证书"></a>使用X509生成pem格式证书</h1><h2 id="生成CA证书"><a href="#生成CA证书" class="headerlink" title="生成CA证书"></a>生成CA证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out rootca.key 2048</span><br><span class="line">openssl req -new -x509 -days 365 -key rootca.key -out rootca.crt -subj <span class="string">"/C=CN/ST=BJ/L=BJ/O=HD/OU=dev/CN=rootca/emailAddress=rootca@world.com"</span></span><br></pre></td></tr></table></figure><h2 id="生成服务器证书请求"><a href="#生成服务器证书请求" class="headerlink" title="生成服务器证书请求"></a>生成服务器证书请求</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line">openssl req -new -key server.key -out server.csr -subj <span class="string">"/C=CN/ST=BJ/L=BJ/O=HD/OU=dev/CN=test.com/emailAddress=test@world.com"</span></span><br></pre></td></tr></table></figure><h2 id="签署证书"><a href="#签署证书" class="headerlink" title="签署证书"></a>签署证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 3650 -<span class="keyword">in</span> server.csr -CA rootca.crt -CAkey rootca.key -CAcreateserial -out server.pem</span><br><span class="line">openssl x509 -<span class="keyword">in</span> server.pem -noout -text</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/u010129119/article/details/53419581&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/u010129119/article/details/53419581&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/7d940d7a07d9&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/7d940d7a07d9&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;Centos7.6&lt;/p&gt;
&lt;h1 id=&quot;初始化&quot;&gt;&lt;a href=&quot;#初始化&quot; class=&quot;headerlink&quot; title=&quot;初始化&quot;&gt;&lt;/a&gt;初始化&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;touch /etc/pki/CA/index.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; 01 &amp;gt; /etc/pki/CA/serial&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="openssl" scheme="https://gongzhao1.gitee.io/categories/openssl/"/>
    
    
      <category term="openssl" scheme="https://gongzhao1.gitee.io/tags/openssl/"/>
    
  </entry>
  
  <entry>
    <title>Nginx优化</title>
    <link href="https://gongzhao1.gitee.io/Nginx%E4%BC%98%E5%8C%96/"/>
    <id>https://gongzhao1.gitee.io/Nginx优化/</id>
    <published>2020-07-02T14:02:06.000Z</published>
    <updated>2020-07-02T14:18:46.112Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Nginx优化之worker-processes-worker-connections"><a href="#1-Nginx优化之worker-processes-worker-connections" class="headerlink" title="1 Nginx优化之worker_processes,worker_connections"></a>1 Nginx优化之worker_processes,worker_connections</h1><p>worker_processes与worker_connections 设置好合适大小，可以提示nginx处理性能，非常重要。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">原作者的话：</span><br><span class="line">As a general rule you need the only worker with large number of worker_connections, say 10,000 or 20,000.</span><br><span class="line">However, if nginx does CPU-intensive work as SSL or gzipping and you have 2 or more CPU, then you may </span><br><span class="line">set worker_processes to be equal to CPU number.</span><br><span class="line">Besides, if you serve many static files and the total size of the files is bigger than memory, then you may </span><br><span class="line">increase worker_processes to utilize a full disk bandwidth.</span><br><span class="line">Igor Sysoev</span><br><span class="line"></span><br><span class="line">翻译：</span><br><span class="line">一般一个进程足够了，你可以把连接数设得很大。（worker_processes: 1，worker_connections: 10,000）</span><br><span class="line">如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。(worker_processes: CPU核心数)</span><br><span class="line">或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）</span><br></pre></td></tr></table></figure><p><strong>worker_processes，工作进程数</strong></p><ol><li>默认：worker_processes: 1</li><li>调大：worker_processes: CPU核心数，(双核4线程，可以设置为4)</li></ol><p><strong>worker_connections，单个工作进程可以允许同时建立外部连接的数量</strong><br>数字越大，能同时处理的连接越多</p><ol><li>默认：worker_connections: 1024</li><li>调大：worker_connections: 100000，（调大到10万连接）</li></ol><p><strong>worker_connections解析</strong></p><ol><li>connections不是随便设置的，而是与两个指标有重要关联，一是内存，二是操作系统级别的“进程最大可打开文件数”。</li><li>内存：每个连接数分别对应一个read_event、一个write_event事件，一个连接数大概占用232字节，2个事件总占用96字节，那么一个连接总共占用328字节，通过数学公式可以算出100000个连接数大概会占用 31M = 100000 * 328 / 1024 / 1024，当然这只是nginx启动时，connections连接数所占用的nginx。</li><li>进程最大可打开文件数：进程最大可打开文件数受限于操作系统，可通过 ulimit -n 命令查询，以前是1024，现在是65535,<br>nginx提供了worker_rlimit_nofile指令，这是除了ulimit的一种设置可用的描述符的方式。 该指令与使用ulimit对用户的设置是同样的效果。此指令的值将覆盖ulimit的值，如：worker_rlimit_nofile 20960;<br>设置ulimits：ulimit -SHn 65535</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 2; </span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line">#pid logs/nginx.pid; </span><br><span class="line">events &#123; </span><br><span class="line">   worker_connections 65535; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-Nginx优化之worker-processes-worker-connections&quot;&gt;&lt;a href=&quot;#1-Nginx优化之worker-processes-worker-connections&quot; class=&quot;headerlink&quot; title=&quot;1 Nginx优化之worker_processes,worker_connections&quot;&gt;&lt;/a&gt;1 Nginx优化之worker_processes,worker_connections&lt;/h1&gt;&lt;p&gt;worker_processes与worker_connections 设置好合适大小，可以提示nginx处理性能，非常重要。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;原作者的话：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;As a general rule you need the only worker with large number of worker_connections, say 10,000 or 20,000.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;However, if nginx does CPU-intensive work as SSL or gzipping and you have 2 or more CPU, then you may &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set worker_processes to be equal to CPU number.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Besides, if you serve many static files and the total size of the files is bigger than memory, then you may &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;increase worker_processes to utilize a full disk bandwidth.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Igor Sysoev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;翻译：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;一般一个进程足够了，你可以把连接数设得很大。（worker_processes: 1，worker_connections: 10,000）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。(worker_processes: CPU核心数)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;worker_processes，工作进程数&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;默认：worker_processes: 1&lt;/li&gt;
&lt;li&gt;调大：worker_processes: CPU核心数，(双核4线程，可以设置为4)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;worker_connections，单个工作进程可以允许同时建立外部连接的数量&lt;/strong&gt;&lt;br&gt;数字越大，能同时处理的连接越多&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;默认：worker_connections: 1024&lt;/li&gt;
&lt;li&gt;调大：worker_connections: 100000，（调大到10万连接）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;worker_connections解析&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;connections不是随便设置的，而是与两个指标有重要关联，一是内存，二是操作系统级别的“进程最大可打开文件数”。&lt;/li&gt;
&lt;li&gt;内存：每个连接数分别对应一个read_event、一个write_event事件，一个连接数大概占用232字节，2个事件总占用96字节，那么一个连接总共占用328字节，通过数学公式可以算出100000个连接数大概会占用 31M = 100000 * 328 / 1024 / 1024，当然这只是nginx启动时，connections连接数所占用的nginx。&lt;/li&gt;
&lt;li&gt;进程最大可打开文件数：进程最大可打开文件数受限于操作系统，可通过 ulimit -n 命令查询，以前是1024，现在是65535,&lt;br&gt;nginx提供了worker_rlimit_nofile指令，这是除了ulimit的一种设置可用的描述符的方式。 该指令与使用ulimit对用户的设置是同样的效果。此指令的值将覆盖ulimit的值，如：worker_rlimit_nofile 20960;&lt;br&gt;设置ulimits：ulimit -SHn 65535&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;worker_processes 2; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;worker_rlimit_nofile 65535;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#pid logs/nginx.pid; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;events &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   worker_connections 65535; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://gongzhao1.gitee.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>maven之settings.xml</title>
    <link href="https://gongzhao1.gitee.io/maven%E4%B9%8Bsettings-xml/"/>
    <id>https://gongzhao1.gitee.io/maven之settings-xml/</id>
    <published>2020-05-24T15:03:37.000Z</published>
    <updated>2020-05-24T15:37:38.860Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://www.cnblogs.com/wdliu/p/8312543.html" target="_blank" rel="noopener">https://www.cnblogs.com/wdliu/p/8312543.html</a></li></ul><h1 id="1-settings-xml详解"><a href="#1-settings-xml详解" class="headerlink" title="1 settings.xml详解"></a>1 settings.xml详解</h1><h2 id="1-1-声明规范"><a href="#1-1-声明规范" class="headerlink" title="1.1 声明规范"></a>1.1 声明规范</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-2-localRepository"><a href="#1-2-localRepository" class="headerlink" title="1.2 localRepository"></a>1.2 localRepository</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 本地仓库的路径。默认值为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/opt/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-3-interactiveMode"><a href="#1-3-interactiveMode" class="headerlink" title="1.3 interactiveMode"></a>1.3 interactiveMode</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Maven是否需要和用户交互以获得输入。如果Maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interactiveMode</span>&gt;</span>true<span class="tag">&lt;/<span class="name">interactiveMode</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-4-usePluginRegistry"><a href="#1-4-usePluginRegistry" class="headerlink" title="1.4 usePluginRegistry"></a>1.4 usePluginRegistry</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Maven是否需要使用plugin-registry.xml文件来管理插件版本。如果需要让Maven使用文件来管理插件版本，则设为true。默认为false。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">usePluginRegistry</span>&gt;</span>false<span class="tag">&lt;/<span class="name">usePluginRegistry</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-5-offline"><a href="#1-5-offline" class="headerlink" title="1.5 offline"></a>1.5 offline</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--表示Maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认为false。当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">offline</span>&gt;</span>false<span class="tag">&lt;/<span class="name">offline</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="1-6-pluginGroups"><a href="#1-6-pluginGroups" class="headerlink" title="1.6 pluginGroups"></a>1.6 pluginGroups</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--当插件的组织Id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。该元素包含一个pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。当我们使用某个插件，并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。默认情况下该列表包含了org.apache.maven.plugins和org.codehaus.mojo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--plugin的组织Id（groupId） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-7-proxies"><a href="#1-7-proxies" class="headerlink" title="1.7 proxies"></a>1.7 proxies</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用来配置不同的代理，多代理profiles 可以应对笔记本或移动设备的工作环境：通过简单的设置profile id就可以很容易的更换整个代理配置。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--代理元素包含配置代理时需要的信息--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的唯一定义符，用来区分不同的代理元素。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>myproxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该代理是否是激活的那个。true则激活代理。当我们声明了一组代理，而某个时候只需要激活一个代理的时候，该元素就可以派上用处。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的协议。 协议://主机名:端口，分隔成离散的元素以方便配置。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>http<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的主机名。协议://主机名:端口，分隔成离散的元素以方便配置。  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">host</span>&gt;</span>proxy.somewhere.com<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的端口。协议://主机名:端口，分隔成离散的元素以方便配置。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的用户名，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">username</span>&gt;</span>proxyuser<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--代理的密码，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">password</span>&gt;</span>somepassword<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--不该被代理的主机名列表。该列表的分隔符由代理服务器指定；例子中使用了竖线分隔符，使用逗号分隔也很常见。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>*.google.com|ibiblio.org<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-8-servers"><a href="#1-8-servers" class="headerlink" title="1.8 servers"></a>1.8 servers</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置服务端的一些设置。一些设置如安全证书不应该和pom.xml一起分发。这种类型的信息应该存在于构建服务器上的settings.xml文件中。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--服务器元素包含配置服务器时需要的信息 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--这是server的id（注意不是用户登陆的id），该id与distributionManagement中repository元素的id相匹配。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>server001<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权用户名。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">username</span>&gt;</span>my_login<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权密码 。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。密码加密功能已被添加到2.1.0 +。详情请访问密码加密页面--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">password</span>&gt;</span>my_password<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权时使用的私钥位置。和前两个元素类似，私钥位置和私钥密码指定了一个私钥的路径（默认是$&#123;user.home&#125;/.ssh/id_dsa）以及如果需要的话，一个密语。将来passphrase和password元素可能会被提取到外部，但目前它们必须在settings.xml文件以纯文本的形式声明。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">privateKey</span>&gt;</span>$&#123;usr.home&#125;/.ssh/id_dsa<span class="tag">&lt;/<span class="name">privateKey</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--鉴权时使用的私钥密码。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">passphrase</span>&gt;</span>some_passphrase<span class="tag">&lt;/<span class="name">passphrase</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--文件被创建时的权限。如果在部署的时候会创建一个仓库文件或者目录，这时候就可以使用权限（permission）。这两个元素合法的值是一个三位数字，其对应了unix文件系统的权限，如664，或者775。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filePermissions</span>&gt;</span>664<span class="tag">&lt;/<span class="name">filePermissions</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--目录被创建时的权限。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directoryPermissions</span>&gt;</span>775<span class="tag">&lt;/<span class="name">directoryPermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-9-mirrors"><a href="#1-9-mirrors" class="headerlink" title="1.9 mirrors"></a>1.9 mirrors</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--为仓库列表配置的下载镜像列表。高级设置请参阅镜像设置页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--给定仓库的下载镜像。 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该镜像的唯一标识符。id用来区分不同的mirror元素。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>planetmirror.com<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--镜像名称 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>PlanetMirror Australia<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该镜像的URL。构建系统会优先考虑使用该URL，而非使用默认的服务器URL。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://downloads.planetmirror.com/pub/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--被镜像的服务器的id。例如，如果我们要设置了一个Maven中央仓库（http://repo.maven.apache.org/maven2/）的镜像，就需要将该元素设置成central。这必须和中央仓库的id central完全一致。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-10-profiles"><a href="#1-10-profiles" class="headerlink" title="1.10 profiles"></a>1.10 profiles</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据环境参数来调整构建配置的列表。settings.xml中的profile元素是pom.xml中profile元素的裁剪版本。它包含了id，activation, repositories, pluginRepositories和 properties元素。这里的profile元素只包含这五个子元素是因为这里只关心构建系统这个整体（这正是settings.xml文件的角色定位），而非单独的项目对象模型设置。如果一个settings中的profile被激活，它的值会覆盖任何其它定义在POM中或者profile.xml中的带有相同id的profile。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--根据环境参数来调整的构件的配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--该配置的唯一标识符。 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-11-Activation"><a href="#1-11-Activation" class="headerlink" title="1.11 Activation"></a>1.11 Activation</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙。如POM中的profile一样，profile的力量来自于它能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式。settings.xml文件中的activeProfile元素可以包含profile的id。profile也可以通过在命令行，使用-P标记和逗号分隔的列表来显式的激活（如，-P test）。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--profile默认是否激活的标识--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统的名字 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统所属家族(如 'windows')  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统体系结构  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的操作系统版本--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;name&#125;引用），其拥有对应的name = 值，Profile就会被激活。如果值字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的属性的名称--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--激活profile的属性的值 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活profile。另一方面，exists则会检查文件是否存在，如果存在则激活profile。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exists</span>&gt;</span>$&#123;basedir&#125;/file2.properties<span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">missing</span>&gt;</span>$&#123;basedir&#125;/file1.properties<span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-12-Repositories"><a href="#1-12-Repositories" class="headerlink" title="1.12 Repositories"></a>1.12 Repositories</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">name</span>&gt;</span>local private nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">               <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库列表，它是Maven用来填充构建系统本地仓库所使用的一组远程项目。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库唯一标识--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>&gt;</span>codehausSnapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库名称 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Codehaus Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--true或者false表示该仓库是否为下载某种类型构件（发布版，快照版）开启。  --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳。这里的选项是：always（一直），daily（默认，每日），interval：X（这里X是以分钟为单位的时间间隔），或者never（从不）。 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做-ignore（忽略），fail（失败），或者warn（警告）。--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如何处理远程仓库里快照版本的下载。有了releases和snapshots这两组配置，POM就可以在每个单独的仓库中，为每种类型的构件采取不同的策略。例如，可能有人会决定只为开发目的开启对快照版本下载的支持。参见repositories/repository/releases元素--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://snapshots.maven.codehaus.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于定位和排序构件的仓库布局类型-可以是default（默认）或者legacy（遗留）。Maven 2为其仓库提供了一个默认的布局；然而，Maven 1.x有一种不同的布局。我们可以使用该元素指定布局是default（默认）还是legacy（遗留）。 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发现插件的远程仓库列表。仓库是两种主要构件的家。第一种构件被用作其它构件的依赖。这是中央仓库中存储的大部分构件类型。另外一种构件类型是插件。Maven插件是一种特殊类型的构件。由于这个原因，插件仓库独立于其它仓库。pluginRepositories元素的结构和repositories元素的结构类似。每个pluginRepository元素指定一个Maven可以用来寻找新插件的远程地址。--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见profiles/profile/repositories/repository元素的说明--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>           </span><br><span class="line">         <span class="tag">&lt;<span class="name">releases</span>&gt;</span>      </span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">name</span>/&gt;</span><span class="tag">&lt;<span class="name">url</span>/&gt;</span><span class="tag">&lt;<span class="name">layout</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-13-activeProfiles"><a href="#1-13-activeProfiles" class="headerlink" title="1.13 activeProfiles"></a>1.13 activeProfiles</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">默认配置：</span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--    &lt;activeProfile&gt;devitcast&lt;/activeProfile&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    配置解释：</span><br><span class="line">    <span class="comment">&lt;!--手动激活profiles的列表，按照profile被应用的顺序定义activeProfile。 该元素包含了一组activeProfile元素，每个activeProfile都含有一个profile id。任何在activeProfile中定义的profile id，不论环境设置如何，其对应的profile都会被激活。如果没有匹配的profile，则什么都不会发生。例如，env-test是一个activeProfile，则在pom.xml（或者profile.xml）中对应id的profile会被激活。如果运行过程中找不到这样一个profile，Maven则会像往常一样运行 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>env-test<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="2-示例"><a href="#2-示例" class="headerlink" title="2 示例"></a>2 示例</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/opt/repository/maven<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like "mvn prefix:goal". Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | "org.apache.maven.plugins" and "org.codehaus.mojo" if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the 'id' attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>thirdparty<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>anonymous123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>internal nexus repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id's for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property 'target-env' with a value of 'dev',</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set 'target-env' to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>apatch<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-apatch<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote apatch<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://inno.starhubdev.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>ibiblio<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-ibiblio<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote ibiblio<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://nexus.sourcesense.com/nexus/content/repositories/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>redev<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>re-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>remote nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repository.sonatype.org/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.0.0.241:9999/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3-私有仓库配置浅析"><a href="#3-私有仓库配置浅析" class="headerlink" title="3 私有仓库配置浅析"></a>3 私有仓库配置浅析</h1><p>基本逻辑</p><ul><li>pom&gt;启用的profile&gt;maven原有配置</li><li>mirror配置mirrorOf和id匹配优先</li></ul><p><strong>简单maven配置</strong></p><p>一般大家的配置（略去无关私有仓库配置）都是这样的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.xxx.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>         </span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">      <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>         </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">      <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-1-mirrors"><a href="#3-1-mirrors" class="headerlink" title="3.1 mirrors"></a>3.1 mirrors</h2><p>这个标签重要的属性包括<strong>id</strong>、<strong>mirrorOf</strong>。id用来唯一区分。mirrorOf用来关联repository。<br>url用来表示私服地址。<br>mirrorOf常见大家配置成*、central、repo啥的</p><ul><li><code>id</code> 唯一标识</li><li><code>mirrorOf</code> 指定镜像的规则。就是什么情况会从镜像仓库拉取，而不是从原本的仓库拉取<br>可选项<a href="https://maven.apache.org/guides/mini/guide-mirror-settings.html" target="_blank" rel="noopener">参考链接</a>:<ol><li><code>*</code> 匹配所有</li><li><code>external:*</code> 除了本地缓存之后的所有仓库</li><li><code>repo,repo1</code> <code>repo</code> 或者 <code>repo1</code>。 这里<code>repo</code>指的是仓库的id，下文会提到</li><li><code>*,!repo1</code> 除了<code>repo1</code>的所有仓库</li></ol></li><li><code>name</code> 名称描述</li><li><code>url</code> 地址</li></ul><h2 id="3-2-profile"><a href="#3-2-profile" class="headerlink" title="3.2 profile"></a>3.2 profile</h2><p>这个就简单说下吧，就是算是个配置，可以配多个，具体哪个生效可以通过mvn命令指定，或者配置<activeprofiles></activeprofiles></p><h2 id="3-3-repositories"><a href="#3-3-repositories" class="headerlink" title="3.3 repositories"></a>3.3 repositories</h2><p>这里面算是配置的重点</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br></pre></td></tr></table></figure><p>几个重要的配置，一目了然吧，id标识，url地址，是否从该仓库下release，是否从该仓库下快照版本。<br> 这里就有人会懵逼了，这里怎么又配了个地址，跟mirrors里面的地址哪个生效呢？</p><p>好的，那咱们试试。先规定一下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.ws.netease.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把地址区分下，mirror里配成xxx，repository配成ccc<br>随便找一个项目，设定一个不存在的依赖，mvn -U compile下：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/1.webp" alt="image"></p><p>可以发现去ccc找了。说明repository里的生效了。<br> 那么mirror里的地址什么时候生效呢？其实刚才说了，mirror里的是靠mirrorOf中的内容和repository中id关联的。比如我们把刚才配置改为</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mvn.ws.netease.com<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.xxx.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把repository中的id改成central</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/2.webp" alt="image"></p><p>这样就行了。此外mirrorOf中可以配置通配符，例如*，表示任何repository都和这个关联。</p><p><strong>其实简单来说就是如果repository的id能和mirrorOf关联上，那么url以mirror的为准，否则以repository中自己的url为准。</strong></p><p>其他还有一些点，repositories中可以配置多个repository，配置多个话，一个找不到会找下一个，比如我们在刚才基础上加上阿里的配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mvn.ccc.com/nexus/content/groups/t_repo_group/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>alibaba<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://code.alibabatech.com/mvn/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在构建一次：</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/3.webp" alt="image"></p><h2 id="3-4-总结"><a href="#3-4-总结" class="headerlink" title="3.4 总结"></a>3.4 总结</h2><p>咱们在回顾下起初的配置，可以看到启用的profile是dev，dev中的repository的id是nexus，跟mirrorOf没有匹配，那么生效的配置就是repository中自己的url配置，所以这里完全可以省略掉mirror的配置。当然如果多个profile公用一个私服地址，也可以指定mirror地址，然后repository中的id指定成和mirrorOf相同，同时可以省略掉自己标签中url。</p><p>此外还有几个点要说，pluginRepositories，配置信息基本和repository一致，不过这个地址是用来下maven的插件的，就是pom中这样的配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filteringDeploymentDescriptors</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filteringDeploymentDescriptors</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">webResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/src/main/webapp/WEB-INF<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>WEB-INF<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还有，pom也可以指定repository:</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/maven/4.webp" alt="image"></p><p>这样配置会和settings.xml中生效的配置合并，并优先从这个库找，找不到继续走settings.xml配置。</p><h2 id="3-5-多仓库配置"><a href="#3-5-多仓库配置" class="headerlink" title="3.5 多仓库配置"></a>3.5 多仓库配置</h2><p>第三方包，自己公司的包等除了手动<code>install:install-file</code>导入之外，最好的办法就是搭建自己公司的私有仓库，这里推荐使用<a href="https://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">nexus</a>, 这样除了中央仓库之外就需要设置自己的仓库了</p><p>设置多仓库有2个方法:</p><ol><li><p>pom设置(java的pom文件)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>setting设置(<code>${user.home}/.m2/settings.xml</code>)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>myprofile<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>your custom repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jarsm2.dyndns.dk<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">       ...</span><br><span class="line">     <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>myprofile<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line"> ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>激活配置文件除了放在<code>activeProfiles</code>中之外，也可以使用mvn的参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mvn -Pmyprofile ...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/wdliu/p/8312543.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/wdliu/p/8312543.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-settings-xml详解&quot;&gt;&lt;a href=&quot;#1-settings-xml详解&quot; class=&quot;headerlink&quot; title=&quot;1 settings.xml详解&quot;&gt;&lt;/a&gt;1 settings.xml详解&lt;/h1&gt;&lt;h2 id=&quot;1-1-声明规范&quot;&gt;&lt;a href=&quot;#1-1-声明规范&quot; class=&quot;headerlink&quot; title=&quot;1.1 声明规范&quot;&gt;&lt;/a&gt;1.1 声明规范&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;&lt;/span&gt; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;xsi:schemaLocation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-2-localRepository&quot;&gt;&lt;a href=&quot;#1-2-localRepository&quot; class=&quot;headerlink&quot; title=&quot;1.2 localRepository&quot;&gt;&lt;/a&gt;1.2 localRepository&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- 本地仓库的路径。默认值为 --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;localRepository&lt;/span&gt;&amp;gt;&lt;/span&gt;/opt/repository&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;localRepository&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-3-interactiveMode&quot;&gt;&lt;a href=&quot;#1-3-interactiveMode&quot; class=&quot;headerlink&quot; title=&quot;1.3 interactiveMode&quot;&gt;&lt;/a&gt;1.3 interactiveMode&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--Maven是否需要和用户交互以获得输入。如果Maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;interactiveMode&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;interactiveMode&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-4-usePluginRegistry&quot;&gt;&lt;a href=&quot;#1-4-usePluginRegistry&quot; class=&quot;headerlink&quot; title=&quot;1.4 usePluginRegistry&quot;&gt;&lt;/a&gt;1.4 usePluginRegistry&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--Maven是否需要使用plugin-registry.xml文件来管理插件版本。如果需要让Maven使用文件来管理插件版本，则设为true。默认为false。--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;usePluginRegistry&lt;/span&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;usePluginRegistry&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1-5-offline&quot;&gt;&lt;a href=&quot;#1-5-offline&quot; class=&quot;headerlink&quot; title=&quot;1.5 offline&quot;&gt;&lt;/a&gt;1.5 offline&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--表示Maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认为false。当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。 --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;offline&lt;/span&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;offline&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="java" scheme="https://gongzhao1.gitee.io/categories/java/"/>
    
    
      <category term="maven" scheme="https://gongzhao1.gitee.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>maven之pom文件详解</title>
    <link href="https://gongzhao1.gitee.io/maven%E4%B9%8Bpom%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.gitee.io/maven之pom文件详解/</id>
    <published>2020-05-24T14:27:34.000Z</published>
    <updated>2020-05-24T15:37:20.145Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://blog.csdn.net/weixin_38569499/article/details/91456988" target="_blank" rel="noopener">https://blog.csdn.net/weixin_38569499/article/details/91456988</a></li></ul><h1 id="1-maven项目目录结构"><a href="#1-maven项目目录结构" class="headerlink" title="1 maven项目目录结构"></a>1 maven项目目录结构</h1><p>  pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。</p><p>  maven的遵循约定大于配置，约定了如下的目录结构：</p><table><thead><tr><th><strong>目录</strong></th><th>目的</th></tr></thead><tbody><tr><td>${basedir}</td><td>存放pom.xml和所有的子目录</td></tr><tr><td>${basedir}/src/main/java</td><td>项目的java源代码</td></tr><tr><td>${basedir}/src/main/resources</td><td>项目的资源，比如说property文件，springmvc.xml</td></tr><tr><td>${basedir}/src/test/java</td><td>项目的测试类，比如说Junit代码</td></tr><tr><td>${basedir}/src/test/resources</td><td>测试用的资源</td></tr><tr><td>${basedir}/src/main/scripts</td><td>项目脚本源码的目录</td></tr><tr><td>${basedir}/src/main/webapp/WEB-INF</td><td>web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面</td></tr><tr><td>${basedir}/target</td><td>打包输出目录</td></tr><tr><td>${basedir}/target/classes</td><td>编译输出目录</td></tr><tr><td>${basedir}/target/site</td><td>生成文档的目录，可以通过index.html查看项目的文档</td></tr><tr><td>${basedir}/target/test-classes</td><td>测试编译输出目录</td></tr><tr><td>Test.java</td><td>Maven只会自动运行符合该命名规则的测试类</td></tr><tr><td>~/.m2/repository</td><td>Maven默认的本地仓库目录位置</td></tr></tbody></table><a id="more"></a><h1 id="2-配置详解"><a href="#2-配置详解" class="headerlink" title="2 配置详解"></a>2 配置详解</h1><h2 id="2-1-根元素和必要配置"><a href="#2-1-根元素和必要配置" class="headerlink" title="2.1 根元素和必要配置"></a>2.1 根元素和必要配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span> = <span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span> = <span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span> = <span class="string">"http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 模型版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 公司或者组织的唯一标志，也是打包成jar包路径的依据 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 例如com.companyname.project-group，maven打包jar包的路径：/com/companyname/project-group --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.companyname.project-group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 项目的唯一ID，一个groupId下面可能多个项目，就是靠artifactId来区分的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--项目产生的构件类型，包括jar、war、ear、pom等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>   project是pom文件的根元素，project下有modelVersion、groupId、artifactId、version、packaging等重要的元素。其中，groupId、artifactId、version三个元素用来定义一个项目的坐标，也就是说，一个maven仓库中，完全相同的一组groupId、artifactId、version，只能有一个项目。</p><ul><li>project：整个pom配置文件的根元素，所有的配置都是写在project元素里面的；</li><li>modelVersion：指定了当前POM模型的版本，对于Maven2及Maven 3来说，它只能是4.0.0；</li><li>groupId：这是项目组的标识。它在一个组织或者项目中通常是唯一的。</li><li>artifactId：这是项目的标识，通常是工程的名称。它在一个项目组（group）下是唯一的。</li><li>version：这是项目的版本号，用来区分同一个artifact的不同版本。</li><li>packaging：这是项目产生的构件类型，即项目通过maven打包的输出文件的后缀名，包括jar、war、ear、pom等。</li></ul><h2 id="2-2-父项目和parent元素"><a href="#2-2-父项目和parent元素" class="headerlink" title="2.2 父项目和parent元素"></a>2.2 父项目和parent元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--父项目的坐标，坐标包括group ID，artifact ID和version。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果项目中没有规定某个元素的值，那么父项目中的对应值即为项目的默认值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的构件标识符 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.companyname.project-group<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的全球唯一标识符 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>base-project<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被继承的父项目的版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.1-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 父项目的pom.xml文件的相对路径,默认值是../pom.xml。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 寻找父项目的pom：构建当前项目的地方--)relativePath指定的位置--)本地仓库--)远程仓库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>所有的pom都继承自一个父pom（Super POM）。父pom包含了一些可以被继承的默认设置，如果项目的pom中没有设置这些元素，就会使用父pom中设置。例如，Super POM中配置了默认仓库<a href="http://repo1.maven.org/maven2，这样哪怕项目的pom中没有配置仓库，也可以去这个默认仓库中去下载依赖。实际上，maven" target="_blank" rel="noopener">http://repo1.maven.org/maven2，这样哪怕项目的pom中没有配置仓库，也可以去这个默认仓库中去下载依赖。实际上，maven</a> pom文件约定大于配置的原则，就是通过在Super POM中预定义了一些配置信息来实现的。</p><p>Maven使用effective pom（Super pom加上工程自己的配置）来执行相关的目标，它帮助开发者在pom.xml中做尽可能少的配置。当然，这些配置也可以被重写。</p><p>parent元素可以指定父pom。用户可以通过增加parent元素来自定义一个父pom，从而继承该pom的配置。parent元素中包含一些子元素，用来定位父项目和父项目的pom文件位置。</p><ul><li>parent：用于指定父项目；</li><li>groupId：parent的子元素，父项目的groupId，用于定位父项目；</li><li>artifactId：parent的子元素，父项目的artifactId，用于定位父项目；</li><li>version：parent的子元素，父项目的version，用于定位父项目；</li><li>relativePath：parent的子元素，用于定位父项目pom文件的位置。</li></ul><h2 id="2-3-项目构建需要的信息"><a href="#2-3-项目构建需要的信息" class="headerlink" title="2.3 项目构建需要的信息"></a>2.3 项目构建需要的信息</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--构建项目需要的信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--------------------- 路径管理（在遵循约定大于配置原则下，不需要配置） ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录。该路径是相对于pom.xml的相对路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--被编译过的测试class文件存放的目录。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testOutputDirectory</span> /&gt;</span>        </span><br><span class="line">    <span class="comment">&lt;!--项目脚本源码目录，该目录下的内容，会直接被拷贝到输出目录，因为脚本是被解释的，而不是被编译的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scriptSourceDirectory</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 资源管理 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 描述了资源的目标输出路径。该路径是相对于target/classes的路径 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 如果是想要把资源直接放在target/classes下，不需要配置该元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自文件里配置的属性，文件在filters元素里列出。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--描述存放资源的目录，该路径相对POM路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--包含的模式列表，例如**/*.xml，只有符合条件的资源文件才会在打包的时候被放入到输出路径中 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，子元素说明参考build/resources/resource元素的说明 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 插件管理 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 子项目可以引用的默认插件信息。pluginManagement中的插件直到被引用时才会被解析或绑定到生命周期 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里只是做了声明，并没有真正的引入。给定插件的任何本地配置都会覆盖这里的配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可使用的插件列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--插件在仓库里的group ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--插件在仓库里的artifact ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--被使用的插件的版本（或版本范围） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 是否从该插件下载Maven扩展(例如打包和类型处理器) --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 由于性能原因，只有在真需要下载时，该元素才被设置成enabled --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--execution元素包含了插件执行需要的信息 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--配置的执行目标 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--配置是否被传播到子POM --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--项目引入插件所需要的额外依赖 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        ......</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用的插件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    ......</span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 构建扩展 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用来自其他项目的一系列构建扩展 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--每个extension描述一个会使用到其构建扩展的一个项目，extension的子元素是项目的坐标 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--------------------- 其他配置 ---------------------&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建产生的所有文件存放的目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>build标签定义了构建项目需要的信息，这部分信息对于定制化项目构建是非常重要的。这里会根据build的子元素的特点，简单地分类讲解。</p><h3 id="2-3-1-路径管理"><a href="#2-3-1-路径管理" class="headerlink" title="2.3.1 路径管理"></a>2.3.1 路径管理</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 路径管理（在遵循约定大于配置原则下，不需要配置） ---------------------&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">sourceDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录。该路径是相对于pom.xml的相对路径 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">testSourceDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--被编译过的测试class文件存放的目录。 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">testOutputDirectory</span> /&gt;</span>        </span><br><span class="line"> <span class="comment">&lt;!--项目脚本源码目录，该目录下的内容，会直接被拷贝到输出目录，因为脚本是被解释的，而不是被编译的 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">scriptSourceDirectory</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>路径管理定义了各种源码和编译结果的输出路径。如果遵循maven默认的路径约定，这里的几个元素是不需要配置的。这些元素包括：</p><ul><li>sourceDirectory：项目源码目录，定义的是相对于pom文件的相对路径；</li><li>testSourceDirectory：项目单元测试源码目录，定义的也是是相对于pom文件的相对路径；</li><li>outputDirectory：被编译过的应用程序class文件存放的目录，也是是相对于pom文件的相对路径；</li><li>testOutoutDIrectory：被编译过的测试class文件存放的目录，也是是相对于pom文件的相对路径；</li><li>scriptSourceDirectory：项目脚本源码目录，也是是相对于pom文件的相对路径。由于脚本是解释性的语言，所以该目录下的内容，会直接被拷贝到输出目录，而不需要编译。</li></ul><h3 id="2-3-2-资源管理"><a href="#2-3-2-资源管理" class="headerlink" title="2.3.2 资源管理"></a>2.3.2 资源管理</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 资源管理 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 描述了资源的目标输出路径。该路径是相对于target/classes的路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果是想要把资源直接放在target/classes下，不需要配置该元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自文件里配置的属性，文件在filters元素里列出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--描述打包前的资源存放的目录，该路径相对POM路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包含的模式列表，例如**/*.xml，只有符合条件的资源文件才会在打包的时候被放入到输出路径中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，子元素说明参考build/resources/resource元素的说明 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的元素主要是对应用程序resource资源和单元测试部分resource资源的管理，分别通过resource标签和testResource标签管理两种资源。两个标签元素可选的子元素都是一样的。子元素包括：</p><ul><li>targetPath：描述了资源的目标输出路径，该路径是相对于target/classes的路径；</li><li>filtering：对文件中的参数值进行过滤，需要被过滤的文件在filter中指定；</li><li>directory：描述打包前的资源的存放路径，这个路径是相对于pom文件所在目录的相对路径；</li><li>includes：包含的模式列表，例如**/*.xml。只有符合条件的资源文件才会在打包的时候被放入到输出路径中；</li><li>excludes：排除的模式列表，例如**/*.xml，符合的资源文件不会在打包的时候会被过滤掉。</li></ul><h3 id="2-3-3-插件管理"><a href="#2-3-3-插件管理" class="headerlink" title="2.3.3 插件管理"></a>2.3.3 插件管理</h3><p>插件管理相关的元素有两个，包括pluginManagement和plugins。pluginManagement中有子元素plugins，它和project下的直接子元素plugins的区别是，pluginManagement主要是用来声明子项目可以引用的默认插件信息，这些插件如果只写在pluginManagement中是不会被引入的。project下的直接子元素plugins中定义的才是这个项目中真正需要被引入的插件。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 插件管理 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 子项目可以引用的默认插件信息。pluginManagement中的插件直到被引用时才会被解析或绑定到生命周期 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里只是做了声明，并没有真正的引入。给定插件的任何本地配置都会覆盖这里的配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可使用的插件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--插件定位坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否使用这个插件的Maven扩展(extensions)，默认为false --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 由于性能原因，只有在真需要下载时，该元素才被设置成enabled --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--execution元素包含了插件执行需要的信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置的执行目标 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置是否被传播到子POM --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目引入插件所需要的额外依赖，参见dependencies元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    ......</span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用的插件列表，这里是真正的引入插件。参见build/pluginManagement/plugins元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-4-构建扩展"><a href="#2-3-4-构建扩展" class="headerlink" title="2.3.4 构建扩展"></a>2.3.4 构建扩展</h3><p>extensions是在此构建中使用的项目的列表，它们将被包含在运行构建的classpath中。这些项目可以启用对构建过程的扩展，并使活动的插件能够对构建生命周期进行更改。简而言之，扩展是在构建期间激活的artifacts。扩展不需要实际执行任何操作，也不包含 Mojo。因此，扩展对于指定普通插件接口的多个实现中的一个是非常好的。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 构建扩展 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用来自其他项目的一系列构建扩展 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--每个extension描述一个会使用到其构建扩展的一个项目，extension的子元素是项目的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-5-其他配置"><a href="#2-3-5-其他配置" class="headerlink" title="2.3.5 其他配置"></a>2.3.5 其他配置</h3><p>  build中还有一些配置，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--------------------- 其他配置 ---------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--构建产生的所有文件存放的目录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-4-项目依赖相关信息"><a href="#2-4-项目依赖相关信息" class="headerlink" title="2.4 项目依赖相关信息"></a>2.4 项目依赖相关信息</h2><p>pom文件中通过dependencyManagement来声明依赖，通过dependencies元素来管理依赖。dependencyManagement下的子元素只有一个直接的子元素dependencice，其配置和dependencies子元素是完全一致的；而dependencies下只有一类直接的子元素：dependency。一个dependency子元素表示一个依赖项目。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖自动从项目定义的仓库中下载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖坐标 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖项目的坐标三元素：groupId + artifactId + version --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-artifact<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖类型 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖类型，默认是jar。通常表示依赖文件的扩展名，但有例外。一个类型可以被映射成另外一个扩展名或分类器 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 类型经常和使用的打包方式对应，尽管这也有例外，一些类型的例子：jar，war，ejb-client和test-jar --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果设置extensions为true，就可以在plugin里定义新的类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果想将项目构建成两个单独的JAR，分别使用Java 4和6编译器，就可以使用分类器来生成两个单独的JAR构件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">classifier</span>&gt;</span><span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖传递 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖排除，即告诉maven只依赖指定的项目，不依赖该项目的这些依赖。此元素主要用于解决版本冲突问题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可选依赖，用于阻断依赖的传递性。如果在项目B中把C依赖声明为可选，那么依赖B的项目中无法使用C依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!------------------- 依赖范围 -------------------&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来</span></span><br><span class="line"><span class="comment">            - compile：默认范围，用于编译;  - provided：类似于编译，但支持jdk或者容器提供，类似于classpath </span></span><br><span class="line"><span class="comment">            - runtime: 在执行时需要使用;    - systemPath: 仅用于范围为system。提供相应的路径 </span></span><br><span class="line"><span class="comment">            - test: 用于test任务时使用;    - system: 需要外在提供相应的元素。通过systemPath来取得 </span></span><br><span class="line"><span class="comment">            - optional: 当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 该元素为依赖规定了文件系统上的路径。仅供scope设置system时使用。但是不推荐使用这个元素 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不推荐使用绝对路径，如果必须要用，推荐使用属性匹配绝对路径，例如$&#123;java.home&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span><span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 继承自该项目的所有子项目的默认依赖信息，这部分的依赖信息不会被立即解析。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当子项目声明一个依赖，如果group ID和artifact ID以外的一些信息没有描述，则使用这里的依赖信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            ......</span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里也是根据元素的作用，简单的对dependency的子元素做了一下分类。下面按分类来看一下dependency的子元素：</p><h3 id="2-4-1-依赖坐标"><a href="#2-4-1-依赖坐标" class="headerlink" title="2.4.1 依赖坐标"></a>2.4.1 依赖坐标</h3><p>依然是通过groupId + artifactId + version来在仓库中定位一个项目：</p><ul><li>groupId：parent的子元素，父项目的groupId，用于定位父项目；</li><li>artifactId：parent的子元素，父项目的artifactId，用于定位父项目；</li><li>version：parent的子元素，父项目的version，用于定位父项目；</li></ul><h3 id="2-4-2-依赖类型"><a href="#2-4-2-依赖类型" class="headerlink" title="2.4.2 依赖类型"></a>2.4.2 依赖类型</h3><p>这个分类主要包括两个元素，分别是依赖类型和依赖的分类器。同一个项目，即使打包成同一种类型，也可以有多个文件同时存在，因为它们的分类器可能是不同的。</p><ul><li>type：依赖类型，默认是jar。通常表示依赖文件的扩展名，但也有例外。一个类型可以被映射成另外一个扩展名或分类器。类型经常和使用的打包方式对应，尽管这也有例外，一些类型的例子：jar，war，ejb-client和test-jar。如果设置extensions为true，就可以在plugin里定义新的类型。</li><li>classifier：依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面，如果想将项目构建成两个单独的JAR，分别使用Java 4和6编译器，就可以使用分类器来生成两个单独的JAR构件</li></ul><h3 id="2-4-3-依赖传递"><a href="#2-4-3-依赖传递" class="headerlink" title="2.4.3 依赖传递"></a>2.4.3 依赖传递</h3><p>依赖传递相关的子元素主要有两个，用于依赖排除的exclusions和设置依赖是否可选的optional。</p><ul><li>exclusions：排除该项目中的一些依赖，即本项目A依赖该dependency指示的项目B，但是不依赖项目B中依赖的这些依赖；</li><li>optional：可选依赖，用于阻断依赖的传递性，即本项目不会依赖父项目中optional设置为true的依赖。</li></ul><h3 id="2-4-4-依赖范围"><a href="#2-4-4-依赖范围" class="headerlink" title="2.4.4 依赖范围"></a>2.4.4 依赖范围</h3><p>还有一些其他元素：</p><ul><li><p>scope：依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来</p><ul><li>compile：默认范围，用于编译;   </li><li>provided：类似于编译，但支持jdk或者容器提供，类似于classpath </li><li>runtime: 在执行时需要使用;         </li><li>systemPath: 仅用于范围为system，提供相应的路径 </li><li>test: 用于test任务时使用;             </li><li>system: 需要外在提供相应的元素，通过systemPath来取得 </li><li>optional: 当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用</li></ul></li><li><p>systemPath：该元素为依赖规定了文件系统上的绝对路径。仅在scope设置成system时才会使用。不推荐使用这个元素。不推荐使用绝对路径，如果必须要用，推荐使用属性匹配绝对路径，例如${java.home}</p></li></ul><h2 id="2-5-生成文档相关的元素"><a href="#2-5-生成文档相关的元素" class="headerlink" title="2.5 生成文档相关的元素"></a>2.5 生成文档相关的元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目的名称, Maven生成文档使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>project-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目主页的URL, Maven生成文档使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://123.a.b/nsnxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 项目的详细描述, Maven生成文档使用。当这个元素能够用HTML格式描述时，不鼓励使用纯文本描述 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果你需要修改生成的web站点的索引页面，你应该修改你自己的索引页文件，而不是调整这里的文档 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Description of this maven project<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure><p>备注：maven可以通过mvn site命令生成项目的相关文档。</p><p>和生成文档相关的元素，包括name，url，和description。</p><ul><li>name：项目名称，maven生成文档会使用项目名；</li><li>url：项目主页的地址，maven生成文档的时候使用。</li><li>description：项目描述。如果可以使用HTML格式进行描述的时候，不推荐使用纯文本的描述。</li></ul><h2 id="2-6-远程仓库列表"><a href="#2-6-远程仓库列表" class="headerlink" title="2.6 远程仓库列表"></a>2.6 远程仓库列表</h2><p>远程仓库列表的配置，包括依赖和扩展的远程仓库配置，以及插件的远程仓库配置。在本地仓库找不到的情况下，maven下载依赖、扩展和插件就是从这里配置的远程仓库中进行下载。</p><p>需要注意的是release和snapshot两者的区别。release是稳定版本，一经发布不再修改，想发布修改后的项目，只能升级项目版本再进行发布；snapshot是不稳定的，一个snapshot的版本可以不断改变。项目在开发期间一般会使用snapshot，更方便进行频繁的代码更新；一旦发布到外部，或者开发基本完成，代码迭代不再频繁，则推荐使用release。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--值为true或者false，表示该仓库是否为下载某种类型构件（发布版，快照版）开启。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--选项：always，daily（默认），interval：X（X单位为分钟），或者never。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做。选项：ignore，fail，或者warn --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如何处理远程仓库里快照版本的下载 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 有了releases和snapshots这两组配置，就可以在每个单独的仓库中，为每种类型的构件采取不同的策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--远程仓库唯一标识符。可以用来匹配在settings.xml文件里配置的远程仓库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-repository-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程仓库名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxs-repository-proxy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.169:9999/repository/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用于定位和排序构件的仓库布局类型。可以是default或者legacy --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息。参见repositories/repository元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-7-项目分发信息相关元素"><a href="#2-7-项目分发信息相关元素" class="headerlink" title="2.7 项目分发信息相关元素"></a>2.7 项目分发信息相关元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目分发信息，在执行mvn deploy后表示要发布的位置。用于把网站部署到远程服务器或者把构件部署到远程仓库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--部署项目产生的构件到远程仓库需要的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 是分配给快照一个唯一的版本号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 其他配置参见repositories/repository元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxsmaven2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;basedir&#125;/target/deploy<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构件的快照部署的仓库。默认部署到distributionManagement/repository元素配置的仓库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nanxs-maven2 Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/nanxs:/usr/local/maven-snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--部署项目的网站需要的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">site</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的唯一标识符，用来匹配站点和settings.xml文件里的配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nanxs-site<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>business api website<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署位置的URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/nanxs:/var/www/localhost/nanxs-web<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">site</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目下载页面的URL。如果没有该元素，用户应该参考主页 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本元素是为了帮助定位那些不在仓库里的构件(license限制) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">downloadUrl</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果构件有了新的group ID和artifact ID（构件移到了新的位置），这里列出构件的重定位信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的group ID --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的artifact ID --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件新的版本号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--显示给用户的，关于移动的额外信息，例如原因 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 给出该构件在远程仓库的状态。本地项目中不能设置该元素，因为这是工具自动更新的 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 有效的值有：none（默认），converted（仓库管理员从 Maven 1 POM转换过来），</span></span><br><span class="line"><span class="comment">        partner（直接从伙伴Maven 2仓库同步过来），deployed（从Maven 2实例部署），</span></span><br><span class="line"><span class="comment">        verified（被核实时正确的和最终的） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">status</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目分发信息的相关配置，在distributionManagement中设置。设置的内容包括：</p><ul><li>repository和snapshotRepository：项目产生的构建/快照构建部署的远程仓库。如果不配置</li><li>snapshotRepository，快照也会部署到repository中；</li><li>site：部署项目的网站需要的信息；</li><li>downloadUrl：项目下载页面的URL，这是为不在仓库中的构建提供的；</li><li>relocation：如果构件有了新的group ID和artifact ID（移到了新的位置），这里列出构件的新的信息；</li><li>status：给出该构件在远程仓库的状态，本地项目中不能设置该元素，这是工具自动更新的。</li></ul><h2 id="2-8-报表规范"><a href="#2-8-报表规范" class="headerlink" title="2.8 报表规范"></a>2.8 报表规范</h2><p>报表规范描述的是使用mvn site命令时使用的一些配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该元素描述使用报表插件产生报表的规范 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当用户执行"mvn site"，这些报表就会运行，在页面导航栏能看到所有报表的链接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--网站是否排除默认的报表。这包括"项目信息"菜单中的报表。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">excludeDefaults</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--所有产生的报表存放到哪里。默认值是$&#123;project.build.directory&#125;/site。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用的报表插件和他们的配置。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--plugin元素包含描述报表插件需要的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--报表插件定位：groupId + artifactId + version --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--报表插件的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 一组报表的多重规范，每个规范可能有不同的配置。一个规范（报表集）对应一个执行目标 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 例如，有1~9这9个报表。1，2构成A报表集，对应一个执行目标；2，5构成B报表集，对应另一个执行目标 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--表示报表的一个集合，以及产生该集合的配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--报表集合的唯一标识符，POM继承时用到 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--产生报表集合时，被使用的报表的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置是否被继承到子POMs --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--这个集合里使用到哪些报表 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-9-profile配置"><a href="#2-9-profile配置" class="headerlink" title="2.9 profile配置"></a>2.9 profile配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在列的项目构建profile，如果被激活，会修改构建处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据环境参数或命令行参数激活某个构建处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构建配置的唯一标识符。即用于命令行激活，也用于在继承时合并具有相同标识符的profile。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙，profile的力量来自于它 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--profile默认是否激活的标志 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdk</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统的名字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统所属家族(如 'windows') --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统体系结构 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的操作系统版本 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;名称&#125;引用），其拥有对应的名称和值，Profile就会被激活 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如果值字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的属性的名称 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--激活profile的属性的值 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活profile --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--另一方面，exists则会检查文件是否存在，如果存在则激活profile --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exists</span>&gt;</span>/usr/local/abcd/abcd-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                <span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">missing</span>&gt;</span>/usr/local/abcd/abcd-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                <span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--构建项目所需要的信息。参见build元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。详情参见repositories元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表。详情参见pluginRepositories元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepositories</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 详细配置参见dependencies --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素包括使用报表插件产生报表的规范。当用户执行"mvn site"，这些报表就会运行。在页面导航栏能看到所有报表的链接。参见reporting元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">reporting</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见dependencyManagement元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencyManagement</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见distributionManagement元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distributionManagement</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--参见properties元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-10-邮件列表和持续集成配置"><a href="#2-10-邮件列表和持续集成配置" class="headerlink" title="2.10 邮件列表和持续集成配置"></a>2.10 邮件列表和持续集成配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目持续集成信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--持续集成系统的名字，例如continuum --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该项目使用的持续集成系统的URL（如果持续集成系统有web接口的话）。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建完成时，需要通知的开发者/用户的配置项。包括被通知者信息和通知条件（错误，失败，成功，警告） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">notifiers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置一种方式，当构建中断时，以该方式通知用户/开发者 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">notifier</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--传送通知的途径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发生错误时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnError</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建失败时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnFailure</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建成功时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnSuccess</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发生警告时是否通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sendOnWarning</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--不赞成使用。通知发送到哪里 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">address</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--扩展配置项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">notifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">notifiers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目相关邮件列表信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目相关的所有邮件列表。自动产生的网站引用这些信息。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mailingList</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--邮件的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--发送邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">post</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">post</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">subscribe</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">subscribe</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--取消订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">unsubscribe</span>&gt;</span>nanxs@123.com<span class="tag">&lt;/<span class="name">unsubscribe</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--你可以浏览邮件信息的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">archive</span>&gt;</span>http:/a.b.c/nanxs/demo/dev/<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mailingList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-11-项目的描述性信息"><a href="#2-11-项目的描述性信息" class="headerlink" title="2.11 项目的描述性信息"></a>2.11 项目的描述性信息</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--项目的问题管理系统(Bugzilla, Jira, Scarab,或任何你喜欢的问题管理系统)的名称和URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--问题管理系统（例如jira）的名字， --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span>&gt;</span>jira<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该项目使用的问题管理系统的URL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jira.baidu.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目创建年份，4位数字。当产生版权信息时需要使用这个值。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">inceptionYear</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目开发者列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--某个项目开发者的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SCM里项目开发者的唯一标识符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>HELLO WORLD<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的全名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>nanxs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的email --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span>&gt;</span>123@abc.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者的主页的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者在项目中扮演的角色，角色元素描述了各种角色 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">roles</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">role</span>&gt;</span>Project Manager<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">role</span>&gt;</span>Architect<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">roles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所属组织 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organization</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所属组织的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者属性，如即时消息如何处理等 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dept</span>&gt;</span>No<span class="tag">&lt;/<span class="name">dept</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目开发者所在时区， -11到12范围内的整数。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--项目的其他贡献者列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contributors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的其他贡献者。参见developers/developer元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contributor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">email</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organization</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">organizationUrl</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">roles</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timezone</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">contributor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--该元素描述了项目所有License列表。 应该只列出该项目的license列表，不要列出依赖项目的license列表 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果列出多个license，用户可以选择它们中的一个而不是接受所有license --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--描述了项目的license，用于生成项目的web站点的license页面，其他一些报表和validation也会用到该元素。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--license用于法律上的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Apache 2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--官方的license正文页面的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs/LICENSE-1.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目分发的主要方式： repo，可以从Maven库下载 manual， 用户必须手动下载和安装依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--关于license的补充信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comments</span>&gt;</span>A business-friendly OSS license<span class="tag">&lt;/<span class="name">comments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--SCM(Source Control Management)标签允许你配置你的代码库，供Maven web站点和其它插件使用。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SCM的URL,该URL描述了版本库和如何连接到版本库。该连接只读 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:svn:http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--给开发者使用的，类似connection元素。即该连接不仅仅只读 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:svn:http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当前代码的标签，在开发阶段默认为HEAD --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指向项目的可浏览SCM库（例如ViewVC或者Fisheye）的URL。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--描述项目所属组织的各种属性。Maven产生的文档用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">organization</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组织的全名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组织主页的URL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://a.b.com/nanxs<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-12-其他配置"><a href="#2-12-其他配置" class="headerlink" title="2.12 其他配置"></a>2.12 其他配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--描述了这个项目构建环境中的前提条件。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建该项目或使用该插件所需要的Maven的最低版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--以值替代名称，Properties可以在整个POM中使用，也可以作为触发条件（见settings.xml中activation元素的说明） --&gt;</span></span><br><span class="line">&lt;!-格式是&lt;name&gt;value&lt;/name&gt;。 --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--不推荐使用，现在Maven忽略该元素. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reports</span>&gt;</span><span class="tag">&lt;/<span class="name">reports</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_38569499/article/details/91456988&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/weixin_38569499/article/details/91456988&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-maven项目目录结构&quot;&gt;&lt;a href=&quot;#1-maven项目目录结构&quot; class=&quot;headerlink&quot; title=&quot;1 maven项目目录结构&quot;&gt;&lt;/a&gt;1 maven项目目录结构&lt;/h1&gt;&lt;p&gt;  pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。&lt;/p&gt;
&lt;p&gt;  maven的遵循约定大于配置，约定了如下的目录结构：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;目的&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;${basedir}&lt;/td&gt;
&lt;td&gt;存放pom.xml和所有的子目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/java&lt;/td&gt;
&lt;td&gt;项目的java源代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/resources&lt;/td&gt;
&lt;td&gt;项目的资源，比如说property文件，springmvc.xml&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/test/java&lt;/td&gt;
&lt;td&gt;项目的测试类，比如说Junit代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/test/resources&lt;/td&gt;
&lt;td&gt;测试用的资源&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/scripts&lt;/td&gt;
&lt;td&gt;项目脚本源码的目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/src/main/webapp/WEB-INF&lt;/td&gt;
&lt;td&gt;web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target&lt;/td&gt;
&lt;td&gt;打包输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/classes&lt;/td&gt;
&lt;td&gt;编译输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/site&lt;/td&gt;
&lt;td&gt;生成文档的目录，可以通过index.html查看项目的文档&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;${basedir}/target/test-classes&lt;/td&gt;
&lt;td&gt;测试编译输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Test.java&lt;/td&gt;
&lt;td&gt;Maven只会自动运行符合该命名规则的测试类&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;~/.m2/repository&lt;/td&gt;
&lt;td&gt;Maven默认的本地仓库目录位置&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
    
    </summary>
    
      <category term="java" scheme="https://gongzhao1.gitee.io/categories/java/"/>
    
    
      <category term="maven" scheme="https://gongzhao1.gitee.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes之StorageClassss——nfs-client</title>
    <link href="https://gongzhao1.gitee.io/Kubernetes%E4%B9%8BStorageClassss%E2%80%94%E2%80%94nfs-client/"/>
    <id>https://gongzhao1.gitee.io/Kubernetes之StorageClassss——nfs-client/</id>
    <published>2020-05-24T09:04:47.000Z</published>
    <updated>2020-05-24T15:37:51.854Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考"><a href="#0-参考" class="headerlink" title="0 参考"></a>0 参考</h1><ul><li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></li><li><a href="http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5" target="_blank" rel="noopener">http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5</a></li></ul><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p> Kubernetes集群管理员通过提供不同的存储类，可以满足用户不同的服务质量级别、备份策略和任意策略要求的存储需求。动态存储卷供应使用StorageClass进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes将能够按照用户的需要，自动创建其需要的存储。</p><p>比如，我们可能会在kubernetes集群中安装一些带持久化数据功能的服务，例如redis、mysql、mq、es等。因此，当有这类需求时，我们必须给整个集群给定一个特定的存储方案。本章我们是NFS的网络存储方案</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/kubernetes/storageclass.png" alt="image"></p><a id="more"></a><h2 id="2-部署"><a href="#2-部署" class="headerlink" title="2 部署"></a>2 部署</h2><h2 id="2-1-NFS服务器"><a href="#2-1-NFS服务器" class="headerlink" title="2.1 NFS服务器"></a>2.1 NFS服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install rpcbind  nfs-utils</span><br><span class="line"></span><br><span class="line">mkdir /nfs_data</span><br><span class="line"></span><br><span class="line">chmod +w /nfs_data</span><br><span class="line"></span><br><span class="line">chmod +x /nfs_data</span><br></pre></td></tr></table></figure><p>编辑/etc/exports,内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nfs_data 192.168.11.0/24(rw,no_root_squash)</span><br></pre></td></tr></table></figure><p>启动nfs服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nfs start #启动nfs服务</span><br><span class="line">service rpcbind start  #启动rpc服务</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.11.24 #查看共享盘 ok</span><br></pre></td></tr></table></figure><h2 id="2-2-使用helm部署nfs-client"><a href="#2-2-使用helm部署nfs-client" class="headerlink" title="2.2 使用helm部署nfs-client"></a>2.2 使用helm部署nfs-client</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm search nfs-client</span><br><span class="line">helm fetch nfs-client</span><br></pre></td></tr></table></figure><p>编辑helm的values文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nfs.server=192.168.11.24</span><br><span class="line">nfs.path=/nfs_data</span><br><span class="line">storageClass.defaultClass=true</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install ....</span><br></pre></td></tr></table></figure><h1 id="3-测试"><a href="#3-测试" class="headerlink" title="3 测试"></a>3 测试</h1><p>创建一个pvc使用默认的storageclass，查看pv是否自动创建成功</p><p>如果没有将nfs-client设为默认的storageclass，可使用以下命令进行操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 `&lt;your-class-name&gt;` 是您选择的 StorageClass 的名字。</span></span><br><span class="line">kubectl patch storageclass &lt;your-class-name&gt; -p <span class="string">'&#123;"metadata": &#123;"annotations":&#123;"storageclass.kubernetes.io/is-default-class":"true"&#125;&#125;&#125;'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考&quot;&gt;&lt;a href=&quot;#0-参考&quot; class=&quot;headerlink&quot; title=&quot;0 参考&quot;&gt;&lt;/a&gt;0 参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/storage/storage-classes/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.io/docs/concepts/storage/storage-classes/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://tingcream.com/blogArticle/detail/28acd1174a49432ba733cf6bbfa077a5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-简介&quot;&gt;&lt;a href=&quot;#1-简介&quot; class=&quot;headerlink&quot; title=&quot;1 简介&quot;&gt;&lt;/a&gt;1 简介&lt;/h1&gt;&lt;p&gt; Kubernetes集群管理员通过提供不同的存储类，可以满足用户不同的服务质量级别、备份策略和任意策略要求的存储需求。动态存储卷供应使用StorageClass进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes将能够按照用户的需要，自动创建其需要的存储。&lt;/p&gt;
&lt;p&gt;比如，我们可能会在kubernetes集群中安装一些带持久化数据功能的服务，例如redis、mysql、mq、es等。因此，当有这类需求时，我们必须给整个集群给定一个特定的存储方案。本章我们是NFS的网络存储方案&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/kubernetes/storageclass.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://gongzhao1.gitee.io/categories/kubernetes/"/>
    
    
      <category term="storageclass" scheme="https://gongzhao1.gitee.io/tags/storageclass/"/>
    
  </entry>
  
  <entry>
    <title>跨域资源共享 CORS 详解</title>
    <link href="https://gongzhao1.gitee.io/%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB-CORS-%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.gitee.io/跨域资源共享-CORS-详解/</id>
    <published>2020-05-24T08:53:05.000Z</published>
    <updated>2020-05-24T15:38:06.004Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-转载"><a href="#0-转载" class="headerlink" title="0 转载"></a>0 转载</h1><ul><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></li></ul><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p><p>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p><p>因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。</p><a id="more"></a><h1 id="2-两种请求"><a href="#2-两种请求" class="headerlink" title="2 两种请求"></a>2 两种请求</h1><p>浏览器将CORS请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。</p><p>只要同时满足以下两大条件，就属于简单请求。</p><blockquote><p>（1) 请求方法是以下三种方法之一：</p><ul><li>HEAD</li><li>GET</li><li>POST</li></ul><p>（2）HTTP的头信息不超出以下几种字段：</p><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Last-Event-ID</li><li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li></ul></blockquote><p>这是为了兼容表单（form），因为历史上表单一直可以发出跨域请求。AJAX 的跨域设计就是，只要表单可以发，AJAX 就可以直接发。</p><p>凡是不同时满足上面两个条件，就属于非简单请求。</p><p>浏览器对这两种请求的处理，是不一样的。</p><h1 id="3-简单请求"><a href="#3-简单请求" class="headerlink" title="3 简单请求"></a>3 简单请求</h1><h2 id="3-1-基本流程"><a href="#3-1-基本流程" class="headerlink" title="3.1 基本流程"></a>3.1 基本流程</h2><p>对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个<code>Origin</code>字段。</p><p>下面是一个例子，浏览器发现这次跨源AJAX请求是简单请求，就自动在头信息之中，添加一个<code>Origin</code>字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; GET /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的头信息中，<code>Origin</code>字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</p><p>如果<code>Origin</code>指定的源，不在许可范围内，服务器会返回一个正常的HTTP回应。浏览器发现，这个回应的头信息没有包含<code>Access-Control-Allow-Origin</code>字段（详见下文），就知道出错了，从而抛出一个错误，被<code>XMLHttpRequest</code>的<code>onerror</code>回调函数捕获。注意，这种错误无法通过状态码识别，因为HTTP回应的状态码有可能是200。</p><p>如果<code>Origin</code>指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt; Access-Control-Expose-Headers: FooBar</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的头信息之中，有三个与CORS请求相关的字段，都以<code>Access-Control-</code>开头。</p><p><strong>（1）Access-Control-Allow-Origin</strong></p><p>该字段是必须的。它的值要么是请求时<code>Origin</code>字段的值，要么是一个<code>*</code>，表示接受任意域名的请求。</p><p><strong>（2）Access-Control-Allow-Credentials</strong></p><p>该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为<code>true</code>，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为<code>true</code>，如果服务器不要浏览器发送Cookie，删除该字段即可。</p><p><strong>（3）Access-Control-Expose-Headers</strong></p><p>该字段可选。CORS请求时，<code>XMLHttpRequest</code>对象的<code>getResponseHeader()</code>方法只能拿到6个基本字段：<code>Cache-Control</code>、<code>Content-Language</code>、<code>Content-Type</code>、<code>Expires</code>、<code>Last-Modified</code>、<code>Pragma</code>。如果想拿到其他字段，就必须在<code>Access-Control-Expose-Headers</code>里面指定。上面的例子指定，<code>getResponseHeader(&#39;FooBar&#39;)</code>可以返回<code>FooBar</code>字段的值。</p><h2 id="3-2-withCredentials-属性"><a href="#3-2-withCredentials-属性" class="headerlink" title="3.2 withCredentials 属性"></a>3.2 withCredentials 属性</h2><p>上面说到，CORS请求默认不发送Cookie和HTTP认证信息。如果要把Cookie发到服务器，一方面要服务器同意，指定<code>Access-Control-Allow-Credentials</code>字段。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>另一方面，开发者必须在AJAX请求中打开<code>withCredentials</code>属性。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt; xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>否则，即使服务器同意发送Cookie，浏览器也不会发送。或者，服务器要求设置Cookie，浏览器也不会处理。</p><p>但是，如果省略<code>withCredentials</code>设置，有的浏览器还是会一起发送Cookie。这时，可以显式关闭<code>withCredentials</code>。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; xhr.withCredentials = <span class="literal">false</span>;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>需要注意的是，如果要发送Cookie，<code>Access-Control-Allow-Origin</code>就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的<code>document.cookie</code>也无法读取服务器域名下的Cookie。</p><h1 id="4-非简单请求"><a href="#4-非简单请求" class="headerlink" title="4 非简单请求"></a>4 非简单请求</h1><h2 id="4-1-预检请求"><a href="#4-1-预检请求" class="headerlink" title="4.1 预检请求"></a>4.1 预检请求</h2><p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是<code>PUT</code>或<code>DELETE</code>，或者<code>Content-Type</code>字段的类型是<code>application/json</code>。</p><p>非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p><p>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的<code>XMLHttpRequest</code>请求，否则就报错。</p><p>下面是一段浏览器的JavaScript脚本。</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> url = <span class="string">'http://api.alice.com/cors'</span>;</span><br><span class="line">&gt; <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&gt; xhr.open(<span class="string">'PUT'</span>, url, <span class="literal">true</span>);</span><br><span class="line">&gt; xhr.setRequestHeader(<span class="string">'X-Custom-Header'</span>, <span class="string">'value'</span>);</span><br><span class="line">&gt; xhr.send();</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面代码中，HTTP请求的方法是<code>PUT</code>，并且发送一个自定义头信息<code>X-Custom-Header</code>。</p><p>浏览器发现，这是一个非简单请求，就自动发出一个”预检”请求，要求服务器确认可以这样请求。下面是这个”预检”请求的HTTP头信息。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; OPTIONS /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Request-Method: PUT</span><br><span class="line">&gt; Access-Control-Request-Headers: X-Custom-Header</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>“预检”请求用的请求方法是<code>OPTIONS</code>，表示这个请求是用来询问的。头信息里面，关键字段是<code>Origin</code>，表示请求来自哪个源。</p><p>除了<code>Origin</code>字段，”预检”请求的头信息包括两个特殊字段。</p><p><strong>（1）Access-Control-Request-Method</strong></p><p>该字段是必须的，用来列出浏览器的CORS请求会用到哪些HTTP方法，上例是<code>PUT</code>。</p><p><strong>（2）Access-Control-Request-Headers</strong></p><p>该字段是一个逗号分隔的字符串，指定浏览器CORS请求会额外发送的头信息字段，上例是<code>X-Custom-Header</code>。</p><h2 id="4-2-预检请求的回应"><a href="#4-2-预检请求的回应" class="headerlink" title="4.2 预检请求的回应"></a>4.2 预检请求的回应</h2><p>服务器收到”预检”请求以后，检查了<code>Origin</code>、<code>Access-Control-Request-Method</code>和<code>Access-Control-Request-Headers</code>字段以后，确认允许跨源请求，就可以做出回应。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; HTTP/1.1 200 OK</span><br><span class="line">&gt; Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">&gt; Server: Apache/2.0.61 (Unix)</span><br><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">&gt; Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt; Content-Encoding: gzip</span><br><span class="line">&gt; Content-Length: 0</span><br><span class="line">&gt; Keep-Alive: timeout=2, max=100</span><br><span class="line">&gt; Connection: Keep-Alive</span><br><span class="line">&gt; Content-Type: text/plain</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面的HTTP回应中，关键的是<code>Access-Control-Allow-Origin</code>字段，表示<code>http://api.bob.com</code>可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: *</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>如果服务器否定了”预检”请求，会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被<code>XMLHttpRequest</code>对象的<code>onerror</code>回调函数捕获。控制台会打印出如下的报错信息。</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; XMLHttpRequest cannot load http://api.alice.com.</span><br><span class="line">&gt; Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>服务器回应的其他CORS相关字段如下。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">&gt; Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">&gt; Access-Control-Allow-Credentials: true</span><br><span class="line">&gt; Access-Control-Max-Age: 1728000</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p><strong>（1）Access-Control-Allow-Methods</strong></p><p>该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次”预检”请求。</p><p><strong>（2）Access-Control-Allow-Headers</strong></p><p>如果浏览器请求包括<code>Access-Control-Request-Headers</code>字段，则<code>Access-Control-Allow-Headers</code>字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在”预检”中请求的字段。</p><p><strong>（3）Access-Control-Allow-Credentials</strong></p><p>该字段与简单请求时的含义相同。</p><p><strong>（4）Access-Control-Max-Age</strong></p><p>该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是20天（1728000秒），即允许缓存该条回应1728000秒（即20天），在此期间，不用发出另一条预检请求。</p><h2 id="4-3-浏览器的正常请求和回应"><a href="#4-3-浏览器的正常请求和回应" class="headerlink" title="4.3 浏览器的正常请求和回应"></a>4.3 浏览器的正常请求和回应</h2><p>一旦服务器通过了”预检”请求，以后每次浏览器正常的CORS请求，就都跟简单请求一样，会有一个<code>Origin</code>头信息字段。服务器的回应，也都会有一个<code>Access-Control-Allow-Origin</code>头信息字段。</p><p>下面是”预检”请求之后，浏览器的正常CORS请求。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; PUT /cors HTTP/1.1</span><br><span class="line">&gt; Origin: http://api.bob.com</span><br><span class="line">&gt; Host: api.alice.com</span><br><span class="line">&gt; X-Custom-Header: value</span><br><span class="line">&gt; Accept-Language: en-US</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; User-Agent: Mozilla/5.0...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面头信息的<code>Origin</code>字段是浏览器自动添加的。</p><p>下面是服务器正常的回应。</p><blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>上面头信息中，<code>Access-Control-Allow-Origin</code>字段是每次回应都必定包含的。</p><h1 id="5-与JSONP的比较"><a href="#5-与JSONP的比较" class="headerlink" title="5 与JSONP的比较"></a>5 与JSONP的比较</h1><p>CORS与JSONP的使用目的相同，但是比JSONP更强大。</p><p>JSONP只支持<code>GET</code>请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-转载&quot;&gt;&lt;a href=&quot;#0-转载&quot; class=&quot;headerlink&quot; title=&quot;0 转载&quot;&gt;&lt;/a&gt;0 转载&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/04/cors.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ruanyifeng.com/blog/2016/04/cors.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-简介&quot;&gt;&lt;a href=&quot;#1-简介&quot; class=&quot;headerlink&quot; title=&quot;1 简介&quot;&gt;&lt;/a&gt;1 简介&lt;/h1&gt;&lt;p&gt;CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。&lt;/p&gt;
&lt;p&gt;整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。&lt;/p&gt;
&lt;p&gt;因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。&lt;/p&gt;
    
    </summary>
    
    
      <category term="cors" scheme="https://gongzhao1.gitee.io/tags/cors/"/>
    
  </entry>
  
  <entry>
    <title>OAuth详解</title>
    <link href="https://gongzhao1.gitee.io/OAuth%E8%AF%A6%E8%A7%A3/"/>
    <id>https://gongzhao1.gitee.io/OAuth详解/</id>
    <published>2020-05-24T08:08:24.000Z</published>
    <updated>2020-05-24T15:36:44.984Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0-参考文章"><a href="#0-参考文章" class="headerlink" title="0 参考文章"></a>0 参考文章</h1><ul><li><a href="https://www.jianshu.com/p/b06944c92228" target="_blank" rel="noopener">https://www.jianshu.com/p/b06944c92228</a></li><li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></li></ul><h1 id="1-什么是OAuth"><a href="#1-什么是OAuth" class="headerlink" title="1 什么是OAuth"></a>1 什么是OAuth</h1><p>官网这样说…</p><blockquote><p>An <strong>open protocol</strong> to allow <strong>secure authorization</strong> in a <strong>simple</strong> and <strong>standard</strong> method from web, mobile and desktop applications.</p></blockquote><ul><li>OAuth 即 <strong>O</strong>pen standard for <strong>Auth</strong>orization</li><li>OAuth就是一个网络开放协议。为保证用户资源的安全授权提供了简易的标准</li><li>在知乎上看到了一个比较直观的比喻，有助于初学者理解。<a href="https://link.jianshu.com?t=http://www.zhihu.com/question/19781476" target="_blank" rel="noopener">知乎话题链接</a></li></ul><h1 id="2-OAuth历史版本"><a href="#2-OAuth历史版本" class="headerlink" title="2 OAuth历史版本"></a>2 OAuth历史版本</h1><p><strong>2007-12</strong> OAuth 1.0发布并迅速成为工业标准。</p><p><strong>2008-06</strong> OAuth 1.0 Revision A发布，这是个稍作修改的修订版本，主要修正一个安全方面的漏洞。</p><p><strong>2010-04</strong>，OAuth 1.0 协议发布为 <a href="https://link.jianshu.com?t=http://www.rfcreader.com/#rfc5849" target="_blank" rel="noopener">RFC 5849</a></p><p><strong>2011-05</strong> OAuth 2.0 草案发布</p><p><strong>2012-10</strong> OAuth 2.0 协议发布为 <a href="https://link.jianshu.com?t=http://www.rfcreader.com/#rfc6749" target="_blank" rel="noopener">RFC 6749</a></p><a id="more"></a><h1 id="3-OAuth-1-0"><a href="#3-OAuth-1-0" class="headerlink" title="3 OAuth 1.0"></a>3 OAuth 1.0</h1><p>OAuth 1.0 协议过于复杂，易用性差，所以并没有得到普及，下文中给出了授权的流程图，可以简单了解了解，现在很少有用的了。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/1.webp" alt="image"></p><p>关于OAuth 1.0， 想了解的可以看看这些：</p><ul><li><a href="https://link.jianshu.com/?t=http://www.rfcreader.com/#rfc5849" target="_blank" rel="noopener">RFC 5849</a></li><li><a href="https://link.jianshu.com/?t=http://blog.csdn.net/hereweare2009/article/details/3968582" target="_blank" rel="noopener">OAUTH协议简介</a></li></ul><h1 id="4-OAuth-2-0"><a href="#4-OAuth-2-0" class="headerlink" title="4 OAuth 2.0"></a>4 OAuth 2.0</h1><p>OAuth 2.0是目前的最新版本，OAuth 2.0不兼容OAuth 1.0。这篇文章主要讲讲OAuth 2.0，并以此展开。</p><p><strong>先来说一个场景：</strong>比如你第一次打开简书官网，想要注册一个账号。你会看到简书允许你通过新浪微博账号登陆。当你点击之后，需要你登陆微博。之后会出现“是否同意简书获取你的个人信息”等等，如果你选择授权，之后会跳转回简书。你会发现你在简书的用户名就是你微博的用户名。然后，你会发出一条新的微博比如“我加入了简书，一个基于内容分享的社区！”(这只是举个例子，不知道简书有没有这样做)。</p><p>好了，这回开始进入正题</p><h2 id="4-1-角色（roles）"><a href="#4-1-角色（roles）" class="headerlink" title="4.1 角色（roles）"></a>4.1 角色（roles）</h2><p>OAuth 2.0 定义了<strong>四个角色</strong>：</p><ul><li><strong>资源拥有者(Resource Owner)</strong><br> 资源拥有者其实就是用户(user)，用户将会授权一个第三方应用可以获取他们的账户资源。当然第三方应用程序对于用户账户的操作是有限制的(比如，read access, read and write access)！这个限制就是用户授权时给予的权限范围(<strong>scope</strong>)<br> 上面场景中，微博账户就是资源拥有者。read access就比如读取微博用户名，write access就比如以你的名义发了一个微博。</li><li><strong>客户端(Client)</strong><br> 客户端就是前面说的第三方应用程序，他们想要获取用户的账户资源，但在这么做之前必须经过授权<br> 上面场景中，简书就是客户端</li><li><strong>资源服务器(Resource Server)</strong><br> 资源服务器存放用户账户以及账户信息和资源<br> 上面场景中，新浪微博就是资源服务器，同时也是授权服务器</li><li><strong>授权服务器(Authorization Server)</strong><br> 授权服务器验证用户身份，并为第三方应用程序颁发授权令牌(access token)</li></ul><p>资源服务器与授权服务器可以是同一台服务器，这里分开主要是便于解释清楚OAuth协议。从程序开发者的角度，这两个都是service’s API会执行的事情。</p><p>在了解完OAuth中的四个角色之后，我们看看这四个角色之间是如何互动的。下面是基本运行流程。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/2.webp" alt="image"></p><ol><li>应用程序向用户请求给予授权，以便获取服务器资源</li></ol><ul><li>如果用户同意授权，应用程序将获得相应授权</li><li>应用程序向授权服务器提供自己的身份证明(app key和app secret)和已被授权的证明(authorization grant)，并请求访问令牌(access token)</li><li>如果应用程序的身份被核实，并且授权是有效地，那么授权服务器将会发放访问令牌给应用程序。<strong>此时，授权完成</strong></li><li>应用程序向资源服务器出示访问令牌，并请求资源</li><li>如果访问令牌是有效的(比如：是否伪造，是否越权，是否过期)，资源服务器将会为应用程序提供资源</li></ul><h2 id="4-2-应用程序注册-Application-Registration"><a href="#4-2-应用程序注册-Application-Registration" class="headerlink" title="4.2 应用程序注册(Application Registration)"></a>4.2 应用程序注册(Application Registration)</h2><p>对于一个应用程序来说，如果它想要使用OAuth，那么首先它要在服务提供商那里注册。一般出现在网站的“developer”或者“API”部分。</p><p>应用程序要提供：</p><ul><li>应用程序名称(Application Name)</li><li>应用程序网站(Application Website)</li><li>回调URL(Redirect URI or Callback URL)</li></ul><p>在用户同意授权(或者拒绝)之后，服务提供商会将用户重新导向这个Callback URL，这个Callback URL要来负责处理授权码或者访问令牌。</p><p>应用程序注册完成之后，服务提供商会颁发给应用程序一个“客户端认证信息(client credentials)”。Client Credential包括：</p><ul><li><p>Client Identifier</p><p>(client ID/API key/consumer key)</p><ul><li>提供给服务提供商，用于<strong>识别</strong>(identify)应用程序</li><li>用于构建提供给用户请求授权的URLs</li></ul></li><li><p>Client Secret</p><p>(secret key/API secret/consumer secret)</p><ul><li>提供给服务提供商，用于<strong>验证</strong>(authenticate)应用程序</li><li>只有应用程序和服务提供商两者可知</li></ul></li></ul><h2 id="4-3-授权许可类型-Authorization-grant-types"><a href="#4-3-授权许可类型-Authorization-grant-types" class="headerlink" title="4.3 授权许可类型(Authorization grant types)"></a>4.3 授权许可类型(Authorization grant types)</h2><p><strong>OAuth 2.0 定义了四种授权模式：</strong></p><ul><li><strong>授权码模式</strong>(Authorization Code)<br> used with server-side Applications</li><li><strong>隐式授权模式</strong>(Implicit)<br> used with Mobile Apps or Web Applications (applications that run on the user’s device)</li><li><strong>资源拥有者密码凭证模式</strong>(Resource Owner Password Credentials)<br> used with trusted Applications, such as those owned by the service itself</li><li><strong>客户端模式</strong>(Client Credentials)<br> used with Applications API access</li></ul><h2 id="4-4-授权码模式-Authorization-Code"><a href="#4-4-授权码模式-Authorization-Code" class="headerlink" title="4.4 授权码模式(Authorization Code)"></a>4.4 授权码模式(Authorization Code)</h2><ul><li>授权码模式是最常见的一种授权模式，最为安全和完善。</li><li>对于服务器端应用程序(server-side application)来说，可以保证Client Secret的安全性。应用程序必须能够和用户代理(user agent)进行交互，获取API授权码。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/3.webp" alt="image"></p><p><strong>第一步：客户端把用户代理定向到授权终端(Authorizaiton Endpoint)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com/v1/oauth/authorize?response_type=code&amp;client_id=CLIENT_ID&amp;redirect_uri=CALLBACK_URL&amp;scope=<span class="built_in">read</span></span><br></pre></td></tr></table></figure><ul><li><strong><a href="https://link.jianshu.com?t=http://www.example.com/v1/oauth/authorize" target="_blank" rel="noopener">www.example.com/v1/oauth/authorize</a></strong>: API授权的终端(Authorization Endpoint)</li><li><strong>client_id</strong>: 应用程序的client ID，用于API识别应用程序</li><li><strong>redirect_uri</strong>：获得授权码之后，服务提供商重定向用户代理(比如浏览器)的地址</li><li><strong>response_type</strong>：表明授权类型，默认值是code，即授权码模式(Authorization Code Grant)</li><li><strong>scope</strong>: 即应用程序可以获得的授权级别(access level)，默认值为read</li><li><strong>state</strong>: 表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值，用于抵制CSRF攻击。</li></ul><p><strong>第二步：用户授权应用程序</strong></p><p>用户点击上述URI之后，用户首先要登陆，证明其身份。然后选择同意授权应用程序可以访问他们的账户或者拒绝。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/4.webp" alt="image"></p><p><strong>第三步：应用程序获取授权码</strong></p><p>如果用户同意授权，服务提供商会将用户代理重定向到第一步中的redirect_uri，并且会包含<strong>授权码</strong>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.jianshu.com/callback?code=AUTHORIZATION_CODE</span></span><br></pre></td></tr></table></figure><p><strong>第四步：应用程序请求授权令牌</strong></p><p>应用程序向API token终端发送刚刚获得的授权码，以及认证信息。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/v1/oauth/token?client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET&amp;grant_type=authorization_code&amp;code=AUTHORIZATION_CODE&amp;redirect_uri=CALLBACK_URL</span></span><br></pre></td></tr></table></figure><p>URI中包括：</p><ul><li><strong><a href="https://link.jianshu.com?t=http://www.example.com/v1/oauth/token" target="_blank" rel="noopener">www.example.com/v1/oauth/token</a></strong>： API token的终端</li><li><strong>client_id</strong>：即app key/consumer key，用于验证应用程序</li><li><strong>client_secret</strong>： 即app secret/consumer secret，用于验证应用程序</li><li><strong>grant_type</strong>：刚刚获得的授权码</li><li><strong>redirect_uri</strong>: 重定向URI，与第一步一致</li></ul><p><strong>第五步：应用程序获得授权令牌</strong></p><p>如果上一步验证有效，API将返回一个HTTP回复。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"access_token"</span>:<span class="string">"ACCESS_TOKEN"</span>,<span class="attr">"token_type"</span>:<span class="string">"bearer"</span>,<span class="attr">"expires_in"</span>:<span class="number">2592000</span>,<span class="attr">"refresh_token"</span>:<span class="string">"REFRESH_TOKEN"</span>,<span class="attr">"scope"</span>:<span class="string">"read"</span>&#125;</span><br></pre></td></tr></table></figure><p>HTTP回复中包含：</p><ul><li><strong>access_token</strong>：访问令牌</li><li><strong>token_type</strong>：令牌类型，bearer类型或mac类型。<a href="https://link.jianshu.com?t=http://oauth2.thephpleague.com/token-types/" target="_blank" rel="noopener">详细</a></li><li><strong>expires_in</strong>：过期时间，单位为秒。</li><li><strong>refresh_token</strong>：更新令牌，用来获取下一次的访问令牌，可选项。</li><li><strong>scope</strong>：权限范围，如果与客户端申请的范围一致，此项可省略。</li></ul><h2 id="4-5-隐式授权模式-Implicit"><a href="#4-5-隐式授权模式-Implicit" class="headerlink" title="4.5 隐式授权模式(Implicit)"></a>4.5 隐式授权模式(Implicit)</h2><ul><li>隐式授权模式主要用于客户端应用程序(client-side application)，比如手机应用、桌面客户端应用程序和运行于浏览器上的web应用程序。</li><li>因为没有server端，client secret的保密性不能得到保证。授权令牌给予用户代理(比如，浏览器)，再由用户代理交给应用程序。所以用户设备上的其他应用程序同样可以得到授权令牌。</li><li>隐式授权模式中，应用程序不需要认证。</li><li>隐式授权模式不支持refresh token。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/5.webp" alt="image"></p><p><strong>第一步：客户端把用户代理定向到授权终端(Authorizaiton Endpoint)</strong></p><ul><li>授权终端是<code>https://www.example.com/authorize</code></li><li>与授权码链接类似，只不过response_type=<code>token</code>而不是<code>code</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com/authorize?response_type=token&amp;client_id=CLIENT_ID&amp;redirect_uri=CALLBACK_URL&amp;scope=<span class="built_in">read</span></span><br></pre></td></tr></table></figure><p><strong>第二步：用户授权应用程序</strong></p><p>用户点击上述URI之后，用户首先要登陆，证明其身份。然后选择同意授权应用程序可访问他们的账户或者拒绝。</p><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/6.webp" alt="image"></p><p><strong>第三步：用户代理收到授权令牌</strong></p><p>假设用户同意授权，授权服务器重定向用户代理到第一步提到的redirect_uri。并在URI fragment中包含授权令牌(但不能查看)。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.example.com/callback</span><span class="comment">#token=ACCESS_TOKEN</span></span><br></pre></td></tr></table></figure><p><strong>第四步：用户代理向资源服务器发出请求</strong></p><p>用户代理依照重定向的指令，向资源服务器发出请求，但并不包含上一步中得到的授权令牌(#后面的部分)。用户代理将完整的重定向URI保存在本地。</p><p><strong>第五步：资源服务器返回一个网页</strong></p><p>资源服务器会返回一个网页(通常是一个HTML文件内嵌一段脚本)。这段内嵌的脚本(script)可以访问第三步中用户代理保存在本地的完整的重定向URI，并从中提取授权令牌。</p><p><strong>第六步：用户代理提取授权令牌</strong></p><p>用户代理执行上面提到的脚本，提取出授权令牌。然后将授权令牌传递给应用程序。</p><h2 id="4-6-资源拥有者密码凭证模式-Resource-Owner-Password-Credentials"><a href="#4-6-资源拥有者密码凭证模式-Resource-Owner-Password-Credentials" class="headerlink" title="4.6 资源拥有者密码凭证模式(Resource Owner Password Credentials)"></a>4.6 资源拥有者密码凭证模式(Resource Owner Password Credentials)</h2><ul><li>在资源拥有者密码凭证模式中，用户直接向应用程序提供其认证信息(即用户名和密码)。应用程序依此向授权服务器获取授权令牌。</li><li>这种模式适用于用户对应用程序高度信任的情况。比如是用户操作系统的一部分。</li><li>认证服务器只有在其他授权模式无法执行的情况下，才能考虑使用这种模式。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/7.webp" alt="image"></p><p><strong>第一步：用户传递认证信息</strong></p><p>用户将用户名和密码交给应用程序。</p><p><strong>第二步：应用程序请求授权令牌</strong></p><ul><li>应用程序得到用户认证信息后，向授权服务器请求授权令牌。</li><li>请求授权令牌终端<code>https://www.example.com/token</code></li><li>response_type=<code>password</code>，前面提到的两种分别是<code>code</code>和<code>token</code>。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/token?grant_type=password&amp;username=USERNAME&amp;password=PASSWORD&amp;client_id=CLIENT_ID</span></span><br></pre></td></tr></table></figure><p><strong>第三步：授权服务器返回授权令牌</strong></p><p>如果用户的认证信息得到验证，授权服务器将向应用程序返回授权令牌。</p><h2 id="4-7-客户端模式-Client-Credentials"><a href="#4-7-客户端模式-Client-Credentials" class="headerlink" title="4.7 客户端模式(Client Credentials)"></a>4.7 客户端模式(Client Credentials)</h2><ul><li>客户端模式应用于应用程序想要以自己的名义与授权服务器以及资源服务器进行互动。</li><li>比如应用程序想要修改自身注册信息或者redirect URI。又或者想要获取资源服务器中不与具体用户相关的信息。比如一个应用程序想要获取新浪微博中含有#happy的微博。</li><li>严格意义上说，客户端模式并不是OAuth协议要解决的问题，因为并未涉及授权。</li></ul><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/OAuth/8.webp" alt="image"></p><p><strong>第一步：应用程序请求授权令牌</strong></p><ul><li>应用程序向授权服务器提供自身认证信息(client ID和client secret)，并请求授权令牌。</li><li>请求授权令牌终端<code>https://www.example.com/token</code></li><li>response_type=<code>client_credentials</code>，前面提到的两种分别是<code>code</code>、<code>token</code>和<code>password</code>。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/token?grant_type=client_credentials&amp;client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET</span></span><br></pre></td></tr></table></figure><p><strong>第二步：授权服务器返回授权令牌</strong></p><p>授权服务器验证认证信息，向应用程序返回授权令牌。</p><h2 id="4-8-更新令牌-Refresh-Token"><a href="#4-8-更新令牌-Refresh-Token" class="headerlink" title="4.8 更新令牌(Refresh Token)"></a>4.8 更新令牌(Refresh Token)</h2><ul><li>如果授权令牌过期，在进行API请求时会报错<code>Invalid Token Error</code></li><li>如果在获取授权令牌时，同时获得了refresh token，那么我们可以向授权服务器申请更新令牌。</li><li>grant_type = <code>refresh_token</code></li><li>scope：表示申请的授权范围，不可以超出上一次申请的范围，如果省略该参数，则表示与上一次一致。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.example.com/v1/oauth/token?grant_type=refresh_token&amp;client_id=CLIENT_ID&amp;client_secret=CLIENT_SECRET&amp;refresh_token=REFRESH_TOKEN</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0-参考文章&quot;&gt;&lt;a href=&quot;#0-参考文章&quot; class=&quot;headerlink&quot; title=&quot;0 参考文章&quot;&gt;&lt;/a&gt;0 参考文章&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/b06944c92228&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/b06944c92228&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-什么是OAuth&quot;&gt;&lt;a href=&quot;#1-什么是OAuth&quot; class=&quot;headerlink&quot; title=&quot;1 什么是OAuth&quot;&gt;&lt;/a&gt;1 什么是OAuth&lt;/h1&gt;&lt;p&gt;官网这样说…&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An &lt;strong&gt;open protocol&lt;/strong&gt; to allow &lt;strong&gt;secure authorization&lt;/strong&gt; in a &lt;strong&gt;simple&lt;/strong&gt; and &lt;strong&gt;standard&lt;/strong&gt; method from web, mobile and desktop applications.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;OAuth 即 &lt;strong&gt;O&lt;/strong&gt;pen standard for &lt;strong&gt;Auth&lt;/strong&gt;orization&lt;/li&gt;
&lt;li&gt;OAuth就是一个网络开放协议。为保证用户资源的安全授权提供了简易的标准&lt;/li&gt;
&lt;li&gt;在知乎上看到了一个比较直观的比喻，有助于初学者理解。&lt;a href=&quot;https://link.jianshu.com?t=http://www.zhihu.com/question/19781476&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;知乎话题链接&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;2-OAuth历史版本&quot;&gt;&lt;a href=&quot;#2-OAuth历史版本&quot; class=&quot;headerlink&quot; title=&quot;2 OAuth历史版本&quot;&gt;&lt;/a&gt;2 OAuth历史版本&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;2007-12&lt;/strong&gt; OAuth 1.0发布并迅速成为工业标准。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2008-06&lt;/strong&gt; OAuth 1.0 Revision A发布，这是个稍作修改的修订版本，主要修正一个安全方面的漏洞。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2010-04&lt;/strong&gt;，OAuth 1.0 协议发布为 &lt;a href=&quot;https://link.jianshu.com?t=http://www.rfcreader.com/#rfc5849&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 5849&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2011-05&lt;/strong&gt; OAuth 2.0 草案发布&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2012-10&lt;/strong&gt; OAuth 2.0 协议发布为 &lt;a href=&quot;https://link.jianshu.com?t=http://www.rfcreader.com/#rfc6749&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 6749&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="OAuth" scheme="https://gongzhao1.gitee.io/tags/OAuth/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes之Ingress</title>
    <link href="https://gongzhao1.gitee.io/Kubernetes%E4%B9%8BIngress/"/>
    <id>https://gongzhao1.gitee.io/Kubernetes之Ingress/</id>
    <published>2020-04-08T14:50:08.000Z</published>
    <updated>2020-05-24T08:41:54.770Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/qianghaohao/article/details/99354304" target="_blank" rel="noopener">https://blog.csdn.net/qianghaohao/article/details/99354304</a></li><li><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx</a></li><li><a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md</a></li><li><a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/</a></li></ul><h1 id="1-k8s-对外暴露服务的方法"><a href="#1-k8s-对外暴露服务的方法" class="headerlink" title="1 k8s 对外暴露服务的方法"></a>1 k8s 对外暴露服务的方法</h1><p>向 k8s 集群外部暴露服务的方式有三种： nodePort，LoadBalancer 和本文要介绍的 Ingress。每种方式都有各自的优缺点，nodePort 方式在服务变多的情况下会导致节点要开的端口越来越多，不好管理。而 LoadBalancer 更适合结合云提供商的 LB 来使用，但是在 LB 越来越多的情况下对成本的花费也是不可小觑。Ingress 是 k8s 官方提供的用于对外暴露服务的方式，也是在生产环境用的比较多的方式，一般在云环境下是 LB + Ingress Ctroller 方式对外提供服务，这样就可以在一个 LB 的情况下根据域名路由到对应后端的 Service，有点类似于 Nginx 反向代理，只不过在 k8s 集群中，这个反向代理是集群外部流量的统一入口。</p><h1 id="2-Ingress-及-Ingress-Controller-简介"><a href="#2-Ingress-及-Ingress-Controller-简介" class="headerlink" title="2 Ingress 及 Ingress Controller 简介"></a>2 Ingress 及 Ingress Controller 简介</h1><p>Ingress 是 k8s 资源对象，用于对外暴露服务，该资源对象定义了不同主机名（域名）及 URL 和对应后端 Service（k8s Service）的绑定，根据不同的路径路由 http 和 https 流量。而 Ingress Contoller 是一个 pod 服务，封装了一个 web 前端负载均衡器，同时在其基础上实现了动态感知 Ingress 并根据 Ingress 的定义动态生成 前端 web 负载均衡器的配置文件，比如 Nginx Ingress Controller 本质上就是一个 Nginx，只不过它能根据 Ingress 资源的定义动态生成 Nginx 的配置文件，然后动态 Reload。个人觉得 Ingress Controller 的重大作用是将前端负载均衡器和 Kubernetes 完美地结合了起来，一方面在云、容器平台下方便配置的管理，另一方面实现了集群统一的流量入口，而不是像 nodePort 那样给集群打多个孔。<br><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/1.png" alt="image"></p><p>所以，总的来说要使用 Ingress，得先部署 Ingress Controller 实体（相当于前端 Nginx），然后再创建 Ingress （相当于 Nginx 配置的 k8s 资源体现），Ingress Controller 部署好后会动态检测 Ingress 的创建情况生成相应配置。Ingress Controller 的实现有很多种：有基于 Nginx 的，也有基于 HAProxy的，还有基于 OpenResty 的 Kong Ingress Controller 等，更多 Controller 见：<a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于</a> Nginx 的 Ingress Controller：<a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>。</p><a id="more"></a><h1 id="3-helm-部署-Nginx-Ingress-Controller"><a href="#3-helm-部署-Nginx-Ingress-Controller" class="headerlink" title="3 helm 部署 Nginx Ingress Controller"></a>3 helm 部署 Nginx Ingress Controller</h1><p>基于 Nginx 的 Ingress Controller 有两种，一种是 k8s 社区提供的 <a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>，另一种是 Nginx 社区提供的 <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">kubernetes-igress</a>，关于两者的区别见 <a href="https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/nginx-ingress-controllers.md" target="_blank" rel="noopener">这里</a>。</p><p>在这里我们部署 k8s 社区提供的 <a href="https://github.com/nginxinc/kubernetes-ingress" target="_blank" rel="noopener">ingress-nginx</a>，Ingress Controller 对外暴露方式采用 hostNetwork，在裸机环境下更多其他暴露方式见：<a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/</a><br><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/2.png" alt="image"></p><p>使用 Helm 官方提供的 Chart <a href="stable/nginx-ingress">stable/nginx-ingress</a>，修改 values 文件：</p><ul><li>使用 DaemonSet 控制器，默认是 Deployment：controller.kind 设为 DaemonSet；</li><li>pod 使用主机网络：controller.hostNetwork 设为 true；</li><li>在hostNetwork 下 pod 使用集群提供 dns 服务：controller.dnsPolicy 设为 ClusterFirstWithHostNet；</li><li>Service 类型设为 ClusterIP，默认是 LoadBalancer：controller.service.type 设为 ClusterIP；</li><li>默认后端镜像使用 docker hub 提供的镜像，Google 国内无法访问；</li></ul><p>helm 部署(国内可以使用微软的helm源)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install stable/nginx-ingress --name nginx-ingress -f myValues.yaml</span><br></pre></td></tr></table></figure><p>部署完成后我们可以看到 Kubernetes 服务中增加了 <code>nginx-ingress-controller</code> 和 <code>nginx-ingress-default-backend</code> 两个服务。<code>nginx-ingress-controller</code> 为 <code>Ingress Controller</code>，主要做为一个七层的负载均衡器来提供 HTTP 路由、粘性会话、SSL 终止、SSL直通、TCP 和 UDP 负载平衡等功能。<code>nginx-ingress-default-backend</code> 为默认的后端，当集群外部的请求通过 Ingress 进入到集群内部时，如果无法负载到相应后端的 Service 上时，这种未知的请求将会被负载到这个默认的后端上。nginx-ingress-default-backend 默认提供了两个 URL 进行访问，其中的 /healthz 用作健康检查返回 200，而 / 返回 404 错误。</p><h1 id="4-使用-Ingress-对外暴露服务-7层"><a href="#4-使用-Ingress-对外暴露服务-7层" class="headerlink" title="4 使用 Ingress 对外暴露服务-7层"></a>4 使用 Ingress 对外暴露服务-7层</h1><h2 id="4-1-HTTP类型服务"><a href="#4-1-HTTP类型服务" class="headerlink" title="4.1 HTTP类型服务"></a>4.1 HTTP类型服务</h2><p>为了快速体验 Ingress，下面部署一个 nginx 服务，然后通过 Ingress 对外暴露 nginx service 进行访问。<br>首先部署 nginx 服务：<br>Deployment + Service</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.7.9</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>接下来创建 Ingress 对外暴露 nginx service 80 端口：<br>ingress.yml:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="comment"># use the shared ingress-nginx</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">nginx.kube.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>kubernetes.io/ingress.class: “nginx”：Nginx Ingress Controller 根据该注解自动发现 Ingress；</li><li>host: nginx.kube.com：对外访问的域名；</li><li>serviceName: nginx：对外暴露的 Service 名称；</li><li>servicePort: 80：nginx service 监听的端口；</li></ul><blockquote><p>创建的 Ingress 必须要和对外暴露的 Service 在同一命名空间下！</p></blockquote><h2 id="4-2-HTTPS类型服务"><a href="#4-2-HTTPS类型服务" class="headerlink" title="4.2 HTTPS类型服务"></a>4.2 HTTPS类型服务</h2><p><strong>通过 Ingress 访问 kubernetes dashboard（支持 HTTPS 访问）</strong><br>首先，练习使用，先用自签名证书来代替吧：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout kube-dashboard.key -out kube-dashboard.crt -subj <span class="string">"/CN=dashboard.kube.com/O=dashboard.kube.com"</span></span><br></pre></td></tr></table></figure><p>使用生成的证书创建 k8s Secret 资源，下一步创建的 Ingress 会引用这个 Secret：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls kube-dasboard-ssl --key kube-dashboard.key --cert kube-dashboard.crt -n kube-system</span><br></pre></td></tr></table></figure><p>创建 Ingress 资源对象（支持 HTTPS 访问）：</p><p>kube-dashboard-ingress.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ingress-kube-dashboard</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="comment"># use the shared ingress-nginx</span></span><br><span class="line">    <span class="string">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/backend-protocol:</span> <span class="string">"HTTPS"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  tls:</span></span><br><span class="line"><span class="attr">  - hosts:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dashboard.kube.com</span></span><br><span class="line"><span class="attr">    secretName:</span> <span class="string">kube-dasboard-ssl</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">dashboard.kube.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">443</span></span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>kubernetes.io/ingress.class: “nginx”：Inginx Ingress Controller 根据该注解自动发现 Ingress；</li><li>nginx.ingress.kubernetes.io/backend-protocol: Controller 向后端 Service 转发时使用 HTTPS 协议，这个注解必须添加，否则访问会报错</li></ul><ul><li>secretName: kube-dasboard-ssl：https 证书 Secret；</li><li>host: dashboard.kube.com：对外访问的域名；</li><li>serviceName: kubernetes-dashboard：集群对外暴露的 Service 名称；</li><li>servicePort: 443：service 监听的端口；</li></ul><blockquote><p>注意：创建的 Ingress 必须要和对外暴露的 Service 在同一命名空间下！</p></blockquote><p>将域名 dashboard.kube.com绑定到 k8s 任意节点 ip 即可访问.</p><h2 id="4-3-basic-auth认证"><a href="#4-3-basic-auth认证" class="headerlink" title="4.3 basic-auth认证"></a>4.3 basic-auth认证</h2><h3 id="4-3-1-创建用户名密码"><a href="#4-3-1-创建用户名密码" class="headerlink" title="4.3.1 创建用户名密码"></a>4.3.1 创建用户名密码</h3><p>首先需要安装htpasswd二进制文件，通过htpasswd生成一个“auth”文件;用来存取我们创建的用户及加密之后的密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c auth user1</span><br><span class="line">New password: &lt;bar&gt;</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user user1</span><br><span class="line"></span><br><span class="line">htpasswd auth user2</span><br><span class="line">2nd user:</span><br><span class="line">htpasswd auth user2</span><br><span class="line">New password: &lt;bar&gt;</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user user2</span><br></pre></td></tr></table></figure><h3 id="4-3-2-创建kubernetes-secret来存储user-pass-pairs"><a href="#4-3-2-创建kubernetes-secret来存储user-pass-pairs" class="headerlink" title="4.3.2 创建kubernetes secret来存储user/pass pairs"></a>4.3.2 创建kubernetes secret来存储user/pass pairs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n &lt;namespace&gt; create secret generic basic-auth --from-file=auth</span><br><span class="line">secret <span class="string">"basic-auth"</span> created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get secret basic-auth -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  auth: Zm9vOiRhcHIxJE9DRzZYeWJcJGNrKDBGSERBa29YWUlsSDkuY3lzVDAK</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: basic-auth</span><br><span class="line">  namespace: default</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><h3 id="4-3-3-创建Ingress"><a href="#4-3-3-创建Ingress" class="headerlink" title="4.3.3 创建Ingress"></a>4.3.3 创建Ingress</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  annotations:</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-type: basic</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-secret: basic-auth   #此secret需和ingress在用一namespace下</span><br><span class="line">    nginx.ingress.kubernetes.io/auth-realm: &quot;Authentication Required&quot; #提示符</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">    - host: prom.xxxxx.im</span><br><span class="line">      http:</span><br><span class="line">        paths:</span><br><span class="line">          - path: /</span><br><span class="line">            backend:</span><br><span class="line">              serviceName: prometheus-svc</span><br><span class="line">              servicePort: 9090</span><br></pre></td></tr></table></figure><h2 id="4-4-多路径及虚拟主机例子"><a href="#4-4-多路径及虚拟主机例子" class="headerlink" title="4.4 多路径及虚拟主机例子"></a>4.4 多路径及虚拟主机例子</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-ingress</span></span><br><span class="line"><span class="attr">  annotations:</span> </span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/use-regex:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">api.mydomain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">api</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">domain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/web/*</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">backoffice.domain.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">backoffice</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><h1 id="5-使用-Ingress-对外暴露服务-4层"><a href="#5-使用-Ingress-对外暴露服务-4层" class="headerlink" title="5 使用 Ingress 对外暴露服务-4层"></a>5 使用 Ingress 对外暴露服务-4层</h1><p>我们可以看到ingress nginx的args里有这两行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span><br><span class="line">- --udp-services-configmap=$(POD_NAMESPACE)/udp-services</span><br></pre></td></tr></table></figure><p>从选项和值可以猜测出，要想代理四层（tcp/udp），得写同namespace里一个名为<code>tcp-service</code>和<code>udp-service</code>的两个configmap的数据 四层的话这边我们创建一个mysql的pod，来代理3306端口到集群外面，则需要写tcp-services这个configmap：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: tcp-services</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">data:</span><br><span class="line">  3306: &quot;default/mysql:3306&quot;</span><br></pre></td></tr></table></figure><p>四层写这两个ConfigMap的data即可，按照这样去写即可<code>out_port: namespaces/svc_name:port</code>，要给每个ingress加一些nginx里的配置可以查看官方的annotation字段以及值（traefik同理）。</p><p><strong>如果我们用如上helm方式部署ingress-nginx的话</strong></p><p>直接编辑它的vales.yaml文件，在TCP/UDP字段之后添加<code>out_port: namespaces/svc_name:port</code>即可，helm会自动帮你生成对应的configmap，并暴露对应的四层端口</p><p><strong>其他例子</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">udp-services</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="number">2200</span><span class="string">:</span> <span class="string">"default/gitlab:22"</span></span><br><span class="line">  <span class="number">3306</span><span class="string">:</span> <span class="string">"kube-public/mysql:3306"</span></span><br><span class="line">  <span class="number">2202</span><span class="string">:</span> <span class="string">"kube-public/centos:22"</span></span><br><span class="line">  <span class="number">2203</span><span class="string">:</span> <span class="string">"kube-public/mongodb:27017"</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">udp-services</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="number">53</span><span class="string">:</span> <span class="string">"kube-system/kube-dns:53"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/qianghaohao/article/details/99354304&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/qianghaohao/article/details/99354304&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/ingress-nginx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/kubernetes/ingress-nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.github.io/ingress-nginx/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;1-k8s-对外暴露服务的方法&quot;&gt;&lt;a href=&quot;#1-k8s-对外暴露服务的方法&quot; class=&quot;headerlink&quot; title=&quot;1 k8s 对外暴露服务的方法&quot;&gt;&lt;/a&gt;1 k8s 对外暴露服务的方法&lt;/h1&gt;&lt;p&gt;向 k8s 集群外部暴露服务的方式有三种： nodePort，LoadBalancer 和本文要介绍的 Ingress。每种方式都有各自的优缺点，nodePort 方式在服务变多的情况下会导致节点要开的端口越来越多，不好管理。而 LoadBalancer 更适合结合云提供商的 LB 来使用，但是在 LB 越来越多的情况下对成本的花费也是不可小觑。Ingress 是 k8s 官方提供的用于对外暴露服务的方式，也是在生产环境用的比较多的方式，一般在云环境下是 LB + Ingress Ctroller 方式对外提供服务，这样就可以在一个 LB 的情况下根据域名路由到对应后端的 Service，有点类似于 Nginx 反向代理，只不过在 k8s 集群中，这个反向代理是集群外部流量的统一入口。&lt;/p&gt;
&lt;h1 id=&quot;2-Ingress-及-Ingress-Controller-简介&quot;&gt;&lt;a href=&quot;#2-Ingress-及-Ingress-Controller-简介&quot; class=&quot;headerlink&quot; title=&quot;2 Ingress 及 Ingress Controller 简介&quot;&gt;&lt;/a&gt;2 Ingress 及 Ingress Controller 简介&lt;/h1&gt;&lt;p&gt;Ingress 是 k8s 资源对象，用于对外暴露服务，该资源对象定义了不同主机名（域名）及 URL 和对应后端 Service（k8s Service）的绑定，根据不同的路径路由 http 和 https 流量。而 Ingress Contoller 是一个 pod 服务，封装了一个 web 前端负载均衡器，同时在其基础上实现了动态感知 Ingress 并根据 Ingress 的定义动态生成 前端 web 负载均衡器的配置文件，比如 Nginx Ingress Controller 本质上就是一个 Nginx，只不过它能根据 Ingress 资源的定义动态生成 Nginx 的配置文件，然后动态 Reload。个人觉得 Ingress Controller 的重大作用是将前端负载均衡器和 Kubernetes 完美地结合了起来，一方面在云、容器平台下方便配置的管理，另一方面实现了集群统一的流量入口，而不是像 nodePort 那样给集群打多个孔。&lt;br&gt;&lt;img src=&quot;https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/ingress/1.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;所以，总的来说要使用 Ingress，得先部署 Ingress Controller 实体（相当于前端 Nginx），然后再创建 Ingress （相当于 Nginx 配置的 k8s 资源体现），Ingress Controller 部署好后会动态检测 Ingress 的创建情况生成相应配置。Ingress Controller 的实现有很多种：有基于 Nginx 的，也有基于 HAProxy的，还有基于 OpenResty 的 Kong Ingress Controller 等，更多 Controller 见：&lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/，本文使用基于&lt;/a&gt; Nginx 的 Ingress Controller：&lt;a href=&quot;https://github.com/nginxinc/kubernetes-ingress&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ingress-nginx&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://gongzhao1.gitee.io/categories/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://gongzhao1.gitee.io/tags/kubernetes/"/>
    
      <category term="ingress" scheme="https://gongzhao1.gitee.io/tags/ingress/"/>
    
  </entry>
  
  <entry>
    <title>python模块之logging</title>
    <link href="https://gongzhao1.gitee.io/python%E6%A8%A1%E5%9D%97%E4%B9%8Blogging/"/>
    <id>https://gongzhao1.gitee.io/python模块之logging/</id>
    <published>2020-03-24T08:24:47.000Z</published>
    <updated>2020-04-08T14:20:25.872Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/yyds/p/6901864.html" target="_blank" rel="noopener">https://www.cnblogs.com/yyds/p/6901864.html</a></li><li><a href="https://www.cnblogs.com/yuanyongqiang/p/11913812.html" target="_blank" rel="noopener">https://www.cnblogs.com/yuanyongqiang/p/11913812.html</a></li><li><a href="https://www.cnblogs.com/nancyzhu/p/8551506.html" target="_blank" rel="noopener">https://www.cnblogs.com/nancyzhu/p/8551506.html</a></li></ul><h1 id="日志相关概念"><a href="#日志相关概念" class="headerlink" title="日志相关概念"></a>日志相关概念</h1><p>日志是一种可以追踪某些软件运行时所发生事件的方法。软件开发人员可以向他们的代码中调用日志记录相关的方法来表明发生了某些事情。一个事件可以用一个可包含可选变量数据的消息来描述。此外，事件也有重要性的概念，这个重要性也可以被称为严重性级别（level）。</p><h2 id="日志的作用"><a href="#日志的作用" class="headerlink" title="日志的作用"></a>日志的作用</h2><p>通过log的分析，可以方便用户了解系统或软件、应用的运行情况；如果你的应用log足够丰富，也可以分析以往用户的操作行为、类型喜好、地域分布或其他更多信息；如果一个应用的log同时也分了多个级别，那么可以很轻易地分析得到该应用的健康状况，及时发现问题并快速定位、解决问题，补救损失。<br>简单来讲就是，我们通过记录和分析日志可以了解一个系统或软件程序运行情况是否正常，也可以在应用程序出现故障时快速定位问题。比如，做运维的同学，在接收到报警或各种问题反馈后，进行问题排查时通常都会先去看各种日志，大部分问题都可以在日志中找到答案。再比如，做开发的同学，可以通过IDE控制台上输出的各种日志进行程序调试。对于运维老司机或者有经验的开发人员，可以快速的通过日志定位到问题的根源。可见，日志的重要性不可小觑。日志的作用可以简单总结为以下3点：</p><ul><li>程序调试</li><li>了解软件程序运行情况，是否正常</li><li>软件程序运行故障分析与问题定位</li></ul><p>如果应用的日志信息足够详细和丰富，还可以用来做用户行为分析，如：分析用户的操作行为、类型洗好、地域分布以及其它更多的信息，由此可以实现改进业务、提高商业利益。</p><h2 id="日志的等级"><a href="#日志的等级" class="headerlink" title="日志的等级"></a>日志的等级</h2><p>我们先来思考下下面的两个问题：</p><ul><li>作为开发人员，在开发一个应用程序时需要什么日志信息？在应用程序正式上线后需要什么日志信息？</li><li>作为应用运维人员，在部署开发环境时需要什么日志信息？在部署生产环境时需要什么日志信息？</li></ul><p>在软件开发阶段或部署开发环境时，为了尽可能详细的查看应用程序的运行状态来保证上线后的稳定性，我们可能需要把该应用程序所有的运行日志全部记录下来进行分析，这是非常耗费机器性能的。当应用程序正式发布或在生产环境部署应用程序时，我们通常只需要记录应用程序的异常信息、错误信息等，这样既可以减小服务器的I/O压力，也可以避免我们在排查故障时被淹没在日志的海洋里。那么，怎样才能在不改动应用程序代码的情况下实现在不同的环境记录不同详细程度的日志呢？这就是日志等级的作用了，我们通过配置文件指定我们需要的日志等级就可以了。</p><p>不同的应用程序所定义的日志等级可能会有所差别，分的详细点的会包含以下几个等级：</p><ul><li>DEBUG</li><li>INFO</li><li>NOTICE</li><li>WARNING</li><li>ERROR</li><li>CRITICAL</li><li>ALERT</li><li>EMERGENCY</li></ul><h2 id="日志字段信息与日志格式"><a href="#日志字段信息与日志格式" class="headerlink" title="日志字段信息与日志格式"></a>日志字段信息与日志格式</h2><p>本节开始问题提到过，一条日志信息对应的是一个事件的发生，而一个事件通常需要包括以下几个内容：</p><ul><li>事件发生时间</li><li>事件发生位置</li><li>事件的严重程度–日志级别</li><li>事件内容</li></ul><p>上面这些都是一条日志记录中可能包含的字段信息，当然还可以包括一些其他信息，如进程ID、进程名称、线程ID、线程名称等。日志格式就是用来定义一条日志记录中包含那些字段的，且日志格式通常都是可以自定义的。</p><blockquote><p>说明：</p><p>输出一条日志时，日志内容和日志级别是需要开发人员明确指定的。对于而其它字段信息，只需要是否显示在日志中就可以了。</p></blockquote><h2 id="日志功能的实现"><a href="#日志功能的实现" class="headerlink" title="日志功能的实现"></a>日志功能的实现</h2><p>几乎所有开发语言都会内置日志相关功能，或者会有比较优秀的第三方库来提供日志操作功能，比如：log4j，log4php等。它们功能强大、使用简单。Python自身也提供了一个用于记录日志的标准库模块–logging。</p><h1 id="logging模块简介"><a href="#logging模块简介" class="headerlink" title="logging模块简介"></a>logging模块简介</h1><p>logging模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。logging模块是Python的一个标准库模块，由标准库模块提供日志记录API的关键好处是所有Python模块都可以使用这个日志记录功能。所以，你的应用日志可以将你自己的日志信息与来自第三方模块的信息整合起来。</p><a id="more"></a><h2 id="logging模块的日志级别"><a href="#logging模块的日志级别" class="headerlink" title="logging模块的日志级别"></a>logging模块的日志级别</h2><p>logging模块默认定义了以下几个日志等级，它允许开发人员自定义其他日志级别，但是这是不被推荐的，尤其是在开发供别人使用的库时，因为这会导致日志级别的混乱。</p><table><thead><tr><th>日志等级（level）</th><th>描述</th></tr></thead><tbody><tr><td>DEBUG</td><td>最详细的日志信息，典型应用场景是 问题诊断</td></tr><tr><td>INFO</td><td>信息详细程度仅次于DEBUG，通常只记录关键节点信息，用于确认一切都是按照我们预期的那样进行工作</td></tr><tr><td>WARNING</td><td>当某些不期望的事情发生时记录的信息（如，磁盘可用空间较低），但是此时应用程序还是正常运行的</td></tr><tr><td>ERROR</td><td>由于一个更严重的问题导致某些功能不能正常运行时记录的信息</td></tr><tr><td>CRITICAL</td><td>当发生严重错误，导致应用程序不能继续运行时记录的信息</td></tr></tbody></table><p>开发应用程序或部署开发环境时，可以使用DEBUG或INFO级别的日志获取尽可能详细的日志信息来进行开发或部署调试；应用上线或部署生产环境时，应该使用WARNING或ERROR或CRITICAL级别的日志来降低机器的I/O压力和提高获取错误日志信息的效率。日志级别的指定通常都是在应用程序的配置文件中进行指定的。</p><blockquote><p>说明：</p><ul><li>上面列表中的日志等级是从上到下依次升高的，即：DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL，而日志的信息量是依次减少的；</li><li>当为某个应用程序指定一个日志级别后，应用程序会记录所有日志级别大于或等于指定日志级别的日志信息，而不是仅仅记录指定级别的日志信息，nginx、php等应用程序以及这里要提高的python的logging模块都是这样的。同样，logging模块也可以指定日志记录器的日志级别，只有级别大于或等于该指定日志级别的日志记录才会被输出，小于该等级的日志记录将会被丢弃。</li></ul></blockquote><h2 id="logging模块的使用方式介绍"><a href="#logging模块的使用方式介绍" class="headerlink" title="logging模块的使用方式介绍"></a>logging模块的使用方式介绍</h2><p>logging模块提供了两种记录日志的方式：</p><ul><li>第一种方式是使用logging提供的模块级别的函数</li><li>第二种方式是使用Logging日志系统的四大组件</li></ul><p>其实，logging所提供的模块级别的日志记录函数也是对logging日志系统相关类的封装而已。</p><p><strong>logging模块定义的模块级别的常用函数</strong></p><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>logging.debug(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为DEBUG的日志记录</td></tr><tr><td><a href="http://logging.info/" target="_blank" rel="noopener">logging.info</a>(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为INFO的日志记录</td></tr><tr><td>logging.warning(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为WARNING的日志记录</td></tr><tr><td>logging.error(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为ERROR的日志记录</td></tr><tr><td>logging.critical(msg, <em>args, *</em>kwargs)</td><td>创建一条严重级别为CRITICAL的日志记录</td></tr><tr><td>logging.log(level, <em>args, *</em>kwargs)</td><td>创建一条严重级别为level的日志记录</td></tr><tr><td>logging.basicConfig(**kwargs)</td><td>对root logger进行一次性配置</td></tr></tbody></table><p>其中<code>logging.basicConfig(**kwargs)</code>函数用于指定“要记录的日志级别”、“日志格式”、“日志输出位置”、“日志文件的打开模式”等信息，其他几个都是用于记录各个级别日志的函数。</p><p><strong>logging模块的四大组件</strong></p><table><thead><tr><th>组件</th><th>说明</th></tr></thead><tbody><tr><td>loggers</td><td>提供应用程序代码直接使用的接口</td></tr><tr><td>handlers</td><td>用于将日志记录发送到指定的目的位置</td></tr><tr><td>filters</td><td>提供更细粒度的日志过滤功能，用于决定哪些日志记录将会被输出（其它的日志记录将会被忽略）</td></tr><tr><td>formatters</td><td>用于控制日志信息的最终输出格式</td></tr></tbody></table><blockquote><p>说明： logging模块提供的模块级别的那些函数实际上也是通过这几个组件的相关实现类来记录日志的，只是在创建这些类的实例时设置了一些默认值。</p></blockquote><h2 id="使用logging提供的模块级别的函数记录日志"><a href="#使用logging提供的模块级别的函数记录日志" class="headerlink" title="使用logging提供的模块级别的函数记录日志"></a>使用logging提供的模块级别的函数记录日志</h2><p>回顾下前面提到的几个重要信息：</p><ul><li>可以通过logging模块定义的模块级别的方法去完成简单的日志记录</li><li>只有级别大于或等于日志记录器指定级别的日志记录才会被输出，小于该级别的日志记录将会被丢弃。</li></ul><h3 id="最简单的日志输出"><a href="#最简单的日志输出" class="headerlink" title="最简单的日志输出"></a>最简单的日志输出</h3><p>先来试着分别输出一条不同日志级别的日志记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>也可以这样写：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logging.log(logging.DEBUG, &quot;This is a debug log.&quot;)</span><br><span class="line">logging.log(logging.INFO, &quot;This is a info log.&quot;)</span><br><span class="line">logging.log(logging.WARNING, &quot;This is a warning log.&quot;)</span><br><span class="line">logging.log(logging.ERROR, &quot;This is a error log.&quot;)</span><br><span class="line">logging.log(logging.CRITICAL, &quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:This is a warning log.</span><br><span class="line">ERROR:root:This is a error log.</span><br><span class="line">CRITICAL:root:This is a critical log.</span><br></pre></td></tr></table></figure><h3 id="那么问题来了"><a href="#那么问题来了" class="headerlink" title="那么问题来了"></a>那么问题来了</h3><p><strong>问题1：为什么前面两条日志没有被打印出来？</strong></p><p>这是因为logging模块提供的日志记录函数所使用的日志器设置的日志级别是<code>WARNING</code>，因此只有<code>WARNING</code>级别的日志记录以及大于它的<code>ERROR</code>和<code>CRITICAL</code>级别的日志记录被输出了，而小于它的<code>DEBUG</code>和<code>INFO</code>级别的日志记录被丢弃了。</p><p><strong>问题2：打印出来的日志信息中各字段表示什么意思？为什么会这样输出？</strong></p><p>上面输出结果中每行日志记录的各个字段含义分别是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">日志级别:日志器名称:日志内容</span><br></pre></td></tr></table></figure><p>之所以会这样输出，是因为logging模块提供的日志记录函数所使用的日志器设置的日志格式默认是BASIC_FORMAT，其值为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%(levelname)s:%(name)s:%(message)s&quot;</span><br></pre></td></tr></table></figure><p><strong>问题3：如果将日志记录输出到文件中，而不是打印到控制台？</strong></p><p>因为在logging模块提供的日志记录函数所使用的日志器设置的处理器所指定的日志输出位置默认为:<br><code>sys.stderr</code>。</p><p><strong>问题4：我是怎么知道这些的？</strong></p><p>查看这些日志记录函数的实现代码，可以发现：当我们没有提供任何配置信息的时候，这些函数都会去调用<code>logging.basicConfig(**kwargs)</code>方法，且不会向该方法传递任何参数。继续查看<code>basicConfig()</code>方法的代码就可以找到上面这些问题的答案了。</p><p><strong>问题5：怎么修改这些默认设置呢？</strong></p><p>其实很简单，在我们调用上面这些日志记录函数之前，手动调用一下basicConfig()方法，把我们想设置的内容以参数的形式传递进去就可以了。</p><h3 id="logging-basicConfig-函数说明"><a href="#logging-basicConfig-函数说明" class="headerlink" title="logging.basicConfig()函数说明"></a>logging.basicConfig()函数说明</h3><p>该方法用于为logging日志系统做一些基本配置，方法定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(**kwargs)</span><br></pre></td></tr></table></figure><p>该函数可接收的关键字参数如下：</p><table><thead><tr><th>参数名称</th><th>描述</th></tr></thead><tbody><tr><td>filename</td><td>指定日志输出目标文件的文件名，指定该设置项后日志信心就不会被输出到控制台了</td></tr><tr><td>filemode</td><td>指定日志文件的打开模式，默认为’a’。需要注意的是，该选项要在filename指定时才有效</td></tr><tr><td>format</td><td>指定日志格式字符串，即指定日志输出时所包含的字段信息以及它们的顺序。logging模块定义的格式字段下面会列出。</td></tr><tr><td>datefmt</td><td>指定日期/时间格式。需要注意的是，该选项要在format中包含时间字段%(asctime)s时才有效</td></tr><tr><td>level</td><td>指定日志器的日志级别</td></tr><tr><td>stream</td><td>指定日志输出目标stream，如sys.stdout、sys.stderr以及网络stream。需要说明的是，stream和filename不能同时提供，否则会引发 <code>ValueError</code>异常</td></tr><tr><td>style</td><td>Python 3.2中新添加的配置项。指定format格式字符串的风格，可取值为’%’、’{‘和’$’，默认为’%’</td></tr><tr><td>handlers</td><td>Python 3.3中新添加的配置项。该选项如果被指定，它应该是一个创建了多个Handler的可迭代对象，这些handler将会被添加到root logger。需要说明的是：filename、stream和handlers这三个配置项只能有一个存在，不能同时出现2个或3个，否则会引发ValueError异常。</td></tr></tbody></table><h3 id="logging模块定义的格式字符串字段"><a href="#logging模块定义的格式字符串字段" class="headerlink" title="logging模块定义的格式字符串字段"></a>logging模块定义的格式字符串字段</h3><p>我们来列举一下logging模块中定义好的可以用于format格式字符串中字段有哪些：</p><table><thead><tr><th>字段/属性名称</th><th>使用格式</th><th>描述</th></tr></thead><tbody><tr><td>asctime</td><td>%(asctime)s</td><td>日志事件发生的时间–人类可读时间，如：2003-07-08 16:49:45,896</td></tr><tr><td>created</td><td>%(created)f</td><td>日志事件发生的时间–时间戳，就是当时调用time.time()函数返回的值</td></tr><tr><td>relativeCreated</td><td>%(relativeCreated)d</td><td>日志事件发生的时间相对于logging模块加载时间的相对毫秒数（目前还不知道干嘛用的）</td></tr><tr><td>msecs</td><td>%(msecs)d</td><td>日志事件发生事件的毫秒部分</td></tr><tr><td>levelname</td><td>%(levelname)s</td><td>该日志记录的文字形式的日志级别（’DEBUG’, ‘INFO’, ‘WARNING’, ‘ERROR’, ‘CRITICAL’）</td></tr><tr><td>levelno</td><td>%(levelno)s</td><td>该日志记录的数字形式的日志级别（10, 20, 30, 40, 50）</td></tr><tr><td>name</td><td>%(name)s</td><td>所使用的日志器名称，默认是’root’，因为默认使用的是 rootLogger</td></tr><tr><td>message</td><td>%(message)s</td><td>日志记录的文本内容，通过 <code>msg % args</code>计算得到的</td></tr><tr><td>pathname</td><td>%(pathname)s</td><td>调用日志记录函数的源码文件的全路径</td></tr><tr><td>filename</td><td>%(filename)s</td><td>pathname的文件名部分，包含文件后缀</td></tr><tr><td>module</td><td>%(module)s</td><td>filename的名称部分，不包含后缀</td></tr><tr><td>lineno</td><td>%(lineno)d</td><td>调用日志记录函数的源代码所在的行号</td></tr><tr><td>funcName</td><td>%(funcName)s</td><td>调用日志记录函数的函数名</td></tr><tr><td>process</td><td>%(process)d</td><td>进程ID</td></tr><tr><td>processName</td><td>%(processName)s</td><td>进程名称，Python 3.1新增</td></tr><tr><td>thread</td><td>%(thread)d</td><td>线程ID</td></tr><tr><td>threadName</td><td>%(thread)s</td><td>线程名称</td></tr></tbody></table><h3 id="经过配置的日志输出-举例"><a href="#经过配置的日志输出-举例" class="headerlink" title="经过配置的日志输出(举例)"></a>经过配置的日志输出(举例)</h3><p><strong>先简单配置下日志器的日志级别</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:This is a debug log.</span><br><span class="line">INFO:root:This is a info log.</span><br><span class="line">WARNING:root:This is a warning log.</span><br><span class="line">ERROR:root:This is a error log.</span><br><span class="line">CRITICAL:root:This is a critical log.</span><br></pre></td></tr></table></figure><p>所有等级的日志信息都被输出了，说明配置生效了。</p><p><strong>在配置日志器日志级别的基础上，在配置下日志输出目标文件和日志格式</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(message)s&quot;</span><br><span class="line">logging.basicConfig(filename=&apos;my.log&apos;, level=logging.DEBUG, format=LOG_FORMAT)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>此时会发现控制台中已经没有输出日志内容了，但是在python代码文件的相同目录下会生成一个名为’my.log’的日志文件，该文件中的内容为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-05-08 14:29:53,783 - DEBUG - This is a debug log.</span><br><span class="line">2017-05-08 14:29:53,784 - INFO - This is a info log.</span><br><span class="line">2017-05-08 14:29:53,784 - WARNING - This is a warning log.</span><br><span class="line">2017-05-08 14:29:53,784 - ERROR - This is a error log.</span><br><span class="line">2017-05-08 14:29:53,784 - CRITICAL - This is a critical log.</span><br></pre></td></tr></table></figure><p><strong>在上面的基础上，我们再来设置下日期/时间格式</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(message)s&quot;</span><br><span class="line">DATE_FORMAT = &quot;%m/%d/%Y %H:%M:%S %p&quot;</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=&apos;my.log&apos;, level=logging.DEBUG, format=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line"></span><br><span class="line">logging.debug(&quot;This is a debug log.&quot;)</span><br><span class="line">logging.info(&quot;This is a info log.&quot;)</span><br><span class="line">logging.warning(&quot;This is a warning log.&quot;)</span><br><span class="line">logging.error(&quot;This is a error log.&quot;)</span><br><span class="line">logging.critical(&quot;This is a critical log.&quot;)</span><br></pre></td></tr></table></figure><p>此时会在my.log日志文件中看到如下输出内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">05/08/2017 14:29:04 PM - DEBUG - This is a debug log.</span><br><span class="line">05/08/2017 14:29:04 PM - INFO - This is a info log.</span><br><span class="line">05/08/2017 14:29:04 PM - WARNING - This is a warning log.</span><br><span class="line">05/08/2017 14:29:04 PM - ERROR - This is a error log.</span><br><span class="line">05/08/2017 14:29:04 PM - CRITICAL - This is a critical log.</span><br></pre></td></tr></table></figure><p>掌握了上面的内容之后，已经能够满足我们平时开发中需要的日志记录功能。</p><p><strong>另外一个例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=<span class="string">"%(asctime)s %(name)s %(levelname)s %(message)s"</span>,</span><br><span class="line">                    datefmt = <span class="string">'%Y-%m-%d  %H:%M:%S %a'</span>    <span class="comment">#注意月份和天数不要搞乱了，这里的格式化符与time模块相同</span></span><br><span class="line">                    )</span><br><span class="line">logging.debug(<span class="string">"msg1"</span>)</span><br><span class="line">logging.info(<span class="string">"msg2"</span>)</span><br><span class="line">logging.warning(<span class="string">"msg3"</span>)</span><br><span class="line">logging.error(<span class="string">"msg4"</span>)</span><br><span class="line">logging.critical(<span class="string">"msg5"</span>)</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root DEBUG msg1</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root INFO msg2</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root WARNING msg3</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root ERROR msg4</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-09</span>  <span class="number">23</span>:<span class="number">37</span>:<span class="number">49</span> Wed root CRITICAL msg5</span><br></pre></td></tr></table></figure><p><strong>输出到文件例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG,<span class="comment">#控制台打印的日志级别</span></span><br><span class="line">                    filename=<span class="string">'new.log'</span>,</span><br><span class="line">                    filemode=<span class="string">'a'</span>,<span class="comment">##模式，有w和a，w就是写模式，每次都会重新写日志，覆盖之前的日志</span></span><br><span class="line">                    <span class="comment">#a是追加模式，默认如果不写的话，就是追加模式</span></span><br><span class="line">                    format=</span><br><span class="line">                    <span class="string">'%(asctime)s - %(pathname)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span></span><br><span class="line">                    <span class="comment">#日志格式</span></span><br><span class="line">                    )</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">LOG_FORMAT = <span class="string">"%(asctime)s %(name)s %(levelname)s %(pathname)s %(message)s "</span><span class="comment">#配置输出日志格式</span></span><br><span class="line">DATE_FORMAT = <span class="string">'%Y-%m-%d  %H:%M:%S %a '</span> <span class="comment">#配置输出时间的格式，注意月份和天数不要搞乱了</span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=LOG_FORMAT,</span><br><span class="line">                    datefmt = DATE_FORMAT ,</span><br><span class="line">                    filename=<span class="string">r"d:\test\test.log"</span> <span class="comment">#有了filename参数就不会直接输出显示到控制台，而是直接写入文件</span></span><br><span class="line">                    )</span><br><span class="line">logging.debug(<span class="string">"msg1"</span>)</span><br><span class="line">logging.info(<span class="string">"msg2"</span>)</span><br><span class="line">logging.warning(<span class="string">"msg3"</span>)</span><br><span class="line">logging.error(<span class="string">"msg4"</span>)</span><br><span class="line">logging.critical(<span class="string">"msg5"</span>)</span><br></pre></td></tr></table></figure><p>日志在d:\test目录下，日志具体内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root DEBUG D:/<span class="number">06</span>python/exercise/test_package/test.py msg1</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root INFO D:/<span class="number">06</span>python/exercise/test_package/test.py msg2</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root WARNING D:/<span class="number">06</span>python/exercise/test_package/test.py msg3</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root ERROR D:/<span class="number">06</span>python/exercise/test_package/test.py msg4</span><br><span class="line"><span class="number">2018</span><span class="number">-05</span><span class="number">-10</span>  <span class="number">02</span>:<span class="number">13</span>:<span class="number">46</span> Thu AM  root CRITICAL D:/<span class="number">06</span>python/exercise/test_package/test.py msg5</span><br></pre></td></tr></table></figure><h3 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h3><p><strong>几个要说明的内容：</strong></p><ul><li><code>logging.basicConfig()</code>函数是一个一次性的简单配置工具使，也就是说只有在第一次调用该函数时会起作用，后续再次调用该函数时完全不会产生任何操作的，多次调用的设置并不是累加操作。</li><li>日志器（Logger）是有层级关系的，上面调用的logging模块级别的函数所使用的日志器是<code>RootLogger</code>类的实例，其名称为’root’，它是处于日志器层级关系最顶层的日志器，且该实例是以单例模式存在的。</li><li>如果要记录的日志中包含变量数据，可使用一个格式字符串作为这个事件的描述消息（logging.debug、logging.info等函数的第一个参数），然后将变量数据作为第二个参数*args的值进行传递，如:<code>logging.warning(&#39;%s is %d years old.&#39;, &#39;Tom&#39;, 10)</code>，输出内容为<code>WARNING:root:Tom is 10 years old.</code></li><li>logging.debug(), <a href="http://logging.info/" target="_blank" rel="noopener">logging.info</a>()等方法的定义中，除了msg和args参数外，还有一个**kwargs参数。它们支持3个关键字参数: <code>exc_info, stack_info, extra</code>，下面对这几个关键字参数作个说明。</li></ul><p><strong>关于exc_info, stack_info, extra关键词参数的说明:</strong></p><ul><li><strong>exc_info：</strong> 其值为布尔值，如果该参数的值设置为True，则会将异常异常信息添加到日志消息中。如果没有异常信息则添加None到日志信息中。</li><li><strong>stack_info：</strong> 其值也为布尔值，默认值为False。如果该参数的值设置为True，栈信息将会被添加到日志信息中。</li><li><strong>extra：</strong> 这是一个字典（dict）参数，它可以用来自定义消息格式中所包含的字段，但是它的key不能与logging模块定义的字段冲突。</li></ul><p><strong>一个例子：</strong></p><p>在日志消息中添加exc_info和stack_info信息，并添加两个自定义的字端 ip和user</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LOG_FORMAT = &quot;%(asctime)s - %(levelname)s - %(user)s[%(ip)s] - %(message)s&quot;</span><br><span class="line">DATE_FORMAT = &quot;%m/%d/%Y %H:%M:%S %p&quot;</span><br><span class="line"></span><br><span class="line">logging.basicConfig(format=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line">logging.warning(&quot;Some one delete the log file.&quot;, exc_info=True, stack_info=True, extra=&#123;&apos;user&apos;: &apos;Tom&apos;, &apos;ip&apos;:&apos;47.98.53.222&apos;&#125;)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">05/08/2017 16:35:00 PM - WARNING - Tom[47.98.53.222] - Some one delete the log file.</span><br><span class="line">NoneType</span><br><span class="line">Stack (most recent call last):</span><br><span class="line">  File &quot;C:/Users/wader/PycharmProjects/LearnPython/day06/log.py&quot;, line 45, in &lt;module&gt;</span><br><span class="line">    logging.warning(&quot;Some one delete the log file.&quot;, exc_info=True, stack_info=True, extra=&#123;&apos;user&apos;: &apos;Tom&apos;, &apos;ip&apos;:&apos;47.98.53.222&apos;&#125;)</span><br></pre></td></tr></table></figure><h2 id="logging模块日志流处理流程"><a href="#logging模块日志流处理流程" class="headerlink" title="logging模块日志流处理流程"></a>logging模块日志流处理流程</h2><p>在介绍logging模块的高级用法之前，很有必要对logging模块所包含的重要组件以及其工作流程做个全面、简要的介绍，这有助于我们更好的理解我们所写的代码（将会触发什么样的操作）。</p><h3 id="logging日志模块四大组件"><a href="#logging日志模块四大组件" class="headerlink" title="logging日志模块四大组件"></a>logging日志模块四大组件</h3><p>在介绍logging模块的日志流处理流程之前，我们先来介绍下logging模块的四大组件：</p><table><thead><tr><th>组件名称</th><th>对应类名</th><th>功能描述</th></tr></thead><tbody><tr><td>日志器</td><td>Logger</td><td>提供了应用程序可一直使用的接口</td></tr><tr><td>处理器</td><td>Handler</td><td>将logger创建的日志记录发送到合适的目的输出</td></tr><tr><td>过滤器</td><td>Filter</td><td>提供了更细粒度的控制工具来决定输出哪条日志记录，丢弃哪条日志记录</td></tr><tr><td>格式器</td><td>Formatter</td><td>决定日志记录的最终输出格式</td></tr></tbody></table><p>logging模块就是通过这些组件来完成日志处理的，上面所使用的logging模块级别的函数也是通过这些组件对应的类来实现的。</p><p><strong>这些组件之间的关系描述：</strong></p><ul><li>日志器（logger）需要通过处理器（handler）将日志信息输出到目标位置，如：文件、sys.stdout、网络等；</li><li>不同的处理器（handler）可以将日志输出到不同的位置；</li><li>日志器（logger）可以设置多个处理器（handler）将同一条日志记录输出到不同的位置；</li><li>每个处理器（handler）都可以设置自己的过滤器（filter）实现日志过滤，从而只保留感兴趣的日志；</li><li>每个处理器（handler）都可以设置自己的格式器（formatter）实现同一条日志以不同的格式输出到不同的地方。</li></ul><p>简单点说就是：日志器（logger）是入口，真正干活儿的是处理器（handler），处理器（handler）还可以通过过滤器（filter）和格式器（formatter）对要输出的日志内容做过滤和格式化等处理操作。</p><h3 id="logging日志模块相关类及其常用方法介绍"><a href="#logging日志模块相关类及其常用方法介绍" class="headerlink" title="logging日志模块相关类及其常用方法介绍"></a>logging日志模块相关类及其常用方法介绍</h3><p>下面介绍下与logging四大组件相关的类：Logger, Handler, Filter, Formatter。</p><h4 id="Logger类"><a href="#Logger类" class="headerlink" title="Logger类"></a>Logger类</h4><p>Logger对象有3个任务要做：</p><ul><li>1）向应用程序代码暴露几个方法，使应用程序可以在运行时记录日志消息；</li><li>2）基于日志严重等级（默认的过滤设施）或filter对象来决定要对哪些日志进行后续处理；</li><li>3）将日志消息传送给所有感兴趣的日志handlers。</li></ul><p>Logger对象最常用的方法分为两类：配置方法 和 消息发送方法</p><p>最常用的配置方法如下：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Logger.setLevel()</td><td>设置日志器将会处理的日志消息的最低严重级别</td></tr><tr><td>Logger.addHandler() 和 Logger.removeHandler()</td><td>为该logger对象添加 和 移除一个handler对象</td></tr><tr><td>Logger.addFilter() 和 Logger.removeFilter()</td><td>为该logger对象添加 和 移除一个filter对象</td></tr></tbody></table><blockquote><p><strong>关于Logger.setLevel()方法的说明：</strong></p><p>内建等级中，级别最低的是DEBUG，级别最高的是CRITICAL。例如setLevel([logging.INFO])，此时函数参数为INFO，那么该logger将只会处理INFO、WARNING、ERROR和CRITICAL级别的日志，而DEBUG级别的消息将会被忽略/丢弃。</p></blockquote><p>Logger对象配置完成后，可以使用下面的方法来创建日志记录：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Logger.debug(), <a href="http://logger.info/" target="_blank" rel="noopener">Logger.info</a>(), Logger.warning(), Logger.error(), Logger.critical()</td><td>创建一个与它们的方法名对应等级的日志记录</td></tr><tr><td>Logger.exception()</td><td>创建一个类似于Logger.error()的日志消息</td></tr><tr><td>Logger.log()</td><td>需要获取一个明确的日志level参数来创建一个日志记录</td></tr></tbody></table><blockquote><p><strong>说明：</strong></p><ul><li>Logger.exception()与Logger.error()的区别在于：Logger.exception()将会输出堆栈追踪信息，另外通常只是在一个exception handler中调用该方法。</li><li>Logger.log()与Logger.debug()、<a href="http://logger.info/" target="_blank" rel="noopener">Logger.info</a>()等方法相比，虽然需要多传一个level参数，显得不是那么方便，但是当需要记录自定义level的日志时还是需要该方法来完成。</li></ul></blockquote><p>那么，怎样得到一个Logger对象呢？一种方式是通过Logger类的实例化方法创建一个Logger类的实例，但是我们通常都是用第二种方式–logging.getLogger()方法。</p><p>logging.getLogger()方法有一个可选参数name，该参数表示将要返回的日志器的名称标识，如果不提供该参数，则其值为’root’。若以相同的name参数值多次调用getLogger()方法，将会返回指向同一个logger对象的引用。</p><blockquote><p><strong>关于logger的层级结构与有效等级的说明：</strong></p><ul><li>logger的名称是一个以’.’分割的层级结构，每个’.’后面的logger都是’.’前面的logger的children，例如，有一个名称为 foo 的logger，其它名称分别为 foo.bar, foo.bar.baz 和 foo.bam都是 foo 的后代。</li><li>logger有一个”有效等级（effective level）”的概念。如果一个logger上没有被明确设置一个level，那么该logger就是使用它parent的level;如果它的parent也没有明确设置level则继续向上查找parent的parent的有效level，依次类推，直到找到个一个明确设置了level的祖先为止。需要说明的是，root logger总是会有一个明确的level设置（默认为 WARNING）。当决定是否去处理一个已发生的事件时，logger的有效等级将会被用来决定是否将该事件传递给该logger的handlers进行处理。</li><li>child loggers在完成对日志消息的处理后，默认会将日志消息传递给与它们的祖先loggers相关的handlers。因此，我们不必为一个应用程序中所使用的所有loggers定义和配置handlers，只需要为一个顶层的logger配置handlers，然后按照需要创建child loggers就可足够了。我们也可以通过将一个logger的propagate属性设置为False来关闭这种传递机制。</li></ul></blockquote><h4 id="Handler类"><a href="#Handler类" class="headerlink" title="Handler类"></a>Handler类</h4><p>Handler对象的作用是（基于日志消息的level）将消息分发到handler指定的位置（文件、网络、邮件等）。Logger对象可以通过addHandler()方法为自己添加0个或者更多个handler对象。比如，一个应用程序可能想要实现以下几个日志需求：</p><ul><li>1）把所有日志都发送到一个日志文件中；</li><li>2）把所有严重级别大于等于error的日志发送到stdout（标准输出）；</li><li>3）把所有严重级别为critical的日志发送到一个email邮件地址。<br>这种场景就需要3个不同的handlers，每个handler复杂发送一个特定严重级别的日志到一个特定的位置。</li></ul><p>一个handler中只有非常少数的方法是需要应用开发人员去关心的。对于使用内建handler对象的应用开发人员来说，似乎唯一相关的handler方法就是下面这几个配置方法：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Handler.setLevel()</td><td>设置handler将会处理的日志消息的最低严重级别</td></tr><tr><td>Handler.setFormatter()</td><td>为handler设置一个格式器对象</td></tr><tr><td>Handler.addFilter() 和 Handler.removeFilter()</td><td>为handler添加 和 删除一个过滤器对象</td></tr></tbody></table><p>需要说明的是，应用程序代码不应该直接实例化和使用Handler实例。因为Handler是一个基类，它只定义了素有handlers都应该有的接口，同时提供了一些子类可以直接使用或覆盖的默认行为。下面是一些常用的Handler：</p><table><thead><tr><th>Handler</th><th>描述</th></tr></thead><tbody><tr><td>logging.StreamHandler</td><td>将日志消息发送到输出到Stream，如std.out, std.err或任何file-like对象。</td></tr><tr><td>logging.FileHandler</td><td>将日志消息发送到磁盘文件，默认情况下文件大小会无限增长</td></tr><tr><td>logging.handlers.RotatingFileHandler</td><td>将日志消息发送到磁盘文件，并支持日志文件按大小切割</td></tr><tr><td>logging.hanlders.TimedRotatingFileHandler</td><td>将日志消息发送到磁盘文件，并支持日志文件按时间切割</td></tr><tr><td>logging.handlers.HTTPHandler</td><td>将日志消息以GET或POST的方式发送给一个HTTP服务器</td></tr><tr><td>logging.handlers.SMTPHandler</td><td>将日志消息发送给一个指定的email地址</td></tr><tr><td>logging.NullHandler</td><td>该Handler实例会忽略error messages，通常被想使用logging的library开发者使用来避免’No handlers could be found for logger XXX’信息的出现。</td></tr></tbody></table><h4 id="Formater类"><a href="#Formater类" class="headerlink" title="Formater类"></a>Formater类</h4><p>Formater对象用于配置日志信息的最终顺序、结构和内容。与logging.Handler基类不同的是，应用代码可以直接实例化Formatter类。另外，如果你的应用程序需要一些特殊的处理行为，也可以实现一个Formatter的子类来完成。</p><p>Formatter类的构造方法定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.Formatter.__init__(fmt=None, datefmt=None, style=&apos;%&apos;)</span><br></pre></td></tr></table></figure><p>可见，该构造方法接收3个可选参数：</p><ul><li>fmt：指定消息格式化字符串，如果不指定该参数则默认使用message的原始值</li><li>datefmt：指定日期格式字符串，如果不指定该参数则默认使用”%Y-%m-%d %H:%M:%S”</li><li>style：Python 3.2新增的参数，可取值为 ‘%’, ‘{‘和 ‘$’，如果不指定该参数则默认使用’%’</li></ul><h4 id="Filter类"><a href="#Filter类" class="headerlink" title="Filter类"></a>Filter类</h4><p>Filter可以被Handler和Logger用来做比level更细粒度的、更复杂的过滤功能。Filter是一个过滤器基类，它只允许某个logger层级下的日志事件通过过滤。该类定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class logging.Filter(name=&apos;&apos;)</span><br><span class="line">    filter(record)</span><br></pre></td></tr></table></figure><p>比如，一个filter实例化时传递的name参数值为’A.B’，那么该filter实例将只允许名称为类似如下规则的loggers产生的日志记录通过过滤：’A.B’，’A.B,C’，’A.B.C.D’，’A.B.D’，而名称为’<a href="http://a.bb/" target="_blank" rel="noopener">A.BB</a>‘, ‘B.A.B’的loggers产生的日志则会被过滤掉。如果name的值为空字符串，则允许所有的日志事件通过过滤。</p><p>filter方法用于具体控制传递的record记录是否能通过过滤，如果该方法返回值为0表示不能通过过滤，返回值为非0表示可以通过过滤。</p><blockquote><p><strong>说明：</strong></p><ul><li>如果有需要，也可以在filter(record)方法内部改变该record，比如添加、删除或修改一些属性。</li><li>我们还可以通过filter做一些统计工作，比如可以计算下被一个特殊的logger或handler所处理的record数量等。</li></ul></blockquote><h3 id="logging日志流处理流程"><a href="#logging日志流处理流程" class="headerlink" title="logging日志流处理流程"></a>logging日志流处理流程</h3><p><img src="https://gongzhao-1256784911.cos.ap-shanghai.myqcloud.com/hexo/images/python/13.png" alt="img"></p><p>我们来描述下上面这个图的日志流处理流程：</p><ul><li>1）（在用户代码中进行）日志记录函数调用，如：<a href="http://logger.info/" target="_blank" rel="noopener">logger.info</a>(…)，logger.debug(…)等；</li><li>2）判断要记录的日志级别是否满足日志器设置的级别要求（要记录的日志级别要大于或等于日志器设置的级别才算满足要求），如果不满足则该日志记录会被丢弃并终止后续的操作，如果满足则继续下一步操作；</li><li>3）根据日志记录函数调用时掺入的参数，创建一个日志记录（LogRecord类）对象；</li><li>4）判断日志记录器上设置的过滤器是否拒绝这条日志记录，如果日志记录器上的某个过滤器拒绝，则该日志记录会被丢弃并终止后续的操作，如果日志记录器上设置的过滤器不拒绝这条日志记录或者日志记录器上没有设置过滤器则继续下一步操作–将日志记录分别交给该日志器上添加的各个处理器；</li><li>5）判断要记录的日志级别是否满足处理器设置的级别要求（要记录的日志级别要大于或等于该处理器设置的日志级别才算满足要求），如果不满足记录将会被该处理器丢弃并终止后续的操作，如果满足则继续下一步操作；</li><li>6）判断该处理器上设置的过滤器是否拒绝这条日志记录，如果该处理器上的某个过滤器拒绝，则该日志记录会被当前处理器丢弃并终止后续的操作，如果当前处理器上设置的过滤器不拒绝这条日志记录或当前处理器上没有设置过滤器测继续下一步操作；</li><li>7）如果能到这一步，说明这条日志记录经过了层层关卡允许被输出了，此时当前处理器会根据自身被设置的格式器（如果没有设置则使用默认格式）将这条日志记录进行格式化，最后将格式化后的结果输出到指定位置（文件、网络、类文件的Stream等）；</li><li>8）如果日志器被设置了多个处理器的话，上面的第5-8步会执行多次；</li><li>9）这里才是完整流程的最后一步：判断该日志器输出的日志消息是否需要传递给上一级logger（之前提到过，日志器是有层级关系的）的处理器，如果propagate属性值为1则表示日志消息将会被输出到处理器指定的位置，同时还会被传递给parent日志器的handlers进行处理直到当前日志器的propagate属性为0停止，如果propagate值为0则表示不向parent日志器的handlers传递该消息，到此结束。</li></ul><p>可见，一条日志信息要想被最终输出需要依次经过以下几次过滤：</p><ul><li>日志器等级过滤；</li><li>日志器的过滤器过滤；</li><li>日志器的处理器等级过滤；</li><li>日志器的处理器的过滤器过滤；</li></ul><blockquote><p><strong>需要说明的是：</strong> 关于上面第9个步骤，如果propagate值为1，那么日志消息会直接传递交给上一级logger的handlers进行处理，此时上一级logger的日志等级并不会对该日志消息进行等级过滤。</p></blockquote><p><strong>简化处理流程</strong>:</p><p>1、创建一个logger</p><p>2、设置下logger的日志的等级</p><p>3、创建合适的Handler(FileHandler要有路径)</p><p>4、设置下每个Handler的日志等级</p><p>5、创建下日志的格式</p><p>6、向Handler中添加上面创建的格式</p><p>7、将上面创建的Handler添加到logger中</p><p>8、打印输出logger.debug\logger.info\logger.warning\logger.error\logger.critical</p><h3 id="使用logging四大组件记录日志"><a href="#使用logging四大组件记录日志" class="headerlink" title="使用logging四大组件记录日志"></a>使用logging四大组件记录日志</h3><p>现在，我们对logging模块的重要组件及整个日志流处理流程都应该有了一个比较全面的了解，下面我们来看一个例子。</p><h4 id="1-需求"><a href="#1-需求" class="headerlink" title="1. 需求"></a>1. 需求</h4><p>现在有以下几个日志记录的需求：</p><ul><li>1）要求将所有级别的所有日志都写入磁盘文件中</li><li>2）all.log文件中记录所有的日志信息，日志格式为：日期和时间 - 日志级别 - 日志信息</li><li>3）error.log文件中单独记录error及以上级别的日志信息，日志格式为：日期和时间 - 日志级别 - 文件名[:行号] - 日志信息</li><li>4）要求all.log在每天凌晨进行日志切割</li></ul><h4 id="2-分析"><a href="#2-分析" class="headerlink" title="2. 分析"></a>2. 分析</h4><ul><li>1）要记录所有级别的日志，因此日志器的有效level需要设置为最低级别–DEBUG;</li><li>2）日志需要被发送到两个不同的目的地，因此需要为日志器设置两个handler；另外，两个目的地都是磁盘文件，因此这两个handler都是与FileHandler相关的；</li><li>3）all.log要求按照时间进行日志切割，因此他需要用logging.handlers.TimedRotatingFileHandler; 而error.log没有要求日志切割，因此可以使用FileHandler;</li><li>4）两个日志文件的格式不同，因此需要对这两个handler分别设置格式器；</li></ul><h4 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import logging.handlers</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(&apos;mylogger&apos;)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">rf_handler = logging.handlers.TimedRotatingFileHandler(&apos;all.log&apos;, when=&apos;midnight&apos;, interval=1, backupCount=7, atTime=datetime.time(0, 0, 0, 0))</span><br><span class="line">rf_handler.setFormatter(logging.Formatter(&quot;%(asctime)s - %(levelname)s - %(message)s&quot;))</span><br><span class="line"></span><br><span class="line">f_handler = logging.FileHandler(&apos;error.log&apos;)</span><br><span class="line">f_handler.setLevel(logging.ERROR)</span><br><span class="line">f_handler.setFormatter(logging.Formatter(&quot;%(asctime)s - %(levelname)s - %(filename)s[:%(lineno)d] - %(message)s&quot;))</span><br><span class="line"></span><br><span class="line">logger.addHandler(rf_handler)</span><br><span class="line">logger.addHandler(f_handler)</span><br><span class="line"></span><br><span class="line">logger.debug(&apos;debug message&apos;)</span><br><span class="line">logger.info(&apos;info message&apos;)</span><br><span class="line">logger.warning(&apos;warning message&apos;)</span><br><span class="line">logger.error(&apos;error message&apos;)</span><br><span class="line">logger.critical(&apos;critical message&apos;)</span><br></pre></td></tr></table></figure><p>all.log文件输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-05-13 16:12:40,612 - DEBUG - debug message</span><br><span class="line">2017-05-13 16:12:40,612 - INFO - info message</span><br><span class="line">2017-05-13 16:12:40,612 - WARNING - warning message</span><br><span class="line">2017-05-13 16:12:40,612 - ERROR - error message</span><br><span class="line">2017-05-13 16:12:40,613 - CRITICAL - critical message</span><br></pre></td></tr></table></figure><p>error.log文件输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2017-05-13 16:12:40,612 - ERROR - log.py[:81] - error message</span><br><span class="line">2017-05-13 16:12:40,613 - CRITICAL - log.py[:82] - critical message</span><br></pre></td></tr></table></figure><h4 id="4-其它例子"><a href="#4-其它例子" class="headerlink" title="4.其它例子"></a>4.其它例子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建handler</span></span><br><span class="line">fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置输出日志格式</span></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">    datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意 logging.Formatter的大小写</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#为handler指定输出格式，注意大小写</span></span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">logger.addHandler(fh)</span><br><span class="line">logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出不同级别的log</span></span><br><span class="line">logger.warning(<span class="string">"泰拳警告"</span>)</span><br><span class="line">logger.info(<span class="string">"提示"</span>)</span><br><span class="line">logger.error(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>python logging 重复写日志问题</strong></p><p>用Python的logging模块记录日志时，可能会遇到重复记录日志的问题，第一条记录写一次，第二条记录写两次，第三条记录写三次</p><p><strong>原因：没有移除handler</strong> <strong>解决：在日志记录完之后removeHandler</strong></p><p>例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建handler</span></span><br><span class="line">    fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">    ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置输出日志格式</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">        datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为handler指定输出格式</span></span><br><span class="line">    fh.setFormatter(formatter)</span><br><span class="line">    ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">    logger.addHandler(fh)</span><br><span class="line">    logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 泰拳警告</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 提示</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 提示</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br><span class="line"><span class="number">2018</span>/<span class="number">05</span>/<span class="number">10</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">18</span> nick test.py 错误</span><br></pre></td></tr></table></figure><p>分析：可以看到输出结果有重复打印</p><p>原因：第二次调用log的时候，根据getLogger(name)里的name获取同一个logger，而这个logger里已经有了第一次你添加的handler，第二次调用又添加了一个handler，所以，这个logger里有了两个同样的handler，以此类推，调用几次就会有几个handler。</p><p><strong>解决方案1</strong></p><p>添加removeHandler语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建handler</span></span><br><span class="line">    fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">    ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置输出日志格式</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">        datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为handler指定输出格式</span></span><br><span class="line">    fh.setFormatter(formatter)</span><br><span class="line">    ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">    logger.addHandler(fh)</span><br><span class="line">    logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#解决方案1，添加removeHandler语句，每次用完之后移除Handler</span></span><br><span class="line">    logger.removeHandler(fh)</span><br><span class="line">    logger.removeHandler(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>解决方案2</strong></p><p>在log方法里做判断，如果这个logger已有handler，则不再添加handler。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#解决方案2：这里进行判断，如果logger.handlers列表为空，则添加，否则，直接去写日志</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logger.handlers:</span><br><span class="line">        <span class="comment">#创建handler</span></span><br><span class="line">        fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置输出日志格式</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">            datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为handler指定输出格式</span></span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">        logger.addHandler(fh)</span><br><span class="line">        logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出不同级别的log</span></span><br><span class="line">    logger.info(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">"泰拳警告"</span>)</span><br><span class="line">log(<span class="string">"提示"</span>)</span><br><span class="line">log(<span class="string">"错误"</span>)</span><br></pre></td></tr></table></figure><p><strong>logger调用方式例子</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#创建logger，如果参数为空则返回root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"nick"</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)  <span class="comment">#设置logger日志等级</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#这里进行判断，如果logger.handlers列表为空，则添加，否则，直接去写日志</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logger.handlers:</span><br><span class="line">        <span class="comment">#创建handler</span></span><br><span class="line">        fh = logging.FileHandler(<span class="string">"test.log"</span>,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置输出日志格式</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            fmt=<span class="string">"%(asctime)s %(name)s %(filename)s %(message)s"</span>,</span><br><span class="line">            datefmt=<span class="string">"%Y/%m/%d %X"</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为handler指定输出格式</span></span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#为logger添加的日志处理器</span></span><br><span class="line">        logger.addHandler(fh)</span><br><span class="line">        logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> logger <span class="comment">#直接返回logger</span></span><br><span class="line"></span><br><span class="line">logger = log()</span><br><span class="line">logger.warning(<span class="string">"泰拳警告"</span>)</span><br><span class="line">logger.info(<span class="string">"提示"</span>)</span><br><span class="line">logger.error(<span class="string">"错误"</span>)</span><br><span class="line">logger.debug(<span class="string">"查错"</span>)</span><br></pre></td></tr></table></figure><h4 id="5-屏幕和文件同时输出"><a href="#5-屏幕和文件同时输出" class="headerlink" title="5.屏幕和文件同时输出"></a>5.屏幕和文件同时输出</h4><p>logging库采取了模块化的设计，提供了许多组件：记录器、处理器、过滤器和格式化器。</p><ul><li>Logger 暴露了应用程序代码能直接使用的接口。</li><li>Handler将（记录器产生的）日志记录发送至合适的目的地。</li><li>Filter提供了更好的粒度控制，它可以决定输出哪些日志记录。</li><li>Formatter 指明了最终输出中日志记录的布局。</li></ul><h5 id="Loggers"><a href="#Loggers" class="headerlink" title="Loggers:"></a>Loggers:</h5><p>Logger 对象要做三件事情。首先，它们向应用代码暴露了许多方法，这样应用可以在运行时记录消息。其次，记录器对象通过严重程度（默认的过滤设施）或者过滤器对象来决定哪些日志消息需要记录下来。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。</p><p>常用的记录器对象的方法分为两类：配置和发送消息。</p><p>这些是最常用的配置方法：</p><p>Logger.setLevel()指定logger将会处理的最低的安全等级日志信息, debug是最低的内置安全等级，critical是最高的内建安全等级。例如，如果严重程度为INFO，记录器将只处理INFO，WARNING，ERROR和CRITICAL消息，DEBUG消息被忽略。<br>Logger.addHandler()和Logger.removeHandler()从记录器对象中添加和删除处理程序对象。处理器详见Handlers。<br>Logger.addFilter()和Logger.removeFilter()从记录器对象添加和删除过滤器对象。</p><h5 id="Handlers"><a href="#Handlers" class="headerlink" title="Handlers"></a>Handlers</h5><p><code>处理程序</code>对象负责将适当的日志消息（基于日志消息的严重性）分派到处理程序的指定目标。<code>Logger</code> 对象可以通过<code>addHandler()</code>方法增加零个或多个handler对象。举个例子，一个应用可以将所有的日志消息发送至日志文件，所有的错误级别（error）及以上的日志消息发送至标准输出，所有的严重级别（critical）日志消息发送至某个电子邮箱。在这个例子中需要三个独立的处理器，每一个负责将特定级别的消息发送至特定的位置。</p><p>常用的有4种： </p><p><strong>1)    logging.StreamHandler -&gt; 控制台输出</strong> </p><p>使用这个Handler可以向类似与sys.stdout或者sys.stderr的任何文件对象(file object)输出信息。</p><p>它的构造函数是：<br><code>StreamHandler([strm])</code><br>其中strm参数是一个文件对象。默认是sys.stderr</p><p>2)   <strong>logging.FileHandler  -&gt; 文件输出</strong></p><p>和StreamHandler类似，用于向一个文件输出日志信息。不过FileHandler会帮你打开这个文件。它的构造函数是：<br><code>FileHandler(filename[,mode])</code><br>filename是文件名，必须指定一个文件名。<br>mode是文件的打开方式。默认是’a’，即添加到文件末尾。</p><p>3)   <strong>logging.handlers.RotatingFileHandler</strong> <strong>-&gt; 按照大小自动分割日志文件，一旦达到指定的大小重新生成文件</strong> </p><p>这个Handler类似于上面的FileHandler，但是它可以管理文件大小。当文件达到一定大小之后，它会自动将当前日志文件改名，然后创建 一个新的同名日志文件继续输出。比如日志文件是chat.log。当chat.log达到指定的大小之后，RotatingFileHandler自动把 文件改名为chat.log.1。不过，如果chat.log.1已经存在，会先把chat.log.1重命名为chat.log.2。最后重新创建 chat.log，继续输出日志信息。它的构造函数是：<br><code>RotatingFileHandler( filename[, mode[, maxBytes[, backupCount]]])</code><br>其中filename和mode两个参数和FileHandler一样。<br>maxBytes用于指定日志文件的最大文件大小。如果maxBytes为0，意味着日志文件可以无限大，这时上面描述的重命名过程就不会发生。<br>backupCount用于指定保留的备份文件的个数。比如，如果指定为2，当上面描述的重命名过程发生时，原有的chat.log.2并不会被更名，而是被删除。</p><p>4)   <strong>logging.handlers.TimedRotatingFileHandler  -&gt;</strong> <strong>按照时间自动分割日志文件</strong> </p><p>这个Handler和RotatingFileHandler类似，不过，它没有通过判断文件大小来决定何时重新创建日志文件，而是间隔一定时间就 自动创建新的日志文件。重命名的过程与RotatingFileHandler类似，不过新的文件不是附加数字，而是当前时间。它的构造函数是：<br><code>TimedRotatingFileHandler( filename [,when [,interval [,backupCount]]])</code><br>其中filename参数和backupCount参数和RotatingFileHandler具有相同的意义。<br>interval是时间间隔。<br>when参数是一个字符串。表示时间间隔的单位，不区分大小写。它有以下取值：<br>S 秒<br>M 分<br>H 小时<br>D 天<br>W 每星期（interval==0时代表星期一）<br>midnight 每天凌晨</p><h5 id="Formatters"><a href="#Formatters" class="headerlink" title="Formatters"></a>Formatters</h5><p>Formatter对象设置日志信息最后的规则、结构和内容，默认的时间格式为<code>%Y-%m-%d %H:%M:%S</code>，下面是Formatter常用的一些信息</p><table><thead><tr><th>%(name)s</th><th>Logger的名字</th></tr></thead><tbody><tr><td>%(levelno)s</td><td>数字形式的日志级别</td></tr><tr><td>%(levelname)s</td><td>文本形式的日志级别</td></tr><tr><td>%(pathname)s</td><td>调用日志输出函数的模块的完整路径名，可能没有</td></tr><tr><td>%(filename)s</td><td>调用日志输出函数的模块的文件名</td></tr><tr><td>%(module)s</td><td>调用日志输出函数的模块名</td></tr><tr><td>%(funcName)s</td><td>调用日志输出函数的函数名</td></tr><tr><td>%(lineno)d</td><td>调用日志输出函数的语句所在的代码行</td></tr><tr><td>%(created)f</td><td>当前时间，用UNIX标准的表示时间的浮 点数表示</td></tr><tr><td>%(relativeCreated)d</td><td>输出日志信息时的，自Logger创建以 来的毫秒数</td></tr><tr><td>%(asctime)s</td><td>字符串形式的当前时间。默认格式是 “2003-07-08 16:49:45,896”。逗号后面的是毫秒</td></tr><tr><td>%(thread)d</td><td>线程ID。可能没有</td></tr><tr><td>%(threadName)s</td><td>线程名。可能没有</td></tr><tr><td>%(process)d</td><td>进程ID。可能没有</td></tr><tr><td>%(message)s</td><td>用户输出的消息</td></tr></tbody></table><h5 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h5><p>输出log到控制台以及将日志写入log文件。<br>保存2种类型的log， all.log 保存debug, info, warning, critical 信息， error.log则只保存error信息，同时按照时间自动分割日志文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> handlers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span><span class="params">(object)</span>:</span></span><br><span class="line">    level_relations = &#123;</span><br><span class="line">        <span class="string">'debug'</span>:logging.DEBUG,</span><br><span class="line">        <span class="string">'info'</span>:logging.INFO,</span><br><span class="line">        <span class="string">'warning'</span>:logging.WARNING,</span><br><span class="line">        <span class="string">'error'</span>:logging.ERROR,</span><br><span class="line">        <span class="string">'crit'</span>:logging.CRITICAL</span><br><span class="line">    &#125;<span class="comment">#日志级别关系映射</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,filename,level=<span class="string">'info'</span>,when=<span class="string">'D'</span>,backCount=<span class="number">3</span>,fmt=<span class="string">'%(asctime)s - %(pathname)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span>)</span>:</span></span><br><span class="line">        self.logger = logging.getLogger(filename)</span><br><span class="line">        format_str = logging.Formatter(fmt)<span class="comment">#设置日志格式</span></span><br><span class="line">        self.logger.setLevel(self.level_relations.get(level))<span class="comment">#设置日志级别</span></span><br><span class="line">        sh = logging.StreamHandler()<span class="comment">#往屏幕上输出</span></span><br><span class="line">        sh.setFormatter(format_str) <span class="comment">#设置屏幕上显示的格式</span></span><br><span class="line">        th = handlers.TimedRotatingFileHandler(filename=filename,when=when,backupCount=backCount,encoding=<span class="string">'utf-8'</span>)<span class="comment">#往文件里写入#指定间隔时间自动生成文件的处理器</span></span><br><span class="line">        <span class="comment">#实例化TimedRotatingFileHandler</span></span><br><span class="line">        <span class="comment">#interval是时间间隔，backupCount是备份文件的个数，如果超过这个个数，就会自动删除，when是间隔的时间单位，单位有以下几种：</span></span><br><span class="line">        <span class="comment"># S 秒</span></span><br><span class="line">        <span class="comment"># M 分</span></span><br><span class="line">        <span class="comment"># H 小时、</span></span><br><span class="line">        <span class="comment"># D 天、</span></span><br><span class="line">        <span class="comment"># W 每星期（interval==0时代表星期一）</span></span><br><span class="line">        <span class="comment"># midnight 每天凌晨</span></span><br><span class="line">        th.setFormatter(format_str)<span class="comment">#设置文件里写入的格式</span></span><br><span class="line">        self.logger.addHandler(sh) <span class="comment">#把对象加到logger里</span></span><br><span class="line">        self.logger.addHandler(th)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    log = Logger(<span class="string">'all.log'</span>,level=<span class="string">'debug'</span>)</span><br><span class="line">    log.logger.debug(<span class="string">'debug'</span>)</span><br><span class="line">    log.logger.info(<span class="string">'info'</span>)</span><br><span class="line">    log.logger.warning(<span class="string">'警告'</span>)</span><br><span class="line">    log.logger.error(<span class="string">'报错'</span>)</span><br><span class="line">    log.logger.critical(<span class="string">'严重'</span>)</span><br><span class="line">    Logger(<span class="string">'error.log'</span>, level=<span class="string">'error'</span>).logger.error(<span class="string">'error'</span>)</span><br></pre></td></tr></table></figure><p>屏幕上结果如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:25] - DEBUG: debug</span><br><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:26] - INFO: info</span><br><span class="line">2018-03-13 21:06:46,092 - D:/write_to_log.py[line:27] - WARNING: 警告</span><br><span class="line">2018-03-13 21:06:46,099 - D:/write_to_log.py[line:28] - ERROR: 报错</span><br><span class="line">2018-03-13 21:06:46,099 - D:/write_to_log.py[line:29] - CRITICAL: 严重</span><br><span class="line">2018-03-13 21:06:46,100 - D:/write_to_log.py[line:30] - ERROR: error</span><br></pre></td></tr></table></figure><h2 id="配置logging的几种方式"><a href="#配置logging的几种方式" class="headerlink" title="配置logging的几种方式"></a>配置logging的几种方式</h2><hr><p>作为开发者，我们可以通过以下3中方式来配置logging:</p><ul><li>1）使用Python代码显式的创建loggers, handlers和formatters并分别调用它们的配置函数；</li><li>2）创建一个日志配置文件，然后使用<code>fileConfig()</code>函数来读取该文件的内容；</li><li>3）创建一个包含配置信息的dict，然后把它传递个<code>dictConfig()</code>函数；</li></ul><p>具体说明请参考另一篇博文<a href="http://www.cnblogs.com/yyds/p/6885182.html" target="_blank" rel="noopener"> 《python之配置日志的几种方式》</a></p><h2 id="向日志输出中添加上下文信息"><a href="#向日志输出中添加上下文信息" class="headerlink" title="向日志输出中添加上下文信息"></a>向日志输出中添加上下文信息</h2><hr><p>除了传递给日志记录函数的参数外，有时候我们还想在日志输出中包含一些额外的上下文信息。比如，在一个网络应用中，可能希望在日志中记录客户端的特定信息，如：远程客户端的IP地址和用户名。这里我们来介绍以下几种实现方式：</p><ul><li>通过向日志记录函数传递一个<code>extra</code>参数引入上下文信息</li><li>使用LoggerAdapters引入上下文信息</li><li>使用Filters引入上下文信息</li></ul><p>具体说明请参考另一篇博文<a href="http://www.cnblogs.com/yyds/p/6897964.html" target="_blank" rel="noopener"> 《Python之向日志输出中添加上下文信息》</a></p><p>关于Python logging的更多高级用法，请参考文档<a href="https://docs.python.org/3.5/howto/logging-cookbook.html" target="_blank" rel="noopener">&lt;&lt; Logging CookBook &gt;&gt;</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/yyds/p/6901864.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/yyds/p/6901864.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/yuanyongqiang/p/11913812.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/yuanyongqiang/p/11913812.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/nancyzhu/p/8551506.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/nancyzhu/p/8551506.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;日志相关概念&quot;&gt;&lt;a href=&quot;#日志相关概念&quot; class=&quot;headerlink&quot; title=&quot;日志相关概念&quot;&gt;&lt;/a&gt;日志相关概念&lt;/h1&gt;&lt;p&gt;日志是一种可以追踪某些软件运行时所发生事件的方法。软件开发人员可以向他们的代码中调用日志记录相关的方法来表明发生了某些事情。一个事件可以用一个可包含可选变量数据的消息来描述。此外，事件也有重要性的概念，这个重要性也可以被称为严重性级别（level）。&lt;/p&gt;
&lt;h2 id=&quot;日志的作用&quot;&gt;&lt;a href=&quot;#日志的作用&quot; class=&quot;headerlink&quot; title=&quot;日志的作用&quot;&gt;&lt;/a&gt;日志的作用&lt;/h2&gt;&lt;p&gt;通过log的分析，可以方便用户了解系统或软件、应用的运行情况；如果你的应用log足够丰富，也可以分析以往用户的操作行为、类型喜好、地域分布或其他更多信息；如果一个应用的log同时也分了多个级别，那么可以很轻易地分析得到该应用的健康状况，及时发现问题并快速定位、解决问题，补救损失。&lt;br&gt;简单来讲就是，我们通过记录和分析日志可以了解一个系统或软件程序运行情况是否正常，也可以在应用程序出现故障时快速定位问题。比如，做运维的同学，在接收到报警或各种问题反馈后，进行问题排查时通常都会先去看各种日志，大部分问题都可以在日志中找到答案。再比如，做开发的同学，可以通过IDE控制台上输出的各种日志进行程序调试。对于运维老司机或者有经验的开发人员，可以快速的通过日志定位到问题的根源。可见，日志的重要性不可小觑。日志的作用可以简单总结为以下3点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;程序调试&lt;/li&gt;
&lt;li&gt;了解软件程序运行情况，是否正常&lt;/li&gt;
&lt;li&gt;软件程序运行故障分析与问题定位&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果应用的日志信息足够详细和丰富，还可以用来做用户行为分析，如：分析用户的操作行为、类型洗好、地域分布以及其它更多的信息，由此可以实现改进业务、提高商业利益。&lt;/p&gt;
&lt;h2 id=&quot;日志的等级&quot;&gt;&lt;a href=&quot;#日志的等级&quot; class=&quot;headerlink&quot; title=&quot;日志的等级&quot;&gt;&lt;/a&gt;日志的等级&lt;/h2&gt;&lt;p&gt;我们先来思考下下面的两个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;作为开发人员，在开发一个应用程序时需要什么日志信息？在应用程序正式上线后需要什么日志信息？&lt;/li&gt;
&lt;li&gt;作为应用运维人员，在部署开发环境时需要什么日志信息？在部署生产环境时需要什么日志信息？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在软件开发阶段或部署开发环境时，为了尽可能详细的查看应用程序的运行状态来保证上线后的稳定性，我们可能需要把该应用程序所有的运行日志全部记录下来进行分析，这是非常耗费机器性能的。当应用程序正式发布或在生产环境部署应用程序时，我们通常只需要记录应用程序的异常信息、错误信息等，这样既可以减小服务器的I/O压力，也可以避免我们在排查故障时被淹没在日志的海洋里。那么，怎样才能在不改动应用程序代码的情况下实现在不同的环境记录不同详细程度的日志呢？这就是日志等级的作用了，我们通过配置文件指定我们需要的日志等级就可以了。&lt;/p&gt;
&lt;p&gt;不同的应用程序所定义的日志等级可能会有所差别，分的详细点的会包含以下几个等级：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DEBUG&lt;/li&gt;
&lt;li&gt;INFO&lt;/li&gt;
&lt;li&gt;NOTICE&lt;/li&gt;
&lt;li&gt;WARNING&lt;/li&gt;
&lt;li&gt;ERROR&lt;/li&gt;
&lt;li&gt;CRITICAL&lt;/li&gt;
&lt;li&gt;ALERT&lt;/li&gt;
&lt;li&gt;EMERGENCY&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;日志字段信息与日志格式&quot;&gt;&lt;a href=&quot;#日志字段信息与日志格式&quot; class=&quot;headerlink&quot; title=&quot;日志字段信息与日志格式&quot;&gt;&lt;/a&gt;日志字段信息与日志格式&lt;/h2&gt;&lt;p&gt;本节开始问题提到过，一条日志信息对应的是一个事件的发生，而一个事件通常需要包括以下几个内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;事件发生时间&lt;/li&gt;
&lt;li&gt;事件发生位置&lt;/li&gt;
&lt;li&gt;事件的严重程度–日志级别&lt;/li&gt;
&lt;li&gt;事件内容&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面这些都是一条日志记录中可能包含的字段信息，当然还可以包括一些其他信息，如进程ID、进程名称、线程ID、线程名称等。日志格式就是用来定义一条日志记录中包含那些字段的，且日志格式通常都是可以自定义的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;说明：&lt;/p&gt;
&lt;p&gt;输出一条日志时，日志内容和日志级别是需要开发人员明确指定的。对于而其它字段信息，只需要是否显示在日志中就可以了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;日志功能的实现&quot;&gt;&lt;a href=&quot;#日志功能的实现&quot; class=&quot;headerlink&quot; title=&quot;日志功能的实现&quot;&gt;&lt;/a&gt;日志功能的实现&lt;/h2&gt;&lt;p&gt;几乎所有开发语言都会内置日志相关功能，或者会有比较优秀的第三方库来提供日志操作功能，比如：log4j，log4php等。它们功能强大、使用简单。Python自身也提供了一个用于记录日志的标准库模块–logging。&lt;/p&gt;
&lt;h1 id=&quot;logging模块简介&quot;&gt;&lt;a href=&quot;#logging模块简介&quot; class=&quot;headerlink&quot; title=&quot;logging模块简介&quot;&gt;&lt;/a&gt;logging模块简介&lt;/h1&gt;&lt;p&gt;logging模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。logging模块是Python的一个标准库模块，由标准库模块提供日志记录API的关键好处是所有Python模块都可以使用这个日志记录功能。所以，你的应用日志可以将你自己的日志信息与来自第三方模块的信息整合起来。&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python模块之时间模块</title>
    <link href="https://gongzhao1.gitee.io/python%E6%A8%A1%E5%9D%97%E4%B9%8B%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9D%97/"/>
    <id>https://gongzhao1.gitee.io/python模块之时间模块/</id>
    <published>2020-03-15T07:53:22.000Z</published>
    <updated>2020-04-08T14:20:25.873Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://itopic.org/python-time-module.html" target="_blank" rel="noopener">https://itopic.org/python-time-module.html</a></li><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616</a></li><li><a href="https://blog.csdn.net/watfe/article/details/84943732" target="_blank" rel="noopener">https://blog.csdn.net/watfe/article/details/84943732</a></li></ul><a id="more"></a><h1 id="time模块"><a href="#time模块" class="headerlink" title="time模块"></a>time模块</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(time.__doc__)</span><br><span class="line"></span><br><span class="line">Functions:</span><br><span class="line"></span><br><span class="line">time() -- <span class="keyword">return</span> current time <span class="keyword">in</span> seconds since the Epoch <span class="keyword">as</span> a float</span><br><span class="line">clock() -- <span class="keyword">return</span> CPU time since process start <span class="keyword">as</span> a float</span><br><span class="line">sleep() -- delay <span class="keyword">for</span> a number of seconds given <span class="keyword">as</span> a float</span><br><span class="line">gmtime() -- convert seconds since Epoch to UTC tuple</span><br><span class="line">localtime() -- convert seconds since Epoch to local time tuple</span><br><span class="line">asctime() -- convert time tuple to string</span><br><span class="line">ctime() -- convert time <span class="keyword">in</span> seconds to string</span><br><span class="line">mktime() -- convert local time tuple to seconds since Epoch</span><br><span class="line">strftime() -- convert time tuple to string according to format specification</span><br><span class="line">strptime() -- parse string to time tuple according to format specification</span><br><span class="line">tzset() -- change the local timezone</span><br></pre></td></tr></table></figure><h2 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a>获取时间戳</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.time()</span><br><span class="line"><span class="number">1552827527.447389</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int(time.time())</span><br><span class="line"><span class="number">1552827538</span></span><br></pre></td></tr></table></figure><h2 id="停留x秒"><a href="#停留x秒" class="headerlink" title="停留x秒"></a>停留x秒</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> time.sleep.__doc__</span><br><span class="line">sleep(seconds)</span><br><span class="line"></span><br><span class="line">Delay execution <span class="keyword">for</span> a given number of seconds.  The argument may be</span><br><span class="line">a floating point number <span class="keyword">for</span> subsecond precision.</span><br></pre></td></tr></table></figure><h2 id="time与字符串互转"><a href="#time与字符串互转" class="headerlink" title="time与字符串互转"></a>time与字符串互转</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print time.strftime.__doc__</span><br><span class="line">strftime(format[, tuple]) -&gt; string</span><br><span class="line"></span><br><span class="line">Convert a time tuple to a string according to a format specification.</span><br><span class="line">See the library reference manual for formatting codes. When the time tuple</span><br><span class="line">is not present, current time as returned by localtime() is used.</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print time.strptime.__doc__</span><br><span class="line">strptime(string, format) -&gt; struct_time</span><br><span class="line"></span><br><span class="line">Parse a string to a time tuple according to a format specification.</span><br><span class="line">See the library reference manual for formatting codes (same as strftime()).</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 格式化成2016-03-20 11:45:39形式</span><br><span class="line">print (time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime()))</span><br><span class="line"></span><br><span class="line"># 格式化成Sat Mar 28 22:24:24 2016形式</span><br><span class="line">print (time.strftime(&quot;%a %b %d %H:%M:%S %Y&quot;, time.localtime()))</span><br><span class="line">  </span><br><span class="line"># 将格式字符串转换为时间戳</span><br><span class="line">a = &quot;Sat Mar 28 22:24:24 2016&quot;</span><br><span class="line">print (time.mktime(time.strptime(a,&quot;%a %b %d %H:%M:%S %Y&quot;)))</span><br></pre></td></tr></table></figure><h1 id="datetime模块"><a href="#datetime模块" class="headerlink" title="datetime模块"></a>datetime模块</h1><h2 id="获取当前日期和时间"><a href="#获取当前日期和时间" class="headerlink" title="获取当前日期和时间"></a>获取当前日期和时间</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now() <span class="comment"># 获取当前datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</span><br><span class="line"><span class="number">2015</span><span class="number">-05</span><span class="number">-18</span> <span class="number">16</span>:<span class="number">28</span>:<span class="number">07.198690</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(now))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>注意到<code>datetime</code>是模块，<code>datetime</code>模块还包含一个<code>datetime</code>类，通过<code>from datetime import datetime</code>导入的才是<code>datetime</code>这个类。</p><p>如果仅导入<code>import datetime</code>，则必须引用全名<code>datetime.datetime</code>。</p><p><code>datetime.now()</code>返回当前日期和时间，其类型是<code>datetime</code>。</p><h2 id="获取指定日期和时间"><a href="#获取指定日期和时间" class="headerlink" title="获取指定日期和时间"></a>获取指定日期和时间</h2><p>要指定某个日期和时间，我们直接用参数构造一个<code>datetime</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>) <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(dt)</span><br><span class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="datetime转换为timestamp"><a href="#datetime转换为timestamp" class="headerlink" title="datetime转换为timestamp"></a>datetime转换为timestamp</h2><p>在计算机中，时间实际上是用数字表示的。我们把1970年1月1日 00:00:00 UTC+00:00时区的时刻称为epoch time，记为<code>0</code>（1970年以前的时间timestamp为负数），当前时间就是相对于epoch time的秒数，称为timestamp。</p><p>你可以认为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestamp = <span class="number">0</span> = <span class="number">1970</span><span class="number">-1</span><span class="number">-1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> UTC+<span class="number">0</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><p>对应的北京时间是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestamp = 0 = 1970-1-1 08:00:00 UTC+8:00</span><br></pre></td></tr></table></figure><p>可见timestamp的值与时区毫无关系，因为timestamp一旦确定，其UTC时间就确定了，转换到任意时区的时间也是完全确定的，这就是为什么计算机存储的当前时间是以timestamp表示的，因为全球各地的计算机在任意时刻的timestamp都是完全相同的（假定时间已校准）。</p><p>把一个<code>datetime</code>类型转换为timestamp只需要简单调用<code>timestamp()</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>) <span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.timestamp() <span class="comment"># 把datetime转换为timestamp</span></span><br><span class="line"><span class="number">1429417200.0</span></span><br></pre></td></tr></table></figure><p>注意Python的timestamp是一个浮点数。如果有小数位，小数位表示毫秒数。</p><p>某些编程语言（如Java和JavaScript）的timestamp使用整数表示毫秒数，这种情况下只需要把timestamp除以1000就得到Python的浮点表示方法。</p><h2 id="timestamp转换为datetime"><a href="#timestamp转换为datetime" class="headerlink" title="timestamp转换为datetime"></a>timestamp转换为datetime</h2><p>要把timestamp转换为<code>datetime</code>，使用<code>datetime</code>提供的<code>fromtimestamp()</code>方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t = 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t))</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure><p>注意到timestamp是一个浮点数，它没有时区的概念，而datetime是有时区的。上述转换是在timestamp和本地时间做转换。</p><p>本地时间是指当前操作系统设定的时区。例如北京时区是东8区，则本地时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure><p>实际上就是UTC+8:00时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 12:20:00 UTC+8:00</span><br></pre></td></tr></table></figure><p>而此刻的格林威治标准时间与北京时间差了8小时，也就是UTC+0:00时区的时间应该是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-04-19 04:20:00 UTC+0:00</span><br></pre></td></tr></table></figure><p>timestamp也可以直接被转换到UTC标准时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t = 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t)) # 本地时间</span><br><span class="line">2015-04-19 12:20:00</span><br><span class="line">&gt;&gt;&gt; print(datetime.utcfromtimestamp(t)) # UTC时间</span><br><span class="line">2015-04-19 04:20:00</span><br></pre></td></tr></table></figure><h2 id="str转换为datetime"><a href="#str转换为datetime" class="headerlink" title="str转换为datetime"></a>str转换为datetime</h2><p>很多时候，用户输入的日期和时间是字符串，要处理日期和时间，首先必须把str转换为datetime。转换方法是通过<code>datetime.strptime()</code>实现，需要一个日期和时间的格式化字符串：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; cday = datetime.strptime(&apos;2015-6-1 18:19:59&apos;, &apos;%Y-%m-%d %H:%M:%S&apos;)</span><br><span class="line">&gt;&gt;&gt; print(cday)</span><br><span class="line">2015-06-01 18:19:59</span><br></pre></td></tr></table></figure><p>字符串<code>&#39;%Y-%m-%d %H:%M:%S&#39;</code>规定了日期和时间部分的格式。详细的说明请参考<a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" target="_blank" rel="noopener">Python文档</a>。</p><p>注意转换后的datetime是没有时区信息的。</p><h2 id="datetime转换为str"><a href="#datetime转换为str" class="headerlink" title="datetime转换为str"></a>datetime转换为str</h2><p>如果已经有了datetime对象，要把它格式化为字符串显示给用户，就需要转换为str，转换方法是通过<code>strftime()</code>实现的，同样需要一个日期和时间的格式化字符串：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; print(now.strftime(&apos;%a, %b %d %H:%M&apos;))</span><br><span class="line">Mon, May 05 16:28</span><br></pre></td></tr></table></figure><h2 id="datetime加减"><a href="#datetime加减" class="headerlink" title="datetime加减"></a>datetime加减</h2><p>对日期和时间进行加减实际上就是把datetime往后或往前计算，得到新的datetime。加减可以直接用<code>+</code>和<code>-</code>运算符，不过需要导入<code>timedelta</code>这个类：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(hours=10)</span><br><span class="line">datetime.datetime(2015, 5, 19, 2, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now - timedelta(days=1)</span><br><span class="line">datetime.datetime(2015, 5, 17, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(days=2, hours=12)</span><br><span class="line">datetime.datetime(2015, 5, 21, 4, 57, 3, 540997)</span><br></pre></td></tr></table></figure><p>可见，使用<code>timedelta</code>你可以很容易地算出前几天和后几天的时刻。</p><h2 id="本地时间转换为UTC时间"><a href="#本地时间转换为UTC时间" class="headerlink" title="本地时间转换为UTC时间"></a>本地时间转换为UTC时间</h2><p>本地时间是指系统设定时区的时间，例如北京时间是UTC+8:00时区的时间，而UTC时间指UTC+0:00时区的时间。</p><p>一个<code>datetime</code>类型有一个时区属性<code>tzinfo</code>，但是默认为<code>None</code>，所以无法区分这个<code>datetime</code>到底是哪个时区，除非强行给<code>datetime</code>设置一个时区：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta, timezone</span><br><span class="line">&gt;&gt;&gt; tz_utc_8 = timezone(timedelta(hours=8)) # 创建时区UTC+8:00</span><br><span class="line">&gt;&gt;&gt; now = datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 17, 2, 10, 871012)</span><br><span class="line">&gt;&gt;&gt; dt = now.replace(tzinfo=tz_utc_8) # 强制设置为UTC+8:00</span><br><span class="line">&gt;&gt;&gt; dt</span><br><span class="line">datetime.datetime(2015, 5, 18, 17, 2, 10, 871012, tzinfo=datetime.timezone(datetime.timedelta(0, 28800)))</span><br></pre></td></tr></table></figure><p>如果系统时区恰好是UTC+8:00，那么上述代码就是正确的，否则，不能强制设置为UTC+8:00时区。</p><p><strong>时区转换</strong></p><p>我们可以先通过<code>utcnow()</code>拿到当前的UTC时间，再转换为任意时区的时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 拿到UTC时间，并强制设置时区为UTC+0:00:</span><br><span class="line">&gt;&gt;&gt; utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">&gt;&gt;&gt; print(utc_dt)</span><br><span class="line">2015-05-18 09:05:12.377316+00:00</span><br><span class="line"># astimezone()将转换时区为北京时间:</span><br><span class="line">&gt;&gt;&gt; bj_dt = utc_dt.astimezone(timezone(timedelta(hours=8)))</span><br><span class="line">&gt;&gt;&gt; print(bj_dt)</span><br><span class="line">2015-05-18 17:05:12.377316+08:00</span><br><span class="line"># astimezone()将转换时区为东京时间:</span><br><span class="line">&gt;&gt;&gt; tokyo_dt = utc_dt.astimezone(timezone(timedelta(hours=9)))</span><br><span class="line">&gt;&gt;&gt; print(tokyo_dt)</span><br><span class="line">2015-05-18 18:05:12.377316+09:00</span><br><span class="line"># astimezone()将bj_dt转换时区为东京时间:</span><br><span class="line">&gt;&gt;&gt; tokyo_dt2 = bj_dt.astimezone(timezone(timedelta(hours=9)))</span><br><span class="line">&gt;&gt;&gt; print(tokyo_dt2)</span><br><span class="line">2015-05-18 18:05:12.377316+09:00</span><br></pre></td></tr></table></figure><p>时区转换的关键在于，拿到一个<code>datetime</code>时，要获知其正确的时区，然后强制设置时区，作为基准时间。</p><p>利用带时区的<code>datetime</code>，通过<code>astimezone()</code>方法，可以转换到任意时区。</p><p>注：不是必须从UTC+0:00时区转换到其他时区，任何带时区的<code>datetime</code>都可以正确转换，例如上述<code>bj_dt</code>到<code>tokyo_dt</code>的转换。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>datetime</code>表示的时间需要时区信息才能确定一个特定的时间，否则只能视为本地时间。</p><p>如果要存储<code>datetime</code>，最佳方法是将其转换为timestamp再存储，因为timestamp的值与时区完全无关。</p><h1 id="dateutil模块"><a href="#dateutil模块" class="headerlink" title="dateutil模块"></a>dateutil模块</h1><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-dateutil</span><br></pre></td></tr></table></figure><h2 id="parser"><a href="#parser" class="headerlink" title="parser"></a>parser</h2><p>parser是根据字符串解析成datetime,字符串可以很随意，可以用时间日期的英文单词，可以用横线、逗号、空格等做分隔符，可以包含时区。<br>没指定时间默认是0点，没指定日期默认是今天，没指定年份默认是今年。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"2018-10-21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"20181021"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"2018/10/21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"10-21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parse(<span class="string">"10/21"</span>)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2 id="rrule"><a href="#rrule" class="headerlink" title="rrule"></a>rrule</h2><p>rrule(self, freq, dtstart=None, interval=1, wkst=None,count=None, until=None, bysetpos=None,bymonth=None, bymonthday=None, byyearday=None, byeaster=None,byweekno=None, byweekday=None, byhour=None, byminute=None, bysecond=None,cache=False)</p><ul><li>freq:可以理解为单位。可以是 YEARLY, MONTHLY, WEEKLY,DAILY, HOURLY, MINUTELY, SECONDLY。即年月日周时分秒</li><li>dtstart,until:是开始和结束时间</li><li>wkst:周开始时间</li><li>interval:间隔</li><li>count:指定生成多少个</li><li>byxxx:指定匹配的周期。比如byweekday=(MO,TU)则只有周一周二的匹配。byweekday可以指定MO,TU,WE,TH,FR,SA,SU。即周一到周日。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil <span class="keyword">import</span> rrule</span><br><span class="line"></span><br><span class="line">生成一个连续的日期列表</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">间隔一天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,interval=<span class="number">2</span>,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只保留前<span class="number">3</span>个元素</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,count=<span class="number">3</span>,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只要周一的</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,byweekday=rrule.MO,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">只要周六和周日的</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.DAILY,byweekday=(rrule.SA,rrule.SU),dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-5'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">以月为间隔</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-7-30'</span>)))</span><br><span class="line">[datetime.datetime(<span class="number">2018</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>), </span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>)]</span><br></pre></td></tr></table></figure><p><strong>计算时间差</strong></p><p>rrule可计算出两个datetime对象间相差的年月日等时间数量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">两个日期相差<span class="number">10</span>天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=parse(<span class="string">'2018-11-10'</span>)).count()</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line">某个日期到今天相差多少天</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.DAILY,dtstart=parse(<span class="string">'2018-11-1'</span>),until=datetime.date.today()).count()</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>两个日期相差几个月<br>前一个月为m月，后一个月为n月，当日期不满整月时，差的月数按n-m算，当日期满整月后，差的月数按n-m+1算。<br>差的年数同月数的情况一样。<br>例子如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-11-10'</span>)).count()</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.MONTHLY,dtstart=parse(<span class="string">'2018-3-15'</span>),until=parse(<span class="string">'2018-11-20'</span>)).count()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.YEARLY,dtstart=parse(<span class="string">'2016-3-15'</span>),until=parse(<span class="string">'2018-2-10'</span>)).count()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rrule.rrule(rrule.YEARLY,dtstart=parse(<span class="string">'2016-3-15'</span>),until=parse(<span class="string">'2018-3-15'</span>)).count()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><h1 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h1><h2 id="当前时间转文本"><a href="#当前时间转文本" class="headerlink" title="当前时间转文本"></a>当前时间转文本</h2><p>无论是<code>time</code>或<code>datetime</code>，哪个模块都可以，具体怎么输出，自行调整格式参数<code>&#39;%Y-%m-%d %H:%M:%S&#39;</code></p><table><thead><tr><th>%字符</th><th>表意</th><th>数值范围</th></tr></thead><tbody><tr><td>%y</td><td>年(2位)</td><td>00, 01, …, 99</td></tr><tr><td>%Y</td><td>年(4位)</td><td>0001, 0002, …, 2013, 2014, …, 9998, 9999</td></tr><tr><td>%m</td><td>月</td><td>01, 02, …, 12</td></tr><tr><td>%d</td><td>日</td><td>01, 02, …, 31</td></tr><tr><td>%H</td><td>时(24小时制)</td><td>00, 01, …, 23</td></tr><tr><td>%M</td><td>分</td><td>00, 01, …, 59</td></tr><tr><td>%S</td><td>秒</td><td>00, 01, …, 59</td></tr><tr><td>%f</td><td>毫秒</td><td>000000, 000001, …, 999999</td></tr><tr><td>%z</td><td>时区</td><td>(empty), +0000, -0400, +1030, +063415, -030712.345216</td></tr></tbody></table><p>这里只列一下我用到的，更多可以看官方文档：<br><a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior" target="_blank" rel="noopener">https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior</a></p><p><strong>【注意】：time、datetime两种时间模块虽然都有strftime，但是(格式,时间)参数位置正好相反。</strong></p><p>time模块（格式在前，时间在后）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>,time.localtime())</span><br><span class="line">print(type(t),t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2019-05-25 08:</span><span class="number">56</span>:<span class="number">45</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p>datetime模块（格式在后，时间在前）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt = datetime.datetime.strftime(datetime.datetime.now(),<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2019-05-25 08:</span><span class="number">56</span>:<span class="number">45</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><h2 id="文本转日期"><a href="#文本转日期" class="headerlink" title="文本转日期"></a>文本转日期</h2><p><strong>常规方法<code>strptime(&quot;日期时间文本&quot;,&quot;文本格式&quot;)</code></strong></p><p>制定时间格式，进行解析</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt = datetime.datetime.strptime(<span class="string">'2019-05-25T07:46:45.743+0000'</span>,<span class="string">'%Y-%m-%dT%H:%M:%S.%f%z'</span>)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 07:</span><span class="number">46</span>:<span class="number">45.743000</span>+<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><p><strong>万能方法<code>parse(&quot;日期时间文本&quot;)</code></strong></p><p>自动解析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from dateutil.parser import parse</span><br><span class="line">dt = parse(&apos;2019-05-25 07:46:45&apos;)</span><br><span class="line">print(type(dt),dt)</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">&lt;class &apos;datetime.datetime&apos;&gt; 2019-05-25 07:46:45</span><br></pre></td></tr></table></figure><p>该方法适用于很多类型时间格式，建议使用前自行测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">dt = [&quot;2001.07.04 AD at 12:08:56 PDT&quot;,</span><br><span class="line">&quot;Wed, 4 Jul 2001 12:08:56 -0700&quot;,</span><br><span class="line">&quot;190525&quot;,&quot;2018-08-06T10:00:00.000Z&quot;,</span><br><span class="line">&quot;Wed, Jul 4&quot;,</span><br><span class="line">&quot;12:08 PM&quot;,</span><br><span class="line">&quot;02001.July.04 AD 12:08 PM&quot;,</span><br><span class="line">&quot;20190525083855-0700&quot;,</span><br><span class="line">&quot;2001-07-04T12:08:56.235-0700&quot;,</span><br><span class="line">&quot;Thu Oct 16 07:13:48 GMT 2014&quot;]</span><br><span class="line"></span><br><span class="line">for i in dt:</span><br><span class="line">print(parse(i))</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">2001-07-04 12:08:56</span><br><span class="line">2001-07-04 12:08:56-07:00</span><br><span class="line">2025-05-19 00:00:00</span><br><span class="line">2018-08-06 10:00:00+00:00</span><br><span class="line">2019-07-04 00:00:00</span><br><span class="line">2019-05-25 12:08:00</span><br><span class="line">2001-07-04 12:08:00</span><br><span class="line">2019-05-25 08:38:55-07:00</span><br><span class="line">2001-07-04 12:08:56.235000-07:00</span><br><span class="line">2014-10-16 07:13:48+00:00</span><br></pre></td></tr></table></figure><p>但是注意，国外日期时间的常用格式和国内不一样。单写<code>19-05-25</code>会被解析成<code>2025年5月19日</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(parse(<span class="string">"19-05-25"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="number">2025</span><span class="number">-05</span><span class="number">-19</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure><p>如果是<code>2019-05-25</code>就不会错了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(parse(<span class="string">"2019-05-25"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="时间戳相关"><a href="#时间戳相关" class="headerlink" title="时间戳相关"></a>时间戳相关</h2><p>生成10或13位时间戳（做一些网页爬虫或构造提交时候可能用到）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t = time.time()</span><br><span class="line">print(type(t),t)</span><br><span class="line">print(<span class="string">'10位时间戳:'</span>,str(int(t)))</span><br><span class="line">print(<span class="string">'13位时间戳:'</span>,str(int(t*<span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">float</span>'&gt; 1558750679.0872486</span></span><br><span class="line"><span class="class">10位时间戳:</span> <span class="number">1558750679</span></span><br><span class="line"><span class="number">13</span>位时间戳: <span class="number">1558750679087</span></span><br><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure><p>时间戳转日期时间（10位或13位通用）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">ts = <span class="string">'1517302458364'</span> <span class="comment"># 该值为int或string类型均可</span></span><br><span class="line">dt1 = datetime.datetime.fromtimestamp(float(ts)/<span class="number">10</span>**(len(str(ts))<span class="number">-10</span>))</span><br><span class="line">print(type(dt1),dt1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2018-01-30 16:</span><span class="number">54</span>:<span class="number">18.364000</span></span><br></pre></td></tr></table></figure><h2 id="时间差计算"><a href="#时间差计算" class="headerlink" title="时间差计算"></a>时间差计算</h2><p>如果是两个<code>datatime</code>格式的日期，直接计算一下差值即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">dt1 = datetime.datetime.fromtimestamp(<span class="number">1517302458</span>)</span><br><span class="line">dt2 = datetime.datetime.now()</span><br><span class="line"><span class="comment">#print(type(dt1),dt1)</span></span><br><span class="line"><span class="comment">#print(type(dt2),dt2)</span></span><br><span class="line">td = dt2-dt1</span><br><span class="line"><span class="comment">#print(type(td),td)</span></span><br><span class="line">output = <span class="string">'相差%d天%.1f小时'</span>%(td.days,td.seconds/<span class="number">60</span>/<span class="number">60</span>)</span><br><span class="line">print(output)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2018-01-30 16:</span><span class="number">54</span>:<span class="number">18</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-12-16 16:</span><span class="number">18</span>:<span class="number">37.443000</span></span><br><span class="line">&lt;class 'datetime.timedelta'&gt; 684 days, 23:24:19.443000</span><br><span class="line">相差<span class="number">684</span>天<span class="number">23.4</span>小时</span><br><span class="line"><span class="number">123456789101112131415</span></span><br></pre></td></tr></table></figure><p>如果是两个文本格式的日期，用<code>parse()</code>转换成<code>datetime</code>，同样计算差值即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line">arr = [<span class="string">'2018-01-30 16:54:18'</span>,<span class="string">'2019-12-16 16:18:37'</span>]</span><br><span class="line">td = parse(arr[<span class="number">1</span>])-parse(arr[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'相差%d天%.1f小时'</span>%(td.days,td.seconds/<span class="number">60</span>/<span class="number">60</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">相差<span class="number">684</span>天<span class="number">23.4</span>小时</span><br></pre></td></tr></table></figure><h2 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h2><p>直接获取0时区的<code>datetime</code>，并转化为东8区<code>datetime</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line">dt0 = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">dt8 = dt0.astimezone(timezone(timedelta(hours=<span class="number">8</span>))) <span class="comment"># 转换时区到东八区</span></span><br><span class="line">print(<span class="string">'UTC协调世界时 \t%s\nUTC+8北京时间\t%s'</span>%(dt0,dt8))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">UTC协调世界时 <span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">02</span>:<span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">UTC+<span class="number">8</span>北京时间<span class="number">2019</span><span class="number">-05</span><span class="number">-25</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="number">12345678</span></span><br></pre></td></tr></table></figure><p>如果是想将文本格式的<code>2019-05-25T02:48:54.281741+00:00</code>转化到东8区<code>datetime</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</span><br><span class="line">dt0_str = <span class="string">'2019-05-25T02:48:54.281741+00:00'</span></span><br><span class="line">dt0 = parse(dt0_str)</span><br><span class="line">dt8 = dt0.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</span><br><span class="line">print(type(dt0),dt0)</span><br><span class="line">print(type(dt8),dt8)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 02:</span><span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt; 2019-05-25 10:</span><span class="number">48</span>:<span class="number">54.281741</span>+<span class="number">08</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><h2 id="获取常用时间"><a href="#获取常用时间" class="headerlink" title="获取常用时间"></a>获取常用时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from datetime import datetime, timedelta</span><br><span class="line"></span><br><span class="line">t1 = datetime.now()</span><br><span class="line"></span><br><span class="line"># 获取本月第一天</span><br><span class="line">t2 = datetime(t1.year, t1.month, 1)</span><br><span class="line">print(t2.strftime(&quot;%Y-%m-%d&quot;))</span><br><span class="line"></span><br><span class="line"># 本月最后一天</span><br><span class="line">t3 = datetime(year=t1.year, month=t1.month+1, day=1) - timedelta(days=1)</span><br><span class="line">print(t3.strftime(&quot;%Y-%m-%d&quot;))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://itopic.org/python-time-module.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://itopic.org/python-time-module.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/watfe/article/details/84943732&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/watfe/article/details/84943732&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="python" scheme="https://gongzhao1.gitee.io/categories/python/"/>
    
    
      <category term="python" scheme="https://gongzhao1.gitee.io/tags/python/"/>
    
  </entry>
  
</feed>
